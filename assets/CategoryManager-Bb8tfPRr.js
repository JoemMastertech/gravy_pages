import{L as p,n as f,a as g,f as _,T as b,D as h,d as E,i as k,b as x,c as q,g as N}from"./index-o0JHZoss.js";const L="/assets/no-image.png";class P{async render(t,e,a){p.info("üü¶ GridView: Rendering...",{count:e.length,context:a});const{fields:s,categoryTitle:r,categorySlug:o}=a,n=document.createElement("div");n.className="grid-view-container u-flex-column u-flex-align-c";const c=document.createElement("div");c.className="product-grid";const i=o||f(r);c.dataset.category=i,this._applyGridType(c,i),this._createTitle(n,r),e.forEach(d=>{const u=this.createProductCard(d,s,i);c.appendChild(u)}),n.appendChild(c),t.appendChild(n),this._retranslateIfNeeded(t)}_applyGridType(t,e){let a;const s=["pizza","alita","sopa","ensalada","carne","plato","snack","cafe","postre","cocktail","cocteleria"],r=["refresco","cerveza","jugo","jarra","vaso","licor","whisky","tequila","ron","vodka","ginebra","mezcal","cognac","brandy","digestivo","espumoso"];s.some(o=>e.includes(o))?a="food":r.some(o=>e.includes(o))?(a="beverage",t.classList.add("sys-grid-vertical")):a="unknown",t.dataset.productType=a}_createTitle(t,e){const a=document.createElement("h2");a.className="page-title",a.textContent=e,e&&(a.setAttribute("data-translate",e),a.setAttribute("data-original-text",e),a.setAttribute("data-namespace","category.title")),t.appendChild(a)}createProductCard(t,e,a){const s=document.createElement("div");s.className="product-card";const r=t.id||t.producto_id||t.product_id;r&&(s.dataset.productId=r);const o=t.codigo||t.sku||t.product_code;return o&&(s.dataset.productCode=o),this._appendName(s,t),this._appendIngredients(s,t),this._appendMedia(s,t,a),this._applyCardClasses(s,t,a),this._appendPrices(s,t,e,a),s}_appendName(t,e){const a=document.createElement("div");a.className="product-name",a.textContent=e.nombre;const s=`product-name_${g((e.nombre||"").trim())}`;a.setAttribute("data-translate",s),a.setAttribute("data-namespace","products"),a.setAttribute("data-original-text",e.nombre||""),t.appendChild(a)}_appendIngredients(t,e){if(e.ingredientes){const a=document.createElement("div");a.className="product-ingredients",a.textContent=e.ingredientes;const s=`product-ingredients_${g((e.ingredientes||"").trim())}`;a.setAttribute("data-translate",s),a.setAttribute("data-namespace","products"),a.setAttribute("data-original-text",e.ingredientes||""),t.appendChild(a)}}_appendMedia(t,e,a){const s=document.createElement("div");s.className="product-media";const n=["cervezas","refrescos","licores","whisky","tequila","ron","vodka","ginebra","mezcal","cognac","brandy","digestivos","espumosos"].includes(a)?e.thumbnail||e.imagen:e.thumbnail||e.imagen||e.ruta_archivo;e.video?this._renderVideoThumbnail(s,e,n):n&&this._renderImage(s,t,e,n),t.appendChild(s)}_renderVideoThumbnail(t,e,a){const s=e.video,r=a||L,o=document.createElement("img");o.className="video-thumbnail",o.loading="lazy",o.decoding="async",o.src=r,o.alt=`Video de ${e.nombre}`,o.dataset.videoUrl=s,o.onerror=function(){this.dataset.fallenBack||(this.dataset.fallenBack="true",p.warn(`Video Thumbnail failed: ${this.src}`))},t.appendChild(o)}_renderImage(t,e,a,s){const r=document.createElement("img");r.className="product-image",r.loading="lazy",r.decoding="async",r.alt=a.nombre,r.onload=function(){this.naturalHeight>this.naturalWidth&&e.classList.add("sys-card-vertical")},r.src=s,t.appendChild(r)}_applyCardClasses(t,e,a){const r=["whisky","tequila","ron","vodka","ginebra","mezcal","cognac","brandy","digestivos","espumosos"].includes(a);!e.ingredientes?t.classList.add("sys-card-vertical"):t.classList.add("sys-card-standard"),r?(t.classList.add("liquor-card"),t.dataset.productType="liquor",t.dataset.category=a):a==="alitas"&&t.classList.add("variant-card")}_appendPrices(t,e,a,s){const r=document.createElement("div");r.className="product-prices";const n=["whisky","tequila","ron","vodka","ginebra","mezcal","cognac","brandy","digestivos","espumosos"].includes(s);this._renderCardPrices(r,e,a,n,s),t.appendChild(r)}_renderCardPrices(t,e,a,s,r){if(s){[{key:"precioBotella",label:"Botella"},{key:"precioLitro",label:"Litro"},{key:"precioCopa",label:"Copa"}].forEach(n=>{const c=e[n.key];c&&c!=="--"&&c!=="0"&&c!==0&&this._createPriceItemRow(t,n.label,c,e,n.key,r)});return}if(r==="alitas"){a.forEach(o=>{if(o.includes("_piezas")&&e[o]){const c=`${o.replace("precio_","").replace("_piezas","")} piezas`;this._createPriceItemRow(t,c,e[o],e,o,r)}});return}a.forEach(o=>{if((o.includes("precio")||o==="precio")&&e[o]){const n=this._createPriceButton(e[o],e,o,r);t.appendChild(n)}})}_createPriceItemRow(t,e,a,s,r,o){const n=document.createElement("div");n.className="price-item";const c=document.createElement("span");c.className="price-label",c.textContent=e+":";const i=this._createPriceButton(a,s,r,o);n.appendChild(c),n.appendChild(i),t.appendChild(n)}_createPriceButton(t,e,a,s){const r=document.createElement("button");if(!t||t==="--"||t==="0"||t===0)return r.textContent="--",r.className="btn btn-ghost price-button non-selectable",r.disabled=!0,r;r.className="btn btn-contrast price-button",r.textContent=_(t);const o=e.id||e.producto_id||e.product_id,n=e.codigo||e.sku||e.product_code;r.dataset.productName=e.nombre,r.dataset.price=t,r.dataset.field=a,o&&(r.dataset.productId=o),n&&(r.dataset.productCode=n),s&&(r.dataset.category=s);let c=null;if(a==="precioBotella"||a==="precio_botella"?c=e.mixersBotella||e.mixers_botella:a==="precioLitro"||a==="precio_litro"?c=e.mixersLitro||e.mixers_litro:(a==="precioCopa"||a==="precio_copa")&&(c=e.mixersCopa||e.mixers_copa),c){const i=typeof c=="string"?c:JSON.stringify(c);i!=="[]"&&i!=="null"&&i!=='""'&&(r.dataset.mixers=i)}return r}_retranslateIfNeeded(t){try{const e=b.getCurrentLanguage();if(e&&e!=="es"){const a=t||document;typeof h.translateElement=="function"?a.querySelectorAll("[data-translate], [data-translate-placeholder]").forEach(r=>h.translateElement(r,e)):typeof b.translatePage=="function"&&b.translatePage(e)}}catch(e){p.warn("Translation reapply failed:",e)}}}const A="/assets/no-image.png";class I{async render(t,e,a){p.info("üìÑ TableView: Rendering...",{count:e.length,context:a});const{fields:s,categoryTitle:r,categorySlug:o}=a,n=a.headers||[],c=a.tableClass||"standard-table",i=document.createElement("div");i.className="grid-view-container u-flex-column u-flex-align-c";const d=this._createTableElement(c,r,o);if(n&&n.length>0){const y=document.createElement("colgroup");n.forEach(()=>{const v=document.createElement("col");y.appendChild(v)}),d.appendChild(y)}const u=n&&n.length?n.length:1,l=this._createTitleRow(r,u),m=this._createTableHeader(n||[],l),w=this._createTableBody(e||[],s||[],r,n||[]);d.appendChild(m),d.appendChild(w),i.appendChild(d),t.appendChild(i),this._retranslateIfNeeded(t)}_createTableElement(t,e,a){const s=document.createElement("table");s.className=`${t} u-full-width`;const r=a||f(e);return s.dataset.category=r,s.dataset.productType=E(r,t,e),s}_createTitleRow(t,e){const a=document.createElement("tr");a.className="title-row";const s=document.createElement("td");s.colSpan=e;const r=document.createElement("h2");if(r.className="page-title",r.textContent=t,t){const o=`category-title_${g((t||"").trim())}`;r.setAttribute("data-translate",o),r.setAttribute("data-original-text",t),r.setAttribute("data-namespace","category.title")}return s.appendChild(r),a.appendChild(s),a}_createTableHeader(t,e){const a=document.createElement("thead");a.appendChild(e);const s=document.createElement("tr");return s.setAttribute("data-nombre-column","true"),t.forEach(r=>{const o=document.createElement("th");if(o.textContent=r,r){const n=`table-header_${g((r||"").trim())}`;o.setAttribute("data-translate",n),o.setAttribute("data-original-text",r),o.setAttribute("data-namespace","table.header")}r==="NOMBRE"&&o.setAttribute("data-nombre-header","true"),s.appendChild(o)}),a.appendChild(s),a}_createTableBody(t,e,a,s){const r=document.createElement("tbody");return t.forEach(o=>{const n=this._createTableRow(o,e,a,s);r.appendChild(n)}),r}_createTableRow(t,e,a,s){const r=document.createElement("tr"),o=t.id||t.producto_id||t.product_id;o&&(r.dataset.productId=o);const n=t.codigo||t.sku||t.product_code;n&&(r.dataset.productCode=n);const c=s?s.length:e.length;return e.slice(0,c).forEach(d=>{const u=this._createTableCell(t,d,a);r.appendChild(u)}),e.length>c&&console.debug(`[TableView] Dropped ${e.length-c} extra fields for ${a}`),r}_createTableCell(t,e,a){const s=document.createElement("td");return e==="nombre"?this._createNameCell(s,t[e]):e==="ingredientes"?this._createIngredientsCell(s,t[e]):e==="precios"?this._createStackedPriceCell(s,t,a):e==="precios_alitas"?this._createAlitasPriceCell(s,t,a):k(e)?this._createPriceCell(s,t,e,a):e==="video"?this._createVideoCell(s,t,a):e==="imagen"||e==="ruta_archivo"?this._createImageCell(s,t,e,a):s.textContent=t[e]||"",s}_createNameCell(t,e){t.className="product-name",t.textContent=e;const a=`product-name_${g((e||"").trim())}`;t.setAttribute("data-translate",a),t.setAttribute("data-namespace","products"),t.setAttribute("data-original-text",e||"")}_createIngredientsCell(t,e){if(t.className="product-ingredients",t.textContent=e||"",e){const a=`product-ingredients_${g((e||"").trim())}`;t.setAttribute("data-translate",a),t.setAttribute("data-namespace","products"),t.setAttribute("data-original-text",e||"")}}_createVideoCell(t,e,a){if(t.className="video-icon",e.video){const s=e.video,r=e.thumbnail||e.imagen||e.ruta_archivo||A,o=document.createElement("img");o.className="video-thumb",o.loading="lazy",o.decoding="async",o.src=r,o.alt=`Ver video de ${e.nombre}`,o.dataset.videoUrl=s,o.onerror=function(){this.dataset.fallenBack||(this.dataset.fallenBack="true",p.warn(`Thumbnail failed: ${this.src}`))},t.appendChild(o)}else t.textContent="--"}_createImageCell(t,e,a,s){t.className="image-icon";const r=e.thumbnail||e[a]||e.imagen||e.ruta_archivo;if(r){const o=document.createElement("img");o.loading="lazy",o.decoding="async",o.src=r,o.alt=e.nombre;const n=["cervezas","refrescos","licores","whisky","tequila","ron","vodka","ginebra","mezcal","cognac","brandy","digestivos","espumosos"],c=f(s),i=n.includes(c);o.className=i?"product-image ratio-1-1":"product-image",t.appendChild(o)}else t.textContent="--"}_createStackedPriceCell(t,e,a){const s=[{key:"precioBotella",label:"Botella",mixerField:"mixersBotella"},{key:"precioLitro",label:"Litro",mixerField:"mixersLitro"},{key:"precioCopa",label:"Copa",mixerField:"mixersCopa"}];this._createMultiPriceCell(t,e,s,a)}_createAlitasPriceCell(t,e,a){const s=[{key:"precio_10_piezas",label:"10 pzas"},{key:"precio_25_piezas",label:"25 pzas"}];this._createMultiPriceCell(t,e,s,a)}_createMultiPriceCell(t,e,a,s){t.className="stacked-price-cell";const r=document.createElement("div");r.className="stacked-price-container";const o=e.id||e.producto_id||e.product_id,n=e.codigo||e.sku||e.product_code;a.forEach(c=>{const i=e[c.key];if(i&&i!=="0"&&i!=="--"&&i!==0){const d=document.createElement("div");d.className="price-chip";const u=document.createElement("span");u.className="price-label-mini",u.textContent=c.label;const l=document.createElement("button");if(l.className="btn btn-contrast price-button mobile-optimized",l.textContent=_(i),l.dataset.productName=e.nombre,l.dataset.price=i,l.dataset.field=c.key,s&&(l.dataset.category=s),o&&(l.dataset.productId=o),n&&(l.dataset.productCode=n),c.mixerField&&e[c.mixerField]){const m=e[c.mixerField];Array.isArray(m)&&m.length>0&&(l.dataset.mixers=JSON.stringify(m))}d.appendChild(u),d.appendChild(l),r.appendChild(d)}}),t.appendChild(r)}_createPriceCell(t,e,a,s){t.className="product-price";const r=this._createPriceButton(e[a],e,a,s);t.appendChild(r)}_createPriceButton(t,e,a,s){const r=document.createElement("button");if(!t||t==="--"||t==="0"||t===0)return r.textContent="--",r.className="btn btn-ghost price-button non-selectable",r.disabled=!0,r;r.className="btn btn-contrast price-button",r.textContent=_(t);const o=e.id||e.producto_id||e.product_id,n=e.codigo||e.sku||e.product_code;r.dataset.productName=e.nombre,r.dataset.price=t,r.dataset.field=a,o&&(r.dataset.productId=o),n&&(r.dataset.productCode=n),s&&(r.dataset.category=s);let c=null;if(a==="precioBotella"||a==="precio_botella"?c=e.mixersBotella||e.mixers_botella:a==="precioLitro"||a==="precio_litro"?c=e.mixersLitro||e.mixers_litro:(a==="precioCopa"||a==="precio_copa")&&(c=e.mixersCopa||e.mixers_copa),c){const i=typeof c=="string"?c:JSON.stringify(c);i!=="[]"&&i!=="null"&&i!=='""'&&(r.dataset.mixers=i)}return r}_retranslateIfNeeded(t){try{const e=b.getCurrentLanguage();if(e&&e!=="es"){const a=t||document;typeof h.translateElement=="function"?a.querySelectorAll("[data-translate], [data-translate-placeholder]").forEach(r=>h.translateElement(r,e)):typeof b.translatePage=="function"&&b.translatePage(e)}}catch(e){p.warn("Translation reapply failed:",e)}}}class T{constructor(){this.strategies={grid:new P,table:new I}}async render(t,e,a){const s=x.currentViewMode||"grid";p.debug(`üé® ProductRenderer: Rendering ${a.categorySlug} in ${s} mode`);try{const r=this.strategies[s];if(!r)throw new Error(`Unknown view mode: ${s}`);if(this._prepareContainer(t,a),Array.isArray(e))await r.render(t,e,a);else if(typeof e=="object"&&e!==null){p.info(`[ProductRenderer] Detected Grouped Data. Rendering ${Object.keys(e).length} sections.`);for(const[o,n]of Object.entries(e)){const c={...a,categoryTitle:o};await r.render(t,n,c)}}else throw new Error("Invalid data format: Expected Array or Grouped Object");this._postRender(t)}catch(r){p.error("‚ùå ProductRenderer Error:",r),t.innerHTML=`<div class="error-message">Error rendering view: ${r.message}</div>`}}_prepareContainer(t,e){t&&(t.innerHTML="",p.debug(`[ProductRenderer] Container cleared for ${e.categorySlug}`))}_postRender(t){}}class ${constructor(){this.renderer=new T,this.repository=q()}async loadCategory(t,e){p.info(`üìÇ CategoryManager: Loading ${e}...`);const a=N(e);let{appConfig:s,categoryTitle:r}=this._resolveConfig(e);if(s&&p.info(`[CategoryManager] Using standardized header for ${e}: "${r}"`),e==="licores"){await this._renderLiquorHub(t,r);return}let o;try{o=await this._fetchData(e)}catch(u){p.error(`Error fetching data for ${e}:`,u),t.innerHTML=`<p>Error cargando ${r}. Por favor, intente de nuevo.</p>`;return}const n=this._processSegmentedData(o,r),c=a.fields||["nombre","imagen","precio"],i=a.headers||["NOMBRE","IMAGEN","PRECIO"],d={categoryTitle:r,categorySlug:e,fields:c,headers:i,tableClass:a.modalType==="drink-options"?"liquor-table":"standard-table"};await this.renderer.render(t,n,d)}async _renderLiquorHub(t,e){p.info("Rendering Liquor Subcategory Hub");try{let a=await this.repository.getLicoresCategories();(!a||a.length===0)&&(p.warn("No dynamic liquor categories found. Using verified fallback list."),a=[{nombre:"Tequila",slug:"tequila",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/webp%20animado/tequila/don_julio_70_1.webp"},{nombre:"Whisky",slug:"whisky",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/webp%20animado/whisky/buchanans_12.webp"},{nombre:"Vodka",slug:"vodka",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/webp%20animado/vodka/absolut_azul.webp"},{nombre:"Ron",slug:"ron",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/webp%20animado/ron/bacardi_blanco1.webp"},{nombre:"Ginebra",slug:"ginebra",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/webp%20animado/ginebra/hendrix2.webp"},{nombre:"Mezcal",slug:"mezcal",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/webp%20animado/mezcal/400_conejos1.webp"},{nombre:"Brandy",slug:"brandy",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/webp%20animado/brandy/torres_X1.webp"},{nombre:"Cognac",slug:"cognac",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/webp%20animado/cognac/henessy1.webp"},{nombre:"Digestivos",slug:"digestivos",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/webp%20animado/digestivos/licor_43_1.webp"},{nombre:"Espumosos",slug:"espumosos",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/webp%20animado/espumosos/chandon_delice1.webp"}]);const s=`
                <div class="grid-view-container u-p-xl">
                    <h2 class="page-title">${e}</h2>
                    <div class="category-grid sys-grid-5" data-category="licores">
                        ${a.map(r=>{const o=r.nombre||r.name,n=r.imagen||r.image||r.icono;return`
                                <div class="category-card" data-target="${r.slug||o.toLowerCase().replace(/\s+/g,"_")}">
                                     <img src="${n}" alt="${o}" class="category-image" loading="lazy" style="pointer-events: none;">
                                     <h3 class="category-name">${o}</h3>
                                </div>
                            `}).join("")}
                    </div>
                </div>
            `;t.innerHTML=s}catch(a){p.error("Error rendering Liquor Hub:",a),t.innerHTML="<p>Error cargando men√∫ de licores.</p>"}}_resolveConfig(t){const e=window.AppInit?.modules?.get("appConfig"),a=e?.getCategoryConfig(t);let s=a?.header;return(!s||s.trim().toLowerCase()==="men√∫")&&(s=a?.label||t.charAt(0).toUpperCase()+t.slice(1).replace(/_/g," ")),{appConfig:e,interfaceConfig:a,categoryTitle:s}}_processSegmentedData(t,e){if(!t||t.length===0)return{};const a={};t.forEach(n=>{const c=(n.titulo||e).trim();a[c]||(a[c]=[]),a[c].push(n)});const r=Object.keys(a).sort((n,c)=>{const i=n.toLowerCase(),d=c.toLowerCase();if(e&&e.toLowerCase().includes("refrescos")){const u=l=>l==="refrescos"?1:l.includes("jarra")?2:l.includes("vaso")?3:4;return u(i)-u(d)}return i.localeCompare(d)}),o={};return r.forEach(n=>{o[n]=a[n]}),o}async _fetchData(t){const e=t.toLowerCase().trim().replace(/\s+/g,"_"),s={platos_fuertes:"getPlatosFuertes","platos-fuertes":"getPlatosFuertes","platos fuertes":"getPlatosFuertes",cocteleria:"getCocteles",snacks:"getSnacks",pizzas:"getPizzas",alitas:"getAlitas",cervezas:"getCervezas",refrescos:"getRefrescos",cafe:"getCafe",postres:"getPostres",cortes_de_carne:"getCortesDeCarne","cortes-de-carne":"getCortesDeCarne"}[e]||`get${e.charAt(0).toUpperCase()+e.slice(1).replace(/_([a-z])/g,r=>r[1].toUpperCase())}`;return typeof this.repository[s]=="function"?await this.repository[s]():await this.repository.getLiquorSubcategory(t)}}export{$ as CategoryManager};
