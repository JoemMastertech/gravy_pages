class r{constructor(){if(r.instance)return r.instance;this.body=document.body,this.overlay=this._createOverlay(),this.activeSidebars=new Set,this.appContainer=document.querySelector(".app-container"),this.config={desktopBreakpoint:1280,openAttribute:"data-sidebar-state",openValue:"open",persistentSidebars:["order-sidebar","side-panel","property-editor-sidebar"],landscapeBreakpoint:640},this._bindGlobalEvents(),r.instance=this}_createOverlay(){let e=document.querySelector(".sidebar-backdrop");return e||(e=document.createElement("div"),e.className="sidebar-backdrop u-hidden",document.body.appendChild(e)),e.setAttribute("aria-hidden","true"),e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.closeAll()}),e}_bindGlobalEvents(){document.addEventListener("keydown",e=>{e.key==="Escape"&&this.activeSidebars.size>0&&this.closeAll()})}_isPersistent(e){if(!e||!this.config.persistentSidebars.includes(e))return!1;const i=window.innerWidth>=this.config.desktopBreakpoint,n=window.innerWidth>=this.config.landscapeBreakpoint&&window.matchMedia("(orientation: landscape)").matches;return i||n}open(e,t={}){console.log(`[SidebarManager] open('${e}') called. Mobile=${window.innerWidth<this.config.desktopBreakpoint}. Non-Blocking=${!!t.disableBackdrop}`),this.overlay||(this.overlay=this._createOverlay()),this.appContainer||(this.appContainer=document.querySelector(".app-container"));const i=document.getElementById(e);if(!i){console.error(`[SidebarManager] ID #${e} not found in DOM.`);return}this.currentOptions=t,t.disableBackdrop||this.closeAll(),this.activeSidebars.add(e),this.lastOpenTime=Date.now(),i.classList.add("active","is-open"),document.body.classList.add("sidebar-open"),this._updateEnvironment(!0,e),t.closeOnClickOutside&&t.triggerId&&this._bindOutsideClick(e,t.triggerId),this._emitEvent("sidebar:open",{id:e,options:t})}_bindOutsideClick(e,t){setTimeout(()=>{const i=n=>{const s=document.getElementById(e),o=document.getElementById(t),a=s&&s.contains(n.target),c=o&&o.contains(n.target);!a&&!c&&(this.close(e),document.removeEventListener("click",i))};this._outsideHandlers=this._outsideHandlers||{},this._outsideHandlers[e]=i,document.addEventListener("click",i)},50)}close(e,t=!1){if(e||(e=Array.from(this.activeSidebars).pop()),!e)return;if(!t&&this._isPersistent(e)){console.warn(`[SidebarManager] Persistent sidebar ${e} requires force=true to close.`);return}console.log(`[SidebarManager] Closing ${e}`);const i=document.getElementById(e);i&&i.classList.remove("active","is-open"),this.activeSidebars.delete(e),this.activeSidebars.size===0&&this.body.classList.remove("sidebar-open"),this._updateEnvironment(!1,e),this._outsideHandlers&&this._outsideHandlers[e]&&(document.removeEventListener("click",this._outsideHandlers[e]),delete this._outsideHandlers[e]),this._emitEvent("sidebar:close",{id:e})}closeAll(e=!1){this.activeSidebars.forEach(t=>this.close(t,e))}toggle(e,t={}){const i=Date.now();this.lastToggleTime&&i-this.lastToggleTime<300||(this.lastToggleTime=i,console.log(`[SidebarManager] toggle('${e}'). ActiveSet:`,this.activeSidebars),this.activeSidebars.has(e)?this.close(e):this.open(e,t))}_updateEnvironment(e,t){const i=this._isPersistent(t),n=this.currentOptions?.disableBackdrop||!1;if(e)if(this.body.classList.add("sidebar-open"),i){if(this.appContainer){const s=t==="property-editor-sidebar"?"editor-mode":this.config.openValue;this.appContainer.setAttribute(this.config.openAttribute,s)}this.overlay.classList.remove("u-block","active"),this.overlay.classList.add("u-hidden")}else if(n)this.appContainer&&t==="property-editor-sidebar"&&this.appContainer.setAttribute(this.config.openAttribute,"editor-mode"),this.overlay.classList.remove("u-block","active"),this.overlay.classList.add("u-hidden"),this.body.classList.remove("sidebar-open");else{this.overlay.classList.remove("u-hidden"),this.overlay.classList.add("u-block","active");const s=this.config.persistentSidebars.find(a=>document.getElementById(a)?.classList.contains("active")),o=window.innerWidth>=this.config.desktopBreakpoint&&s;this.appContainer&&!o&&this.appContainer.removeAttribute(this.config.openAttribute)}else{this.body.classList.remove("sidebar-open"),this.overlay.classList.remove("u-block","active"),this.overlay.classList.add("u-hidden");const s=this.config.persistentSidebars.find(d=>document.getElementById(d)?.classList.contains("active")),o=window.innerWidth>=this.config.desktopBreakpoint,a=window.innerWidth>=this.config.landscapeBreakpoint&&window.matchMedia("(orientation: landscape)").matches,c=(o||a)&&s;this.appContainer&&!c&&this.appContainer.removeAttribute(this.config.openAttribute)}}_emitEvent(e,t){window.dispatchEvent(new CustomEvent(e,{detail:t}))}}const l=new r;export{l as default};
