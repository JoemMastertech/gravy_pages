const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginModal-8pR5BUzO.js","assets/AuthService-BxOLs-0-.js","assets/OrderDrawer-BWVmZfwH.js","assets/SidebarManager-BcOD6Mmh.js","assets/PropertyEditor-BRS94YcV.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const xi="modulepreload",Mi=function(r){return"/gravy_pages/"+r},Lr={},A=function(e,t,o){let i=Promise.resolve();if(t&&t.length>0){let c=function(l){return Promise.all(l.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");i=c(t.map(l=>{if(l=Mi(l),l in Lr)return;Lr[l]=!0;const d=l.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":xi,d||(p.as="script"),p.crossOrigin="",p.href=l,a&&p.setAttribute("nonce",a),document.head.appendChild(p),d)return new Promise((g,f)=>{p.addEventListener("load",g),p.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return i.then(s=>{for(const a of s||[])a.status==="rejected"&&n(a.reason);return e().catch(n)})},Bi=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>A(async()=>{const{default:o}=await Promise.resolve().then(()=>Ye);return{default:o}},void 0).then(({default:o})=>o(...t)):e=fetch,(...t)=>e(...t)};class fr extends Error{constructor(e,t="FunctionsError",o){super(e),this.name=t,this.context=o}}class Pr extends fr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class jr extends fr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Rr extends fr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Kt;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Kt||(Kt={}));var Ui=function(r,e,t,o){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function a(d){try{l(o.next(d))}catch(u){s(u)}}function c(d){try{l(o.throw(d))}catch(u){s(u)}}function l(d){d.done?n(d.value):i(d.value).then(a,c)}l((o=o.apply(r,e||[])).next())})};class Vi{constructor(e,{headers:t={},customFetch:o,region:i=Kt.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Bi(o)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Ui(this,arguments,void 0,function*(t,o={}){var i;try{const{headers:n,method:s,body:a,signal:c}=o;let l={},{region:d}=o;d||(d=this.region);const u=new URL(`${this.url}/${t}`);d&&d!=="any"&&(l["x-region"]=d,u.searchParams.set("forceFunctionRegion",d));let p;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",p=a):typeof a=="string"?(l["Content-Type"]="text/plain",p=a):typeof FormData<"u"&&a instanceof FormData?p=a:(l["Content-Type"]="application/json",p=JSON.stringify(a)));const g=yield this.fetch(u.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),n),body:p,signal:c}).catch(S=>{throw S.name==="AbortError"?S:new Pr(S)}),f=g.headers.get("x-relay-error");if(f&&f==="true")throw new jr(g);if(!g.ok)throw new Rr(g);let b=((i=g.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),v;return b==="application/json"?v=yield g.json():b==="application/octet-stream"?v=yield g.blob():b==="text/event-stream"?v=g:b==="multipart/form-data"?v=yield g.formData():v=yield g.text(),{data:v,error:null,response:g}}catch(n){return n instanceof Error&&n.name==="AbortError"?{data:null,error:new Pr(n)}:{data:null,error:n,response:n instanceof Rr||n instanceof jr?n.context:void 0}}})}}function Fi(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Gi(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function o(){var i=!1;try{i=this instanceof o}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(o){var i=Object.getOwnPropertyDescriptor(r,o);Object.defineProperty(t,o,i.get?i:{enumerable:!0,get:function(){return r[o]}})}),t}var F={},Ae={},Oe={},Te={},Ie={},$e={},Hi=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},We=Hi();const Zi=We.fetch,No=We.fetch.bind(We),Do=We.Headers,Wi=We.Request,Ji=We.Response,Ye=Object.freeze(Object.defineProperty({__proto__:null,Headers:Do,Request:Wi,Response:Ji,default:No,fetch:Zi},Symbol.toStringTag,{value:"Module"})),Ki=Gi(Ye);var pt={},Nr;function zo(){if(Nr)return pt;Nr=1,Object.defineProperty(pt,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return pt.default=r,pt}var Dr;function qo(){if(Dr)return $e;Dr=1;var r=$e&&$e.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty($e,"__esModule",{value:!0});const e=r(Ki),t=r(zo());class o{constructor(n){var s,a;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(s=n.shouldThrowOnError)!==null&&s!==void 0?s:!1,this.signal=n.signal,this.isMaybeSingle=(a=n.isMaybeSingle)!==null&&a!==void 0?a:!1,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,s){return this.headers=new Headers(this.headers),this.headers.set(n,s),this}then(n,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let c=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var d,u,p,g;let f=null,b=null,v=null,S=l.status,_=l.statusText;if(l.ok){if(this.method!=="HEAD"){const I=await l.text();I===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((d=this.headers.get("Accept"))===null||d===void 0)&&d.includes("application/vnd.pgrst.plan+text"))?b=I:b=JSON.parse(I))}const w=(u=this.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),$=(p=l.headers.get("content-range"))===null||p===void 0?void 0:p.split("/");w&&$&&$.length>1&&(v=parseInt($[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(b)&&(b.length>1?(f={code:"PGRST116",details:`Results contain ${b.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},b=null,v=null,S=406,_="Not Acceptable"):b.length===1?b=b[0]:b=null)}else{const w=await l.text();try{f=JSON.parse(w),Array.isArray(f)&&l.status===404&&(b=[],f=null,S=200,_="OK")}catch{l.status===404&&w===""?(S=204,_="No Content"):f={message:w}}if(f&&this.isMaybeSingle&&(!((g=f?.details)===null||g===void 0)&&g.includes("0 rows"))&&(f=null,S=200,_="OK"),f&&this.shouldThrowOnError)throw new t.default(f)}return{error:f,data:b,count:v,status:S,statusText:_}});return this.shouldThrowOnError||(c=c.catch(l=>{var d,u,p;return{error:{message:`${(d=l?.name)!==null&&d!==void 0?d:"FetchError"}: ${l?.message}`,details:`${(u=l?.stack)!==null&&u!==void 0?u:""}`,hint:"",code:`${(p=l?.code)!==null&&p!==void 0?p:""}`},data:null,count:null,status:0,statusText:""}})),c.then(n,s)}returns(){return this}overrideTypes(){return this}}return $e.default=o,$e}var zr;function xo(){if(zr)return Ie;zr=1;var r=Ie&&Ie.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Ie,"__esModule",{value:!0});const e=r(qo());class t extends e.default{select(i){let n=!1;const s=(i??"*").split("").map(a=>/\s/.test(a)&&!n?"":(a==='"'&&(n=!n),a)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:n=!0,nullsFirst:s,foreignTable:a,referencedTable:c=a}={}){const l=c?`${c}.order`:"order",d=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${d?`${d},`:""}${i}.${n?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:n,referencedTable:s=n}={}){const a=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(a,`${i}`),this}range(i,n,{foreignTable:s,referencedTable:a=s}={}){const c=typeof a>"u"?"offset":`${a}.offset`,l=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(c,`${i}`),this.url.searchParams.set(l,`${n-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:n=!1,settings:s=!1,buffers:a=!1,wal:c=!1,format:l="text"}={}){var d;const u=[i?"analyze":null,n?"verbose":null,s?"settings":null,a?"buffers":null,c?"wal":null].filter(Boolean).join("|"),p=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${l}; for="${p}"; options=${u};`),l==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return Ie.default=t,Ie}var qr;function mr(){if(qr)return Te;qr=1;var r=Te&&Te.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Te,"__esModule",{value:!0});const e=r(xo());class t extends e.default{eq(i,n){return this.url.searchParams.append(i,`eq.${n}`),this}neq(i,n){return this.url.searchParams.append(i,`neq.${n}`),this}gt(i,n){return this.url.searchParams.append(i,`gt.${n}`),this}gte(i,n){return this.url.searchParams.append(i,`gte.${n}`),this}lt(i,n){return this.url.searchParams.append(i,`lt.${n}`),this}lte(i,n){return this.url.searchParams.append(i,`lte.${n}`),this}like(i,n){return this.url.searchParams.append(i,`like.${n}`),this}likeAllOf(i,n){return this.url.searchParams.append(i,`like(all).{${n.join(",")}}`),this}likeAnyOf(i,n){return this.url.searchParams.append(i,`like(any).{${n.join(",")}}`),this}ilike(i,n){return this.url.searchParams.append(i,`ilike.${n}`),this}ilikeAllOf(i,n){return this.url.searchParams.append(i,`ilike(all).{${n.join(",")}}`),this}ilikeAnyOf(i,n){return this.url.searchParams.append(i,`ilike(any).{${n.join(",")}}`),this}is(i,n){return this.url.searchParams.append(i,`is.${n}`),this}in(i,n){const s=Array.from(new Set(n)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(i,`in.(${s})`),this}contains(i,n){return typeof n=="string"?this.url.searchParams.append(i,`cs.${n}`):Array.isArray(n)?this.url.searchParams.append(i,`cs.{${n.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(n)}`),this}containedBy(i,n){return typeof n=="string"?this.url.searchParams.append(i,`cd.${n}`):Array.isArray(n)?this.url.searchParams.append(i,`cd.{${n.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(n)}`),this}rangeGt(i,n){return this.url.searchParams.append(i,`sr.${n}`),this}rangeGte(i,n){return this.url.searchParams.append(i,`nxl.${n}`),this}rangeLt(i,n){return this.url.searchParams.append(i,`sl.${n}`),this}rangeLte(i,n){return this.url.searchParams.append(i,`nxr.${n}`),this}rangeAdjacent(i,n){return this.url.searchParams.append(i,`adj.${n}`),this}overlaps(i,n){return typeof n=="string"?this.url.searchParams.append(i,`ov.${n}`):this.url.searchParams.append(i,`ov.{${n.join(",")}}`),this}textSearch(i,n,{config:s,type:a}={}){let c="";a==="plain"?c="pl":a==="phrase"?c="ph":a==="websearch"&&(c="w");const l=s===void 0?"":`(${s})`;return this.url.searchParams.append(i,`${c}fts${l}.${n}`),this}match(i){return Object.entries(i).forEach(([n,s])=>{this.url.searchParams.append(n,`eq.${s}`)}),this}not(i,n,s){return this.url.searchParams.append(i,`not.${n}.${s}`),this}or(i,{foreignTable:n,referencedTable:s=n}={}){const a=s?`${s}.or`:"or";return this.url.searchParams.append(a,`(${i})`),this}filter(i,n,s){return this.url.searchParams.append(i,`${n}.${s}`),this}}return Te.default=t,Te}var xr;function Mo(){if(xr)return Oe;xr=1;var r=Oe&&Oe.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Oe,"__esModule",{value:!0});const e=r(mr());class t{constructor(i,{headers:n={},schema:s,fetch:a}){this.url=i,this.headers=new Headers(n),this.schema=s,this.fetch=a}select(i,n){const{head:s=!1,count:a}=n??{},c=s?"HEAD":"GET";let l=!1;const d=(i??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",d),a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:n,defaultToNull:s=!0}={}){var a;const c="POST";if(n&&this.headers.append("Prefer",`count=${n}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const l=i.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(l.length>0){const d=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(i,{onConflict:n,ignoreDuplicates:s=!1,count:a,defaultToNull:c=!0}={}){var l;const d="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),n!==void 0&&this.url.searchParams.set("on_conflict",n),a&&this.headers.append("Prefer",`count=${a}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const u=i.reduce((p,g)=>p.concat(Object.keys(g)),[]);if(u.length>0){const p=[...new Set(u)].map(g=>`"${g}"`);this.url.searchParams.set("columns",p.join(","))}}return new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}update(i,{count:n}={}){var s;const a="PATCH";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:i}={}){var n;const s="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}}return Oe.default=t,Oe}var Mr;function Yi(){if(Mr)return Ae;Mr=1;var r=Ae&&Ae.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ae,"__esModule",{value:!0});const e=r(Mo()),t=r(mr());class o{constructor(n,{headers:s={},schema:a,fetch:c}={}){this.url=n,this.headers=new Headers(s),this.schemaName=a,this.fetch=c}from(n){const s=new URL(`${this.url}/${n}`);return new e.default(s,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(n){return new o(this.url,{headers:this.headers,schema:n,fetch:this.fetch})}rpc(n,s={},{head:a=!1,get:c=!1,count:l}={}){var d;let u;const p=new URL(`${this.url}/rpc/${n}`);let g;a||c?(u=a?"HEAD":"GET",Object.entries(s).filter(([b,v])=>v!==void 0).map(([b,v])=>[b,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([b,v])=>{p.searchParams.append(b,v)})):(u="POST",g=s);const f=new Headers(this.headers);return l&&f.set("Prefer",`count=${l}`),new t.default({method:u,url:p,headers:f,schema:this.schemaName,body:g,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}}return Ae.default=o,Ae}var Br;function Xi(){if(Br)return F;Br=1;var r=F&&F.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(F,"__esModule",{value:!0}),F.PostgrestError=F.PostgrestBuilder=F.PostgrestTransformBuilder=F.PostgrestFilterBuilder=F.PostgrestQueryBuilder=F.PostgrestClient=void 0;const e=r(Yi());F.PostgrestClient=e.default;const t=r(Mo());F.PostgrestQueryBuilder=t.default;const o=r(mr());F.PostgrestFilterBuilder=o.default;const i=r(xo());F.PostgrestTransformBuilder=i.default;const n=r(qo());F.PostgrestBuilder=n.default;const s=r(zo());return F.PostgrestError=s.default,F.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:o.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:n.default,PostgrestError:s.default},F}var Qi=Xi();const en=Fi(Qi),{PostgrestClient:tn,PostgrestQueryBuilder:eh,PostgrestFilterBuilder:th,PostgrestTransformBuilder:rh,PostgrestBuilder:oh,PostgrestError:ih}=en;class rn{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const o=t.node,i=parseInt(o.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const o=this.getWebSocketConstructor();return new o(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const on="2.75.0",nn=`realtime-js/${on}`,sn="1.0.0",Yt=1e4,an=1e3,cn=100;var rt;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(rt||(rt={}));var V;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(V||(V={}));var ee;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(ee||(ee={}));var Xt;(function(r){r.websocket="websocket"})(Xt||(Xt={}));var ve;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(ve||(ve={}));class ln{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),o=new TextDecoder;return this._decodeBroadcast(e,t,o)}_decodeBroadcast(e,t,o){const i=t.getUint8(1),n=t.getUint8(2);let s=this.HEADER_LENGTH+2;const a=o.decode(e.slice(s,s+i));s=s+i;const c=o.decode(e.slice(s,s+n));s=s+n;const l=JSON.parse(o.decode(e.slice(s,e.byteLength)));return{ref:null,topic:a,event:c,payload:l}}}class Bo{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var P;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(P||(P={}));const Ur=(r,e,t={})=>{var o;const i=(o=t.skipTypes)!==null&&o!==void 0?o:[];return e?Object.keys(e).reduce((n,s)=>(n[s]=dn(s,r,e,i),n),{}):{}},dn=(r,e,t,o)=>{const i=e.find(a=>a.name===r),n=i?.type,s=t[r];return n&&!o.includes(n)?Uo(n,s):Qt(s)},Uo=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return gn(e,t)}switch(r){case P.bool:return un(e);case P.float4:case P.float8:case P.int2:case P.int4:case P.int8:case P.numeric:case P.oid:return hn(e);case P.json:case P.jsonb:return pn(e);case P.timestamp:return fn(e);case P.abstime:case P.date:case P.daterange:case P.int4range:case P.int8range:case P.money:case P.reltime:case P.text:case P.time:case P.timestamptz:case P.timetz:case P.tsrange:case P.tstzrange:return Qt(e);default:return Qt(e)}},Qt=r=>r,un=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},hn=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},pn=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},gn=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,o=r[t];if(r[0]==="{"&&o==="}"){let n;const s=r.slice(1,t);try{n=JSON.parse("["+s+"]")}catch{n=s?s.split(","):[]}return n.map(a=>Uo(e,a))}return r},fn=r=>typeof r=="string"?r.replace(" ","T"):r,Vo=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Dt{constructor(e,t,o={},i=Yt){this.channel=e,this.event=t,this.payload=o,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var o;return this._hasReceived(e)&&t((o=this.receivedResp)===null||o===void 0?void 0:o.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(o=>o.status===e).forEach(o=>o.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Vr;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Vr||(Vr={}));class ot{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const o=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(o.state,{},i=>{const{onJoin:n,onLeave:s,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ot.syncState(this.state,i,n,s),this.pendingDiffs.forEach(c=>{this.state=ot.syncDiff(this.state,c,n,s)}),this.pendingDiffs=[],a()}),this.channel._on(o.diff,{},i=>{const{onJoin:n,onLeave:s,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=ot.syncDiff(this.state,i,n,s),a())}),this.onJoin((i,n,s)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:s})}),this.onLeave((i,n,s)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,o,i){const n=this.cloneDeep(e),s=this.transformState(t),a={},c={};return this.map(n,(l,d)=>{s[l]||(c[l]=d)}),this.map(s,(l,d)=>{const u=n[l];if(u){const p=d.map(v=>v.presence_ref),g=u.map(v=>v.presence_ref),f=d.filter(v=>g.indexOf(v.presence_ref)<0),b=u.filter(v=>p.indexOf(v.presence_ref)<0);f.length>0&&(a[l]=f),b.length>0&&(c[l]=b)}else a[l]=d}),this.syncDiff(n,{joins:a,leaves:c},o,i)}static syncDiff(e,t,o,i){const{joins:n,leaves:s}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return o||(o=()=>{}),i||(i=()=>{}),this.map(n,(a,c)=>{var l;const d=(l=e[a])!==null&&l!==void 0?l:[];if(e[a]=this.cloneDeep(c),d.length>0){const u=e[a].map(g=>g.presence_ref),p=d.filter(g=>u.indexOf(g.presence_ref)<0);e[a].unshift(...p)}o(a,d,c)}),this.map(s,(a,c)=>{let l=e[a];if(!l)return;const d=c.map(u=>u.presence_ref);l=l.filter(u=>d.indexOf(u.presence_ref)<0),e[a]=l,i(a,l,c),l.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(o=>t(o,e[o]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,o)=>{const i=e[o];return"metas"in i?t[o]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[o]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Fr;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Fr||(Fr={}));var it;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(it||(it={}));var se;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(se||(se={}));class br{constructor(e,t={config:{}},o){var i,n;if(this.topic=e,this.params=t,this.socket=o,this.bindings={},this.state=V.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Dt(this,ee.join,this.params,this.timeout),this.rejoinTimer=new Bo(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=V.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=V.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=V.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=V.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=V.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ee.reply,{},(s,a)=>{this._trigger(this._replyEventName(a),s)}),this.presence=new ot(this),this.broadcastEndpointURL=Vo(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((n=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||n===void 0)&&n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var o,i,n;if(this.socket.isConnected()||this.socket.connect(),this.state==V.closed){const{config:{broadcast:s,presence:a,private:c}}=this.params,l=(i=(o=this.bindings.postgres_changes)===null||o===void 0?void 0:o.map(g=>g.filter))!==null&&i!==void 0?i:[],d=!!this.bindings[it.PRESENCE]&&this.bindings[it.PRESENCE].length>0||((n=this.params.config.presence)===null||n===void 0?void 0:n.enabled)===!0,u={},p={broadcast:s,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:l,private:c};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(g=>e?.(se.CHANNEL_ERROR,g)),this._onClose(()=>e?.(se.CLOSED)),this.updateJoinPayload(Object.assign({config:p},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:g})=>{var f;if(this.socket.setAuth(),g===void 0){e?.(se.SUBSCRIBED);return}else{const b=this.bindings.postgres_changes,v=(f=b?.length)!==null&&f!==void 0?f:0,S=[];for(let _=0;_<v;_++){const y=b[_],{filter:{event:w,schema:$,table:I,filter:q}}=y,re=g&&g[_];if(re&&re.event===w&&re.schema===$&&re.table===I&&re.filter===q)S.push(Object.assign(Object.assign({},y),{id:re.id}));else{this.unsubscribe(),this.state=V.errored,e?.(se.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=S,e&&e(se.SUBSCRIBED);return}}).receive("error",g=>{this.state=V.errored,e?.(se.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(g).join(", ")||"error")))}).receive("timeout",()=>{e?.(se.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,o){return this.state===V.joined&&e===it.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,o)}async send(e,t={}){var o,i;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:s}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:s,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(o=t.timeout)!==null&&o!==void 0?o:this.timeout);return await((i=l.body)===null||i===void 0?void 0:i.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var s,a,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(s=this.params)===null||s===void 0?void 0:s.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&n("ok"),l.receive("ok",()=>n("ok")),l.receive("error",()=>n("error")),l.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=V.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ee.close,"leave",this._joinRef())};this.joinPush.destroy();let o=null;return new Promise(i=>{o=new Dt(this,ee.leave,{},e),o.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),o.send(),this._canPush()||o.trigger("ok",{})}).finally(()=>{o?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=V.closed,this.bindings={}}async _fetchWithTimeout(e,t,o){const i=new AbortController,n=setTimeout(()=>i.abort(),o),s=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),s}_push(e,t,o=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Dt(this,e,t,o);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>cn){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,o){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,o){var i,n;const s=e.toLocaleLowerCase(),{close:a,error:c,leave:l,join:d}=ee;if(o&&[a,c,l,d].indexOf(s)>=0&&o!==this._joinRef())return;let p=this._onMessage(s,t,o);if(t&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(g=>{var f,b,v;return((f=g.filter)===null||f===void 0?void 0:f.event)==="*"||((v=(b=g.filter)===null||b===void 0?void 0:b.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===s}).map(g=>g.callback(p,o)):(n=this.bindings[s])===null||n===void 0||n.filter(g=>{var f,b,v,S,_,y;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in g){const w=g.id,$=(f=g.filter)===null||f===void 0?void 0:f.event;return w&&((b=t.ids)===null||b===void 0?void 0:b.includes(w))&&($==="*"||$?.toLocaleLowerCase()===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const w=(_=(S=g?.filter)===null||S===void 0?void 0:S.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return w==="*"||w===((y=t?.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===s}).map(g=>{if(typeof p=="object"&&"ids"in p){const f=p.data,{schema:b,table:v,commit_timestamp:S,type:_,errors:y}=f;p=Object.assign(Object.assign({},{schema:b,table:v,commit_timestamp:S,eventType:_,new:{},old:{},errors:y}),this._getPayloadRecords(f))}g.callback(p,o)})}_isClosed(){return this.state===V.closed}_isJoined(){return this.state===V.joined}_isJoining(){return this.state===V.joining}_isLeaving(){return this.state===V.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,o){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:o};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const o=e.toLocaleLowerCase();return this.bindings[o]&&(this.bindings[o]=this.bindings[o].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===o&&br.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const o in e)if(e[o]!==t[o])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ee.close,{},e)}_onError(e){this._on(ee.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=V.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ur(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ur(e.columns,e.old_record)),t}}const zt=()=>{},gt={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},mn=[1e3,2e3,5e3,1e4],bn=1e4,vn=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class yn{constructor(e,t){var o;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Yt,this.transport=null,this.heartbeatIntervalMs=gt.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=zt,this.ref=0,this.reconnectTimer=null,this.logger=zt,this.conn=null,this.sendBuffer=[],this.serializer=new ln,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let n;return i?n=i:typeof fetch>"u"?n=(...s)=>A(async()=>{const{default:a}=await Promise.resolve().then(()=>Ye);return{default:a}},void 0).then(({default:a})=>a(...s)).catch(a=>{throw new Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):n=fetch,(...s)=>n(...s)},!(!((o=t?.params)===null||o===void 0)&&o.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Xt.websocket}`,this.httpEndpoint=Vo(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=rn.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:sn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const o=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(o),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,o){this.logger(e,t,o)}connectionState(){switch(this.conn&&this.conn.readyState){case rt.connecting:return ve.Connecting;case rt.open:return ve.Open;case rt.closing:return ve.Closing;default:return ve.Closed}}isConnected(){return this.connectionState()===ve.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const o=`realtime:${e}`,i=this.getChannels().find(n=>n.topic===o);if(i)return i;{const n=new br(`realtime:${e}`,t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:o,payload:i,ref:n}=e,s=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${o} (${n})`,i),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(an,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},gt.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(o=>o.topic===e&&(o._isJoined()||o._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(l){this.log("error","error in heartbeat callback",l)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:o,event:i,payload:n,ref:s}=t,a=s?`(${s})`:"",c=n.status||"";this.log("receive",`${c} ${o} ${i} ${a}`.trim(),n),this.channels.filter(l=>l._isMember(o)).forEach(l=>l._trigger(i,n,s)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(ee.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const o=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${o}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const o=new Blob([vn],{type:"application/javascript"});t=URL.createObjectURL(o)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(o=>{const i={access_token:t,version:nn};t&&o.updateJoinPayload(i),o.joinedOnce&&o._isJoined()&&o._push(ee.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(o=>{try{o(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(o){this.log("error",`error triggering ${e} callbacks`,o)}}_setupReconnectionTimer(){this.reconnectTimer=new Bo(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},gt.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,o,i,n,s,a,c,l,d;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(o=e?.timeout)!==null&&o!==void 0?o:Yt,this.heartbeatIntervalMs=(i=e?.heartbeatIntervalMs)!==null&&i!==void 0?i:gt.HEARTBEAT_INTERVAL,this.worker=(n=e?.worker)!==null&&n!==void 0?n:!1,this.accessToken=(s=e?.accessToken)!==null&&s!==void 0?s:null,this.heartbeatCallback=(a=e?.heartbeatCallback)!==null&&a!==void 0?a:zt,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e?.reconnectAfterMs)!==null&&c!==void 0?c:(u=>mn[u-1]||bn),this.encode=(l=e?.encode)!==null&&l!==void 0?l:((u,p)=>p(JSON.stringify(u))),this.decode=(d=e?.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class vr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function B(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class _n extends vr{constructor(e,t,o){super(e),this.name="StorageApiError",this.status=t,this.statusCode=o}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class er extends vr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var wn=function(r,e,t,o){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function a(d){try{l(o.next(d))}catch(u){s(u)}}function c(d){try{l(o.throw(d))}catch(u){s(u)}}function l(d){d.done?n(d.value):i(d.value).then(a,c)}l((o=o.apply(r,e||[])).next())})};const Fo=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>A(async()=>{const{default:o}=await Promise.resolve().then(()=>Ye);return{default:o}},void 0).then(({default:o})=>o(...t)):e=fetch,(...t)=>e(...t)},En=()=>wn(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield A(()=>Promise.resolve().then(()=>Ye),void 0)).Response:Response}),tr=r=>{if(Array.isArray(r))return r.map(t=>tr(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,o])=>{const i=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[i]=tr(o)}),e},Cn=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var Ce=function(r,e,t,o){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function a(d){try{l(o.next(d))}catch(u){s(u)}}function c(d){try{l(o.throw(d))}catch(u){s(u)}}function l(d){d.done?n(d.value):i(d.value).then(a,c)}l((o=o.apply(r,e||[])).next())})};const qt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Sn=(r,e,t)=>Ce(void 0,void 0,void 0,function*(){const o=yield En();r instanceof o&&!t?.noResolveJson?r.json().then(i=>{const n=r.status||500,s=i?.statusCode||n+"";e(new _n(qt(i),n,s))}).catch(i=>{e(new er(qt(i),i))}):e(new er(qt(r),r))}),kn=(r,e,t,o)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"||!o?i:(Cn(o)?(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(o)):i.body=o,e?.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function ht(r,e,t,o,i,n){return Ce(this,void 0,void 0,function*(){return new Promise((s,a)=>{r(t,kn(e,o,i,n)).then(c=>{if(!c.ok)throw c;return o?.noResolveJson?c:c.json()}).then(c=>s(c)).catch(c=>Sn(c,a,o))})})}function Ct(r,e,t,o){return Ce(this,void 0,void 0,function*(){return ht(r,"GET",e,t,o)})}function oe(r,e,t,o,i){return Ce(this,void 0,void 0,function*(){return ht(r,"POST",e,o,i,t)})}function rr(r,e,t,o,i){return Ce(this,void 0,void 0,function*(){return ht(r,"PUT",e,o,i,t)})}function An(r,e,t,o){return Ce(this,void 0,void 0,function*(){return ht(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),o)})}function Go(r,e,t,o,i){return Ce(this,void 0,void 0,function*(){return ht(r,"DELETE",e,o,i,t)})}var On=function(r,e,t,o){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function a(d){try{l(o.next(d))}catch(u){s(u)}}function c(d){try{l(o.throw(d))}catch(u){s(u)}}function l(d){d.done?n(d.value):i(d.value).then(a,c)}l((o=o.apply(r,e||[])).next())})};class Tn{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return On(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(B(e))return{data:null,error:e};throw e}})}}var In=function(r,e,t,o){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function a(d){try{l(o.next(d))}catch(u){s(u)}}function c(d){try{l(o.throw(d))}catch(u){s(u)}}function l(d){d.done?n(d.value):i(d.value).then(a,c)}l((o=o.apply(r,e||[])).next())})};class $n{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}asStream(){return new Tn(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.execute().then(e,t)}execute(){return In(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(B(e))return{data:null,error:e};throw e}})}}var Z=function(r,e,t,o){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function a(d){try{l(o.next(d))}catch(u){s(u)}}function c(d){try{l(o.throw(d))}catch(u){s(u)}}function l(d){d.done?n(d.value):i(d.value).then(a,c)}l((o=o.apply(r,e||[])).next())})};const Ln={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Gr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Pn{constructor(e,t={},o,i){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=o,this.fetch=Fo(i)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,o,i){return Z(this,void 0,void 0,function*(){try{let n;const s=Object.assign(Object.assign({},Gr),i);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(s.upsert)});const c=s.metadata;typeof Blob<"u"&&o instanceof Blob?(n=new FormData,n.append("cacheControl",s.cacheControl),c&&n.append("metadata",this.encodeMetadata(c)),n.append("",o)):typeof FormData<"u"&&o instanceof FormData?(n=o,n.append("cacheControl",s.cacheControl),c&&n.append("metadata",this.encodeMetadata(c))):(n=o,a["cache-control"]=`max-age=${s.cacheControl}`,a["content-type"]=s.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),i?.headers&&(a=Object.assign(Object.assign({},a),i.headers));const l=this._removeEmptyFolders(t),d=this._getFinalPath(l),u=yield(e=="PUT"?rr:oe)(this.fetch,`${this.url}/object/${d}`,n,Object.assign({headers:a},s?.duplex?{duplex:s.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(B(n))return{data:null,error:n};throw n}})}upload(e,t,o){return Z(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,o)})}uploadToSignedUrl(e,t,o,i){return Z(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),s=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${s}`);a.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:Gr.upsert},i),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&o instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",o)):typeof FormData<"u"&&o instanceof FormData?(c=o,c.append("cacheControl",l.cacheControl)):(c=o,d["cache-control"]=`max-age=${l.cacheControl}`,d["content-type"]=l.contentType);const u=yield rr(this.fetch,a.toString(),c,{headers:d});return{data:{path:n,fullPath:u.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(B(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return Z(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e);const i=Object.assign({},this.headers);t?.upsert&&(i["x-upsert"]="true");const n=yield oe(this.fetch,`${this.url}/object/upload/sign/${o}`,{},{headers:i}),s=new URL(this.url+n.url),a=s.searchParams.get("token");if(!a)throw new vr("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:a},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(B(o))return{data:null,error:o};throw o}})}update(e,t,o){return Z(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,o)})}move(e,t,o){return Z(this,void 0,void 0,function*(){try{return{data:yield oe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:o?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(B(i))return{data:null,error:i};throw i}})}copy(e,t,o){return Z(this,void 0,void 0,function*(){try{return{data:{path:(yield oe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:o?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(B(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,o){return Z(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield oe(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},o?.transform?{transform:o.transform}:{}),{headers:this.headers});const s=o?.download?`&download=${o.download===!0?"":o.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${s}`)},{data:n,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(B(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,o){return Z(this,void 0,void 0,function*(){try{const i=yield oe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=o?.download?`&download=${o.download===!0?"":o.download}`:"";return{data:i.map(s=>Object.assign(Object.assign({},s),{signedUrl:s.signedURL?encodeURI(`${this.url}${s.signedURL}${n}`):null})),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(B(i))return{data:null,error:i};throw i}})}download(e,t){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString(t?.transform||{}),s=n?`?${n}`:"",a=this._getFinalPath(e),c=()=>Ct(this.fetch,`${this.url}/${i}/${a}${s}`,{headers:this.headers,noResolveJson:!0});return new $n(c,this.shouldThrowOnError)}info(e){return Z(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const o=yield Ct(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:tr(o),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(B(o))return{data:null,error:o};throw o}})}exists(e){return Z(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield An(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(B(o)&&o instanceof er){const i=o.originalError;if([400,404].includes(i?.status))return{data:!1,error:o}}throw o}})}getPublicUrl(e,t){const o=this._getFinalPath(e),i=[],n=t?.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const a=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&i.push(c);let l=i.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${o}${l}`)}}}remove(e){return Z(this,void 0,void 0,function*(){try{return{data:yield Go(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}list(e,t,o){return Z(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Ln),t),{prefix:e||""});return{data:yield oe(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},o),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(B(i))return{data:null,error:i};throw i}})}listV2(e,t){return Z(this,void 0,void 0,function*(){try{const o=Object.assign({},e);return{data:yield oe(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,o,{headers:this.headers},t),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(B(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const jn="2.75.0",Rn={"X-Client-Info":`storage-js/${jn}`};var Le=function(r,e,t,o){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function a(d){try{l(o.next(d))}catch(u){s(u)}}function c(d){try{l(o.throw(d))}catch(u){s(u)}}function l(d){d.done?n(d.value):i(d.value).then(a,c)}l((o=o.apply(r,e||[])).next())})};class Nn{constructor(e,t={},o,i){this.shouldThrowOnError=!1;const n=new URL(e);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),this.url=n.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Rn),t),this.fetch=Fo(o)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Le(this,void 0,void 0,function*(){try{return{data:yield Ct(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(B(e))return{data:null,error:e};throw e}})}getBucket(e){return Le(this,void 0,void 0,function*(){try{return{data:yield Ct(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}createBucket(e){return Le(this,arguments,void 0,function*(t,o={public:!1}){try{return{data:yield oe(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:o.type,public:o.public,file_size_limit:o.fileSizeLimit,allowed_mime_types:o.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(B(i))return{data:null,error:i};throw i}})}updateBucket(e,t){return Le(this,void 0,void 0,function*(){try{return{data:yield rr(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(B(o))return{data:null,error:o};throw o}})}emptyBucket(e){return Le(this,void 0,void 0,function*(){try{return{data:yield oe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Le(this,void 0,void 0,function*(){try{return{data:yield Go(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(B(t))return{data:null,error:t};throw t}})}}class Dn extends Nn{constructor(e,t={},o,i){super(e,t,o,i)}from(e){return new Pn(this.url,this.headers,e,this.fetch)}}const zn="2.75.0";let tt="";typeof Deno<"u"?tt="deno":typeof document<"u"?tt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?tt="react-native":tt="node";const qn={"X-Client-Info":`supabase-js-${tt}/${zn}`},xn={headers:qn},Mn={schema:"public"},Bn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Un={};var Vn=function(r,e,t,o){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function a(d){try{l(o.next(d))}catch(u){s(u)}}function c(d){try{l(o.throw(d))}catch(u){s(u)}}function l(d){d.done?n(d.value):i(d.value).then(a,c)}l((o=o.apply(r,e||[])).next())})};const Fn=r=>{let e;return r?e=r:typeof fetch>"u"?e=No:e=fetch,(...t)=>e(...t)},Gn=()=>typeof Headers>"u"?Do:Headers,Hn=(r,e,t)=>{const o=Fn(t),i=Gn();return(n,s)=>Vn(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:r;let l=new i(s?.headers);return l.has("apikey")||l.set("apikey",r),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),o(n,Object.assign(Object.assign({},s),{headers:l}))})};var Zn=function(r,e,t,o){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function a(d){try{l(o.next(d))}catch(u){s(u)}}function c(d){try{l(o.throw(d))}catch(u){s(u)}}function l(d){d.done?n(d.value):i(d.value).then(a,c)}l((o=o.apply(r,e||[])).next())})};function Wn(r){return r.endsWith("/")?r:r+"/"}function Jn(r,e){var t,o;const{db:i,auth:n,realtime:s,global:a}=r,{db:c,auth:l,realtime:d,global:u}=e,p={db:Object.assign(Object.assign({},c),i),auth:Object.assign(Object.assign({},l),n),realtime:Object.assign(Object.assign({},d),s),storage:{},global:Object.assign(Object.assign(Object.assign({},u),a),{headers:Object.assign(Object.assign({},(t=u?.headers)!==null&&t!==void 0?t:{}),(o=a?.headers)!==null&&o!==void 0?o:{})}),accessToken:()=>Zn(this,void 0,void 0,function*(){return""})};return r.accessToken?p.accessToken=r.accessToken:delete p.accessToken,p}function Kn(r){const e=r?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Wn(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Ho="2.75.0",Me=30*1e3,or=3,xt=or*Me,Yn="http://localhost:9999",Xn="supabase.auth.token",Qn={"X-Client-Info":`gotrue-js/${Ho}`},ir="X-Supabase-Api-Version",Zo={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},es=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,ts=600*1e3;class at extends Error{constructor(e,t,o){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=o}}function C(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class rs extends at{constructor(e,t,o){super(e,t,o),this.name="AuthApiError",this.status=t,this.code=o}}function os(r){return C(r)&&r.name==="AuthApiError"}class ye extends at{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ue extends at{constructor(e,t,o,i){super(e,o,i),this.name=t,this.status=o}}class le extends ue{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function is(r){return C(r)&&r.name==="AuthSessionMissingError"}class Pe extends ue{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ft extends ue{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class mt extends ue{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function ns(r){return C(r)&&r.name==="AuthImplicitGrantRedirectError"}class Hr extends ue{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class nr extends ue{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Mt(r){return C(r)&&r.name==="AuthRetryableFetchError"}class Zr extends ue{constructor(e,t,o){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=o}}class sr extends ue{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const St="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Wr=` 	
\r=`.split(""),ss=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Wr.length;e+=1)r[Wr[e].charCodeAt(0)]=-2;for(let e=0;e<St.length;e+=1)r[St[e].charCodeAt(0)]=e;return r})();function Jr(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const o=e.queue>>e.queuedBits-6&63;t(St[o]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const o=e.queue>>e.queuedBits-6&63;t(St[o]),e.queuedBits-=6}}function Wo(r,e,t){const o=ss[r];if(o>-1)for(e.queue=e.queue<<6|o,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(o===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Kr(r){const e=[],t=s=>{e.push(String.fromCodePoint(s))},o={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=s=>{ls(s,o,t)};for(let s=0;s<r.length;s+=1)Wo(r.charCodeAt(s),i,n);return e.join("")}function as(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function cs(r,e){for(let t=0;t<r.length;t+=1){let o=r.charCodeAt(t);if(o>55295&&o<=56319){const i=(o-55296)*1024&65535;o=(r.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}as(o,e)}}function ls(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let o=1;o<6;o+=1)if((r>>7-o&1)===0){e.utf8seq=o;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Ge(r){const e=[],t={queue:0,queuedBits:0},o=i=>{e.push(i)};for(let i=0;i<r.length;i+=1)Wo(r.charCodeAt(i),t,o);return new Uint8Array(e)}function ds(r){const e=[];return cs(r,t=>e.push(t)),new Uint8Array(e)}function _e(r){const e=[],t={queue:0,queuedBits:0},o=i=>{e.push(i)};return r.forEach(i=>Jr(i,t,o)),Jr(null,t,o),e.join("")}function us(r){return Math.round(Date.now()/1e3)+r}function hs(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const J=()=>typeof window<"u"&&typeof document<"u",pe={tested:!1,writable:!1},Jo=()=>{if(!J())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(pe.tested)return pe.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),pe.tested=!0,pe.writable=!0}catch{pe.tested=!0,pe.writable=!1}return pe.writable};function ps(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((o,i)=>{e[i]=o}),e}const Ko=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>A(async()=>{const{default:o}=await Promise.resolve().then(()=>Ye);return{default:o}},void 0).then(({default:o})=>o(...t)):e=fetch,(...t)=>e(...t)},gs=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Be=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},ge=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ae=async(r,e)=>{await r.removeItem(e)};class $t{constructor(){this.promise=new $t.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}$t.promiseConstructor=Promise;function Bt(r){const e=r.split(".");if(e.length!==3)throw new sr("Invalid JWT structure");for(let o=0;o<e.length;o++)if(!es.test(e[o]))throw new sr("JWT not in base64url format");return{header:JSON.parse(Kr(e[0])),payload:JSON.parse(Kr(e[1])),signature:Ge(e[2]),raw:{header:e[0],payload:e[1]}}}async function fs(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function ms(r,e){return new Promise((o,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const s=await r(n);if(!e(n,null,s)){o(s);return}}catch(s){if(!e(n,s)){i(s);return}}})()})}function bs(r){return("0"+r.toString(16)).substr(-2)}function vs(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",o=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*o));return i}return crypto.getRandomValues(e),Array.from(e,bs).join("")}async function ys(r){const t=new TextEncoder().encode(r),o=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(o);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}async function _s(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await ys(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function je(r,e,t=!1){const o=vs();let i=o;t&&(i+="/PASSWORD_RECOVERY"),await Be(r,`${e}-code-verifier`,i);const n=await _s(o);return[n,o===n?"plain":"s256"]}const ws=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Es(r){const e=r.headers.get(ir);if(!e||!e.match(ws))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Cs(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function Ss(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const ks=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Re(r){if(!ks.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ut(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const o=t.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Yr(r){return JSON.parse(JSON.stringify(r))}var As=function(r,e){var t={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&e.indexOf(o)<0&&(t[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(r);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(r,o[i])&&(t[o[i]]=r[o[i]]);return t};const be=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Os=[502,503,504];async function Xr(r){var e;if(!gs(r))throw new nr(be(r),0);if(Os.includes(r.status))throw new nr(be(r),r.status);let t;try{t=await r.json()}catch(n){throw new ye(be(n),n)}let o;const i=Es(r);if(i&&i.getTime()>=Zo["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?o=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(o=t.error_code),o){if(o==="weak_password")throw new Zr(be(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(o==="session_not_found")throw new le}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,s)=>n&&typeof s=="string",!0))throw new Zr(be(t),r.status,t.weak_password.reasons);throw new rs(be(t),r.status||500,o)}const Ts=(r,e,t,o)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(o),Object.assign(Object.assign({},i),t))};async function k(r,e,t,o){var i;const n=Object.assign({},o?.headers);n[ir]||(n[ir]=Zo["2024-01-01"].name),o?.jwt&&(n.Authorization=`Bearer ${o.jwt}`);const s=(i=o?.query)!==null&&i!==void 0?i:{};o?.redirectTo&&(s.redirect_to=o.redirectTo);const a=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",c=await Is(r,e,t+a,{headers:n,noResolveJson:o?.noResolveJson},{},o?.body);return o?.xform?o?.xform(c):{data:Object.assign({},c),error:null}}async function Is(r,e,t,o,i,n){const s=Ts(e,o,i,n);let a;try{a=await r(t,Object.assign({},s))}catch(c){throw console.error(c),new nr(be(c),0)}if(a.ok||await Xr(a),o?.noResolveJson)return a;try{return await a.json()}catch(c){await Xr(c)}}function Q(r){var e;let t=null;Ps(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=us(r.expires_in)));const o=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:o},error:null}}function Qr(r){const e=Q(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,o)=>t&&typeof o=="string",!0)&&(e.data.weak_password=r.weak_password),e}function de(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function $s(r){return{data:r,error:null}}function Ls(r){const{action_link:e,email_otp:t,hashed_token:o,redirect_to:i,verification_type:n}=r,s=As(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:o,redirect_to:i,verification_type:n},c=Object.assign({},s);return{data:{properties:a,user:c},error:null}}function eo(r){return r}function Ps(r){return r.access_token&&r.refresh_token&&r.expires_in}const Vt=["global","local","others"];var js=function(r,e){var t={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&e.indexOf(o)<0&&(t[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(r);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(r,o[i])&&(t[o[i]]=r[o[i]]);return t};class Rs{constructor({url:e="",headers:t={},fetch:o}){this.url=e,this.headers=t,this.fetch=Ko(o),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Vt[0]){if(Vt.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Vt.join(", ")}`);try{return await k(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(o){if(C(o))return{data:null,error:o};throw o}}async inviteUserByEmail(e,t={}){try{return await k(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:de})}catch(o){if(C(o))return{data:{user:null},error:o};throw o}}async generateLink(e){try{const{options:t}=e,o=js(e,["options"]),i=Object.assign(Object.assign({},o),t);return"newEmail"in o&&(i.new_email=o?.newEmail,delete i.newEmail),await k(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Ls,redirectTo:t?.redirectTo})}catch(t){if(C(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await k(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:de})}catch(t){if(C(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,o,i,n,s,a,c;try{const l={nextPage:null,lastPage:0,total:0},d=await k(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(o=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&o!==void 0?o:"",per_page:(n=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:eo});if(d.error)throw d.error;const u=await d.json(),p=(s=d.headers.get("x-total-count"))!==null&&s!==void 0?s:0,g=(c=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return g.length>0&&(g.forEach(f=>{const b=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(f.split(";")[1].split("=")[1]);l[`${v}Page`]=b}),l.total=parseInt(p)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(C(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Re(e);try{return await k(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:de})}catch(t){if(C(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Re(e);try{return await k(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:de})}catch(o){if(C(o))return{data:{user:null},error:o};throw o}}async deleteUser(e,t=!1){Re(e);try{return await k(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:de})}catch(o){if(C(o))return{data:{user:null},error:o};throw o}}async _listFactors(e){Re(e.userId);try{const{data:t,error:o}=await k(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:o}}catch(t){if(C(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Re(e.userId),Re(e.id);try{return{data:await k(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(C(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,o,i,n,s,a,c;try{const l={nextPage:null,lastPage:0,total:0},d=await k(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(o=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&o!==void 0?o:"",per_page:(n=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:eo});if(d.error)throw d.error;const u=await d.json(),p=(s=d.headers.get("x-total-count"))!==null&&s!==void 0?s:0,g=(c=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return g.length>0&&(g.forEach(f=>{const b=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(f.split(";")[1].split("=")[1]);l[`${v}Page`]=b}),l.total=parseInt(p)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(C(l))return{data:{clients:[]},error:l};throw l}}async _createOAuthClient(e){try{return await k(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(C(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await k(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(C(t))return{data:null,error:t};throw t}}async _deleteOAuthClient(e){try{return await k(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(C(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await k(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(C(t))return{data:null,error:t};throw t}}}function to(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}const Ne={debug:!!(globalThis&&Jo()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Yo extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ns extends Yo{}async function Ds(r,e,t){Ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const o=new globalThis.AbortController;return e>0&&setTimeout(()=>{o.abort(),Ne.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:o.signal},async i=>{if(i){Ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{Ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw Ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Ns(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Ne.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function zs(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Xo(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function qs(r){return parseInt(r,16)}function xs(r){const e=new TextEncoder().encode(r);return"0x"+Array.from(e,o=>o.toString(16).padStart(2,"0")).join("")}function Ms(r){var e;const{chainId:t,domain:o,expirationTime:i,issuedAt:n=new Date,nonce:s,notBefore:a,requestId:c,resources:l,scheme:d,uri:u,version:p}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!o)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(s&&s.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${s}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(p!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${p}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const g=Xo(r.address),f=d?`${d}://${o}`:o,b=r.statement?`${r.statement}
`:"",v=`${f} wants you to sign in with your Ethereum account:
${g}

${b}`;let S=`URI: ${u}
Version: ${p}
Chain ID: ${t}${s?`
Nonce: ${s}`:""}
Issued At: ${n.toISOString()}`;if(i&&(S+=`
Expiration Time: ${i.toISOString()}`),a&&(S+=`
Not Before: ${a.toISOString()}`),c&&(S+=`
Request ID: ${c}`),l){let _=`
Resources:`;for(const y of l){if(!y||typeof y!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${y}`);_+=`
- ${y}`}S+=_}return`${v}
${S}`}class M extends Error{constructor({message:e,code:t,cause:o,name:i}){var n;super(e,{cause:o}),this.__isWebAuthnError=!0,this.name=(n=i??(o instanceof Error?o.name:void 0))!==null&&n!==void 0?n:"Unknown Error",this.code=t}}class kt extends M{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Bs({error:r,options:e}){var t,o,i;const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new M({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=n.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new M({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((o=n.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new M({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((i=n.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new M({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new M({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new M({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return n.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new M({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new M({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const s=window.location.hostname;if(ei(s)){if(n.rp.id!==s)return new M({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new M({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new M({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new M({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new M({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function Us({error:r,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new M({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new M({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const o=window.location.hostname;if(ei(o)){if(t.rpId!==o)return new M({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new M({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new M({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new M({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}var Qo=function(r,e){var t={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&e.indexOf(o)<0&&(t[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(r);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(r,o[i])&&(t[o[i]]=r[o[i]]);return t};class Vs{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Fs=new Vs;function Gs(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:e,user:t,excludeCredentials:o}=r,i=Qo(r,["challenge","user","excludeCredentials"]),n=Ge(e).buffer,s=Object.assign(Object.assign({},t),{id:Ge(t.id).buffer}),a=Object.assign(Object.assign({},i),{challenge:n,user:s});if(o&&o.length>0){a.excludeCredentials=new Array(o.length);for(let c=0;c<o.length;c++){const l=o[c];a.excludeCredentials[c]=Object.assign(Object.assign({},l),{id:Ge(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return a}function Hs(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:e,allowCredentials:t}=r,o=Qo(r,["challenge","allowCredentials"]),i=Ge(e).buffer,n=Object.assign(Object.assign({},o),{challenge:i});if(t&&t.length>0){n.allowCredentials=new Array(t.length);for(let s=0;s<t.length;s++){const a=t[s];n.allowCredentials[s]=Object.assign(Object.assign({},a),{id:Ge(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return n}function Zs(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r;return{id:r.id,rawId:r.id,response:{attestationObject:_e(new Uint8Array(r.response.attestationObject)),clientDataJSON:_e(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Ws(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r,o=r.getClientExtensionResults(),i=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:_e(new Uint8Array(i.authenticatorData)),clientDataJSON:_e(new Uint8Array(i.clientDataJSON)),signature:_e(new Uint8Array(i.signature)),userHandle:i.userHandle?_e(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:o,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function ei(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function ro(){var r,e;return!!(J()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator?.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function Js(r){try{const e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new kt("Browser returned unexpected credential type",e)}:{data:null,error:new kt("Empty credential response",e)}}catch(e){return{data:null,error:Bs({error:e,options:r})}}}async function Ks(r){try{const e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new kt("Browser returned unexpected credential type",e)}:{data:null,error:new kt("Empty credential response",e)}}catch(e){return{data:null,error:Us({error:e,options:r})}}}const Ys={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},Xs={userVerification:"preferred",hints:["security-key"]};function At(...r){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),t=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),o={};for(const i of r)if(i)for(const n in i){const s=i[n];if(s!==void 0)if(Array.isArray(s))o[n]=s;else if(t(s))o[n]=s;else if(e(s)){const a=o[n];e(a)?o[n]=At(a,s):o[n]=At(s)}else o[n]=s}return o}function Qs(r,e){return At(Ys,r,e||{})}function ea(r,e){return At(Xs,r,e||{})}class ta{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:o,signal:i},n){try{const{data:s,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!s)return{data:null,error:a};const c=i??Fs.createNewAbortSignal();if(s.webauthn.type==="create"){const{user:l}=s.webauthn.credential_options.publicKey;l.name||(l.name=`${l.id}:${o}`),l.displayName||(l.displayName=l.name)}switch(s.webauthn.type){case"create":{const l=Qs(s.webauthn.credential_options.publicKey,n?.create),{data:d,error:u}=await Js({publicKey:l,signal:c});return d?{data:{factorId:e,challengeId:s.id,webauthn:{type:s.webauthn.type,credential_response:d}},error:null}:{data:null,error:u}}case"request":{const l=ea(s.webauthn.credential_options.publicKey,n?.request),{data:d,error:u}=await Ks(Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:l,signal:c}));return d?{data:{factorId:e,challengeId:s.id,webauthn:{type:s.webauthn.type,credential_response:d}},error:null}:{data:null,error:u}}}}catch(s){return C(s)?{data:null,error:s}:{data:null,error:new ye("Unexpected error in challenge",s)}}}async _verify({challengeId:e,factorId:t,webauthn:o}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:o})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:o=typeof window<"u"?[window.location.origin]:void 0,signal:i}},n){if(!t)return{data:null,error:new at("rpId is required for WebAuthn authentication")};try{if(!ro())return{data:null,error:new ye("Browser does not support WebAuthn",null)};const{data:s,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:o},signal:i},{request:n});if(!s)return{data:null,error:a};const{webauthn:c}=s;return this._verify({factorId:e,challengeId:s.challengeId,webauthn:{type:c.type,rpId:t,rpOrigins:o,credential_response:c.credential_response}})}catch(s){return C(s)?{data:null,error:s}:{data:null,error:new ye("Unexpected error in authenticate",s)}}}async _register({friendlyName:e,rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:o=typeof window<"u"?[window.location.origin]:void 0,signal:i},n){if(!t)return{data:null,error:new at("rpId is required for WebAuthn registration")};try{if(!ro())return{data:null,error:new ye("Browser does not support WebAuthn",null)};const{data:s,error:a}=await this._enroll({friendlyName:e});if(!s)return await this.client.mfa.listFactors().then(d=>{var u;return(u=d.data)===null||u===void 0?void 0:u.all.find(p=>p.factor_type==="webauthn"&&p.friendly_name===e&&p.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d?.id}):void 0),{data:null,error:a};const{data:c,error:l}=await this._challenge({factorId:s.id,friendlyName:s.friendly_name,webauthn:{rpId:t,rpOrigins:o},signal:i},{create:n});return c?this._verify({factorId:s.id,challengeId:c.challengeId,webauthn:{rpId:t,rpOrigins:o,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:l}}catch(s){return C(s)?{data:null,error:s}:{data:null,error:new ye("Unexpected error in register",s)}}}}zs();const ra={url:Yn,storageKey:Xn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Qn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function oo(r,e,t){return await t()}const De={};class ct{get jwks(){var e,t;return(t=(e=De[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){De[this.storageKey]=Object.assign(Object.assign({},De[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=De[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){De[this.storageKey]=Object.assign(Object.assign({},De[this.storageKey]),{cachedAt:e})}constructor(e){var t,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ct.nextInstanceID,ct.nextInstanceID+=1,this.instanceID>0&&J()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},ra),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Rs({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Ko(i.fetch),this.lock=i.lock||oo,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:J()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Ds:this.lock=oo,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new ta(this)},this.persistSession?(i.storage?this.storage=i.storage:Jo()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=to(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=to(this.memoryStorage)),J()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ho}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=ps(window.location.href);let o="none";if(this._isImplicitGrantCallback(t)?o="implicit":await this._isPKCECallback(t)&&(o="pkce"),J()&&this.detectSessionInUrl&&o!=="none"){const{data:i,error:n}=await this._getSessionFromURL(t,o);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),ns(n)){const c=(e=n.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:s,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",s,"redirect type",a),await this._saveSession(s),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return C(t)?{error:t}:{error:new ye("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,o,i;try{const n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(o=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:Q}),{data:s,error:a}=n;if(a||!s)return{data:{user:null,session:null},error:a};const c=s.session,l=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(n){if(C(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,o,i;try{let n;if("email"in e){const{email:d,password:u,options:p}=e;let g=null,f=null;this.flowType==="pkce"&&([g,f]=await je(this.storage,this.storageKey)),n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p?.emailRedirectTo,body:{email:d,password:u,data:(t=p?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:g,code_challenge_method:f},xform:Q})}else if("phone"in e){const{phone:d,password:u,options:p}=e;n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:u,data:(o=p?.data)!==null&&o!==void 0?o:{},channel:(i=p?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:p?.captchaToken}},xform:Q})}else throw new ft("You must provide either an email or phone number and a password");const{data:s,error:a}=n;if(a||!s)return{data:{user:null,session:null},error:a};const c=s.session,l=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(n){if(C(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:s,options:a}=e;t=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:s,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Qr})}else if("phone"in e){const{phone:n,password:s,options:a}=e;t=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:s,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Qr})}else throw new ft("You must provide either an email or phone number and a password");const{data:o,error:i}=t;return i?{data:{user:null,session:null},error:i}:!o||!o.session||!o.user?{data:{user:null,session:null},error:new Pe}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign({user:o.user,session:o.session},o.weak_password?{weakPassword:o.weak_password}:null),error:i})}catch(t){if(C(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,o,i,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,o,i,n,s,a,c,l,d,u,p;let g,f;if("message"in e)g=e.message,f=e.signature;else{const{chain:b,wallet:v,statement:S,options:_}=e;let y;if(J())if(typeof v=="object")y=v;else{const ne=window;if("ethereum"in ne&&typeof ne.ethereum=="object"&&"request"in ne.ethereum&&typeof ne.ethereum.request=="function")y=ne.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=v}const w=new URL((t=_?.url)!==null&&t!==void 0?t:window.location.href),$=await y.request({method:"eth_requestAccounts"}).then(ne=>ne).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!$||$.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const I=Xo($[0]);let q=(o=_?.signInWithEthereum)===null||o===void 0?void 0:o.chainId;if(!q){const ne=await y.request({method:"eth_chainId"});q=qs(ne)}const re={domain:w.host,address:I,statement:S,uri:w.href,version:"1",chainId:q,nonce:(i=_?.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(s=(n=_?.signInWithEthereum)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date,expirationTime:(a=_?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(c=_?.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(l=_?.signInWithEthereum)===null||l===void 0?void 0:l.requestId,resources:(d=_?.signInWithEthereum)===null||d===void 0?void 0:d.resources};g=Ms(re),f=await y.request({method:"personal_sign",params:[xs(g),I]})}try{const{data:b,error:v}=await k(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:g,signature:f},!((u=e.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Q});if(v)throw v;return!b||!b.session||!b.user?{data:{user:null,session:null},error:new Pe}:(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),{data:Object.assign({},b),error:v})}catch(b){if(C(b))return{data:{user:null,session:null},error:b};throw b}}async signInWithSolana(e){var t,o,i,n,s,a,c,l,d,u,p,g;let f,b;if("message"in e)f=e.message,b=e.signature;else{const{chain:v,wallet:S,statement:_,options:y}=e;let w;if(J())if(typeof S=="object")w=S;else{const I=window;if("solana"in I&&typeof I.solana=="object"&&("signIn"in I.solana&&typeof I.solana.signIn=="function"||"signMessage"in I.solana&&typeof I.solana.signMessage=="function"))w=I.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!y?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=S}const $=new URL((t=y?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in w&&w.signIn){const I=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y?.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),_?{statement:_}:null));let q;if(Array.isArray(I)&&I[0]&&typeof I[0]=="object")q=I[0];else if(I&&typeof I=="object"&&"signedMessage"in I&&"signature"in I)q=I;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in q&&"signature"in q&&(typeof q.signedMessage=="string"||q.signedMessage instanceof Uint8Array)&&q.signature instanceof Uint8Array)f=typeof q.signedMessage=="string"?q.signedMessage:new TextDecoder().decode(q.signedMessage),b=q.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${$.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(i=(o=y?.signInWithSolana)===null||o===void 0?void 0:o.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((n=y?.signInWithSolana)===null||n===void 0)&&n.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((s=y?.signInWithSolana)===null||s===void 0)&&s.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((a=y?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((c=y?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((l=y?.signInWithSolana)===null||l===void 0)&&l.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((u=(d=y?.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||u===void 0)&&u.length?["Resources",...y.signInWithSolana.resources.map(q=>`- ${q}`)]:[]].join(`
`);const I=await w.signMessage(new TextEncoder().encode(f),"utf8");if(!I||!(I instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");b=I}}try{const{data:v,error:S}=await k(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:_e(b)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:Q});if(S)throw S;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new Pe}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:S})}catch(v){if(C(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const t=await ge(this.storage,`${this.storageKey}-code-verifier`),[o,i]=(t??"").split("/");try{const{data:n,error:s}=await k(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:o},xform:Q});if(await ae(this.storage,`${this.storageKey}-code-verifier`),s)throw s;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new Pe}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:s})}catch(n){if(C(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:o,token:i,access_token:n,nonce:s}=e,a=await k(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:o,id_token:i,access_token:n,nonce:s,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Q}),{data:c,error:l}=a;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Pe}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(C(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,o,i,n,s;try{if("email"in e){const{email:a,options:c}=e;let l=null,d=null;this.flowType==="pkce"&&([l,d]=await je(this.storage,this.storageKey));const{error:u}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(o=c?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:l,code_challenge_method:d},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:a,options:c}=e,{data:l,error:d}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=c?.data)!==null&&i!==void 0?i:{},create_user:(n=c?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(s=c?.channel)!==null&&s!==void 0?s:"sms"}});return{data:{user:null,session:null,messageId:l?.message_id},error:d}}throw new ft("You must provide either an email or phone number.")}catch(a){if(C(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,o;try{let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(o=e.options)===null||o===void 0?void 0:o.captchaToken);const{data:s,error:a}=await k(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:Q});if(a)throw a;if(!s)throw new Error("An error occurred on token verification.");const c=s.session,l=s.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(C(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,o,i;try{let n=null,s=null;return this.flowType==="pkce"&&([n,s]=await je(this.storage,this.storageKey)),await k(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(o=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&o!==void 0?o:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:s}),headers:this.headers,xform:$s})}catch(n){if(C(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:o}=e;if(o)throw o;if(!t)throw new le;const{error:i}=await k(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(C(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:o,type:i,options:n}=e,{error:s}=await k(this.fetch,"POST",t,{headers:this.headers,body:{email:o,type:i,gotrue_meta_security:{captcha_token:n?.captchaToken}},redirectTo:n?.emailRedirectTo});return{data:{user:null,session:null},error:s}}else if("phone"in e){const{phone:o,type:i,options:n}=e,{data:s,error:a}=await k(this.fetch,"POST",t,{headers:this.headers,body:{phone:o,type:i,gotrue_meta_security:{captcha_token:n?.captchaToken}}});return{data:{user:null,session:null,messageId:s?.message_id},error:a}}throw new ft("You must provide either an email or phone number and a type")}catch(t){if(C(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const o=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await o,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const o=t();for(this.pendingInLock.push((async()=>{try{await o}catch{}})()),await o;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await o}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ge(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const o=e.expires_at?e.expires_at*1e3-Date.now()<xt:!1;if(this._debug("#__loadSession()",`session has${o?"":" not"} expired`,"expires_at",e.expires_at),!o){if(this.userStorage){const s=await ge(this.userStorage,this.storageKey+"-user");s?.user?e.user=s.user:e.user=Ut()}if(this.storage.isServer&&e.user){let s=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,l,d)=>(!s&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),s=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,d))})}return{data:{session:e},error:null}}const{data:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:de}):await this._useSession(async t=>{var o,i,n;const{data:s,error:a}=t;if(a)throw a;return!(!((o=s.session)===null||o===void 0)&&o.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new le}:await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=s.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0,xform:de})})}catch(t){if(C(t))return is(t)&&(await this._removeSession(),await ae(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async o=>{const{data:i,error:n}=o;if(n)throw n;if(!i.session)throw new le;const s=i.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await je(this.storage,this.storageKey));const{data:l,error:d}=await k(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:s.access_token,xform:de});if(d)throw d;return s.user=l.user,await this._saveSession(s),await this._notifyAllSubscribers("USER_UPDATED",s),{data:{user:s.user},error:null}})}catch(o){if(C(o))return{data:{user:null},error:o};throw o}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new le;const t=Date.now()/1e3;let o=t,i=!0,n=null;const{payload:s}=Bt(e.access_token);if(s.exp&&(o=s.exp,i=o<=t),i){const{data:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};n=a}else{const{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;n={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:o-t,expires_at:o},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(C(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var o;if(!e){const{data:s,error:a}=t;if(a)throw a;e=(o=s.session)!==null&&o!==void 0?o:void 0}if(!e?.refresh_token)throw new le;const{data:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(C(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!J())throw new mt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new mt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Hr("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new mt("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Hr("No code detected.");const{data:_,error:y}=await this._exchangeCodeForSession(e.code);if(y)throw y;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:o,provider_refresh_token:i,access_token:n,refresh_token:s,expires_in:a,expires_at:c,token_type:l}=e;if(!n||!a||!s||!l)throw new mt("No session defined in URL");const d=Math.round(Date.now()/1e3),u=parseInt(a);let p=d+u;c&&(p=parseInt(c));const g=p-d;g*1e3<=Me&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${u}s`);const f=p-u;d-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,p,d):d-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,p,d);const{data:b,error:v}=await this._getUser(n);if(v)throw v;const S={provider_token:o,provider_refresh_token:i,access_token:n,expires_in:u,expires_at:p,refresh_token:s,token_type:l,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:S,redirectType:e.type},error:null}}catch(o){if(C(o))return{data:{session:null,redirectType:null},error:o};throw o}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ge(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var o;const{data:i,error:n}=t;if(n)return{error:n};const s=(o=i.session)===null||o===void 0?void 0:o.access_token;if(s){const{error:a}=await this.admin.signOut(s,e);if(a&&!(os(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await ae(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=hs(),o={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,o),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:o}}}async _emitInitialSession(e){return await this._useSession(async t=>{var o,i;try{const{data:{session:n},error:s}=t;if(s)throw s;await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let o=null,i=null;this.flowType==="pkce"&&([o,i]=await je(this.storage,this.storageKey,!0));try{return await k(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:o,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(C(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:o}=await this.getUser();if(o)throw o;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(C(t))return{data:null,error:t};throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:o,error:i}=await this._useSession(async n=>{var s,a,c,l,d;const{data:u,error:p}=n;if(p)throw p;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(s=e.options)===null||s===void 0?void 0:s.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await k(this.fetch,"GET",g,{headers:this.headers,jwt:(d=(l=u.session)===null||l===void 0?void 0:l.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return J()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(o?.url),{data:{provider:e.provider,url:o?.url},error:null}}catch(o){if(C(o))return{data:{provider:e.provider,url:null},error:o};throw o}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var o;try{const{error:i,data:{session:n}}=t;if(i)throw i;const{options:s,provider:a,token:c,access_token:l,nonce:d}=e,u=await k(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(o=n?.access_token)!==null&&o!==void 0?o:void 0,body:{provider:a,id_token:c,access_token:l,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:Q}),{data:p,error:g}=u;return g?{data:{user:null,session:null},error:g}:!p||!p.session||!p.user?{data:{user:null,session:null},error:new Pe}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("USER_UPDATED",p.session)),{data:p,error:g})}catch(i){if(C(i))return{data:{user:null,session:null},error:i};throw i}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var o,i;const{data:n,error:s}=t;if(s)throw s;return await k(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(o=n.session)===null||o===void 0?void 0:o.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(C(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const o=Date.now();return await ms(async i=>(i>0&&await fs(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await k(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Q})),(i,n)=>{const s=200*Math.pow(2,i);return n&&Mt(n)&&Date.now()+s-o<Me})}catch(o){if(this._debug(t,"error",o),C(o))return{data:{session:null,user:null},error:o};throw o}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const o=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",o),J()&&!t.skipBrowserRedirect&&window.location.assign(o),{data:{provider:e,url:o},error:null}}async _recoverAndRefresh(){var e,t;const o="#_recoverAndRefresh()";this._debug(o,"begin");try{const i=await ge(this.storage,this.storageKey);if(i&&this.userStorage){let s=await ge(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!s&&(s={user:i.user},await Be(this.userStorage,this.storageKey+"-user",s)),i.user=(e=s?.user)!==null&&e!==void 0?e:Ut()}else if(i&&!i.user&&!i.user){const s=await ge(this.storage,this.storageKey+"-user");s&&s?.user?(i.user=s.user,await ae(this.storage,this.storageKey+"-user"),await Be(this.storage,this.storageKey,i)):i.user=Ut()}if(this._debug(o,"session from storage",i),!this._isValidSession(i)){this._debug(o,"session is not valid"),i!==null&&await this._removeSession();return}const n=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<xt;if(this._debug(o,`session has${n?"":" not"} expired with margin of ${xt}s`),n){if(this.autoRefreshToken&&i.refresh_token){const{error:s}=await this._callRefreshToken(i.refresh_token);s&&(console.error(s),Mt(s)||(this._debug(o,"refresh failed with a non-retryable error, removing the session",s),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:s,error:a}=await this._getUser(i.access_token);!a&&s?.user?(i.user=s.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(o,"could not get user data, skipping SIGNED_IN notification")}catch(s){console.error("Error getting user data:",s),this._debug(o,"error getting user data, skipping SIGNED_IN notification",s)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(o,"error",i),console.error(i);return}finally{this._debug(o,"end")}}async _callRefreshToken(e){var t,o;if(!e)throw new le;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new $t;const{data:n,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!n.session)throw new le;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const a={data:n.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(n){if(this._debug(i,"error",n),C(n)){const s={data:null,error:n};return Mt(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(s),s}throw(o=this.refreshingDeferred)===null||o===void 0||o.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,o=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${o}`);try{this.broadcastChannel&&o&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],s=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(c){n.push(c)}});if(await Promise.all(s),n.length>0){for(let a=0;a<n.length;a+=1)console.error(n[a]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),o=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!o&&t.user&&await Be(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const n=Yr(i);await Be(this.storage,this.storageKey,n)}else{const i=Yr(t);await Be(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await ae(this.storage,this.storageKey),await ae(this.storage,this.storageKey+"-code-verifier"),await ae(this.storage,this.storageKey+"-user"),this.userStorage&&await ae(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&J()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Me);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:o}}=t;if(!o||!o.refresh_token||!o.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((o.expires_at*1e3-e)/Me);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Me}ms, refresh threshold is ${or} ticks`),i<=or&&await this._callRefreshToken(o.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Yo)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!J()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,o){const i=[`provider=${encodeURIComponent(t)}`];if(o?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(o.redirectTo)}`),o?.scopes&&i.push(`scopes=${encodeURIComponent(o.scopes)}`),this.flowType==="pkce"){const[n,s]=await je(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(s)}`});i.push(a.toString())}if(o?.queryParams){const n=new URLSearchParams(o.queryParams);i.push(n.toString())}return o?.skipBrowserRedirect&&i.push(`skip_http_redirect=${o.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var o;const{data:i,error:n}=t;return n?{data:null,error:n}:await k(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token})})}catch(t){if(C(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var o,i;const{data:n,error:s}=t;if(s)return{data:null,error:s};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:l}=await k(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(o=n?.session)===null||o===void 0?void 0:o.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&c.type==="totp"&&(!((i=c?.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(C(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var o;const{data:i,error:n}=t;if(n)return{data:null,error:n};const s=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?Zs(e.webauthn.credential_response):Ws(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:c}=await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:s,headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:c})})}catch(t){if(C(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var o;const{data:i,error:n}=t;if(n)return{data:null,error:n};const s=await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token});if(s.error)return s;const{data:a}=s;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Gs(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Hs(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(C(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:o}=await this._challenge({factorId:e.factorId});return o?{data:null,error:o}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:o}=await this.getUser();if(o)return{data:null,error:o};const i={all:[],phone:[],totp:[],webauthn:[]};for(const n of(e=t?.factors)!==null&&e!==void 0?e:[])i.all.push(n),n.status==="verified"&&i[n.factor_type].push(n);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,o;const{data:{session:i},error:n}=e;if(n)return{data:null,error:n};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=Bt(i.access_token);let a=null;s.aal&&(a=s.aal);let c=a;((o=(t=i.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&o!==void 0?o:[]).length>0&&(c="aal2");const d=s.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let o=t.keys.find(a=>a.kid===e);if(o)return o;const i=Date.now();if(o=this.jwks.keys.find(a=>a.kid===e),o&&this.jwks_cached_at+ts>i)return o;const{data:n,error:s}=await k(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(s)throw s;return!n.keys||n.keys.length===0||(this.jwks=n,this.jwks_cached_at=i,o=n.keys.find(a=>a.kid===e),!o)?null:o}async getClaims(e,t={}){try{let o=e;if(!o){const{data:g,error:f}=await this.getSession();if(f||!g.session)return{data:null,error:f};o=g.session.access_token}const{header:i,payload:n,signature:s,raw:{header:a,payload:c}}=Bt(o);t?.allowExpired||Cs(n.exp);const l=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!l){const{error:g}=await this.getUser(o);if(g)throw g;return{data:{claims:n,header:i,signature:s},error:null}}const d=Ss(i.alg),u=await crypto.subtle.importKey("jwk",l,d,!0,["verify"]);if(!await crypto.subtle.verify(d,u,s,ds(`${a}.${c}`)))throw new sr("Invalid JWT signature");return{data:{claims:n,header:i,signature:s},error:null}}catch(o){if(C(o))return{data:null,error:o};throw o}}}ct.nextInstanceID=0;const oa=ct;class ia extends oa{constructor(e){super(e)}}var na=function(r,e,t,o){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function a(d){try{l(o.next(d))}catch(u){s(u)}}function c(d){try{l(o.throw(d))}catch(u){s(u)}}function l(d){d.done?n(d.value):i(d.value).then(a,c)}l((o=o.apply(r,e||[])).next())})};class sa{constructor(e,t,o){var i,n,s;this.supabaseUrl=e,this.supabaseKey=t;const a=Kn(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const c=`sb-${a.hostname.split(".")[0]}-auth-token`,l={db:Mn,realtime:Un,auth:Object.assign(Object.assign({},Bn),{storageKey:c}),global:xn},d=Jn(o??{},l);this.storageKey=(i=d.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(n=d.global.headers)!==null&&n!==void 0?n:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(u,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((s=d.auth)!==null&&s!==void 0?s:{},this.headers,d.global.fetch),this.fetch=Hn(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new tn(new URL("rest/v1",a).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new Dn(this.storageUrl.href,this.headers,this.fetch,o?.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new Vi(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},o={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,o)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return na(this,void 0,void 0,function*(){var e,t;if(this.accessToken)return yield this.accessToken();const{data:o}=yield this.auth.getSession();return(t=(e=o.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:o,storage:i,userStorage:n,storageKey:s,flowType:a,lock:c,debug:l},d,u){const p={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ia({url:this.authUrl.href,headers:Object.assign(Object.assign({},p),d),storageKey:s,autoRefreshToken:e,persistSession:t,detectSessionInUrl:o,storage:i,userStorage:n,flowType:a,lock:c,debug:l,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(g=>g.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new yn(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,o)=>{this._handleTokenChanged(t,"CLIENT",o?.access_token)})}_handleTokenChanged(e,t,o){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==o?(this.changedAccessToken=o,this.realtime.setAuth(o)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const aa=(r,e,t)=>new sa(r,e,t);function ca(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}ca()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Ft={BASE_URL:"/gravy_pages/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_CACHE_TIMEOUT:"300000",VITE_DEFAULT_LANGUAGE:"es",VITE_ENABLE_CACHING:"true",VITE_ENABLE_LOGGING:"true",VITE_ENABLE_TRANSLATION_CACHE:"true",VITE_ENVIRONMENT:"development",VITE_GOOGLE_TRANSLATE_API_KEY:"AIzaSyCQ5XF34qdC0dC2vkgfdfieGGu5UCVHZLY",VITE_GOOGLE_TRANSLATE_ENABLED:"true",VITE_LOG_LEVEL:"debug",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVkdGxxam1ydGJjcGRxa253dXJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI5NDYyNzQsImV4cCI6MjA1ODUyMjI3NH0.5UW6IHyGVFfX5bnr5kv1XFIvevVxWvBoBy2a7_0visU",VITE_SUPABASE_URL:"https://udtlqjmrtbcpdqknwuro.supabase.co"};var la={};class da{constructor(){console.log("[AppConfig] Constructor called"),this.config=this.loadConfiguration(),this.validateConfiguration(),console.log("[AppConfig] Initial config features:",this.config.features),this.initSaaS(),this.resources={logo:"",bg_light_blue:"",bg_dark_red:"",bg_white:"",bg_dark_blue:""},this.interfaces=[],this.interface_customizations={}}async fetchInterfaces(){return this._interfacesPromise?this._interfacesPromise:(this._interfacesPromise=(async()=>{try{const e=await fetch(`${this.config.database.supabaseUrl}/rest/v1/interfaces?select=*&order=nombre.asc`,{headers:{apikey:this.config.database.supabaseKey,Authorization:`Bearer ${this.config.database.supabaseKey}`}});if(!e.ok){const o=await e.text();throw console.error(`[AppConfig]  Supabase Fetch Error (interfaces): Status ${e.status}`,o),new Error(`HTTP ${e.status}: ${o}`)}const t=await e.json();!t||t.length===0?(console.warn("[AppConfig]  Supabase returned 0 interfaces. Is RLS enabled?"),this.interfaces=this._getFallbackInterfaces()):this.interfaces=t.map(o=>{const i=(o.categoria||"").trim(),n=`${this.config.database.supabaseUrl}/storage/v1/object/public`,s=a=>a?a.startsWith("http")?a:`${n}/${a.replace(/^\/+/,"")}`:null;return{...o,slug:i,label:o.nombre||i,header:o.titulo||o.nombre||i,image:s(o.imagen),thumbnailUrl:s(o.thumbnail),descripcion:o.descripcion||""}})}catch(e){console.error("[AppConfig]  Failed to load interfaces:",e),this.interfaces=this._getFallbackInterfaces()}finally{window.dispatchEvent(new CustomEvent("app:interfaces-ready",{detail:this.interfaces}))}})(),this._interfacesPromise)}_getFallbackInterfaces(){const e=`${this.config.database.supabaseUrl}/storage/v1/object/public`;return[{id:"0b4bd478-6c75-4ddb-b8fb-8e6e95ef7fa1",nombre:"Caf",imagen:"productos/imagenes/interfaces/cafe.webp",categoria:"cafe"},{id:"15faf49b-9ebf-4bc1-a261-ee7af49a0121",nombre:"Licores",imagen:"productos/imagenes/interfaces/Licores.webp",categoria:"licores"},{id:"1a0ca882-1c48-423f-ae2a-c6ae3296f7fe",nombre:"Cervezas",imagen:"productos/imagenes/interfaces/cervezas.webp",categoria:"cervezas"},{id:"1f90f617-026e-4c96-950e-b80fbb1ef761",nombre:"Coctelera",imagen:"productos/imagenes/interfaces/cocteleria.webp",categoria:"cocteleria"},{id:"29ffba47-81bf-4250-99f4-524a7954fc80",nombre:"Pizzas",imagen:"productos/imagenes/interfaces/pizzas.webp",categoria:"pizzas"},{id:"427968ed-9ac2-4a7e-be91-ae3593e8e23b",nombre:"Snacks",imagen:"productos/imagenes/interfaces/snaks.webp",categoria:"snacks"},{id:"8d874833-5dc0-4025-a922-efe3612b60c0",nombre:"Sopas",imagen:"productos/imagenes/interfaces/sopas.webp",categoria:"sopas"},{id:"9622133c-8cd2-411a-97ad-4cbe72907f1e",nombre:"Postres",imagen:"productos/imagenes/interfaces/postres.webp",categoria:"postres"},{id:"9788676b-4b98-494c-adea-f528aa89e92a",nombre:"Alitas",imagen:"productos/imagenes/interfaces/alitas.webp",categoria:"alitas"},{id:"a2345918-7068-4f05-847e-a6efd49dab61",nombre:"Ensaladas",imagen:"productos/imagenes/interfaces/ensaladas.webp",categoria:"ensaladas"},{id:"b1583bb9-84c0-4257-a50d-31ae187c9609",nombre:"Cortes de carne",imagen:"productos/imagenes/interfaces/cortes_de_carne.webp",categoria:"cortes_de_carne"},{id:"c8d46d84-c9c7-42df-ad7e-1ef81cbdf2d0",nombre:"Refrescos",imagen:"productos/imagenes/interfaces/refrescos.webp",categoria:"refrescos"},{id:"fc8996de-b701-4ae2-9654-e7244bdeb31c",nombre:"Platos fuertes",imagen:"productos/imagenes/interfaces/platos_fuertes.webp",categoria:"platos_fuertes"}].map(t=>({...t,image:`${e}/${t.imagen}`}))}applyInterfaceOverrides(e){if(!e||!e.configuracion_json)return;this.interface_customizations=e.configuracion_json.interface_customizations||{};const t=e.configuracion_json.hidden_categories||[];this.resources.activeTheme=e.configuracion_json.active_theme||"bg_light_blue",this.resources.logoSize=e.configuracion_json.logo_size||"medium",console.log("[AppConfig]  Applying interface overrides:",Object.keys(this.interface_customizations).length),this.interfaces=this.interfaces.map(o=>{const i=this.interface_customizations[o.slug]||{};return{...o,label:i.name||o.nombre||o.slug,header:i.name||o.titulo||o.nombre||o.slug,descripcion:i.description||o.descripcion||"",image:i.image||o.image,thumbnailUrl:i.thumbnail||o.thumbnailUrl,isHidden:t.includes(o.slug)||t.includes(o.nombre)}}),window.dispatchEvent(new CustomEvent("app:interfaces-updated",{detail:this.interfaces}))}async fetchGlobalResources(){return this._resourcesPromise?this._resourcesPromise:(this._resourcesPromise=(async()=>{try{console.log("[AppConfig]  Fetching global resources from Supabase...");const e=await fetch(`${this.config.database.supabaseUrl}/rest/v1/recursos?select=*`,{headers:{apikey:this.config.database.supabaseKey,Authorization:`Bearer ${this.config.database.supabaseKey}`}});if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();this.resources={...this.resources,logo:{url:"",id:""},bg_light_blue:{url:"",id:""},bg_dark_red:{url:"",id:""},bg_white:{url:"",id:""},bg_dark_blue:{url:"",id:""},establishmentName:{value:"",id:""}},t.forEach(o=>{const i=(o.descripcion||"").toLowerCase(),n=(o.tipo||"").trim(),s=n.toLowerCase();if(s==="logo")this.resources.logo={url:o.url,id:o.id};else if(s==="fondo"){const a={url:o.url,id:o.id};i.includes("azul claro")?this.resources.bg_light_blue=a:i.includes("rojo")?this.resources.bg_dark_red=a:i.includes("blanco")?this.resources.bg_white=a:i.includes("azul obscuro")&&(this.resources.bg_dark_blue=a)}else i.includes("nombre de establecimiento")&&(this.resources.establishmentName={value:n,id:o.id})}),window.dispatchEvent(new CustomEvent("app:resources-ready",{detail:this.resources}))}catch(e){console.error("[AppConfig]  Failed to load global resources:",e)}})(),this._resourcesPromise)}async initSaaS(){if(typeof window<"u"){console.log("[AppConfig]  Starting SaaS initialization..."),this.fetchGlobalResources(),this.fetchInterfaces();try{const{default:e}=await A(async()=>{const{default:i}=await import("./AuthService-BxOLs-0-.js");return{default:i}},[]),{default:t}=await A(async()=>{const{default:i}=await import("./LoginModal-8pR5BUzO.js");return{default:i}},__vite__mapDeps([0,1])),{default:o}=await A(async()=>{const{default:i}=await Promise.resolve().then(()=>Xu);return{default:i}},void 0);e.subscribe((i,n)=>{console.log("[SaaS Core] User Context Changed:",i?.email,n?.restaurant_id);const s=new o;typeof window<"u"&&(window.saasAdapter=s),n?.restaurant_id?(this.config.database.establishmentId=n.restaurant_id,console.log("[AppConfig]  Security Context Switched to Owner:",n.restaurant_id),s.setRestaurantContext(n.restaurant_id),this.applyInterfaceOverrides(n),this._updateAdminUI(!0,n)):i?(console.warn("[SaaS Core] User logged in without restaurant context. Admin features disabled."),s.setRestaurantContext(this.config.database.establishmentId),this._updateAdminUI(!1,null)):(s.setRestaurantContext(this.config.database.establishmentId),this._updateAdminUI(!1,null))}),window.addEventListener("SAAS_SAVE_OVERRIDE",async i=>{const{productId:n,payload:s,originalProduct:a}=i.detail;try{const{default:c}=await A(async()=>{const{default:u}=await import("./AuthService-BxOLs-0-.js");return{default:u}},[]);if(!c.canEdit()){alert("Debes iniciar sesin para editar.");return}const l=new o,d=c.getRestaurantId()||this.config.database.establishmentId;l.setRestaurantContext(d),await l.saveOverride(n,s,a)}catch(c){console.error("[SaaS Core] Error saving:",c),alert("Error al guardar: "+c.message)}}),window.addEventListener("SAAS_RESET_PRODUCT",async i=>{const{productId:n,tableName:s}=i.detail;try{const a=new o,{default:c}=await A(async()=>{const{default:d}=await import("./AuthService-BxOLs-0-.js");return{default:d}},[]),l=c.getRestaurantId()||this.config.database.establishmentId;a.setRestaurantContext(l),await a.deleteProduct(n,s)}catch(a){console.error("[SaaS Core] Error resetting:",a),alert("Error al restaurar: "+a.message)}}),this._initAuthUI(t,e)}catch(e){console.error("[AppConfig]  Critical failure in SaaS initialization:",e)}}}_initAuthUI(e,t){console.log("[AppConfig] _initAuthUI called. Starting mount sequence...");const o=()=>{const i=document.getElementById("login-btn"),n=document.getElementById("register-btn"),s=document.getElementById("admin-mode-option");if(!i&&!n||!s){this._mountAttempts||(this._mountAttempts=0),this._mountAttempts<10?(this._mountAttempts++,setTimeout(o,200)):console.warn("[AppConfig] Auth UI elements not found after retries");return}const a=()=>{const l=!!t.user,d=document.getElementById("login-btn"),u=document.getElementById("register-btn");if(console.log("[AppConfig] Updating Auth UI. Logged:",l),l?(d&&(d.style.display="none",d.classList.add("hidden")),u&&(u.style.display="none",u.classList.add("hidden"))):(d&&(d.style.display="flex",d.classList.remove("hidden"),d.onclick=()=>e.show()),u&&(u.style.display="flex",u.classList.remove("hidden"),u.onclick=()=>e.showForRegistration())),s){s.style.display="flex",s.classList.remove("hidden");const p=s.querySelector("span");p&&(p.textContent=l?"Mi Cuenta":"Acceso Clientes"),s.onclick=()=>{e.show()}}};a(),t.subscribe(()=>a())};o()}_updateAdminUI(e,t){document.body.classList.toggle("mode-admin",e),document.querySelectorAll(".edit-product-btn")}loadConfiguration(){const e=this.detectEnvironment();return{environment:e,isDevelopment:e==="development",isProduction:e==="production",database:{supabaseUrl:this.getEnvVar("VITE_SUPABASE_URL","https://udtlqjmrtbcpdqknwuro.supabase.co"),supabaseKey:this.getEnvVar("VITE_SUPABASE_ANON_KEY","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVkdGxxam1ydGJjcGRxa253dXJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI5NDYyNzQsImV4cCI6MjA1ODUyMjI3NH0.5UW6IHyGVFfX5bnr5kv1XFIvevVxWvBoBy2a7_0visU"),establishmentId:this.getEnvVar("VITE_ESTABLISHMENT_ID","d290f1ee-6c54-4b01-90e6-d701748f0851"),establishmentName:this.getEnvVar("VITE_ESTABLISHMENT_NAME","Master Technology Bar"),enableCaching:this.getBooleanEnv("VITE_ENABLE_CACHING",!0),cacheTimeout:this.getNumberEnv("VITE_CACHE_TIMEOUT",3e5)},features:{orderSystem:!0,videoPlayback:!0,imageModal:!0,multipleCategories:!0,drinkCustomization:!0,meatCustomization:!0,orderHistory:!0,realTimeSync:!1,googleTranslateEnabled:this.getBooleanEnv("VITE_GOOGLE_TRANSLATE_ENABLED",!1)},validations:{ageCheck:{enabled:!1},stockEnabled:!1,orderValidation:!0,priceValidation:!0},ui:{theme:"light-blue",animations:{enabled:!0,duration:{welcome:3e3,logo:3e3,category:2e3,fade:1e3}},layout:{tableWidth:"63.75%",tableMaxWidth:"900px",tableMargin:"30px"},modals:{backdrop:"rgba(0, 0, 0, 0.8)",borderRadius:"15px",boxShadow:"0 0 30px var(--price-color)"}},products:{maxDrinkCount:5,enableVideoThumbnails:!0,enableImageModals:!0,defaultCategory:"cocteleria",categories:["cocteleria","refrescos","licores","cervezas","pizzas","alitas","sopas","ensaladas","carnes","cafe","postres"]},api:{timeout:this.getNumberEnv("VITE_API_TIMEOUT",1e4),retryAttempts:this.getNumberEnv("VITE_API_RETRY_ATTEMPTS",3),retryDelay:this.getNumberEnv("VITE_API_RETRY_DELAY",1e3),googleTranslateApiKey:this.getEnvVar("VITE_GOOGLE_TRANSLATE_API_KEY")},logging:{enabled:this.getBooleanEnv("VITE_ENABLE_LOGGING",e==="development"),level:this.getEnvVar("VITE_LOG_LEVEL",e==="development"?"debug":"error"),console:e==="development",remote:e==="production"},security:{sanitizeHtml:!0,validateInput:!0,enableCSP:e==="production",allowUnsafeEval:e==="development"}}}detectEnvironment(){if(typeof window>"u")return"server";const e=this.getEnvVar("VITE_ENVIRONMENT");if(e)return e;const t=window.location?.hostname||"";return t==="localhost"||t==="127.0.0.1"||t.includes("local")?"development":t.includes("staging")||t.includes("test")?"staging":"production"}getEnvVar(e,t=null){try{return Ft&&Ft[e]!==void 0?Ft[e]:window?.importMeta?.env?.[e]||globalThis?.importMeta?.env?.[e]||la?.[e]||window?.env?.[e]||t}catch{return t}}getBooleanEnv(e,t=!1){const o=this.getEnvVar(e);if(o==null)return t;if(typeof o=="boolean")return o;if(typeof o=="string"){const i=o.trim().toLowerCase();if(i==="true"||i==="1")return!0;if(i==="false"||i==="0")return!1}return t}getNumberEnv(e,t=0){const o=this.getEnvVar(e),i=parseInt(o,10);return isNaN(i)?t:i}validateConfiguration(){const e=[];this.config.database.supabaseUrl||e.push("Database URL is required"),this.config.database.supabaseKey||e.push("Database key is required");for(const[t,o]of Object.entries(this.config.features))typeof o!="boolean"&&e.push(`Feature flag '${t}' must be boolean, got ${typeof o}`);if((!Array.isArray(this.config.products.categories)||this.config.products.categories.length===0)&&e.push("Product categories must be a non-empty array"),e.length>0)throw new Error(`Configuration validation failed: ${e.join(", ")}`)}get(e,t=null){const o=e.split(".");let i=this.config;for(const n of o)if(i&&typeof i=="object"&&n in i)i=i[n];else return t;return i}isFeatureEnabled(e){if(e==="googleTranslateEnabled"&&this.getBooleanEnv("VITE_GOOGLE_TRANSLATE_ENABLED",!1))return!0;const t=this.get(`features.${e}`,!1);return console.log(`[AppConfig] isFeatureEnabled('${e}') returning:`,t),t}getValidationRule(e){return this.get(`validations.${e}`)}getUI(e){return this.get(`ui.${e}`)}getAll(){return JSON.parse(JSON.stringify(this.config))}reload(){this.config=this.loadConfiguration(),this.validateConfiguration()}getCategoryConfig(e){return!e||!this.interfaces?null:this.interfaces.find(t=>t.slug===e||t.categoria===e)||null}async waitForInitialSync(){await Promise.allSettled([this.fetchGlobalResources(),this.fetchInterfaces()])}}const T=new da;class nt{static#e=null;static getInstance(){if(!nt.#e){const e=T.getAll(),t=e.database.supabaseUrl,o=e.database.supabaseKey;(!t||!o)&&console.error("[SupabaseClient] CRITICAL: Supabase URL or Key is missing in AppConfig!"),console.log("[SupabaseClient] Creating shared singleton instance for:",t),nt.#e=aa(t,o)}return nt.#e}}const H=nt.getInstance();class h{static#e=!1;static info(e,t={}){this.#e||console.log(`[INFO] ${new Date().toISOString()} - ${e}`,t)}static error(e,t={}){console.error(`[ERROR] ${new Date().toISOString()} - ${e}`,t),this.#e&&t.stack}static warn(e,t={}){console.warn(`[WARN] ${new Date().toISOString()} - ${e}`,t)}static debug(e,t={}){this.#e||console.debug(`[DEBUG] ${new Date().toISOString()} - ${e}`,t)}}class ua{constructor(){this.config=T,this.appConfig=this.config.getAll(),this.supabase=H,this.translationCache=new Map,this.currentLanguage="es",this.supportedLanguages={es:"Espaol",en:"English",fr:"Franais",it:"Italiano",zh:""},h.info("TranslationService: Initialized"),this.initDebugPanel()}initDebugPanel(){if(!window.location.search.includes("debug=true"))return;let e=document.getElementById("translation-debug-panel");if(!e){e=document.createElement("div"),e.id="translation-debug-panel";const t=document.createElement("div");t.textContent="Translation Debug Log",e.appendChild(t),document.body.appendChild(e)}if(e){const t=document.createElement("div");t.className="translation-debug-controls";const o=document.createElement("button");o.textContent=" Clear Local Cache",o.className="translation-debug-btn translation-debug-btn--clear",o.onclick=()=>{this.clearCache(),this.logToPanel("Local cache cleared! Reloading...","success"),setTimeout(()=>window.location.reload(),500)};const i=document.createElement("button");i.textContent=" Reset DB for Current Lang",i.className="translation-debug-btn translation-debug-btn--reset",i.onclick=async()=>{if(this.currentLanguage==="es"){alert("Cannot delete Spanish (source) translations.");return}if(confirm(`Are you sure you want to delete ALL '${this.currentLanguage}' translations from the database? This forces a re-translation.`)){this.logToPanel(`Deleting all '${this.currentLanguage}' translations from DB...`,"info");const{error:n}=await this.supabase.from("translations").delete().eq("target_language",this.currentLanguage);n?this.logToPanel(`Error deleting DB: ${n.message}`,"error"):(this.logToPanel("DB cleared! Clearing local cache and reloading...","success"),this.clearCache(),setTimeout(()=>window.location.reload(),1e3))}},t.hasChildNodes()||(t.appendChild(o),t.appendChild(i)),e.querySelector(".translation-debug-controls")||(e.firstChild?e.insertBefore(t,e.firstChild.nextSibling):e.appendChild(t))}}logToPanel(e,t="info"){const o=document.getElementById("translation-debug-panel");if(o){const i=t==="error"?"red":t==="success"?"#0f0":"#fff";o.innerHTML+=`<div style="color:${i}">${e}</div>`,o.scrollTop=o.scrollHeight}}reloadConfig(){this.config&&typeof this.config.reload=="function"&&(this.config.reload(),this.appConfig=this.config.getAll(),h.info("TranslationService: Configuration reloaded"))}isValidTranslation(e,t,o){if(!t)return!1;if(o==="zh"&&!/[\u4e00-\u9fa5]/.test(t))return console.warn(`[Validation] Invalid Chinese translation (no chinese chars): "${t}"`),!1;if(o!=="es"&&e.trim().toLowerCase()===t.trim().toLowerCase()){const n=["mezcal","tequila","vodka","whisky","gin","ron","brandy","cognac","total","ml","700","750","1l","reserva","gran","anejo","blanco","reposado","cristalino","sherry","cask","double","black","label","red","blue","gold","platinum","1800","don","julio"].some(s=>e.toLowerCase().includes(s));if(e.length>40&&!n)return console.warn(`[Validation] Suspicious identical translation: "${e}" -> "${t}"`),!1}return!0}async getTranslation(e,t,o,i="general"){try{if(o==="es")return t;const n=`${e}_${i}_${o}`;if(this.translationCache.has(n))return h.debug(`Translation cache hit for: ${n}`),this.translationCache.get(n);const s=await this.getFromSupabase(e,o,i,t);if(s){if(this.isValidTranslation(t,s,o))return this.translationCache.set(n,s),h.debug(`Translation loaded from Supabase: ${e} -> ${o}`),s;h.warn(`Invalid translation found in DB for ${e}, ignoring.`)}if(!this.config.isFeatureEnabled("googleTranslateEnabled"))return h.info("Google Translate disabled by config; returning source text"),this.logToPanel(`Skipping: Google Translate disabled for ${e}`,"error"),t;this.logToPanel(`Requesting API: "${t.substring(0,15)}..." -> ${o}`,"info");const c=await this.requestTranslation(t,o);return c?this.isValidTranslation(t,c,o)?(await this.saveToSupabase(e,t,c,o,i),this.translationCache.set(n,c),h.info(`New translation created: ${e} (${o})`),c):(this.logToPanel(`Validation Failed: "${c}"`,"error"),h.warn(`Validation failed for ${e}, not saving.`),t):(h.warn(`Translation failed for ${e}, returning source text without saving.`),t)}catch(n){return h.error(`Translation error for ${e}:`,n),this.logToPanel(`Error getting translation for ${e}: ${n.message}`,"error"),t}}async getFromSupabase(e,t,o,i=null){try{const n=this.supabase.from("translations").select("translated_text").eq("text_key",e).eq("target_language",t).eq("namespace",o),s=typeof n.maybeSingle=="function"?await n.maybeSingle():await n.single(),{data:a,error:c,status:l}=s;if(c&&!(l===406||c.code==="PGRST116"))return h.error("Supabase translation query error:",c),this.logToPanel(`Supabase Error: ${c.message}`,"error"),null;if(a?.translated_text)return a.translated_text;if(i)try{const d=this.supabase.from("translations").select("translated_text").eq("source_text",i).eq("target_language",t).limit(1),u=typeof d.maybeSingle=="function"?await d.maybeSingle():await d.single(),{data:p,error:g,status:f}=u;return g?(f===406||g.code==="PGRST116"||h.debug("Supabase fallback by source_text returned error (non-fatal):",g),null):p?.translated_text||null}catch(d){return h.debug("Supabase fallback by source_text failed:",d),null}return null}catch(n){return h.error("Error fetching translation from Supabase:",n),null}}async requestTranslation(e,t){try{try{const l=new AbortController,d=setTimeout(()=>l.abort(),5e3),u=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,targetLanguage:t,sourceLanguage:"es"}),signal:l.signal});if(clearTimeout(d),u.ok)return(await u.json()).translatedText}catch(l){h.warn("Server-side translation failed, trying client-side fallback...",l)}const o=this.config.getEnvVar("VITE_GOOGLE_TRANSLATE_API_KEY");if(!o||o==="PLACEHOLDER_API_KEY_PLEASE_REPLACE")return h.error("Google Translate API key not configured or is placeholder"),console.warn("Please replace PLACEHOLDER_API_KEY_PLEASE_REPLACE in index.html with your actual Google Translate API Key"),null;this.logToPanel(`Using API Key: ${o.substring(0,5)}...`,"info");const i=`https://translation.googleapis.com/language/translate/v2?key=${o}`,n=new AbortController,s=setTimeout(()=>n.abort(),5e3),a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:e,source:"es",target:t,format:"text"}),signal:n.signal});if(clearTimeout(s),!a.ok){const l=await a.text();return this.logToPanel(`API Error: ${l}`,"error"),null}const c=await a.json();return this.logToPanel(`Success: ${e.substring(0,10)}... -> ${c.data.translations[0].translatedText.substring(0,10)}...`,"success"),c.data.translations[0].translatedText}catch(o){return o.name==="AbortError"?(h.error("Translation API timed out"),this.logToPanel("API Timeout after 5s","error")):h.error("Translation error (both server and client failed):",o),null}}async saveToSupabase(e,t,o,i,n){try{const{error:s}=await this.supabase.from("translations").upsert({text_key:e,namespace:n,source_language:"es",target_language:i,source_text:t,translated_text:o},{onConflict:"text_key,namespace,target_language"});s?h.error("Error saving translation to Supabase:",s):h.debug(`Translation saved to Supabase: ${e} -> ${i}`)}catch(s){h.error("Error saving translation to Supabase:",s)}}async translatePage(e){try{h.info(`Starting page translation to: ${e}`),this.logToPanel(`--- Starting Page Translation to ${e} ---`,"info"),this.currentLanguage=e;const t=document.querySelectorAll("[data-translate]");this.logToPanel(`Found ${t.length} elements to translate`,"info");const o=10,i=[],n=Array.from(t);for(let s=0;s<n.length;s+=o){const a=n.slice(s,s+o);this.logToPanel(`Processing batch ${Math.floor(s/o)+1} (Size: ${a.length})`,"info");const c=a.map(async(d,u)=>{const p=d.getAttribute("data-translate"),g=d.getAttribute("data-namespace")||"general",f=d.getAttribute("data-original-text")||d.textContent.trim();d.getAttribute("data-original-text")||d.setAttribute("data-original-text",f);try{const b=await this.getTranslation(p,f,e,g);return u===0&&this.logToPanel(`Batch Debug: "${f.substring(0,10)}..." -> "${b?b.substring(0,10):"null"}..."`,"info"),b&&(d.textContent=b),{textKey:p,translatedText:b}}catch(b){return h.error(`Error processing element ${p}:`,b),{textKey:p,error:b}}}),l=await Promise.all(c);i.push(...l),await new Promise(d=>setTimeout(d,20))}h.info(`Page translation completed. Translated ${i.length} elements to ${e}`),window.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:e,translations:i}}))}catch(t){h.error("Error translating page:",t),this.logToPanel(`Page Translation Error: ${t.message}`,"error")}}getCurrentLanguage(){return this.currentLanguage}getSupportedLanguages(){return this.supportedLanguages}clearCache(){this.translationCache.clear(),h.info("Translation cache cleared")}async preloadTranslations(e,t,o="general"){try{const i=e.map(async n=>{const s=document.querySelector(`[data-translate="${n}"]`);if(s){const a=s.textContent.trim();return this.getTranslation(n,a,t,o)}return Promise.resolve()});await Promise.all(i),h.info(`Preloaded ${e.length} translations for ${t}`)}catch(i){h.error("Error preloading translations:",i)}}}const He=new ua,ha=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"}));class pa{constructor(){this.translationService=He,this.observer=null,this.isInitialized=!1,this.translatedElements=new Set,h.info("DOMTranslator: Initialized")}initialize(){if(this.isInitialized){h.warn("DOMTranslator: Already initialized");return}this.identifyTranslatableElements(),this.setupMutationObserver(),this.isInitialized=!0,h.info("DOMTranslator: Initialization completed")}identifyTranslatableElements(){const e=["button:not([data-translate])","h1:not([data-translate])","h2:not([data-translate])","h3:not([data-translate])","h4:not([data-translate])","h5:not([data-translate])","h6:not([data-translate])","p:not([data-translate])","span.menu-text:not([data-translate])","span.category-name:not([data-translate])","label:not([data-translate])",".language-btn:not([data-translate])",".nav-btn:not([data-translate])",".drawer-menu .nav-button:not([data-translate])",".product-name:not([data-translate])",".product-description:not([data-translate])",".product-ingredients:not([data-translate])",".order-item-name:not([data-translate])",".saved-order-item-name:not([data-translate])",".price-label:not([data-translate])",".category-title:not([data-translate])",".welcome-text:not([data-translate])",".title-text:not([data-translate])"],t=["input[placeholder]:not([data-translate-placeholder])","textarea[placeholder]:not([data-translate-placeholder])"],o=["script","style","code","pre","[data-no-translate]",".price",".number",'[contenteditable="true"]'];e.forEach(i=>{document.querySelectorAll(i).forEach(s=>{if(this.isExcluded(s,o))return;const a=s.querySelector("[data-translate]")!==null,c=s.querySelector("#order-total-amount")!==null,l=Array.from(s.children||[]).some(g=>!!g.id);if(a||c||l)return;const d=s.textContent.trim();if(!d||d.length<2||/^[\d\s\$\\\\\.\,\-\+\(\)]+$/.test(d))return;const u=this.generateTextKey(s,d),p=this.determineNamespace(s);s.setAttribute("data-translate",u),s.setAttribute("data-namespace",p),s.setAttribute("data-original-text",d),h.debug(`Marked for translation: ${u} (${p})`)})}),t.forEach(i=>{document.querySelectorAll(i).forEach(s=>{if(this.isExcluded(s,o))return;const a=(s.getAttribute("placeholder")||"").trim();if(!a||a.length<2)return;const c=this.determineNamespace(s)||"inputs",l=this.generatePlaceholderKey(s,a);s.setAttribute("data-translate-placeholder",l),s.setAttribute("data-namespace",c),s.setAttribute("data-original-placeholder",a),h.debug(`Marked placeholder for translation: ${l} (${c})`)})})}identifySpecificElement(e){const t=["script","style","code","pre","[data-no-translate]",".price",".number",'[contenteditable="true"]'];if(this.isExcluded(e,t))return;if((e.tagName==="INPUT"||e.tagName==="TEXTAREA")&&!e.hasAttribute("data-translate-placeholder")){const u=(e.getAttribute("placeholder")||"").trim();if(u&&u.length>1){const p=this.determineNamespace(e)||"inputs",g=this.generatePlaceholderKey(e,u);e.setAttribute("data-translate-placeholder",g),e.setAttribute("data-namespace",p),e.setAttribute("data-original-placeholder",u),h.debug(`DOMTranslator: Marked placeholder for translation: ${g} (${p})`)}}const o=e.textContent.trim();if(!o||o.length<2||/^[\d\s\$\\\\\.\,\-\+\(\)]+$/.test(o)||e.hasAttribute("data-translate"))return;const i=e.querySelector("[data-translate]")!==null,n=e.querySelector("#order-total-amount")!==null,s=Array.from(e.children||[]).some(u=>!!u.id);if(i||n||s)return;const a=["BUTTON","H1","H2","H3","H4","H5","H6","P","SPAN","LABEL"],c=["menu-text","category-name","language-btn","nav-btn","nav-button","product-name","product-description","product-ingredients","order-item-name","saved-order-item-name","price-label","category-title","welcome-text","title-text"],l=a.includes(e.tagName),d=c.some(u=>e.classList.contains(u));if(l||d){const u=this.generateTextKey(e,o),p=this.determineNamespace(e);e.setAttribute("data-translate",u),e.setAttribute("data-namespace",p),e.setAttribute("data-original-text",o),h.debug(`DOMTranslator: Marked element for translation: ${u} (${p})`)}}isExcluded(e,t){for(const o of t)if(e.matches(o))return!0;for(const o of t)if(e.closest(o))return!0;return!1}generateTextKey(e){if(e.id)return`${e.tagName.toLowerCase()}_${e.id}`;if(e.className){const n=e.className.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");if(n)return`${e.tagName.toLowerCase()}_${n}`}const t=e.parentElement;let o="";t&&(t.id?o=`${t.id}_`:t.className&&(o=`${t.className.split(" ")[0]}_`));const i=this.simpleHash(e.textContent.trim());return`${o}${e.tagName.toLowerCase()}_${i}`}generatePlaceholderKey(e,t){if(e.id)return`placeholder_${e.id}`;if(e.className){const s=e.className.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"");if(s)return`placeholder_${s}`}const o=e.parentElement;let i="";o&&(o.id?i=`${o.id}_`:o.className&&(i=`${o.className.split(" ")[0]}_`));const n=this.simpleHash((t||"").trim());return`${i}placeholder_${n}`}determineNamespace(e){return e.closest(".settings-menu, #settings-menu")?"settings":e.closest(".drawer-menu, #drawer-menu")?"menu":e.closest(".product-card, .product-item")?"products":e.closest("button")?"buttons":e.closest("nav, .navigation")?"navigation":e.matches("h1, h2, h3, h4, h5, h6")?"headings":"general"}simpleHash(e){let t=0;for(let o=0;o<e.length;o++){const i=e.charCodeAt(o);t=(t<<5)-t+i,t=t&t}return Math.abs(t).toString(36)}setupMutationObserver(){this.observer=new MutationObserver(e=>{e.forEach(t=>{t.type==="childList"&&t.addedNodes.forEach(o=>{o.nodeType===Node.ELEMENT_NODE&&this.processNewElement(o)})})}),this.observer.observe(document.body,{childList:!0,subtree:!0}),h.debug("DOMTranslator: Mutation observer set up")}processNewElement(e){this.observer&&this.observer.disconnect();try{[e,...e.querySelectorAll("*")].forEach(o=>{if(o.nodeType===Node.ELEMENT_NODE&&!o.hasAttribute("data-translate")){this.identifySpecificElement(o);const i=this.translationService.getCurrentLanguage();i!=="es"&&o.hasAttribute("data-translate")&&this.translateElement(o,i)}})}finally{this.observer&&this.observer.observe(document.body,{childList:!0,subtree:!0})}}async translateElement(e,t){const o=e.getAttribute("data-translate"),i=e.getAttribute("data-namespace")||"general",n=e.getAttribute("data-original-text")||e.textContent.trim();if(!o||!n)return;try{const c=await this.translationService.getTranslation(o,n,t,i);e.textContent=c,this.translatedElements.add(e)}catch(c){h.error(`Error translating element ${o}:`,c)}const s=e.getAttribute("data-translate-placeholder"),a=e.getAttribute("data-original-placeholder");if(s&&a)try{const c=await this.translationService.getTranslation(s,a,t,e.getAttribute("data-namespace")||"inputs");e.setAttribute("placeholder",c)}catch(c){h.error(`Error translating placeholder ${s}:`,c)}}async translateAll(e){const t=document.querySelectorAll("[data-translate], [data-translate-placeholder]"),o=Array.from(t).map(i=>this.translateElement(i,e));await Promise.all(o),h.info(`Translated ${t.length} elements (including placeholders) to ${e}`)}resetToOriginal(){document.querySelectorAll("[data-translate][data-original-text]").forEach(t=>{const o=t.getAttribute("data-original-text");o&&(t.textContent=o)}),this.translatedElements.clear(),h.info("Reset all elements to original language")}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.resetToOriginal(),this.translatedElements.clear(),this.isInitialized=!1,h.info("DOMTranslator: Destroyed")}getStats(){const e=document.querySelectorAll("[data-translate]").length,t=this.translatedElements.size;return{totalTranslatableElements:e,currentlyTranslated:t,currentLanguage:this.translationService.getCurrentLanguage()}}}const lt=new pa,ga=Object.freeze(Object.defineProperty({__proto__:null,default:lt},Symbol.toStringTag,{value:"Module"}));class fa{constructor(){this.settingsBtn=document.getElementById("settings-btn"),this.settingsMenu=document.getElementById("settings-menu"),this.settingsOverlay=document.getElementById("settings-overlay"),this.mainPanel=document.getElementById("main-settings-panel"),this.languagesPanel=document.getElementById("languages-panel"),this.darkModePanel=document.getElementById("dark-mode-panel"),this.lightModePanel=document.getElementById("light-mode-panel"),this.settingsBackBtn=document.getElementById("settings-back-btn"),this.languagesOption=document.getElementById("languages-option"),this.darkModeOption=document.getElementById("dark-mode-option"),this.lightModeOption=document.getElementById("light-mode-option"),this.backToMainBtn=document.getElementById("back-to-main"),this.backFromDarkBtn=document.getElementById("back-from-dark"),this.backFromLightBtn=document.getElementById("back-from-light"),this.languageBtns=document.querySelectorAll(".language-btn"),this.themeBtns=document.querySelectorAll(".theme-btn"),this.backgroundVideo=document.getElementById("background-video"),this.translationService=He,this.domTranslator=lt,this.isTranslationInitialized=!1,this.initListeners(),this.initializeTranslation(),window.addEventListener("app:resources-ready",e=>{this.updateDynamicResources(e.detail)}),document.addEventListener("navigation:starting",()=>{this.updateLogosForTheme(document.body.getAttribute("data-theme"))})}initListeners(){console.log("SettingsManager: Initializing listeners"),this.settingsBtn||console.error("SettingsManager: settingsBtn not found"),this.settingsMenu||console.error("SettingsManager: settingsMenu not found"),!this.languageBtns||this.languageBtns.length===0?console.error("SettingsManager: No language buttons found"):console.log(`SettingsManager: Found ${this.languageBtns.length} language buttons`),this.settingsBtn.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault(),this.toggleSettingsMenu()}),this.settingsBackBtn.addEventListener("click",()=>{this.closeSettingsMenu()}),this.languagesOption.addEventListener("click",()=>{this.showPanel(this.languagesPanel)}),this.darkModeOption.addEventListener("click",()=>{this.showPanel(this.darkModePanel)}),this.lightModeOption.addEventListener("click",()=>{this.showPanel(this.lightModePanel)}),this.backToMainBtn.addEventListener("click",()=>{this.showPanel(this.mainPanel)}),this.backFromDarkBtn.addEventListener("click",()=>{this.showPanel(this.mainPanel)}),this.backFromLightBtn.addEventListener("click",()=>{this.showPanel(this.mainPanel)}),this.languagesPanel&&this.languagesPanel.addEventListener("click",e=>{const t=e.target.closest(".language-btn");if(!t)return;const o=t.getAttribute("data-lang");this.changeLanguage(o)}),this.themeBtns.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-theme"),o=e.getAttribute("data-video");this.changeTheme(t,o)})})}async toggleSettingsMenu(){try{(await A(()=>import("./SettingsDrawer-BQVYxWAK.js"),[])).default.toggle()}catch(e){console.error("SettingsManager: Failed to load SettingsDrawer",e)}}async closeSettingsMenu(){try{(await A(()=>import("./SettingsDrawer-BQVYxWAK.js"),[])).default.close()}catch(e){console.error("SettingsManager: Failed to load SettingsDrawer",e)}}async showPanel(e){if(e)try{(await A(()=>import("./SettingsDrawer-BQVYxWAK.js"),[])).default.showPanel(e.id)}catch{document.querySelectorAll(".settings-panel").forEach(i=>i.classList.add("u-hidden")),e.classList.remove("u-hidden"),e.classList.add("u-fade-in")}}async changeLanguage(e){console.log(`Changing language to: ${e}`);try{this.isTranslationInitialized||await this.initializeTranslation(),this.translationService&&typeof this.translationService.reloadConfig=="function"?this.translationService.reloadConfig():this.translationService.config&&typeof this.translationService.config.reload=="function"&&this.translationService.config.reload(),this.showLanguageLoadingState(!0),await this.translationService.translatePage(e),this.languageBtns.forEach(t=>{t.getAttribute("data-lang")===e?t.classList.add("active"):t.classList.remove("active")}),localStorage.setItem("selectedLanguage",e),this.showLanguageLoadingState(!1),console.log(` Language successfully changed to: ${e}`),setTimeout(()=>{this.closeSettingsMenu()},500)}catch(t){console.error("Error changing language:",t),this.showLanguageLoadingState(!1),this.showLanguageError(e)}}changeTheme(e,t){if(console.log(`Changing theme to: ${e}`),document.body.setAttribute("data-theme",e),this.updateLogosForTheme(e),t&&this.backgroundVideo){const o=document.createElement("source");for(o.src=t,o.type="video/mp4";this.backgroundVideo.firstChild;)this.backgroundVideo.removeChild(this.backgroundVideo.firstChild);this.backgroundVideo.appendChild(o),this.backgroundVideo.load(),this.backgroundVideo.muted=!0,this.backgroundVideo.loop=!0}this.backgroundVideo&&(e==="light-white"?t?(this.backgroundVideo.classList.remove("u-hidden"),this.backgroundVideo.classList.add("u-block"),this.backgroundVideo.play().catch(()=>{})):(this.backgroundVideo.pause(),this.backgroundVideo.classList.remove("u-block"),this.backgroundVideo.classList.add("u-hidden")):(this.backgroundVideo.classList.remove("u-hidden"),this.backgroundVideo.classList.add("u-block"),this.backgroundVideo.play().catch(()=>{}),this.backgroundVideo.style.display="")),document.body.style.backgroundColor="",this.themeBtns.forEach(o=>{o.getAttribute("data-theme")===e?o.classList.add("active"):o.classList.remove("active")});try{localStorage.setItem("selectedTheme",e),t&&localStorage.setItem("selectedVideoUrl",t)}catch(o){console.error("Error saving theme preference:",o)}}async initializeTranslation(){try{console.log(" Initializing translation system..."),this.translationService&&typeof this.translationService.reloadConfig=="function"?this.translationService.reloadConfig():this.translationService.config&&typeof this.translationService.config.reload=="function"&&this.translationService.config.reload(),this.domTranslator.initialize(),this.isTranslationInitialized=!0,console.log(" Translation system initialized successfully")}catch(e){console.error(" Error initializing translation system:",e),this.isTranslationInitialized=!1}}showLanguageLoadingState(e){document.querySelectorAll(".language-btn").forEach(i=>{e?(i.classList.add("u-opacity-60","u-pointer-events-none"),i.classList.remove("u-pointer-events-auto","u-opacity-100")):(i.classList.add("u-pointer-events-auto","u-opacity-100"),i.classList.remove("u-opacity-60","u-pointer-events-none"))});const o=document.getElementById("languages-panel");o&&(e?o.classList.add("loading"):o.classList.remove("loading"))}showLanguageError(e){console.error(`Failed to change language to: ${e}`);const t=`Error al cambiar idioma a ${e}. Intntalo de nuevo.`;window.confirm(`${t}

Quieres intentar de nuevo?`)&&setTimeout(()=>{this.changeLanguage(e)},1e3)}updateDynamicResources(e){console.log("[SettingsManager] Updating UI with dynamic resources..."),this.themeBtns.forEach(i=>{const n=i.getAttribute("data-theme");let s=null;n==="dark-blue"?s=e.bg_dark_blue?.url||e.bg_dark_blue:n==="dark-red"?s=e.bg_dark_red?.url||e.bg_dark_red:n==="light-blue"?s=e.bg_light_blue?.url||e.bg_light_blue:n==="light-white"&&(s=e.bg_white?.url||e.bg_white),s&&(i.setAttribute("data-video",s),console.log(`[SettingsManager] Theme '${n}' video updated.`))});const t=document.body.getAttribute("data-theme");let o=null;if(t==="dark-blue"?o=e.bg_dark_blue?.url||e.bg_dark_blue:t==="dark-red"?o=e.bg_dark_red?.url||e.bg_dark_red:t==="light-blue"?o=e.bg_light_blue?.url||e.bg_light_blue:t==="light-white"&&(o=e.bg_white?.url||e.bg_white),o&&this.backgroundVideo){const i=this.backgroundVideo.querySelector("source");i&&!i.src.includes(o)&&(console.log(`[SettingsManager] Refreshing current background video for theme: ${t}`),this.changeTheme(t,o))}}async applySavedPreferences(){try{const e=localStorage.getItem("selectedLanguage");e&&document.querySelector(`.language-btn[data-lang="${e}"]`)&&setTimeout(async()=>{await this.changeLanguage(e)},200);const t=localStorage.getItem("selectedTheme"),o=localStorage.getItem("selectedVideoUrl");if(t){document.body.setAttribute("data-theme",t),this.updateLogosForTheme(t);const i=document.querySelector(`.theme-btn[data-theme="${t}"]`);i&&i.classList.add("active"),window.__initialThemeApplied||this.changeTheme(t,o)}else{const i="light-blue";document.body.setAttribute("data-theme",i),this.updateLogosForTheme(i)}}catch(e){console.error("Error applying saved preferences:",e)}}getLogoUrl(e){return T&&T.resources&&T.resources.logo?T.resources.logo:""}updateLogosForTheme(e){const t=this.getLogoUrl(e),o=document.querySelector(".logo-screen .logo-container img.logo");o&&(o.src=t);const i=document.querySelector(".drawer-logo");i&&(i.src=t);const n=document.querySelector('meta[property="og:image"]'),s=document.querySelector('meta[property="twitter:image"]');n&&n.setAttribute("content",t),s&&s.setAttribute("content",t)}}document.addEventListener("DOMContentLoaded",()=>{setTimeout(async()=>{const r=new fa;await r.applySavedPreferences(),window.SettingsManager=r,console.log(" SettingsManager initialized with translation support")},100)});function m(r,e,t){function o(a,c){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:c,constr:s,traits:new Set},enumerable:!1}),a._zod.traits.has(r))return;a._zod.traits.add(r),e(a,c);const l=s.prototype,d=Object.keys(l);for(let u=0;u<d.length;u++){const p=d[u];p in a||(a[p]=l[p].bind(a))}}const i=t?.Parent??Object;class n extends i{}Object.defineProperty(n,"name",{value:r});function s(a){var c;const l=t?.Parent?new n:this;o(l,a),(c=l._zod).deferred??(c.deferred=[]);for(const d of l._zod.deferred)d();return l}return Object.defineProperty(s,"init",{value:o}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>t?.Parent&&a instanceof t.Parent?!0:a?._zod?.traits?.has(r)}),Object.defineProperty(s,"name",{value:r}),s}class Ze extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class ti extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const ri={};function we(r){return ri}function ma(r){const e=Object.values(r).filter(o=>typeof o=="number");return Object.entries(r).filter(([o,i])=>e.indexOf(+o)===-1).map(([o,i])=>i)}function ar(r,e){return typeof e=="bigint"?e.toString():e}function yr(r){return{get value(){{const e=r();return Object.defineProperty(this,"value",{value:e}),e}}}}function _r(r){return r==null}function wr(r){const e=r.startsWith("^")?1:0,t=r.endsWith("$")?r.length-1:r.length;return r.slice(e,t)}function ba(r,e){const t=(r.toString().split(".")[1]||"").length,o=e.toString();let i=(o.split(".")[1]||"").length;if(i===0&&/\d?e-\d?/.test(o)){const c=o.match(/\d?e-(\d?)/);c?.[1]&&(i=Number.parseInt(c[1]))}const n=t>i?t:i,s=Number.parseInt(r.toFixed(n).replace(".","")),a=Number.parseInt(e.toFixed(n).replace(".",""));return s%a/10**n}const io=Symbol("evaluating");function j(r,e,t){let o;Object.defineProperty(r,e,{get(){if(o!==io)return o===void 0&&(o=io,o=t()),o},set(i){Object.defineProperty(r,e,{value:i})},configurable:!0})}function Se(r,e,t){Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0})}function ke(...r){const e={};for(const t of r){const o=Object.getOwnPropertyDescriptors(t);Object.assign(e,o)}return Object.defineProperties({},e)}function no(r){return JSON.stringify(r)}function va(r){return r.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const oi="captureStackTrace"in Error?Error.captureStackTrace:(...r)=>{};function Ot(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}const ya=yr(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const r=Function;return new r(""),!0}catch{return!1}});function dt(r){if(Ot(r)===!1)return!1;const e=r.constructor;if(e===void 0||typeof e!="function")return!0;const t=e.prototype;return!(Ot(t)===!1||Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")===!1)}function ii(r){return dt(r)?{...r}:Array.isArray(r)?[...r]:r}const _a=new Set(["string","number","symbol"]);function Lt(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function he(r,e,t){const o=new r._zod.constr(e??r._zod.def);return(!e||t?.parent)&&(o._zod.parent=r),o}function E(r){const e=r;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function wa(r){return Object.keys(r).filter(e=>r[e]._zod.optin==="optional"&&r[e]._zod.optout==="optional")}const Ea={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Ca(r,e){const t=r._zod.def,o=ke(r._zod.def,{get shape(){const i={};for(const n in e){if(!(n in t.shape))throw new Error(`Unrecognized key: "${n}"`);e[n]&&(i[n]=t.shape[n])}return Se(this,"shape",i),i},checks:[]});return he(r,o)}function Sa(r,e){const t=r._zod.def,o=ke(r._zod.def,{get shape(){const i={...r._zod.def.shape};for(const n in e){if(!(n in t.shape))throw new Error(`Unrecognized key: "${n}"`);e[n]&&delete i[n]}return Se(this,"shape",i),i},checks:[]});return he(r,o)}function ka(r,e){if(!dt(e))throw new Error("Invalid input to extend: expected a plain object");const t=r._zod.def.checks;if(t&&t.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const i=ke(r._zod.def,{get shape(){const n={...r._zod.def.shape,...e};return Se(this,"shape",n),n},checks:[]});return he(r,i)}function Aa(r,e){if(!dt(e))throw new Error("Invalid input to safeExtend: expected a plain object");const t={...r._zod.def,get shape(){const o={...r._zod.def.shape,...e};return Se(this,"shape",o),o},checks:r._zod.def.checks};return he(r,t)}function Oa(r,e){const t=ke(r._zod.def,{get shape(){const o={...r._zod.def.shape,...e._zod.def.shape};return Se(this,"shape",o),o},get catchall(){return e._zod.def.catchall},checks:[]});return he(r,t)}function Ta(r,e,t){const o=ke(e._zod.def,{get shape(){const i=e._zod.def.shape,n={...i};if(t)for(const s in t){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(n[s]=r?new r({type:"optional",innerType:i[s]}):i[s])}else for(const s in i)n[s]=r?new r({type:"optional",innerType:i[s]}):i[s];return Se(this,"shape",n),n},checks:[]});return he(e,o)}function Ia(r,e,t){const o=ke(e._zod.def,{get shape(){const i=e._zod.def.shape,n={...i};if(t)for(const s in t){if(!(s in n))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(n[s]=new r({type:"nonoptional",innerType:i[s]}))}else for(const s in i)n[s]=new r({type:"nonoptional",innerType:i[s]});return Se(this,"shape",n),n},checks:[]});return he(e,o)}function Ve(r,e=0){if(r.aborted===!0)return!0;for(let t=e;t<r.issues.length;t++)if(r.issues[t]?.continue!==!0)return!0;return!1}function ni(r,e){return e.map(t=>{var o;return(o=t).path??(o.path=[]),t.path.unshift(r),t})}function bt(r){return typeof r=="string"?r:r?.message}function Ee(r,e,t){const o={...r,path:r.path??[]};if(!r.message){const i=bt(r.inst?._zod.def?.error?.(r))??bt(e?.error?.(r))??bt(t.customError?.(r))??bt(t.localeError?.(r))??"Invalid input";o.message=i}return delete o.inst,delete o.continue,e?.reportInput||delete o.input,o}function Er(r){return Array.isArray(r)?"array":typeof r=="string"?"string":"unknown"}function ut(...r){const[e,t,o]=r;return typeof e=="string"?{message:e,code:"custom",input:t,inst:o}:{...e}}const si=(r,e)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:e,enumerable:!1}),r.message=JSON.stringify(e,ar,2),Object.defineProperty(r,"toString",{value:()=>r.message,enumerable:!1})},ai=m("$ZodError",si),ci=m("$ZodError",si,{Parent:Error});function $a(r,e=t=>t.message){const t={},o=[];for(const i of r.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):o.push(e(i));return{formErrors:o,fieldErrors:t}}function La(r,e=t=>t.message){const t={_errors:[]},o=i=>{for(const n of i.issues)if(n.code==="invalid_union"&&n.errors.length)n.errors.map(s=>o({issues:s}));else if(n.code==="invalid_key")o({issues:n.issues});else if(n.code==="invalid_element")o({issues:n.issues});else if(n.path.length===0)t._errors.push(e(n));else{let s=t,a=0;for(;a<n.path.length;){const c=n.path[a];a===n.path.length-1?(s[c]=s[c]||{_errors:[]},s[c]._errors.push(e(n))):s[c]=s[c]||{_errors:[]},s=s[c],a++}}};return o(r),t}const Cr=r=>(e,t,o,i)=>{const n=o?Object.assign(o,{async:!1}):{async:!1},s=e._zod.run({value:t,issues:[]},n);if(s instanceof Promise)throw new Ze;if(s.issues.length){const a=new(i?.Err??r)(s.issues.map(c=>Ee(c,n,we())));throw oi(a,i?.callee),a}return s.value},Sr=r=>async(e,t,o,i)=>{const n=o?Object.assign(o,{async:!0}):{async:!0};let s=e._zod.run({value:t,issues:[]},n);if(s instanceof Promise&&(s=await s),s.issues.length){const a=new(i?.Err??r)(s.issues.map(c=>Ee(c,n,we())));throw oi(a,i?.callee),a}return s.value},Pt=r=>(e,t,o)=>{const i=o?{...o,async:!1}:{async:!1},n=e._zod.run({value:t,issues:[]},i);if(n instanceof Promise)throw new Ze;return n.issues.length?{success:!1,error:new(r??ai)(n.issues.map(s=>Ee(s,i,we())))}:{success:!0,data:n.value}},Pa=Pt(ci),jt=r=>async(e,t,o)=>{const i=o?Object.assign(o,{async:!0}):{async:!0};let n=e._zod.run({value:t,issues:[]},i);return n instanceof Promise&&(n=await n),n.issues.length?{success:!1,error:new r(n.issues.map(s=>Ee(s,i,we())))}:{success:!0,data:n.value}},ja=jt(ci),Ra=r=>(e,t,o)=>{const i=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return Cr(r)(e,t,i)},Na=r=>(e,t,o)=>Cr(r)(e,t,o),Da=r=>async(e,t,o)=>{const i=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return Sr(r)(e,t,i)},za=r=>async(e,t,o)=>Sr(r)(e,t,o),qa=r=>(e,t,o)=>{const i=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return Pt(r)(e,t,i)},xa=r=>(e,t,o)=>Pt(r)(e,t,o),Ma=r=>async(e,t,o)=>{const i=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return jt(r)(e,t,i)},Ba=r=>async(e,t,o)=>jt(r)(e,t,o),Ua=/^[cC][^\s-]{8,}$/,Va=/^[0-9a-z]+$/,Fa=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Ga=/^[0-9a-vA-V]{20}$/,Ha=/^[A-Za-z0-9]{27}$/,Za=/^[a-zA-Z0-9_-]{21}$/,Wa=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Ja=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,so=r=>r?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${r}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Ka=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Ya="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Xa(){return new RegExp(Ya,"u")}const Qa=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ec=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,tc=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,rc=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,oc=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,li=/^[A-Za-z0-9_-]*$/,ic=/^\+(?:[0-9]){6,14}[0-9]$/,di="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",nc=new RegExp(`^${di}$`);function ui(r){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof r.precision=="number"?r.precision===-1?`${e}`:r.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${r.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function sc(r){return new RegExp(`^${ui(r)}$`)}function ac(r){const e=ui({precision:r.precision}),t=["Z"];r.local&&t.push(""),r.offset&&t.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const o=`${e}(?:${t.join("|")})`;return new RegExp(`^${di}T(?:${o})$`)}const cc=r=>{const e=r?`[\\s\\S]{${r?.minimum??0},${r?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},lc=/^-?\d+$/,dc=/^-?\d+(?:\.\d+)?/,uc=/^(?:true|false)$/i,hc=/^[^A-Z]*$/,pc=/^[^a-z]*$/,W=m("$ZodCheck",(r,e)=>{var t;r._zod??(r._zod={}),r._zod.def=e,(t=r._zod).onattach??(t.onattach=[])}),hi={number:"number",bigint:"bigint",object:"date"},pi=m("$ZodCheckLessThan",(r,e)=>{W.init(r,e);const t=hi[typeof e.value];r._zod.onattach.push(o=>{const i=o._zod.bag,n=(e.inclusive?i.maximum:i.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<n&&(e.inclusive?i.maximum=e.value:i.exclusiveMaximum=e.value)}),r._zod.check=o=>{(e.inclusive?o.value<=e.value:o.value<e.value)||o.issues.push({origin:t,code:"too_big",maximum:e.value,input:o.value,inclusive:e.inclusive,inst:r,continue:!e.abort})}}),gi=m("$ZodCheckGreaterThan",(r,e)=>{W.init(r,e);const t=hi[typeof e.value];r._zod.onattach.push(o=>{const i=o._zod.bag,n=(e.inclusive?i.minimum:i.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>n&&(e.inclusive?i.minimum=e.value:i.exclusiveMinimum=e.value)}),r._zod.check=o=>{(e.inclusive?o.value>=e.value:o.value>e.value)||o.issues.push({origin:t,code:"too_small",minimum:e.value,input:o.value,inclusive:e.inclusive,inst:r,continue:!e.abort})}}),gc=m("$ZodCheckMultipleOf",(r,e)=>{W.init(r,e),r._zod.onattach.push(t=>{var o;(o=t._zod.bag).multipleOf??(o.multipleOf=e.value)}),r._zod.check=t=>{if(typeof t.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof t.value=="bigint"?t.value%e.value===BigInt(0):ba(t.value,e.value)===0)||t.issues.push({origin:typeof t.value,code:"not_multiple_of",divisor:e.value,input:t.value,inst:r,continue:!e.abort})}}),fc=m("$ZodCheckNumberFormat",(r,e)=>{W.init(r,e),e.format=e.format||"float64";const t=e.format?.includes("int"),o=t?"int":"number",[i,n]=Ea[e.format];r._zod.onattach.push(s=>{const a=s._zod.bag;a.format=e.format,a.minimum=i,a.maximum=n,t&&(a.pattern=lc)}),r._zod.check=s=>{const a=s.value;if(t){if(!Number.isInteger(a)){s.issues.push({expected:o,format:e.format,code:"invalid_type",continue:!1,input:a,inst:r});return}if(!Number.isSafeInteger(a)){a>0?s.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:r,origin:o,continue:!e.abort}):s.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:r,origin:o,continue:!e.abort});return}}a<i&&s.issues.push({origin:"number",input:a,code:"too_small",minimum:i,inclusive:!0,inst:r,continue:!e.abort}),a>n&&s.issues.push({origin:"number",input:a,code:"too_big",maximum:n,inst:r})}}),mc=m("$ZodCheckMaxLength",(r,e)=>{var t;W.init(r,e),(t=r._zod.def).when??(t.when=o=>{const i=o.value;return!_r(i)&&i.length!==void 0}),r._zod.onattach.push(o=>{const i=o._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<i&&(o._zod.bag.maximum=e.maximum)}),r._zod.check=o=>{const i=o.value;if(i.length<=e.maximum)return;const s=Er(i);o.issues.push({origin:s,code:"too_big",maximum:e.maximum,inclusive:!0,input:i,inst:r,continue:!e.abort})}}),bc=m("$ZodCheckMinLength",(r,e)=>{var t;W.init(r,e),(t=r._zod.def).when??(t.when=o=>{const i=o.value;return!_r(i)&&i.length!==void 0}),r._zod.onattach.push(o=>{const i=o._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>i&&(o._zod.bag.minimum=e.minimum)}),r._zod.check=o=>{const i=o.value;if(i.length>=e.minimum)return;const s=Er(i);o.issues.push({origin:s,code:"too_small",minimum:e.minimum,inclusive:!0,input:i,inst:r,continue:!e.abort})}}),vc=m("$ZodCheckLengthEquals",(r,e)=>{var t;W.init(r,e),(t=r._zod.def).when??(t.when=o=>{const i=o.value;return!_r(i)&&i.length!==void 0}),r._zod.onattach.push(o=>{const i=o._zod.bag;i.minimum=e.length,i.maximum=e.length,i.length=e.length}),r._zod.check=o=>{const i=o.value,n=i.length;if(n===e.length)return;const s=Er(i),a=n>e.length;o.issues.push({origin:s,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:o.value,inst:r,continue:!e.abort})}}),Rt=m("$ZodCheckStringFormat",(r,e)=>{var t,o;W.init(r,e),r._zod.onattach.push(i=>{const n=i._zod.bag;n.format=e.format,e.pattern&&(n.patterns??(n.patterns=new Set),n.patterns.add(e.pattern))}),e.pattern?(t=r._zod).check??(t.check=i=>{e.pattern.lastIndex=0,!e.pattern.test(i.value)&&i.issues.push({origin:"string",code:"invalid_format",format:e.format,input:i.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:r,continue:!e.abort})}):(o=r._zod).check??(o.check=()=>{})}),yc=m("$ZodCheckRegex",(r,e)=>{Rt.init(r,e),r._zod.check=t=>{e.pattern.lastIndex=0,!e.pattern.test(t.value)&&t.issues.push({origin:"string",code:"invalid_format",format:"regex",input:t.value,pattern:e.pattern.toString(),inst:r,continue:!e.abort})}}),_c=m("$ZodCheckLowerCase",(r,e)=>{e.pattern??(e.pattern=hc),Rt.init(r,e)}),wc=m("$ZodCheckUpperCase",(r,e)=>{e.pattern??(e.pattern=pc),Rt.init(r,e)}),Ec=m("$ZodCheckIncludes",(r,e)=>{W.init(r,e);const t=Lt(e.includes),o=new RegExp(typeof e.position=="number"?`^.{${e.position}}${t}`:t);e.pattern=o,r._zod.onattach.push(i=>{const n=i._zod.bag;n.patterns??(n.patterns=new Set),n.patterns.add(o)}),r._zod.check=i=>{i.value.includes(e.includes,e.position)||i.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:i.value,inst:r,continue:!e.abort})}}),Cc=m("$ZodCheckStartsWith",(r,e)=>{W.init(r,e);const t=new RegExp(`^${Lt(e.prefix)}.*`);e.pattern??(e.pattern=t),r._zod.onattach.push(o=>{const i=o._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(t)}),r._zod.check=o=>{o.value.startsWith(e.prefix)||o.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:o.value,inst:r,continue:!e.abort})}}),Sc=m("$ZodCheckEndsWith",(r,e)=>{W.init(r,e);const t=new RegExp(`.*${Lt(e.suffix)}$`);e.pattern??(e.pattern=t),r._zod.onattach.push(o=>{const i=o._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(t)}),r._zod.check=o=>{o.value.endsWith(e.suffix)||o.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:o.value,inst:r,continue:!e.abort})}}),kc=m("$ZodCheckOverwrite",(r,e)=>{W.init(r,e),r._zod.check=t=>{t.value=e.tx(t.value)}});class Ac{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const o=e.split(`
`).filter(s=>s),i=Math.min(...o.map(s=>s.length-s.trimStart().length)),n=o.map(s=>s.slice(i)).map(s=>" ".repeat(this.indent*2)+s);for(const s of n)this.content.push(s)}compile(){const e=Function,t=this?.args,i=[...(this?.content??[""]).map(n=>`  ${n}`)];return new e(...t,i.join(`
`))}}const Oc={major:4,minor:1,patch:13},x=m("$ZodType",(r,e)=>{var t;r??(r={}),r._zod.def=e,r._zod.bag=r._zod.bag||{},r._zod.version=Oc;const o=[...r._zod.def.checks??[]];r._zod.traits.has("$ZodCheck")&&o.unshift(r);for(const i of o)for(const n of i._zod.onattach)n(r);if(o.length===0)(t=r._zod).deferred??(t.deferred=[]),r._zod.deferred?.push(()=>{r._zod.run=r._zod.parse});else{const i=(s,a,c)=>{let l=Ve(s),d;for(const u of a){if(u._zod.def.when){if(!u._zod.def.when(s))continue}else if(l)continue;const p=s.issues.length,g=u._zod.check(s);if(g instanceof Promise&&c?.async===!1)throw new Ze;if(d||g instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await g,s.issues.length!==p&&(l||(l=Ve(s,p)))});else{if(s.issues.length===p)continue;l||(l=Ve(s,p))}}return d?d.then(()=>s):s},n=(s,a,c)=>{if(Ve(s))return s.aborted=!0,s;const l=i(a,o,c);if(l instanceof Promise){if(c.async===!1)throw new Ze;return l.then(d=>r._zod.parse(d,c))}return r._zod.parse(l,c)};r._zod.run=(s,a)=>{if(a.skipChecks)return r._zod.parse(s,a);if(a.direction==="backward"){const l=r._zod.parse({value:s.value,issues:[]},{...a,skipChecks:!0});return l instanceof Promise?l.then(d=>n(d,s,a)):n(l,s,a)}const c=r._zod.parse(s,a);if(c instanceof Promise){if(a.async===!1)throw new Ze;return c.then(l=>i(l,o,a))}return i(c,o,a)}}r["~standard"]={validate:i=>{try{const n=Pa(r,i);return n.success?{value:n.data}:{issues:n.error?.issues}}catch{return ja(r,i).then(s=>s.success?{value:s.data}:{issues:s.error?.issues})}},vendor:"zod",version:1}}),kr=m("$ZodString",(r,e)=>{x.init(r,e),r._zod.pattern=[...r?._zod.bag?.patterns??[]].pop()??cc(r._zod.bag),r._zod.parse=(t,o)=>{if(e.coerce)try{t.value=String(t.value)}catch{}return typeof t.value=="string"||t.issues.push({expected:"string",code:"invalid_type",input:t.value,inst:r}),t}}),N=m("$ZodStringFormat",(r,e)=>{Rt.init(r,e),kr.init(r,e)}),Tc=m("$ZodGUID",(r,e)=>{e.pattern??(e.pattern=Ja),N.init(r,e)}),Ic=m("$ZodUUID",(r,e)=>{if(e.version){const o={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(o===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=so(o))}else e.pattern??(e.pattern=so());N.init(r,e)}),$c=m("$ZodEmail",(r,e)=>{e.pattern??(e.pattern=Ka),N.init(r,e)}),Lc=m("$ZodURL",(r,e)=>{N.init(r,e),r._zod.check=t=>{try{const o=t.value.trim(),i=new URL(o);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(i.hostname)||t.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:t.value,inst:r,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||t.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:t.value,inst:r,continue:!e.abort})),e.normalize?t.value=i.href:t.value=o;return}catch{t.issues.push({code:"invalid_format",format:"url",input:t.value,inst:r,continue:!e.abort})}}}),Pc=m("$ZodEmoji",(r,e)=>{e.pattern??(e.pattern=Xa()),N.init(r,e)}),jc=m("$ZodNanoID",(r,e)=>{e.pattern??(e.pattern=Za),N.init(r,e)}),Rc=m("$ZodCUID",(r,e)=>{e.pattern??(e.pattern=Ua),N.init(r,e)}),Nc=m("$ZodCUID2",(r,e)=>{e.pattern??(e.pattern=Va),N.init(r,e)}),Dc=m("$ZodULID",(r,e)=>{e.pattern??(e.pattern=Fa),N.init(r,e)}),zc=m("$ZodXID",(r,e)=>{e.pattern??(e.pattern=Ga),N.init(r,e)}),qc=m("$ZodKSUID",(r,e)=>{e.pattern??(e.pattern=Ha),N.init(r,e)}),xc=m("$ZodISODateTime",(r,e)=>{e.pattern??(e.pattern=ac(e)),N.init(r,e)}),Mc=m("$ZodISODate",(r,e)=>{e.pattern??(e.pattern=nc),N.init(r,e)}),Bc=m("$ZodISOTime",(r,e)=>{e.pattern??(e.pattern=sc(e)),N.init(r,e)}),Uc=m("$ZodISODuration",(r,e)=>{e.pattern??(e.pattern=Wa),N.init(r,e)}),Vc=m("$ZodIPv4",(r,e)=>{e.pattern??(e.pattern=Qa),N.init(r,e),r._zod.bag.format="ipv4"}),Fc=m("$ZodIPv6",(r,e)=>{e.pattern??(e.pattern=ec),N.init(r,e),r._zod.bag.format="ipv6",r._zod.check=t=>{try{new URL(`http://[${t.value}]`)}catch{t.issues.push({code:"invalid_format",format:"ipv6",input:t.value,inst:r,continue:!e.abort})}}}),Gc=m("$ZodCIDRv4",(r,e)=>{e.pattern??(e.pattern=tc),N.init(r,e)}),Hc=m("$ZodCIDRv6",(r,e)=>{e.pattern??(e.pattern=rc),N.init(r,e),r._zod.check=t=>{const o=t.value.split("/");try{if(o.length!==2)throw new Error;const[i,n]=o;if(!n)throw new Error;const s=Number(n);if(`${s}`!==n)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${i}]`)}catch{t.issues.push({code:"invalid_format",format:"cidrv6",input:t.value,inst:r,continue:!e.abort})}}});function fi(r){if(r==="")return!0;if(r.length%4!==0)return!1;try{return atob(r),!0}catch{return!1}}const Zc=m("$ZodBase64",(r,e)=>{e.pattern??(e.pattern=oc),N.init(r,e),r._zod.bag.contentEncoding="base64",r._zod.check=t=>{fi(t.value)||t.issues.push({code:"invalid_format",format:"base64",input:t.value,inst:r,continue:!e.abort})}});function Wc(r){if(!li.test(r))return!1;const e=r.replace(/[-_]/g,o=>o==="-"?"+":"/"),t=e.padEnd(Math.ceil(e.length/4)*4,"=");return fi(t)}const Jc=m("$ZodBase64URL",(r,e)=>{e.pattern??(e.pattern=li),N.init(r,e),r._zod.bag.contentEncoding="base64url",r._zod.check=t=>{Wc(t.value)||t.issues.push({code:"invalid_format",format:"base64url",input:t.value,inst:r,continue:!e.abort})}}),Kc=m("$ZodE164",(r,e)=>{e.pattern??(e.pattern=ic),N.init(r,e)});function Yc(r,e=null){try{const t=r.split(".");if(t.length!==3)return!1;const[o]=t;if(!o)return!1;const i=JSON.parse(atob(o));return!("typ"in i&&i?.typ!=="JWT"||!i.alg||e&&(!("alg"in i)||i.alg!==e))}catch{return!1}}const Xc=m("$ZodJWT",(r,e)=>{N.init(r,e),r._zod.check=t=>{Yc(t.value,e.alg)||t.issues.push({code:"invalid_format",format:"jwt",input:t.value,inst:r,continue:!e.abort})}}),mi=m("$ZodNumber",(r,e)=>{x.init(r,e),r._zod.pattern=r._zod.bag.pattern??dc,r._zod.parse=(t,o)=>{if(e.coerce)try{t.value=Number(t.value)}catch{}const i=t.value;if(typeof i=="number"&&!Number.isNaN(i)&&Number.isFinite(i))return t;const n=typeof i=="number"?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return t.issues.push({expected:"number",code:"invalid_type",input:i,inst:r,...n?{received:n}:{}}),t}}),Qc=m("$ZodNumberFormat",(r,e)=>{fc.init(r,e),mi.init(r,e)}),el=m("$ZodBoolean",(r,e)=>{x.init(r,e),r._zod.pattern=uc,r._zod.parse=(t,o)=>{if(e.coerce)try{t.value=!!t.value}catch{}const i=t.value;return typeof i=="boolean"||t.issues.push({expected:"boolean",code:"invalid_type",input:i,inst:r}),t}}),tl=m("$ZodUnknown",(r,e)=>{x.init(r,e),r._zod.parse=t=>t}),rl=m("$ZodNever",(r,e)=>{x.init(r,e),r._zod.parse=(t,o)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:r}),t)});function ao(r,e,t){r.issues.length&&e.issues.push(...ni(t,r.issues)),e.value[t]=r.value}const ol=m("$ZodArray",(r,e)=>{x.init(r,e),r._zod.parse=(t,o)=>{const i=t.value;if(!Array.isArray(i))return t.issues.push({expected:"array",code:"invalid_type",input:i,inst:r}),t;t.value=Array(i.length);const n=[];for(let s=0;s<i.length;s++){const a=i[s],c=e.element._zod.run({value:a,issues:[]},o);c instanceof Promise?n.push(c.then(l=>ao(l,t,s))):ao(c,t,s)}return n.length?Promise.all(n).then(()=>t):t}});function Tt(r,e,t,o){r.issues.length&&e.issues.push(...ni(t,r.issues)),r.value===void 0?t in o&&(e.value[t]=void 0):e.value[t]=r.value}function bi(r){const e=Object.keys(r.shape);for(const o of e)if(!r.shape?.[o]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${o}": expected a Zod schema`);const t=wa(r.shape);return{...r,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(t)}}function vi(r,e,t,o,i,n){const s=[],a=i.keySet,c=i.catchall._zod,l=c.def.type;for(const d in e){if(a.has(d))continue;if(l==="never"){s.push(d);continue}const u=c.run({value:e[d],issues:[]},o);u instanceof Promise?r.push(u.then(p=>Tt(p,t,d,e))):Tt(u,t,d,e)}return s.length&&t.issues.push({code:"unrecognized_keys",keys:s,input:e,inst:n}),r.length?Promise.all(r).then(()=>t):t}const il=m("$ZodObject",(r,e)=>{if(x.init(r,e),!Object.getOwnPropertyDescriptor(e,"shape")?.get){const a=e.shape;Object.defineProperty(e,"shape",{get:()=>{const c={...a};return Object.defineProperty(e,"shape",{value:c}),c}})}const o=yr(()=>bi(e));j(r._zod,"propValues",()=>{const a=e.shape,c={};for(const l in a){const d=a[l]._zod;if(d.values){c[l]??(c[l]=new Set);for(const u of d.values)c[l].add(u)}}return c});const i=Ot,n=e.catchall;let s;r._zod.parse=(a,c)=>{s??(s=o.value);const l=a.value;if(!i(l))return a.issues.push({expected:"object",code:"invalid_type",input:l,inst:r}),a;a.value={};const d=[],u=s.shape;for(const p of s.keys){const f=u[p]._zod.run({value:l[p],issues:[]},c);f instanceof Promise?d.push(f.then(b=>Tt(b,a,p,l))):Tt(f,a,p,l)}return n?vi(d,l,a,c,o.value,r):d.length?Promise.all(d).then(()=>a):a}}),nl=m("$ZodObjectJIT",(r,e)=>{il.init(r,e);const t=r._zod.parse,o=yr(()=>bi(e)),i=p=>{const g=new Ac(["shape","payload","ctx"]),f=o.value,b=y=>{const w=no(y);return`shape[${w}]._zod.run({ value: input[${w}], issues: [] }, ctx)`};g.write("const input = payload.value;");const v=Object.create(null);let S=0;for(const y of f.keys)v[y]=`key_${S++}`;g.write("const newResult = {};");for(const y of f.keys){const w=v[y],$=no(y);g.write(`const ${w} = ${b(y)};`),g.write(`
        if (${w}.issues.length) {
          payload.issues = payload.issues.concat(${w}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${$}, ...iss.path] : [${$}]
          })));
        }
        
        
        if (${w}.value === undefined) {
          if (${$} in input) {
            newResult[${$}] = undefined;
          }
        } else {
          newResult[${$}] = ${w}.value;
        }
        
      `)}g.write("payload.value = newResult;"),g.write("return payload;");const _=g.compile();return(y,w)=>_(p,y,w)};let n;const s=Ot,a=!ri.jitless,l=a&&ya.value,d=e.catchall;let u;r._zod.parse=(p,g)=>{u??(u=o.value);const f=p.value;return s(f)?a&&l&&g?.async===!1&&g.jitless!==!0?(n||(n=i(e.shape)),p=n(p,g),d?vi([],f,p,g,u,r):p):t(p,g):(p.issues.push({expected:"object",code:"invalid_type",input:f,inst:r}),p)}});function co(r,e,t,o){for(const n of r)if(n.issues.length===0)return e.value=n.value,e;const i=r.filter(n=>!Ve(n));return i.length===1?(e.value=i[0].value,i[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:t,errors:r.map(n=>n.issues.map(s=>Ee(s,o,we())))}),e)}const sl=m("$ZodUnion",(r,e)=>{x.init(r,e),j(r._zod,"optin",()=>e.options.some(i=>i._zod.optin==="optional")?"optional":void 0),j(r._zod,"optout",()=>e.options.some(i=>i._zod.optout==="optional")?"optional":void 0),j(r._zod,"values",()=>{if(e.options.every(i=>i._zod.values))return new Set(e.options.flatMap(i=>Array.from(i._zod.values)))}),j(r._zod,"pattern",()=>{if(e.options.every(i=>i._zod.pattern)){const i=e.options.map(n=>n._zod.pattern);return new RegExp(`^(${i.map(n=>wr(n.source)).join("|")})$`)}});const t=e.options.length===1,o=e.options[0]._zod.run;r._zod.parse=(i,n)=>{if(t)return o(i,n);let s=!1;const a=[];for(const c of e.options){const l=c._zod.run({value:i.value,issues:[]},n);if(l instanceof Promise)a.push(l),s=!0;else{if(l.issues.length===0)return l;a.push(l)}}return s?Promise.all(a).then(c=>co(c,i,r,n)):co(a,i,r,n)}}),al=m("$ZodIntersection",(r,e)=>{x.init(r,e),r._zod.parse=(t,o)=>{const i=t.value,n=e.left._zod.run({value:i,issues:[]},o),s=e.right._zod.run({value:i,issues:[]},o);return n instanceof Promise||s instanceof Promise?Promise.all([n,s]).then(([c,l])=>lo(t,c,l)):lo(t,n,s)}});function cr(r,e){if(r===e)return{valid:!0,data:r};if(r instanceof Date&&e instanceof Date&&+r==+e)return{valid:!0,data:r};if(dt(r)&&dt(e)){const t=Object.keys(e),o=Object.keys(r).filter(n=>t.indexOf(n)!==-1),i={...r,...e};for(const n of o){const s=cr(r[n],e[n]);if(!s.valid)return{valid:!1,mergeErrorPath:[n,...s.mergeErrorPath]};i[n]=s.data}return{valid:!0,data:i}}if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return{valid:!1,mergeErrorPath:[]};const t=[];for(let o=0;o<r.length;o++){const i=r[o],n=e[o],s=cr(i,n);if(!s.valid)return{valid:!1,mergeErrorPath:[o,...s.mergeErrorPath]};t.push(s.data)}return{valid:!0,data:t}}return{valid:!1,mergeErrorPath:[]}}function lo(r,e,t){if(e.issues.length&&r.issues.push(...e.issues),t.issues.length&&r.issues.push(...t.issues),Ve(r))return r;const o=cr(e.value,t.value);if(!o.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(o.mergeErrorPath)}`);return r.value=o.data,r}const cl=m("$ZodEnum",(r,e)=>{x.init(r,e);const t=ma(e.entries),o=new Set(t);r._zod.values=o,r._zod.pattern=new RegExp(`^(${t.filter(i=>_a.has(typeof i)).map(i=>typeof i=="string"?Lt(i):i.toString()).join("|")})$`),r._zod.parse=(i,n)=>{const s=i.value;return o.has(s)||i.issues.push({code:"invalid_value",values:t,input:s,inst:r}),i}}),ll=m("$ZodTransform",(r,e)=>{x.init(r,e),r._zod.parse=(t,o)=>{if(o.direction==="backward")throw new ti(r.constructor.name);const i=e.transform(t.value,t);if(o.async)return(i instanceof Promise?i:Promise.resolve(i)).then(s=>(t.value=s,t));if(i instanceof Promise)throw new Ze;return t.value=i,t}});function uo(r,e){return r.issues.length&&e===void 0?{issues:[],value:void 0}:r}const dl=m("$ZodOptional",(r,e)=>{x.init(r,e),r._zod.optin="optional",r._zod.optout="optional",j(r._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),j(r._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${wr(t.source)})?$`):void 0}),r._zod.parse=(t,o)=>{if(e.innerType._zod.optin==="optional"){const i=e.innerType._zod.run(t,o);return i instanceof Promise?i.then(n=>uo(n,t.value)):uo(i,t.value)}return t.value===void 0?t:e.innerType._zod.run(t,o)}}),ul=m("$ZodNullable",(r,e)=>{x.init(r,e),j(r._zod,"optin",()=>e.innerType._zod.optin),j(r._zod,"optout",()=>e.innerType._zod.optout),j(r._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${wr(t.source)}|null)$`):void 0}),j(r._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),r._zod.parse=(t,o)=>t.value===null?t:e.innerType._zod.run(t,o)}),hl=m("$ZodDefault",(r,e)=>{x.init(r,e),r._zod.optin="optional",j(r._zod,"values",()=>e.innerType._zod.values),r._zod.parse=(t,o)=>{if(o.direction==="backward")return e.innerType._zod.run(t,o);if(t.value===void 0)return t.value=e.defaultValue,t;const i=e.innerType._zod.run(t,o);return i instanceof Promise?i.then(n=>ho(n,e)):ho(i,e)}});function ho(r,e){return r.value===void 0&&(r.value=e.defaultValue),r}const pl=m("$ZodPrefault",(r,e)=>{x.init(r,e),r._zod.optin="optional",j(r._zod,"values",()=>e.innerType._zod.values),r._zod.parse=(t,o)=>(o.direction==="backward"||t.value===void 0&&(t.value=e.defaultValue),e.innerType._zod.run(t,o))}),gl=m("$ZodNonOptional",(r,e)=>{x.init(r,e),j(r._zod,"values",()=>{const t=e.innerType._zod.values;return t?new Set([...t].filter(o=>o!==void 0)):void 0}),r._zod.parse=(t,o)=>{const i=e.innerType._zod.run(t,o);return i instanceof Promise?i.then(n=>po(n,r)):po(i,r)}});function po(r,e){return!r.issues.length&&r.value===void 0&&r.issues.push({code:"invalid_type",expected:"nonoptional",input:r.value,inst:e}),r}const fl=m("$ZodCatch",(r,e)=>{x.init(r,e),j(r._zod,"optin",()=>e.innerType._zod.optin),j(r._zod,"optout",()=>e.innerType._zod.optout),j(r._zod,"values",()=>e.innerType._zod.values),r._zod.parse=(t,o)=>{if(o.direction==="backward")return e.innerType._zod.run(t,o);const i=e.innerType._zod.run(t,o);return i instanceof Promise?i.then(n=>(t.value=n.value,n.issues.length&&(t.value=e.catchValue({...t,error:{issues:n.issues.map(s=>Ee(s,o,we()))},input:t.value}),t.issues=[]),t)):(t.value=i.value,i.issues.length&&(t.value=e.catchValue({...t,error:{issues:i.issues.map(n=>Ee(n,o,we()))},input:t.value}),t.issues=[]),t)}}),ml=m("$ZodPipe",(r,e)=>{x.init(r,e),j(r._zod,"values",()=>e.in._zod.values),j(r._zod,"optin",()=>e.in._zod.optin),j(r._zod,"optout",()=>e.out._zod.optout),j(r._zod,"propValues",()=>e.in._zod.propValues),r._zod.parse=(t,o)=>{if(o.direction==="backward"){const n=e.out._zod.run(t,o);return n instanceof Promise?n.then(s=>vt(s,e.in,o)):vt(n,e.in,o)}const i=e.in._zod.run(t,o);return i instanceof Promise?i.then(n=>vt(n,e.out,o)):vt(i,e.out,o)}});function vt(r,e,t){return r.issues.length?(r.aborted=!0,r):e._zod.run({value:r.value,issues:r.issues},t)}const bl=m("$ZodReadonly",(r,e)=>{x.init(r,e),j(r._zod,"propValues",()=>e.innerType._zod.propValues),j(r._zod,"values",()=>e.innerType._zod.values),j(r._zod,"optin",()=>e.innerType?._zod?.optin),j(r._zod,"optout",()=>e.innerType?._zod?.optout),r._zod.parse=(t,o)=>{if(o.direction==="backward")return e.innerType._zod.run(t,o);const i=e.innerType._zod.run(t,o);return i instanceof Promise?i.then(go):go(i)}});function go(r){return r.value=Object.freeze(r.value),r}const vl=m("$ZodCustom",(r,e)=>{W.init(r,e),x.init(r,e),r._zod.parse=(t,o)=>t,r._zod.check=t=>{const o=t.value,i=e.fn(o);if(i instanceof Promise)return i.then(n=>fo(n,t,o,r));fo(i,t,o,r)}});function fo(r,e,t,o){if(!r){const i={code:"custom",input:t,inst:o,path:[...o._zod.def.path??[]],continue:!o._zod.def.abort};o._zod.def.params&&(i.params=o._zod.def.params),e.issues.push(ut(i))}}var mo;class yl{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){const o=t[0];if(this._map.set(e,o),o&&typeof o=="object"&&"id"in o){if(this._idmap.has(o.id))throw new Error(`ID ${o.id} already exists in the registry`);this._idmap.set(o.id,e)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const o={...this.get(t)??{}};delete o.id;const i={...o,...this._map.get(e)};return Object.keys(i).length?i:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function _l(){return new yl}(mo=globalThis).__zod_globalRegistry??(mo.__zod_globalRegistry=_l());const yt=globalThis.__zod_globalRegistry;function wl(r,e){return new r({type:"string",...E(e)})}function El(r,e){return new r({type:"string",coerce:!0,...E(e)})}function Cl(r,e){return new r({type:"string",format:"email",check:"string_format",abort:!1,...E(e)})}function bo(r,e){return new r({type:"string",format:"guid",check:"string_format",abort:!1,...E(e)})}function Sl(r,e){return new r({type:"string",format:"uuid",check:"string_format",abort:!1,...E(e)})}function kl(r,e){return new r({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...E(e)})}function Al(r,e){return new r({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...E(e)})}function Ol(r,e){return new r({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...E(e)})}function Tl(r,e){return new r({type:"string",format:"url",check:"string_format",abort:!1,...E(e)})}function Il(r,e){return new r({type:"string",format:"emoji",check:"string_format",abort:!1,...E(e)})}function $l(r,e){return new r({type:"string",format:"nanoid",check:"string_format",abort:!1,...E(e)})}function Ll(r,e){return new r({type:"string",format:"cuid",check:"string_format",abort:!1,...E(e)})}function Pl(r,e){return new r({type:"string",format:"cuid2",check:"string_format",abort:!1,...E(e)})}function jl(r,e){return new r({type:"string",format:"ulid",check:"string_format",abort:!1,...E(e)})}function Rl(r,e){return new r({type:"string",format:"xid",check:"string_format",abort:!1,...E(e)})}function Nl(r,e){return new r({type:"string",format:"ksuid",check:"string_format",abort:!1,...E(e)})}function Dl(r,e){return new r({type:"string",format:"ipv4",check:"string_format",abort:!1,...E(e)})}function zl(r,e){return new r({type:"string",format:"ipv6",check:"string_format",abort:!1,...E(e)})}function ql(r,e){return new r({type:"string",format:"cidrv4",check:"string_format",abort:!1,...E(e)})}function xl(r,e){return new r({type:"string",format:"cidrv6",check:"string_format",abort:!1,...E(e)})}function Ml(r,e){return new r({type:"string",format:"base64",check:"string_format",abort:!1,...E(e)})}function Bl(r,e){return new r({type:"string",format:"base64url",check:"string_format",abort:!1,...E(e)})}function Ul(r,e){return new r({type:"string",format:"e164",check:"string_format",abort:!1,...E(e)})}function Vl(r,e){return new r({type:"string",format:"jwt",check:"string_format",abort:!1,...E(e)})}function Fl(r,e){return new r({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...E(e)})}function Gl(r,e){return new r({type:"string",format:"date",check:"string_format",...E(e)})}function Hl(r,e){return new r({type:"string",format:"time",check:"string_format",precision:null,...E(e)})}function Zl(r,e){return new r({type:"string",format:"duration",check:"string_format",...E(e)})}function Wl(r,e){return new r({type:"number",coerce:!0,checks:[],...E(e)})}function Jl(r,e){return new r({type:"number",check:"number_format",abort:!1,format:"safeint",...E(e)})}function Kl(r,e){return new r({type:"boolean",...E(e)})}function Yl(r){return new r({type:"unknown"})}function Xl(r,e){return new r({type:"never",...E(e)})}function vo(r,e){return new pi({check:"less_than",...E(e),value:r,inclusive:!1})}function Gt(r,e){return new pi({check:"less_than",...E(e),value:r,inclusive:!0})}function yo(r,e){return new gi({check:"greater_than",...E(e),value:r,inclusive:!1})}function Ht(r,e){return new gi({check:"greater_than",...E(e),value:r,inclusive:!0})}function _o(r,e){return new gc({check:"multiple_of",...E(e),value:r})}function yi(r,e){return new mc({check:"max_length",...E(e),maximum:r})}function It(r,e){return new bc({check:"min_length",...E(e),minimum:r})}function _i(r,e){return new vc({check:"length_equals",...E(e),length:r})}function Ql(r,e){return new yc({check:"string_format",format:"regex",...E(e),pattern:r})}function ed(r){return new _c({check:"string_format",format:"lowercase",...E(r)})}function td(r){return new wc({check:"string_format",format:"uppercase",...E(r)})}function rd(r,e){return new Ec({check:"string_format",format:"includes",...E(e),includes:r})}function od(r,e){return new Cc({check:"string_format",format:"starts_with",...E(e),prefix:r})}function id(r,e){return new Sc({check:"string_format",format:"ends_with",...E(e),suffix:r})}function Xe(r){return new kc({check:"overwrite",tx:r})}function nd(r){return Xe(e=>e.normalize(r))}function sd(){return Xe(r=>r.trim())}function ad(){return Xe(r=>r.toLowerCase())}function cd(){return Xe(r=>r.toUpperCase())}function ld(){return Xe(r=>va(r))}function dd(r,e,t){return new r({type:"array",element:e,...E(t)})}function ud(r,e,t){return new r({type:"custom",check:"custom",fn:e,...E(t)})}function hd(r){const e=pd(t=>(t.addIssue=o=>{if(typeof o=="string")t.issues.push(ut(o,t.value,e._zod.def));else{const i=o;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=t.value),i.inst??(i.inst=e),i.continue??(i.continue=!e._zod.def.abort),t.issues.push(ut(i))}},r(t.value,t)));return e}function pd(r,e){const t=new W({check:"custom",...E(e)});return t._zod.check=r,t}const gd=m("ZodISODateTime",(r,e)=>{xc.init(r,e),D.init(r,e)});function fd(r){return Fl(gd,r)}const md=m("ZodISODate",(r,e)=>{Mc.init(r,e),D.init(r,e)});function bd(r){return Gl(md,r)}const vd=m("ZodISOTime",(r,e)=>{Bc.init(r,e),D.init(r,e)});function yd(r){return Hl(vd,r)}const _d=m("ZodISODuration",(r,e)=>{Uc.init(r,e),D.init(r,e)});function wd(r){return Zl(_d,r)}const Ed=(r,e)=>{ai.init(r,e),r.name="ZodError",Object.defineProperties(r,{format:{value:t=>La(r,t)},flatten:{value:t=>$a(r,t)},addIssue:{value:t=>{r.issues.push(t),r.message=JSON.stringify(r.issues,ar,2)}},addIssues:{value:t=>{r.issues.push(...t),r.message=JSON.stringify(r.issues,ar,2)}},isEmpty:{get(){return r.issues.length===0}}})},X=m("ZodError",Ed,{Parent:Error}),Cd=Cr(X),Sd=Sr(X),kd=Pt(X),Ad=jt(X),Od=Ra(X),Td=Na(X),Id=Da(X),$d=za(X),Ld=qa(X),Pd=xa(X),jd=Ma(X),Rd=Ba(X),U=m("ZodType",(r,e)=>(x.init(r,e),r.def=e,r.type=e.type,Object.defineProperty(r,"_def",{value:e}),r.check=(...t)=>r.clone(ke(e,{checks:[...e.checks??[],...t.map(o=>typeof o=="function"?{_zod:{check:o,def:{check:"custom"},onattach:[]}}:o)]})),r.clone=(t,o)=>he(r,t,o),r.brand=()=>r,r.register=((t,o)=>(t.add(r,o),r)),r.parse=(t,o)=>Cd(r,t,o,{callee:r.parse}),r.safeParse=(t,o)=>kd(r,t,o),r.parseAsync=async(t,o)=>Sd(r,t,o,{callee:r.parseAsync}),r.safeParseAsync=async(t,o)=>Ad(r,t,o),r.spa=r.safeParseAsync,r.encode=(t,o)=>Od(r,t,o),r.decode=(t,o)=>Td(r,t,o),r.encodeAsync=async(t,o)=>Id(r,t,o),r.decodeAsync=async(t,o)=>$d(r,t,o),r.safeEncode=(t,o)=>Ld(r,t,o),r.safeDecode=(t,o)=>Pd(r,t,o),r.safeEncodeAsync=async(t,o)=>jd(r,t,o),r.safeDecodeAsync=async(t,o)=>Rd(r,t,o),r.refine=(t,o)=>r.check(Eu(t,o)),r.superRefine=t=>r.check(Cu(t)),r.overwrite=t=>r.check(Xe(t)),r.optional=()=>So(r),r.nullable=()=>ko(r),r.nullish=()=>So(ko(r)),r.nonoptional=t=>fu(r,t),r.array=()=>Y(r),r.or=t=>su([r,t]),r.and=t=>cu(r,t),r.transform=t=>dr(r,ki(t)),r.default=t=>hu(r,t),r.prefault=t=>gu(r,t),r.catch=t=>bu(r,t),r.pipe=t=>dr(r,t),r.readonly=()=>_u(r),r.describe=t=>{const o=r.clone();return yt.add(o,{description:t}),o},Object.defineProperty(r,"description",{get(){return yt.get(r)?.description},configurable:!0}),r.meta=(...t)=>{if(t.length===0)return yt.get(r);const o=r.clone();return yt.add(o,t[0]),o},r.isOptional=()=>r.safeParse(void 0).success,r.isNullable=()=>r.safeParse(null).success,r)),wi=m("_ZodString",(r,e)=>{kr.init(r,e),U.init(r,e);const t=r._zod.bag;r.format=t.format??null,r.minLength=t.minimum??null,r.maxLength=t.maximum??null,r.regex=(...o)=>r.check(Ql(...o)),r.includes=(...o)=>r.check(rd(...o)),r.startsWith=(...o)=>r.check(od(...o)),r.endsWith=(...o)=>r.check(id(...o)),r.min=(...o)=>r.check(It(...o)),r.max=(...o)=>r.check(yi(...o)),r.length=(...o)=>r.check(_i(...o)),r.nonempty=(...o)=>r.check(It(1,...o)),r.lowercase=o=>r.check(ed(o)),r.uppercase=o=>r.check(td(o)),r.trim=()=>r.check(sd()),r.normalize=(...o)=>r.check(nd(...o)),r.toLowerCase=()=>r.check(ad()),r.toUpperCase=()=>r.check(cd()),r.slugify=()=>r.check(ld())}),Ei=m("ZodString",(r,e)=>{kr.init(r,e),wi.init(r,e),r.email=t=>r.check(Cl(Nd,t)),r.url=t=>r.check(Tl(Dd,t)),r.jwt=t=>r.check(Vl(Yd,t)),r.emoji=t=>r.check(Il(zd,t)),r.guid=t=>r.check(bo(wo,t)),r.uuid=t=>r.check(Sl(_t,t)),r.uuidv4=t=>r.check(kl(_t,t)),r.uuidv6=t=>r.check(Al(_t,t)),r.uuidv7=t=>r.check(Ol(_t,t)),r.nanoid=t=>r.check($l(qd,t)),r.guid=t=>r.check(bo(wo,t)),r.cuid=t=>r.check(Ll(xd,t)),r.cuid2=t=>r.check(Pl(Md,t)),r.ulid=t=>r.check(jl(Bd,t)),r.base64=t=>r.check(Ml(Wd,t)),r.base64url=t=>r.check(Bl(Jd,t)),r.xid=t=>r.check(Rl(Ud,t)),r.ksuid=t=>r.check(Nl(Vd,t)),r.ipv4=t=>r.check(Dl(Fd,t)),r.ipv6=t=>r.check(zl(Gd,t)),r.cidrv4=t=>r.check(ql(Hd,t)),r.cidrv6=t=>r.check(xl(Zd,t)),r.e164=t=>r.check(Ul(Kd,t)),r.datetime=t=>r.check(fd(t)),r.date=t=>r.check(bd(t)),r.time=t=>r.check(yd(t)),r.duration=t=>r.check(wd(t))});function L(r){return wl(Ei,r)}const D=m("ZodStringFormat",(r,e)=>{N.init(r,e),wi.init(r,e)}),Nd=m("ZodEmail",(r,e)=>{$c.init(r,e),D.init(r,e)}),wo=m("ZodGUID",(r,e)=>{Tc.init(r,e),D.init(r,e)}),_t=m("ZodUUID",(r,e)=>{Ic.init(r,e),D.init(r,e)}),Dd=m("ZodURL",(r,e)=>{Lc.init(r,e),D.init(r,e)}),zd=m("ZodEmoji",(r,e)=>{Pc.init(r,e),D.init(r,e)}),qd=m("ZodNanoID",(r,e)=>{jc.init(r,e),D.init(r,e)}),xd=m("ZodCUID",(r,e)=>{Rc.init(r,e),D.init(r,e)}),Md=m("ZodCUID2",(r,e)=>{Nc.init(r,e),D.init(r,e)}),Bd=m("ZodULID",(r,e)=>{Dc.init(r,e),D.init(r,e)}),Ud=m("ZodXID",(r,e)=>{zc.init(r,e),D.init(r,e)}),Vd=m("ZodKSUID",(r,e)=>{qc.init(r,e),D.init(r,e)}),Fd=m("ZodIPv4",(r,e)=>{Vc.init(r,e),D.init(r,e)}),Gd=m("ZodIPv6",(r,e)=>{Fc.init(r,e),D.init(r,e)}),Hd=m("ZodCIDRv4",(r,e)=>{Gc.init(r,e),D.init(r,e)}),Zd=m("ZodCIDRv6",(r,e)=>{Hc.init(r,e),D.init(r,e)}),Wd=m("ZodBase64",(r,e)=>{Zc.init(r,e),D.init(r,e)}),Jd=m("ZodBase64URL",(r,e)=>{Jc.init(r,e),D.init(r,e)}),Kd=m("ZodE164",(r,e)=>{Kc.init(r,e),D.init(r,e)}),Yd=m("ZodJWT",(r,e)=>{Xc.init(r,e),D.init(r,e)}),Ci=m("ZodNumber",(r,e)=>{mi.init(r,e),U.init(r,e),r.gt=(o,i)=>r.check(yo(o,i)),r.gte=(o,i)=>r.check(Ht(o,i)),r.min=(o,i)=>r.check(Ht(o,i)),r.lt=(o,i)=>r.check(vo(o,i)),r.lte=(o,i)=>r.check(Gt(o,i)),r.max=(o,i)=>r.check(Gt(o,i)),r.int=o=>r.check(Eo(o)),r.safe=o=>r.check(Eo(o)),r.positive=o=>r.check(yo(0,o)),r.nonnegative=o=>r.check(Ht(0,o)),r.negative=o=>r.check(vo(0,o)),r.nonpositive=o=>r.check(Gt(0,o)),r.multipleOf=(o,i)=>r.check(_o(o,i)),r.step=(o,i)=>r.check(_o(o,i)),r.finite=()=>r;const t=r._zod.bag;r.minValue=Math.max(t.minimum??Number.NEGATIVE_INFINITY,t.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,r.maxValue=Math.min(t.maximum??Number.POSITIVE_INFINITY,t.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,r.isInt=(t.format??"").includes("int")||Number.isSafeInteger(t.multipleOf??.5),r.isFinite=!0,r.format=t.format??null}),Xd=m("ZodNumberFormat",(r,e)=>{Qc.init(r,e),Ci.init(r,e)});function Eo(r){return Jl(Xd,r)}const Qd=m("ZodBoolean",(r,e)=>{el.init(r,e),U.init(r,e)});function Si(r){return Kl(Qd,r)}const eu=m("ZodUnknown",(r,e)=>{tl.init(r,e),U.init(r,e)});function Co(){return Yl(eu)}const tu=m("ZodNever",(r,e)=>{rl.init(r,e),U.init(r,e)});function ru(r){return Xl(tu,r)}const ou=m("ZodArray",(r,e)=>{ol.init(r,e),U.init(r,e),r.element=e.element,r.min=(t,o)=>r.check(It(t,o)),r.nonempty=t=>r.check(It(1,t)),r.max=(t,o)=>r.check(yi(t,o)),r.length=(t,o)=>r.check(_i(t,o)),r.unwrap=()=>r.element});function Y(r,e){return dd(ou,r,e)}const iu=m("ZodObject",(r,e)=>{nl.init(r,e),U.init(r,e),j(r,"shape",()=>e.shape),r.keyof=()=>Or(Object.keys(r._zod.def.shape)),r.catchall=t=>r.clone({...r._zod.def,catchall:t}),r.passthrough=()=>r.clone({...r._zod.def,catchall:Co()}),r.loose=()=>r.clone({...r._zod.def,catchall:Co()}),r.strict=()=>r.clone({...r._zod.def,catchall:ru()}),r.strip=()=>r.clone({...r._zod.def,catchall:void 0}),r.extend=t=>ka(r,t),r.safeExtend=t=>Aa(r,t),r.merge=t=>Oa(r,t),r.pick=t=>Ca(r,t),r.omit=t=>Sa(r,t),r.partial=(...t)=>Ta(Ai,r,t[0]),r.required=(...t)=>Ia(Oi,r,t[0])});function Ar(r,e){const t={type:"object",shape:r??{},...E(e)};return new iu(t)}const nu=m("ZodUnion",(r,e)=>{sl.init(r,e),U.init(r,e),r.options=e.options});function su(r,e){return new nu({type:"union",options:r,...E(e)})}const au=m("ZodIntersection",(r,e)=>{al.init(r,e),U.init(r,e)});function cu(r,e){return new au({type:"intersection",left:r,right:e})}const lr=m("ZodEnum",(r,e)=>{cl.init(r,e),U.init(r,e),r.enum=e.entries,r.options=Object.values(e.entries);const t=new Set(Object.keys(e.entries));r.extract=(o,i)=>{const n={};for(const s of o)if(t.has(s))n[s]=e.entries[s];else throw new Error(`Key ${s} not found in enum`);return new lr({...e,checks:[],...E(i),entries:n})},r.exclude=(o,i)=>{const n={...e.entries};for(const s of o)if(t.has(s))delete n[s];else throw new Error(`Key ${s} not found in enum`);return new lr({...e,checks:[],...E(i),entries:n})}});function Or(r,e){const t=Array.isArray(r)?Object.fromEntries(r.map(o=>[o,o])):r;return new lr({type:"enum",entries:t,...E(e)})}const lu=m("ZodTransform",(r,e)=>{ll.init(r,e),U.init(r,e),r._zod.parse=(t,o)=>{if(o.direction==="backward")throw new ti(r.constructor.name);t.addIssue=n=>{if(typeof n=="string")t.issues.push(ut(n,t.value,e));else{const s=n;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=t.value),s.inst??(s.inst=r),t.issues.push(ut(s))}};const i=e.transform(t.value,t);return i instanceof Promise?i.then(n=>(t.value=n,t)):(t.value=i,t)}});function ki(r){return new lu({type:"transform",transform:r})}const Ai=m("ZodOptional",(r,e)=>{dl.init(r,e),U.init(r,e),r.unwrap=()=>r._zod.def.innerType});function So(r){return new Ai({type:"optional",innerType:r})}const du=m("ZodNullable",(r,e)=>{ul.init(r,e),U.init(r,e),r.unwrap=()=>r._zod.def.innerType});function ko(r){return new du({type:"nullable",innerType:r})}const uu=m("ZodDefault",(r,e)=>{hl.init(r,e),U.init(r,e),r.unwrap=()=>r._zod.def.innerType,r.removeDefault=r.unwrap});function hu(r,e){return new uu({type:"default",innerType:r,get defaultValue(){return typeof e=="function"?e():ii(e)}})}const pu=m("ZodPrefault",(r,e)=>{pl.init(r,e),U.init(r,e),r.unwrap=()=>r._zod.def.innerType});function gu(r,e){return new pu({type:"prefault",innerType:r,get defaultValue(){return typeof e=="function"?e():ii(e)}})}const Oi=m("ZodNonOptional",(r,e)=>{gl.init(r,e),U.init(r,e),r.unwrap=()=>r._zod.def.innerType});function fu(r,e){return new Oi({type:"nonoptional",innerType:r,...E(e)})}const mu=m("ZodCatch",(r,e)=>{fl.init(r,e),U.init(r,e),r.unwrap=()=>r._zod.def.innerType,r.removeCatch=r.unwrap});function bu(r,e){return new mu({type:"catch",innerType:r,catchValue:typeof e=="function"?e:()=>e})}const vu=m("ZodPipe",(r,e)=>{ml.init(r,e),U.init(r,e),r.in=e.in,r.out=e.out});function dr(r,e){return new vu({type:"pipe",in:r,out:e})}const yu=m("ZodReadonly",(r,e)=>{bl.init(r,e),U.init(r,e),r.unwrap=()=>r._zod.def.innerType});function _u(r){return new yu({type:"readonly",innerType:r})}const wu=m("ZodCustom",(r,e)=>{vl.init(r,e),U.init(r,e)});function Eu(r,e={}){return ud(wu,r,e)}function Cu(r){return hd(r)}function Ti(r,e){return dr(ki(r),e)}function Su(r){return El(Ei,r)}function te(r){return Wl(Ci,r)}const Ii=Ar({id:Su().min(1).catch("ID_DESCONOCIDO"),nombre:L().min(3).catch("Producto Sin Nombre").default("Producto Sin Nombre"),precio:te().nonnegative().catch(0).default(0),imagen:L().catch(null).default(null).transform(r=>r===""||r==="/assets/images/default-bottle.png"?null:r),categoria:Or(["cervezas","licores","vinos","snacks","sin_alcohol","refresco","refrescos","jugo","cerveza","alitas","pizzas","sopas","ensaladas","carnes","platos fuertes","platos_fuertes","postres","cafe","tequila","whisky","ron","vodka","ginebra","mezcal","cognac","brandy","digestivos","espumosos","cocteleria","cocteles","cortes_de_carne"]).catch("cervezas").default("cervezas"),available:Si().catch(!0).default(!0),opcionesPersonalizadas:Y(L()).catch([]).default([])}),$i=r=>{if(!r||typeof r!="object")return r;const e=r.categoria??r.category;return{...r,id:r.id??r.producto_id??r.product_id,nombre:r.nombre??r.name,precio:r.precio??r.price,imagen:r.imagen??r.image??r.image_url,categoria:e?String(e).toLowerCase():"cervezas",opcionesPersonalizadas:r.opciones_personalizadas??r.custom_options??[]}},ku=Ti($i,Ii.passthrough()).transform(r=>r),ze=["Coca Cola","Agua Mineral","Squirt","Sprite"],Au=Ii.extend({precioBotella:te().nonnegative().catch(0).default(0),precioCopa:te().nonnegative().nullable().catch(null).default(null),precioLitro:te().nonnegative().nullable().catch(null).default(null),mixersBotella:Y(L()).catch(ze).default(ze),mixersCopa:Y(L()).catch(ze).default(ze),mixersLitro:Y(L()).catch(ze).default(ze),pais:L().catch("Desconocido").default("Desconocido")}),Ou=r=>{const e=$i(r);if(!e||typeof e!="object")return e;const t=s=>{if(!s)return;let a=s;if(typeof s=="string")try{if(s.trim().startsWith("["))a=JSON.parse(s);else return}catch{console.warn("[Schema] Failed to parse mixer JSON",s);return}if(!(Array.isArray(a)&&a.length===0))return a},o=e.mixersBotella||e.mixers_botella||e.bottleMixers,i=e.mixersCopa||e.mixers_copa||e.glassMixers,n=e.mixersLitro||e.mixers_litro||e.literMixers;return{...e,precioBotella:e.precioBotella??e.precio_botella??e.bottlePrice??e.bottle_price,precioCopa:e.precioCopa??e.precio_copa??e.glassPrice??e.cup_price,precioLitro:e.precioLitro??e.precio_litro??e.literPrice??e.liter_price,precio:e.precio??e.price??e.precio_venta,mixersBotella:t(o),mixersCopa:t(i),mixersLitro:t(n),pais:e.pais??e.country}},Ue=Ti(Ou,Au.passthrough()),Tu=["vodka","whisky","tequila","ron","brandy","cognac","digestivos","ginebra","mezcal","licores","espumosos","whiskies","tequilas","rones","brandies","cognacs","ginebras","mezcales"],ce=(r,e="")=>{if(!Array.isArray(r))return[];const o=Tu.includes(e.toLowerCase())?Ue:ku;return r.map(i=>{try{const n={...i};return!n.categoria&&e&&(n.categoria=e),o.parse(n)}catch(n){return console.error("[Schema:Error] Validation failed for product:",i,n),i}})},Iu={cocteles:[{id:"1",nombre:"ABC",ingredientes:"Amaretto, baileys y cognac",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/abc.mp4",precio:"$165.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/abc.webp"},{id:"2",nombre:"Alfonso 13",ingredientes:"Brandy, licor de caf, crema",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/alfonso-13.mp4",precio:"$180.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/alfonso-13.webp"},{id:"3",nombre:"Bufanda Negra",ingredientes:"Ron, licor de naranja, jugo de limn",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/bufanda-negra.mp4",precio:"$190.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/bufanda-negra.webp"},{id:"4",nombre:"Cantarito Fresa",ingredientes:"Tequila, jugo de limn, toronja y fresa",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/cantarito-fresa.mp4",precio:"$170.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/cantarito-fresa.webp"},{id:"5",nombre:"Cantarito",ingredientes:"Tequila, jugo de limn, toronja y refresco de toronja",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/cantarito.mp4",precio:"$160.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/cantarito.webp"},{id:"6",nombre:"Carajillo",ingredientes:"Licor de caf, espresso",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/carajillo.mp4",precio:"$150.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/carajillo.webp"},{id:"7",nombre:"Cosmopolitan",ingredientes:"Vodka, licor de naranja, jugo de limn y arndano",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/cosmopolitan.mp4",precio:"$180.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/cosmopolitan.webp"},{id:"8",nombre:"Duvalin",ingredientes:"Licor de avellana, vodka de vainilla y crema de cacao",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/duvalin.mp4",precio:"$190.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/duvalin.webp"},{id:"9",nombre:"Margarita",ingredientes:"Tequila, licor de naranja, jugo de limn",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/margarita.mp4",precio:"$175.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/margarita.webp"},{id:"10",nombre:"Martini Baileys",ingredientes:"Baileys, vodka, crema",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/martini-bealys.mp4",precio:"$185.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/martini-baileys.webp"},{id:"11",nombre:"Martini Chocolate",ingredientes:"Licor de cacao, vodka, crema de leche",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/martini-chocolate.mp4",precio:"$195.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/martini-chocolate.webp"},{id:"12",nombre:"Martini Lichi",ingredientes:"Vodka, licor de lichi, jugo de limn",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/martini-lichi.mp4",precio:"$200.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/martini-lichi.webp"},{id:"13",nombre:"Mojito Fresa",ingredientes:"Ron, hierbabuena, jugo de limn y fresa",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/mojito-fresa.mp4",precio:"$170.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/mojito-fresa.webp"},{id:"14",nombre:"Mojito Frutos Rojos",ingredientes:"Ron, hierbabuena, jugo de limn y frutos rojos",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/mojito-frutos-rojos.mp4",precio:"$175.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/mojito-frutos-rojos.webp"},{id:"15",nombre:"Mojito Mango",ingredientes:"Ron, hierbabuena, jugo de limn y mango",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/mojito-mango.mp4",precio:"$180.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/mojito-mango.webp"},{id:"16",nombre:"Mojito",ingredientes:"Ron, hierbabuena, jugo de limn y azcar",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/mojito.mp4",precio:"$165.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/mojito.webp"},{id:"17",nombre:"Pia Colada",ingredientes:"Ron, crema de coco, jugo de pia",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/bebidas/cocteleria/pina-colada.mp4",precio:"$190.00",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/cocteleria/pina-colada.webp"}],refrescos:[{id:"22",nombre:"COCA COLA 355ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/coca-cola.webp",precio:"$55.00"},{id:"23",nombre:"FANTA 355ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/fanta.webp",precio:"$55.00"},{id:"24",nombre:"MANZANA 355ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/manzana.webp",precio:"$55.00"},{id:"25",nombre:"SPRITE 355ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/sprite.webp",precio:"$55.00"},{id:"26",nombre:"MINERAL 355ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/mineral.webp",precio:"$55.00"},{id:"27",nombre:"SQUIRT 355ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/squirt.webp",precio:"$55.00"},{id:"28",nombre:"QUINA 355ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/quina.webp",precio:"$55.00"},{id:"29",nombre:"AGUA 355ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/agua.webp",precio:"$55.00"},{id:"30",nombre:"RED BULL 250ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/redbull.webp",precio:"$95.00"},{id:"31",nombre:"BOOST 235ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/boost.webp",precio:"$75.00"},{id:"32",nombre:"JARRA DE JUGO PIA LT",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/Jarra%20Pina.webp",precio:"$165.00"},{id:"33",nombre:"JARRA DE JUGO UVA LT",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/Jarra%20de%20Uva.webp",precio:"$165.00"},{id:"34",nombre:"JARRA DE JUGO NARANJA",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/Jarra%20de%20Naranja.webp",precio:"$165.00"},{id:"35",nombre:"JARRA DE JUGO ARNDANO",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/Jarra%20de%20Arandano.webp",precio:"$165.00"},{id:"36",nombre:"JARRA DE JUGO DURAZNO",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/Jarra%20Durazno.webp",precio:"$165.00"},{id:"37",nombre:"JARRA DE JUGO MANGO",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/Jarra%20Mango.webp",precio:"$165.00"},{id:"38",nombre:"VASO DE JUGO PIA 355ML",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/vaso-pina.webp",precio:"$55.00"},{id:"39",nombre:"VASO DE JUGO UVA 355ML",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/vaso-uva.webp",precio:"$55.00"},{id:"40",nombre:"VASO DE JUGO NARANJA 355ML",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/vaso-naranja.webp",precio:"$55.00"},{id:"41",nombre:"VASO DE JUGO ARNDANO 355ML",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/vaso-arandano.webp",precio:"$55.00"},{id:"42",nombre:"VASO DE JUGO DURAZNO 355ML",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/vaso-durazno.webp",precio:"$55.00"},{id:"43",nombre:"VASO DE JUGO MANGO 355ML",categoria:"jugo",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/vaso-mango.webp",precio:"$55.00"}],cervezas:[{id:"1",nombre:"INDIO",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/indio.webp",precio:"$75.00"},{id:"2",nombre:"TECATE ROJA",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/tecate-roja.webp",precio:"$75.00"},{id:"3",nombre:"TECATE LIGHT",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/tecate-ligth.webp",precio:"$75.00"},{id:"4",nombre:"TECATE MBAR",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/tecate-ambar.webp",precio:"$75.00"},{id:"5",nombre:"XX MBAR",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/xx-ambar.webp",precio:"$75.00"},{id:"6",nombre:"XX LAGER",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/laguer.webp",precio:"$75.00"},{id:"7",nombre:"BOHEMIA CLARA",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/bohemia-clara.webp",precio:"$75.00"},{id:"8",nombre:"BOHEMIA OSCURA",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/bohemia-oscura.webp",precio:"$75.00"},{id:"9",nombre:"ULTRA",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/ultra.webp",precio:"$75.00"},{id:"10",nombre:"XX ULTRA",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/xxultra.webp",precio:"$75.00"},{id:"11",nombre:"HEINEKEN",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/heineken.webp",precio:"$75.00"},{id:"12",nombre:"HEINEKEN 00",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/heineken00.webp",precio:"$75.00"},{id:"13",nombre:"TARRO DE CERVEZA CLARO LT",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/tarro-claro.webp",precio:"$110.00"},{id:"14",nombre:"TARRO DE CERVEZA OSCURO LT",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/tarro-oscuro.webp",precio:"$110.00"},{id:"15",nombre:"TARRO CUBANO CLARO LT",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/tarro-cubano-claro.webp",precio:"$140.00"},{id:"16",nombre:"TARRO CUBANO OSCURO LT",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/tarro-cubano-oscuro.webp",precio:"$140.00"},{id:"17",nombre:"TARRO MICHELADO CLARO LT",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/michelada-clara.webp",precio:"$125.00"},{id:"18",nombre:"TARRO MICHELADO OSCURO LT",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/michelada-obscura.webp",precio:"$125.00"},{id:"19",nombre:"VASO MICHELADO",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/vaso-michelado.webp",precio:"$15.00"},{id:"20",nombre:"VASO CUBANO",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/vaso-cubano.webp",precio:"$20.00"}],licoresCategories:[{id:"10",nombre:"WHISKY",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/WhikysX3.webp"},{id:"8",nombre:"TEQUILA",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/TequilaX3.webp"},{id:"9",nombre:"VODKA",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/VodkaX3.webp"},{id:"7",nombre:"RON",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/RonX2.webp"},{id:"2",nombre:"BRANDY",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/Brandyx3.webp"},{id:"6",nombre:"GINEBRA",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/GinebraX3.webp"},{id:"1",nombre:"MEZCAL",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/400conejosX3.webp"},{id:"3",nombre:"COGNAC",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/Cognac.webp"},{id:"4",nombre:"DIGESTIVOS",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/Digestivo.webp"},{id:"5",nombre:"ESPUMOSOS",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/Espumoso.webp"}],brandies:[{id:"1",nombre:"TORRES 15 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/brandy/torres-15.webp",precioBotella:"$1450.00",precioLitro:"$365.00",precioCopa:"$140.00"},{id:"2",nombre:"TERRY CENTENARIO 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/brandy/terry-centenario.webp",precioBotella:"$1145.00",precioLitro:"$280.00",precioCopa:"$110.00"},{id:"3",nombre:"TORRES 10 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/brandy/torres-10.webp",precioBotella:"$1110.00",precioLitro:"$275.00",precioCopa:"$110.00"},{id:"4",nombre:"CARLOS I 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/brandy/calos-I.webp",precioBotella:"$1495.00",precioLitro:"$375.00",precioCopa:"$135.00"},{id:"5",nombre:"FUNDADOR 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/brandy/fundador.webp",precioBotella:"$1185.00",precioLitro:"$285.00",precioCopa:"$105.00"}],cognacs:[{id:"1",nombre:"Remy Martin V.S.O.P. 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/cognac/remy-martin.webp",precioBotella:"$2240.00",precioLitro:"$600.00",precioCopa:"$215.00"},{id:"2",nombre:"Hennessy V.S.O.P. 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/cognac/henesyy.webp",precioBotella:"$2000.00",precioLitro:"$580.00",precioCopa:"$200.00"},{id:"3",nombre:"Martell V.S.O.P. 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/cognac/martell.webp",precioBotella:"$2050.00",precioLitro:"$580.00",precioCopa:"$200.00"},{id:"4",nombre:"COURVOISIER VSOP",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/cognac/courvoisier.webp",precioBotella:"$2150.00",precioLitro:"$590.00",precioCopa:"$210.00"}],digestivos:[{id:"1",nombre:"HIPNOTIQ 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/digestivos/hipnotyc.webp",precioBotella:"$1470.00",precioCopa:"--"},{id:"2",nombre:"LICOR 43 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/digestivos/licor-43.webp",precioBotella:"$1390.00",precioCopa:"$120.00"},{id:"3",nombre:"JGERMEISTER 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/digestivos/jaguer.webp",precioBotella:"$1115.00",precioCopa:"$115.00"},{id:"4",nombre:"BAILEYS 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/digestivos/bealys.webp",precioBotella:"$1040.00",precioCopa:"$100.00"},{id:"5",nombre:"CADENAS DULCE 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/digestivos/cadenas.webp",precioBotella:"$920.00",precioCopa:"$90.00"},{id:"6",nombre:"ZAMBUCA NEGRO 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/digestivos/zambuca-negro.webp",precioBotella:"$1350.00",precioCopa:"$125.00"}],espumosos:[{id:"1",nombre:"MOET ICE",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/espumosos/moet-ice-imperial.webp",precioBotella:"$3000.00"},{id:"2",nombre:"MOET ICE ROS",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/espumosos/moet-ice-rose.webp",precioBotella:"$3290.00"},{id:"3",nombre:"MOET NECTAR IMPERIAL",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/espumosos/moet-nectar-imperial.webp",precioBotella:"$2670.00"},{id:"4",nombre:"CHANDON DELICE",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/espumosos/chandon.webp",precioBotella:"$850.00"},{id:"5",nombre:"VEUVE CLICQUOT BRUT 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/espumosos/veuve-clicquot.webp",precioBotella:"$3600.00"},{id:"6",nombre:"TAITTINGER BRUT 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/espumosos/taittinger.webp",precioBotella:"$3100.00"}],ginebras:[{id:"1",nombre:"BOMBAY SAPPHIRE 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ginebra/bombay.webp",precioBotella:"$1295.00",precioLitro:"$315.00",precioCopa:"$140.00"},{id:"2",nombre:"HENDRICK'S 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ginebra/hendrix.webp",precioBotella:"$2270.00",precioLitro:"$540.00",precioCopa:"$195.00"},{id:"3",nombre:"TANQUERAY 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ginebra/tanqueray.webp",precioBotella:"$1135.00",precioLitro:"$275.00",precioCopa:"$115.00"},{id:"4",nombre:"BEEFEATER 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ginebra/beefeater.webp",precioBotella:"$1100.00",precioLitro:"$275.00",precioCopa:"$110.00"},{id:"5",nombre:"MONKEY 47 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ginebra/monkey-47.webp",precioBotella:"$2500.00",precioLitro:"$625.00",precioCopa:"$215.00"},{id:"6",nombre:"THE BOTANIST 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ginebra/the-botanist.webp",precioBotella:"$2200.00",precioLitro:"$550.00",precioCopa:"$200.00"}],mezcales:[{id:"1",nombre:"400 CONEJOS 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/mezcal/400-conejos.webp",precioBotella:"$1435.00",precioLitro:"$360.00",precioCopa:"$125.00"},{id:"2",nombre:"400 CONEJOS REPOSADO 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/mezcal/400-conejos-reposado.webp",precioBotella:"$1595.00",precioLitro:"$400.00",precioCopa:"$145.00"},{id:"3",nombre:"AMARS ESPADIN 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/mezcal/amaras-espadin.webp",precioBotella:"$1200.00",precioLitro:"$300.00",precioCopa:"$120.00"},{id:"4",nombre:"TRIPAS DE MAGUEY 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/mezcal/tripas-de-maguey.webp",precioBotella:"$1350.00",precioLitro:"$340.00",precioCopa:"$130.00"},{id:"5",nombre:"MONTELOBOS 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/mezcal/montelobos.webp",precioBotella:"$1550.00",precioLitro:"$385.00",precioCopa:"$140.00"},{id:"6",nombre:"UNION 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/mezcal/union.webp",precioBotella:"$1285.00",precioLitro:"$325.00",precioCopa:"$120.00"}],rones:[{id:"1",nombre:"APPLETON ESTATE 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/apleton-state.webp",precioBotella:"$1365.00",precioLitro:"$345.00",precioCopa:"$130.00"},{id:"2",nombre:"BACARD BLANCO 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/bacardi-blanco.webp",precioBotella:"$915.00",precioLitro:"$220.00",precioCopa:"$105.00"},{id:"3",nombre:"BACARD LIMN 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/bacardi-limon.webp",precioBotella:"$895.00",precioLitro:"$215.00",precioCopa:"$100.00"},{id:"4",nombre:"BACARD MANGO 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/bacardi-mango.webp",precioBotella:"$900.00",precioLitro:"$215.00",precioCopa:"$105.00"},{id:"5",nombre:"BACARD RASPBERRY 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/bacardi-raspberri.webp",precioBotella:"$900.00",precioLitro:"$215.00",precioCopa:"$105.00"},{id:"6",nombre:"CAPITN MORGAN 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/capitan-morgan.webp",precioBotella:"$1200.00",precioLitro:"$295.00",precioCopa:"$125.00"},{id:"7",nombre:"HAVANA CLUB 7 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/havana-7.webp",precioBotella:"$1240.00",precioLitro:"$310.00",precioCopa:"$125.00"},{id:"8",nombre:"MALIBU 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/malibu.webp",precioBotella:"$995.00",precioLitro:"$255.00",precioCopa:"$110.00"},{id:"9",nombre:"MATUSALEM 15 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/matusalen-15.webp",precioBotella:"$1245.00",precioLitro:"$310.00",precioCopa:"$125.00"},{id:"10",nombre:"MATUSALEM CLSICO 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/matusalem-clasico.webp",precioBotella:"$960.00",precioLitro:"$230.00",precioCopa:"$110.00"},{id:"11",nombre:"MATUSALEM PLATINO 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/matusalem-plata.webp",precioBotella:"$990.00",precioLitro:"--",precioCopa:"$110.00"},{id:"12",nombre:"ZACAPA 23 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/ron/zacapa-23.webp",precioBotella:"$2100.00",precioLitro:"$550.00",precioCopa:"$195.00"}],tequilas:[{id:"1",nombre:"CUERVO 1800 CRISTALINO 700ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/1800-cristalino.webp",precioBotella:"$1790.00",precioLitro:"$435.00",precioCopa:"$170.00"},{id:"2",nombre:"CUERVO 1800 REPOSADO 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/1800-reposado.webp",precioBotella:"$1265.00",precioLitro:"$305.00",precioCopa:"$135.00"},{id:"3",nombre:"CUERVO ESPECIAL 695 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/cuervo-especial.webp",precioBotella:"$885.00",precioLitro:"$275.00",precioCopa:"$125.00"},{id:"4",nombre:"DON JULIO 70 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/don-julio-70.webp",precioBotella:"$1865.00",precioLitro:"$465.00",precioCopa:"$170.00"},{id:"5",nombre:"DON JULIO BLANCO 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/don-julio-blanco.webp",precioBotella:"$1325.00",precioLitro:"$320.00",precioCopa:"$130.00"},{id:"6",nombre:"DON JULIO REPOSADO 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/don-julio-reposado.webp",precioBotella:"$1395.00",precioLitro:"$380.00",precioCopa:"$150.00"},{id:"7",nombre:"HERRADURA REPOSADO 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/herradura-reposado.webp",precioBotella:"$1435.00",precioLitro:"$360.00",precioCopa:"$160.00"},{id:"8",nombre:"MAESTRO DOBEL DIAMANTE",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/maestro-dobel-diamante.webp",precioBotella:"$1780.00",precioLitro:"$340.00",precioCopa:"$140.00"},{id:"9",nombre:"TRADICIONAL CRISTALINO 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/tradicional-cristalino.webp",precioBotella:"$1200.00",precioLitro:"$285.00",precioCopa:"$115.00"},{id:"10",nombre:"TRADICIONAL PLATA 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/tradicional-plata.webp",precioBotella:"$1000.00",precioLitro:"$255.00",precioCopa:"$115.00"},{id:"11",nombre:"TRADICIONAL REPOSADO 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/tradicional.webp",precioBotella:"$1100.00",precioLitro:"$285.00",precioCopa:"$105.00"},{id:"12",nombre:"JIMADOR 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/Jimador.webp",precioBotella:"$990.00",precioLitro:"$230.00",precioCopa:"$100.00"},{id:"13",nombre:"TRES GENERACIONES REPOSADO 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/Tres%20Gneraciones%20Reposado.webp",precioBotella:"$1800.00",precioLitro:"$445.00",precioCopa:"$190.00"},{id:"14",nombre:"CAZADORES REPOSADO 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/Cazadores.webp",precioBotella:"$1090.00",precioLitro:"$275.00",precioCopa:"$125.00"},{id:"15",nombre:"ESPOLON REPOSADO 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/tequila/Espolon%20Reposado.webp",precioBotella:"$1850.00",precioLitro:"$450.00",precioCopa:"$190.00"}],vodkas:[{id:"1",nombre:"ABSOLUT AZUL 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/absolut-azul.webp",precioBotella:"$1085.00",precioLitro:"$275.00",precioCopa:"$110.00"},{id:"2",nombre:"ABSOLUT CITRON 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/absolut-citron.webp",precioBotella:"$1090.00",precioLitro:"$275.00",precioCopa:"$110.00"},{id:"3",nombre:"ABSOLUT MANDRIN 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/absolut-mandrin.webp",precioBotella:"$1090.00",precioLitro:"$275.00",precioCopa:"$110.00"},{id:"4",nombre:"ABSOLUT RASPBERRI 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/absolut-raspberri.webp",precioBotella:"$1090.00",precioLitro:"$275.00",precioCopa:"$110.00"},{id:"5",nombre:"GREY GOOSE 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/grey-goose.webp",precioBotella:"$1580.00",precioLitro:"$395.00",precioCopa:"$135.00"},{id:"6",nombre:"SMIRNOFF 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/smirnoff.webp",precioBotella:"$875.00",precioLitro:"$220.00",precioCopa:"$100.00"},{id:"7",nombre:"SMIRNOFF TAMARINDO 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/smirnoff-tamarindo.webp",precioBotella:"$855.00",precioLitro:"$225.00",precioCopa:"$100.00"},{id:"8",nombre:"STOLICHNAYA 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/stolichnaya.webp",precioBotella:"$1110.00",precioLitro:"$275.00",precioCopa:"$110.00"},{id:"9",nombre:"KETEL ONE 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/Ketel%20One.webp",precioBotella:"$1450.00",precioLitro:"$360.00",precioCopa:"$145.00"},{id:"10",nombre:"KETEL ONE BOTANICAL PEACH & ORANGE 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/Ketel%20One%20Botanic.webp",precioBotella:"$1890.00",precioLitro:"$460.00",precioCopa:"$190.00"},{id:"11",nombre:"CIROC 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/Ciroc.webp",precioBotella:"$2590.00",precioLitro:"$650.00",precioCopa:"$290.00"},{id:"12",nombre:"CIROC RED BERRY 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/Ciroc%20Red%20Berry.webp",precioBotella:"$2500.00",precioLitro:"$590.00",precioCopa:"$225.00"},{id:"13",nombre:"CIROC PEACH 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/Ciroc%20Peach.webp",precioBotella:"$2500.00",precioLitro:"$590.00",precioCopa:"$225.00"},{id:"14",nombre:"CIROC PINEAPPLE 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/Ciroc%20Pinapple.webp",precioBotella:"$2500.00",precioLitro:"$590.00",precioCopa:"$225.00"},{id:"15",nombre:"SMIRNOFF CITRUS 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/vodka/Smirnoff%20Citrus.webp",precioBotella:"$1080.00",precioLitro:"$260.00",precioCopa:"$110.00"}],whiskies:[{id:"1",nombre:"BLACK & WHITE 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/black-and-white.webp",precioBotella:"$940.00",precioLitro:"$255.00",precioCopa:"$105.00"},{id:"2",nombre:"BUCHANANS 18 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/buchanans-18.webp",precioBotella:"$3200.00",precioLitro:"--",precioCopa:"--"},{id:"3",nombre:"BUCHANANS 12 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/buchanans-12.webp",precioBotella:"$1800.00",precioLitro:"$455.00",precioCopa:"$165.00"},{id:"4",nombre:"BUCHANANS MASTER 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/buchanans-masters.webp",precioBotella:"$2100.00",precioLitro:"$530.00",precioCopa:"$190.00"},{id:"5",nombre:"BUCHANANS TWO SOULS 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/buchanans-two-souls.webp",precioBotella:"$1685.00",precioLitro:"$410.00",precioCopa:"$155.00"},{id:"6",nombre:"CHIVAS REGAL 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/chivas.webp",precioBotella:"$1685.00",precioLitro:"$410.00",precioCopa:"$155.00"},{id:"7",nombre:"J.W. BLACK LABEL 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/etiqueta-negra.webp",precioBotella:"$1815.00",precioLitro:"$460.00",precioCopa:"$170.00"},{id:"8",nombre:"J.W. GREEN LABEL 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/etiqueta-verde.webp",precioBotella:"$2990.00",precioLitro:"--",precioCopa:"--"},{id:"9",nombre:"J.W. RED LABEL 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/etiqueta-roja.webp",precioBotella:"$1090.00",precioLitro:"$275.00",precioCopa:"$110.00"},{id:"10",nombre:"JACK DANIELS 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/jack-daniels.webp",precioBotella:"$1240.00",precioLitro:"$255.00",precioCopa:"$125.00"},{id:"11",nombre:"JACK DANIELS HONEY 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/jack-honey.webp",precioBotella:"$1190.00",precioLitro:"--",precioCopa:"--"},{id:"12",nombre:"J&B 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/J&B.webp",precioBotella:"$990.00",precioLitro:"$245.00",precioCopa:"$100.00"},{id:"13",nombre:"CARDHU 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/Cardhu.webp",precioBotella:"$1850.00",precioLitro:"$425.00",precioCopa:"$180.00"},{id:"14",nombre:"OLD PARR 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/Old%20Parr.webp",precioBotella:"$2490.00",precioLitro:"$625.00",precioCopa:"$245.00"},{id:"15",nombre:"MONCKEY SHOULDER 700ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/whisky/Monckey%20Shouder.webp",precioBotella:"$1090.00",precioLitro:"$245.00",precioCopa:"$110.00"}],alitas:[{id:"1",nombre:"Alitas BBQ (10 pzs)",ingredientes:"Las mejores alitas adobadas, con la famosa salsa BBQ, pero con nuestro toque.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/alitas/alitas-bbq.mp4",precio:"$190.00"},{id:"2",nombre:"Alitas BBQ (25 pzs)",ingredientes:"Las mejores alitas adobadas, con la famosa salsa BBQ, pero con nuestro toque.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/alitas/alitas-bbq.mp4",precio:"$365.00"},{id:"3",nombre:"Alitas HOT (10 pzs)",ingredientes:"La salsa picante para acompaar una buena chela.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/alitas/alitas-fuego-picante.mp4",precio:"$190.00"},{id:"4",nombre:"Alitas HOT (25 pzs)",ingredientes:"La salsa picante para acompaar una buena chela.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/alitas/alitas-fuego-picante.mp4",precio:"$365.00"},{id:"5",nombre:"Alitas Mango Habanero (10 pzs)",ingredientes:"Si te gusta el picante, no dejes de probar la mejor combinacin de dulce y picosa, salsa de mango agridulce con chile habanero toreado.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/alitas/alitas-mango-habanero.mp4",precio:"$190.00"},{id:"6",nombre:"Alitas Mango Habanero (25 pzs)",ingredientes:"Si te gusta el picante, no dejes de probar la mejor combinacin de dulce y picosa, salsa de mango agridulce con chile habanero toreado.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/alitas/alitas-mango-habanero.mp4",precio:"$365.00"},{id:"7",nombre:"Alitas Salsa de Jamaica (10 pzs)",ingredientes:"Deliciosas alitas en salsa de flor de jamaica con chile de rbol tostado. Te van a encantar.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/alitas/alitas-jamaica.mp4",precio:"$190.00"},{id:"8",nombre:"Alitas Salsa de Jamaica (25 pzs)",ingredientes:"Deliciosas alitas en salsa de flor de jamaica con chile de rbol tostado. Te van a encantar.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/alitas/alitas-jamaica.mp4",precio:"$365.00"},{id:"9",nombre:"Extra de Queso",ingredientes:"Extra de queso.",video:"",precio:"$30.00"},{id:"10",nombre:"Extra de Tocino",ingredientes:"Extra de tocino.",video:"",precio:"$30.00"}],ensaladas:[{id:"1",nombre:"Ensalada Csar",ingredientes:"Lechuga romana, crutones, queso parmesano y aderezo Csar.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/ensaladas/ensalada-cesar.mp4",precio:"$120.00"},{id:"2",nombre:"Ensalada de Quinoa",ingredientes:"Quinoa, espinacas, jitomate cherry, aguacate, pepino y aderezo de limn.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/ensaladas/ensalada-de-quinoa.mp4",precio:"$140.00"},{id:"3",nombre:"Ensalada Mediterrnea",ingredientes:"Lechuga mixta, aceitunas negras, queso feta, jitomate, pepino y aderezo de vinagreta.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/ensaladas/ensalada-mediterranea.mp4",precio:"$130.00"},{id:"4",nombre:"Ensalada de Pollo a la Parrilla",ingredientes:"Lechuga, pollo a la parrilla, zanahoria rallada, jitomate, aguacate y aderezo ranch.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/ensaladas/ensalada-mixta-con-pollo-parrilla.mp4",precio:"$150.00"}],carnes:[{id:"1",nombre:"Picaa",ingredientes:"Un corte jugoso y tierno con una capa de grasa que resalta su sabor nico.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/carnes/picana.mp4",precio:"$249.00"},{id:"2",nombre:"Sirloin",ingredientes:"Un corte magro, verstil y delicioso, ideal para asar o cocinar a la plancha.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/carnes/sirloin.mp4",precio:"$244.00"},{id:"3",nombre:"Rib Eye",ingredientes:"Un corte suave, jugoso y marmoleado, perfecto para parrilla o plancha.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/carnes/rye-bye.mp4",precio:"$369.00"},{id:"4",nombre:"Arrachera",ingredientes:"Un corte marinado con sabor intenso, ideal para asados y tacos.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/carnes/arrachera.mp4",precio:"$199.00"}],cafes:[{id:"1",nombre:"Americano",ingredientes:"Caf filtrado, con sabor suave y aromtico, hecho con granos de alta calidad.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/cafe/cafe-americano.mp4",precio:"$55.00"},{id:"2",nombre:"Caf express",ingredientes:"Caf negro concentrado y fuerte, preparado con mquinas especializadas de alta presin.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/cafe/cafe-express.mp4",precio:"$45.00"},{id:"3",nombre:"Capuchino",ingredientes:"Caf espresso combinado con leche vaporizada y una capa espumosa decorada con cacao.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/cafe/cafe-capuchino.mp4",precio:"$60.00"},{id:"4",nombre:"Mokachino",ingredientes:"Caf espresso mezclado con chocolate caliente, leche vaporizada y crema batida.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/cafe/mokachino.mp4",precio:"$65.00"}],postres:[{id:"1",nombre:"Pastel de Tres Leches",ingredientes:"Bizcocho baado en tres tipos de leche, decorado con crema batida y frutas frescas.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/postres/pastel-de-3-leches.mp4",precio:"$95.00"},{id:"2",nombre:"Flan Napolitano",ingredientes:"Flan cremoso con caramelo lquido.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/postres/flan-napolitano.mp4",precio:"$85.00"},{id:"3",nombre:"Tarta de Limn",ingredientes:"Base de galleta, crema de limn y merengue dorado.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/postres/tarta-de-limon.mp4",precio:"$90.00"},{id:"4",nombre:"Brownie con Helado",ingredientes:"Brownie de chocolate con nueces, helado de vainilla y salsa de chocolate.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/postres/brownie-helado.mp4",precio:"$110.00"}],pizzas:[{id:"1",nombre:"PIZZA DE PASTOR",ingredientes:"Masa crujiente y dorada con una deliciosa salsa de tomate y queso mozzarella, con la carne al pastor, cebolla y cilantro picado, trocitos de pia.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/pizzas/pizza-pastor.mp4",precio:"$240.00"},{id:"2",nombre:"PIZZA DE CHILAQUILES ARRACHERA",ingredientes:"Base de salsa verde asada, totopos horneados, arrachera a la parrilla, cebolla, cilantro y gratinado de mozzarella.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/pizzas/pizza-chilaquiles.mp4",precio:"$225.00"},{id:"3",nombre:"PIZZA DE PEPPERONI",ingredientes:"Masa clsica con pepperoni, queso gratinado y salsa italiana.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/pizzas/pizza-peperoni.mp4",precio:"$110.00"},{id:"4",nombre:"PIZZA HAWAIANA",ingredientes:"Jamn, queso, pia, salsa italiana y queso mozzarella.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/pizzas/pizza-hawaiana.mp4",precio:"$115.00"},{id:"5",nombre:"PIZZA DE 3 QUESOS",ingredientes:"Mezcla de queso mozzarella, queso manchego y queso azul gratinados al horno.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/pizzas/pizza-3-quesos.mp4",precio:"$100.00"}],sopas:[{id:"1",nombre:"Caldo Tlalpeo",ingredientes:"Pollo, garbanzo, zanahoria, chipotle, aguacate y caldo de pollo.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/sopas/caldo-tlalpeno.mp4",precio:"$100.00"},{id:"2",nombre:"Consom de Pollo",ingredientes:"Pollo, zanahoria, apio, arroz, cilantro y limn.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/sopas/consome-de-pollo.mp4",precio:"$90.00"},{id:"3",nombre:"Jugo de Carne",ingredientes:"Carne de res, zanahoria, papa, apio y caldo de hueso.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/sopas/jugo-de-carne.mp4",precio:"$110.00"},{id:"4",nombre:"Sopa de Tortilla",ingredientes:"Tortilla frita, jitomate, chile pasilla, aguacate, crema y queso.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/sopas/sopa-de-tortilla.mp4",precio:"$95.00"}],getPlatosFuertes:async function(){try{const{data:r,error:e}=await H.from("platos_fuertes").select("*").order("nombre");return e?(console.error("Error fetching platos fuertes:",e),[]):ce(r,"platos fuertes")}catch(r){return console.error("Unexpected error fetching platos fuertes:",r),[]}},getTequilas:async function(){try{const{data:r,error:e}=await H.from("tequila").select("*").order("nombre");return e?(console.error("Error fetching tequilas:",e),[]):ce(r,"tequila")}catch(r){return console.error("Unexpected error fetching tequilas:",r),[]}},vodka:[],getVodkas:async function(){try{const{data:r,error:e}=await H.from("vodka").select("*").order("nombre");if(e)return console.error("Error fetching vodkas:",e),[];const t=r.map(o=>({id:o.id,nombre:o.nombre,imagen:o.imagen,precioBotella:o.precio_botella,precioLitro:o.precio_litro,precioCopa:o.precio_copa,pais:o.pais,mixersBotella:o.mixers_botella,mixersLitro:o.mixers_litro,mixersCopa:o.mixers_copa,categoria:"vodka"}));return Y(Ue).parse(t)}catch(r){return console.error("Unexpected error fetching vodkas:",r),[]}},whisky:[],getWhiskies:async function(){try{const{data:r,error:e}=await H.from("whisky").select("*").order("nombre");if(e)return console.error("Error fetching whiskies:",e),[];const t=r.map(o=>({id:o.id,nombre:o.nombre,imagen:o.imagen,precioBotella:o.precio_botella,precioLitro:o.precio_litro,precioCopa:o.precio_copa,pais:o.pais,mixersBotella:o.mixers_botella,mixersLitro:o.mixers_litro,mixersCopa:o.mixers_copa,categoria:"whisky"}));return Y(Ue).parse(t)}catch(r){return console.error("Unexpected error fetching whiskies:",r),[]}},ron:[],getRones:async function(){try{const{data:r,error:e}=await H.from("ron").select("*").order("nombre");if(e)return console.error("Error fetching rones:",e),[];const t=r.map(o=>({id:o.id,nombre:o.nombre,imagen:o.imagen,precioBotella:o.precio_botella,precioLitro:o.precio_litro,precioCopa:o.precio_copa,pais:o.pais,mixersBotella:o.mixers_botella,mixersLitro:o.mixers_litro,mixersCopa:o.mixers_copa,categoria:"ron"}));return Y(Ue).parse(t)}catch(r){return console.error("Unexpected error fetching rones:",r),[]}},brandy:[],getBrandies:async function(){try{const{data:r,error:e}=await H.from("brandy").select("*").order("nombre");if(e)return console.error("Error fetching brandies:",e),[];const t=r.map(o=>({id:o.id,nombre:o.nombre,imagen:o.imagen,precioBotella:o.precio_botella,precioLitro:o.precio_litro,precioCopa:o.precio_copa,pais:o.pais,mixersBotella:o.mixers_botella,mixersLitro:o.mixers_litro,mixersCopa:o.mixers_copa,categoria:"brandy"}));return Y(Ue).parse(t)}catch(r){return console.error("Unexpected error fetching brandies:",r),[]}},cognac:[],getCognacs:async function(){try{const{data:r,error:e}=await H.from("cognac").select("*").order("nombre");if(e)return console.error("Error fetching cognacs:",e),[];const t=r.map(o=>({id:o.id,nombre:o.nombre,imagen:o.imagen,precioBotella:o.precio_botella,precioLitro:o.precio_litro,precioCopa:o.precio_copa,pais:o.pais,mixersBotella:o.mixers_botella,mixersLitro:o.mixers_litro,mixersCopa:o.mixers_copa,categoria:"cognac"}));return Y(Ue).parse(t)}catch(r){return console.error("Unexpected error fetching cognacs:",r),[]}},ginebra:[],getGinebras:async function(){try{const{data:r,error:e}=await H.from("ginebra").select("*").order("nombre");return e?(console.error("Error fetching ginebras:",e),[]):ce(r,"ginebra")}catch(r){return console.error("Unexpected error fetching ginebras:",r),[]}},mezcal:[],getMezcales:async function(){try{const{data:r,error:e}=await H.from("mezcal").select("*").order("nombre");return e?(console.error("Error fetching mezcales:",e),[]):ce(r,"mezcal")}catch(r){return console.error("Unexpected error fetching mezcales:",r),[]}},digestivos:[],getDigestivos:async function(){try{const{data:r,error:e}=await H.from("digestivos").select("*").order("nombre");return e?(console.error("Error fetching digestivos:",e),[]):ce(r,"digestivos")}catch(r){return console.error("Unexpected error fetching digestivos:",r),[]}},licores:[],getLicores:async function(){try{const{data:r,error:e}=await H.from("licores").select("*").order("nombre");return e?(console.error("Error fetching licores:",e),[]):ce(r,"licores")}catch(r){return console.error("Unexpected error fetching licores:",r),[]}},espumosos:[],getEspumosos:async function(){try{const{data:r,error:e}=await H.from("espumosos").select("*").order("nombre");return e?(console.error("Error fetching espumosos:",e),[]):ce(r,"espumosos")}catch(r){return console.error("Unexpected error fetching espumosos:",r),[]}},getSnacks:async function(){try{const{data:r,error:e}=await H.from("snacks").select("*").order("nombre");return e?(console.error("Error fetching snacks:",e),[]):ce(r,"snacks")}catch(r){return console.error("Unexpected error fetching snacks:",r),[]}}};function K(){const r=window.DIContainer||window.container;if(!r){console.warn("DI Container not initialized. Returning fallback ProductRepository with sample data.");const e={licoresCategories:[{id:"10",nombre:"WHISKY",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/WhikysX3.webp"},{id:"8",nombre:"TEQUILA",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/TequilaX3.webp"},{id:"4",nombre:"DIGESTIVOS",icono:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/recursos/iconos-licores/Digestivo.webp"}],digestivos:[{id:"d1",nombre:"BAILEYS 750 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/digestivos/bealys.webp",precioBotella:"$1040.00",precioCopa:"$100.00"},{id:"d2",nombre:"JGERMEISTER 700 ML",imagen:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/licores/digestivos/jaguer.webp",precioBotella:"$1115.00",precioCopa:"$115.00"}],cervezas:[{id:"c1",nombre:"CORONA 355ML",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/corona.webp",precio:"$60.00"},{id:"c2",nombre:"MODELO ESPECIAL 355ML",categoria:"cerveza",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/cervezas/modelo-especial.webp",precio:"$65.00"}],refrescos:[{id:"r1",nombre:"COCA COLA 355ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/coca-cola.webp",precio:"$55.00"},{id:"r2",nombre:"SPRITE 355ML",categoria:"refresco",tipo_contenido:"imagen",ruta_archivo:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/imagenes/bebidas/refrescos/sprite.webp",precio:"$55.00"}],pizzas:[{id:"p1",nombre:"PIZZA DE PEPPERONI",ingredientes:"Masa clsica con pepperoni, queso gratinado y salsa italiana.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/pizzas/pizza-peperoni.mp4",precio:"$110.00"},{id:"p2",nombre:"PIZZA HAWAIANA",ingredientes:"Jamn, queso, pia, salsa italiana y queso mozzarella.",video:"https://udtlqjmrtbcpdqknwuro.supabase.co/storage/v1/object/public/productos/videos/comida/pizzas/pizza-hawaiana.mp4",precio:"$115.00"}]};return{async getLicoresCategories(){return e.licoresCategories},async getLiquorSubcategory(t){return e[t]||[]},async getCervezas(){return e.cervezas},async getPizzas(){return e.pizzas},async getRefrescos(){return e.refrescos},async saveOrder(){return console.warn("saveOrder: Using fallback repository. Order not saved to cloud."),!1}}}return r.resolve("ProductRepository")}function Li(r){if(typeof window.DIContainer>"u"&&typeof window.container>"u")throw new Error("DI Container not initialized. Make sure AppInit.initialize() has been called.");return(window.DIContainer||window.container).resolve(r)}const $u=Object.freeze(Object.defineProperty({__proto__:null,getProductRepository:K,resolveService:Li},Symbol.toStringTag,{value:"Module"}));class ie{static handle(e,t="",o={}){const i=e instanceof Error?e.message:e||"Error desconocido",n=new Date().toISOString();return h.error(`[${n}] [${t}] ERROR: ${i}`,{name:e?.name,stack:e?.stack,context:t,additionalInfo:o.additionalInfo}),this.#e(e)}static#e(e){if(!e)return"Algo sali mal. Por favor intenta de nuevo.";switch(e.name||e.constructor?.name||""){case"NetworkError":case"TypeError":if(e.message.includes("fetch"))return"Problema de conexin. Verifica tu internet e intenta de nuevo.";break;case"ValidationError":return e.message||"Los datos ingresados no son vlidos.";case"DomainError":return e.message||"Error en la operacin solicitada.";case"InfrastructureError":return"Problema temporal del servicio. Intenta de nuevo en unos momentos.";default:if(e.message&&e.message.length<100)return e.message}return"Algo sali mal. Por favor intenta de nuevo."}static handleValidation(e,t="Validation"){return this.handle(e,t,{type:"validation"})}static handleDomain(e,t="Domain"){return this.handle(e,t,{type:"domain"})}static logWarning(e,t={}){h.warn(e,t)}static handleValidationError(e,t,o){const i=`Validation failed for field '${e}' with value '${t}': ${o}`;this.handle(i,"Validation",{field:e,value:t,rule:o}),A(async()=>{const{default:n}=await import("./ValidationError-DaI9iVYG.js");return{default:n}},[]).then(({default:n})=>{throw new n(i)}).catch(n=>{throw new Error(i)})}static showUserError(e,t=null){if(this.handle(`User error: ${e}`,"UI"),t){const o=document.getElementById(t);o&&(o.textContent=e,o.className=o.className.replace("error-hidden","").trim()+" error-red error-visible")}else alert(`Error: ${e}`)}static clearUserError(e){const t=document.getElementById(e);t&&(t.textContent="",t.className=t.className.replace("error-visible","").replace("error-red","").trim()+" error-hidden")}static handleXSSError(e,t){this.handle("ERROR DE SEGURIDAD XSS!",e,{type:"security",suspiciousData:t,additionalInfo:`XSS attempt detected in ${e}`})}static async handleAsync(e,t=""){try{return[null,await e]}catch(o){const i=this.handle(o,t);return[{originalError:o,userMessage:i},null]}}}const G=(r,e=null,t={})=>{ie.handle(e||r,t.module||"Unknown",{additionalInfo:t})},Et=ie.logWarning;ie.handleValidationError;ie.handle;ie.showUserError;ie.clearUserError;const Je=ie.handleXSSError,fe={BACKGROUND_SYNC_INTERVAL:3e5,AUTO_UPDATE_ENABLED:!0,MAX_SYNC_RETRIES:3,SYNC_RETRY_DELAY:3e4},qe={EMAIL_PATTERN:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,PHONE_PATTERN:/^[\+]?[1-9][\d]{0,15}$/,MIN_NAME_LENGTH:2,MAX_NAME_LENGTH:100,MIN_PASSWORD_LENGTH:6};class Ke{static isValidEmail(e){return!e||typeof e!="string"?!1:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim())}static isValidPhone(e){return!e||typeof e!="string"?!1:/^[\+]?[1-9][\d]{0,15}$/.test(e.replace(/[\s\-\(\)]/g,""))}static isPositiveNumber(e){const t=Number(e);return!isNaN(t)&&t>0}static isValidLength(e,t=0,o=1/0){if(typeof e!="string")return!1;const i=e.trim().length;return i>=t&&i<=o}static isValidUrl(e){if(!e||typeof e!="string")return!1;try{return new URL(e),!0}catch{return!1}}static validate(e,t,o={}){try{if(this.#e(e)&&!o.optional)return{isValid:!1,message:"Este campo es requerido"};if(this.#e(e)&&o.optional)return{isValid:!0,message:""};switch(t){case"email":return this.#t(e);case"phone":return this.#r(e);case"number":return this.#o(e,o);case"text":return this.#i(e,o);case"password":return this.#n(e);default:return{isValid:!0,message:""}}}catch{return{isValid:!1,message:"Error en la validacin"}}}static validateFields(e,t){const o={};let i=!0;for(const[n,s]of Object.entries(t)){const a=e[n],c=this.validate(a,s.type,s.options||{});c.isValid||(o[n]=c.message,i=!1)}return{isValid:i,errors:o}}static#e(e){return e==null||e===""||typeof e=="string"&&e.trim()===""}static#t(e){return qe.EMAIL_PATTERN.test(e)?{isValid:!0,message:""}:{isValid:!1,message:"Email no vlido"}}static#r(e){const t=e.replace(/[\s\-\(\)]/g,"");return qe.PHONE_PATTERN.test(t)?{isValid:!0,message:""}:{isValid:!1,message:"Telfono no vlido"}}static#o(e,t={}){const o=Number(e);return isNaN(o)?{isValid:!1,message:"Debe ser un nmero vlido"}:t.integer&&!Number.isInteger(o)?{isValid:!1,message:"Debe ser un nmero entero"}:t.min!==void 0&&o<t.min?{isValid:!1,message:`Debe ser mayor o igual a ${t.min}`}:t.max!==void 0&&o>t.max?{isValid:!1,message:`Debe ser menor o igual a ${t.max}`}:{isValid:!0,message:""}}static#i(e,t={}){const o=t.minLength||qe.MIN_NAME_LENGTH,i=t.maxLength||qe.MAX_NAME_LENGTH;return e.length<o?{isValid:!1,message:`Debe tener al menos ${o} caracteres`}:e.length>i?{isValid:!1,message:`No puede exceder ${i} caracteres`}:{isValid:!0,message:""}}static#n(e){return e.length<qe.MIN_PASSWORD_LENGTH?{isValid:!1,message:`La contrasea debe tener al menos ${qe.MIN_PASSWORD_LENGTH} caracteres`}:{isValid:!0,message:""}}static sanitizeText(e){return typeof e!="string"?"":e.trim().replace(/[<>"'&]/g,"").substring(0,1e3)}static validateBatch=e=>e.map(({value:t,type:o,options:i={}})=>this.validate(t,o,i));static validateAndSanitize=(e,t,o={})=>{const i=this.validate(e,t,o),n=i.isValid?this.sanitizeText(e):"";return{...i,sanitizedValue:n}};static validateProduct(e){const t=[];return e?.name?.trim()||t.push("Product name is required"),this.isPositiveNumber(e?.price)||t.push("Valid price is required"),e?.category?.trim()||t.push("Product category is required"),{isValid:t.length===0,errors:t}}static validateCocktail(e){const t=[];return e?.name?.trim()||t.push("Cocktail name is required"),this.isPositiveNumber(e?.price)||t.push("Valid price is required"),e?.ingredients?.length||t.push("At least one ingredient is required"),{isValid:t.length===0,errors:t}}static validateOrder(e){const t=[];return e?.items?.length||t.push("Order must contain at least one item"),this.isPositiveNumber(e?.total)||t.push("Valid order total is required"),{isValid:t.length===0,errors:t}}static validateBeer(e){const t=[];return e?.nombre?.trim()||t.push("Beer name is required"),this.isPositiveNumber(e?.precio)||t.push("Valid price is required"),{isValid:t.length===0,errors:t}}static validateFood(e){const t=[];return e?.nombre?.trim()||t.push("Food name is required"),this.isPositiveNumber(e?.precio)||t.push("Valid price is required"),{isValid:t.length===0,errors:t}}static throwIfInvalid(e,t="Validation"){if(!e.isValid)throw new Error(`${t} failed: ${e.errors.join(", ")}`)}}function Tr(r,e={}){if(!r||typeof r!="string")return"";const t=Ke.validate(r,"text",{maxLength:1e4});if(!t.isValid)return Je("sanitizeHTML",t.message),"";if(!window.DOMPurify)return h.error("DOMPurify not available. HTML sanitization disabled."),"";try{const o={ALLOWED_TAGS:["p","br","strong","em","span","div","img","h1","h2","h3","h4","h5","h6"],ALLOWED_ATTR:["class","src","alt","data-category"],KEEP_CONTENT:!0,FORBID_ATTR:["onload","onerror","onclick","onmouseover"],...e};return window.DOMPurify.sanitize(r,o)}catch(o){return Je("sanitizeHTML",{html:r,error:o.message}),""}}function Pi(r,e=1e3){return!r||typeof r!="string"?"":Ke.validate(r,"text",{maxLength:e}).isValid?r.trim().replace(/[<>"'&]/g,"").substring(0,e):Ke.sanitizeText(r)}function ji(r){if(!r||typeof r!="string")return"";if(r.length>2048)return Je("sanitizeURL","URL too long"),"";const e=r.trim().toLowerCase();return e.startsWith("javascript:")||e.startsWith("data:")||e.startsWith("vbscript:")||e.startsWith("file:")||e.startsWith("ftp:")?(Je("sanitizeURL",r),""):r.trim()}const Lu=(r,e="text",t={})=>{switch(e.toLowerCase()){case"html":return Tr(r,t);case"url":return ji(r);case"text":default:return Pi(r,t.maxLength)}};window.sanitizeHTML=Tr;window.sanitizeText=Pi;window.sanitizeURL=ji;window.sanitize=Lu;function Nt(r,e){if(!r||typeof r.innerHTML>"u")return h.error("setSafeInnerHTML: Invalid element provided"),!1;if(typeof e!="string")return Je("setSafeInnerHTML",e),!1;try{return r.innerHTML=Tr(e),!0}catch(t){return Je("setSafeInnerHTML",{html:e,error:t.message}),!1}}function me(r){let e=0;for(let t=0;t<r.length;t++){const o=r.charCodeAt(t);e=(e<<5)-e+o,e=e&e}return Math.abs(e).toString(36)}function Ao(r){if(!r||r==="--")return"--";let e=r;typeof r=="string"&&(e=r.replace("$","").trim());const t=parseFloat(e);return isNaN(t)?r:`$${t.toFixed(2)}`}function Oo(r){return r?r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase():""}function Pu(r,e,t){const o=["pizzas","alitas","sopas","ensaladas","carnes","platos fuertes","platos-fuertes","platos_fuertes","snacks","cortes de carne","cortes_de_carne","cortes-de-carne"],i=["cocteleria","refrescos","cervezas","cafe","postres"],n=["licores","tequila","whisky","ron","vodka","ginebra","mezcal","cognac","brandy","digestivos","espumosos"],s=(r||"").replace(/[-_]/g," "),a=r||"";return o.includes(a)||o.includes(s)?"food":i.includes(a)||i.includes(s)?"beverage":e==="liquor-table"||n.includes(a)||n.includes(s)?"liquor":(Et(`Unknown product type for category: ${t} (normalized: ${r})`),"unknown")}function ju(r){return r.includes("precio")||r==="precioBotella"||r==="precioLitro"||r==="precioCopa"}const z={currentViewMode:"grid",eventDelegationInitialized:!1,boundDelegatedHandler:null,productCache:{}},Fe={toggleViewMode(){return z.currentViewMode=z.currentViewMode==="table"?"grid":"table",z.currentViewMode},setEventDelegationInitialized(r){z.eventDelegationInitialized=r},setBoundDelegatedHandler(r){z.boundDelegatedHandler=r},setProductCache(r,e){z.productCache[r]=e},getProductFromCache(r,e){return z.productCache[r]?z.productCache[r].find(t=>t.nombre&&t.nombre.trim().toLowerCase()===e.trim().toLowerCase()):null}},Ru=Object.freeze(Object.defineProperty({__proto__:null,actions:Fe,state:z},Symbol.toStringTag,{value:"Module"}));class Nu{constructor(){this.establishmentId=T.get("database.establishmentId")}track(e,t={}){const o={establecimiento_id:this.establishmentId,tipo_evento:e,producto_id:t.productId||t.id||"unknown",marca_id:t.brandId||t.marca_id||null,contexto:t.context||{product_name:t.nombre||t.name,category:t.categoria||t.category},timestamp:new Date().toISOString()};H.from("eventos_analiticos").insert([o]).then(({error:i})=>{i?console.warn("[Analytics] Telemetra fallida (Silencioso):",e,i):h.debug(`[Analytics] Evento registrado: ${e}`,o)}).catch(i=>{console.warn("[Analytics] Error crtico en envo de mtricas:",i)})}trackView(e){this.track("view",e)}trackAddToCart(e){this.track("add_to_cart",e)}trackRemoveFromCart(e){this.track("remove_from_cart",e)}trackStockout(e){this.track("stockout_click",e)}}const st=new Nu;class Du{constructor(){this._state={isEditingMode:!1,selectedProduct:null,activeOverlay:null},this._listeners=[],this._autoBind()}_autoBind(){this.toggleMode=this.toggleMode.bind(this),this.selectProduct=this.selectProduct.bind(this),this.clearSelection=this.clearSelection.bind(this)}get isEditing(){return this._state.isEditingMode}get selection(){return this._state.selectedProduct}toggleMode(e=null){const t=e!==null?e:!this._state.isEditingMode;this._state.isEditingMode!==t&&(this._state.isEditingMode=t,h.info(` Editor Mode: ${t?"ACTIVATED":"DEACTIVATED"}`),this._notify({type:"MODE_CHANGED",isEditing:t}),t?document.body.classList.add("admin-mode-active"):(document.body.classList.remove("admin-mode-active"),this.clearSelection()))}selectProduct(e,t){this.isEditing&&(this._state.selectedProduct&&this._state.selectedProduct.id===e.id||(this._state.selectedProduct={...e,sourceElement:t},h.debug(` Product Selected for Editing: ${e.nombre} (${e.id})`),this._notify({type:"PRODUCT_SELECTED",product:this._state.selectedProduct})))}clearSelection(){this._state.selectedProduct&&(this._state.selectedProduct=null,this._notify({type:"SELECTION_CLEARED"}))}subscribe(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(t=>t!==e)}}_notify(e){this._listeners.forEach(t=>t(e))}}const Zt=new Du,zu={initEventDelegation:function(){if(z.eventDelegationInitialized)return;const r=this.handleDelegatedEvent.bind(this);Fe.setBoundDelegatedHandler(r),document.addEventListener("click",r),Fe.setEventDelegationInitialized(!0),h.info("Event delegation system initialized for ProductRenderer")},handleDelegatedEvent:function(r){const e=r.target,t=e.closest("#home-hub-grid .category-card");if(t){r.preventDefault(),r.stopPropagation();const o=t.dataset.category||t.dataset.target;o&&window.AppInit&&typeof window.AppInit.loadContent=="function"&&(h.info(`[Events] Home Hub Navigation -> ${o}`),window.AppInit.loadContent(o));return}if(Zt.isEditing){const o=e.closest("tr[data-product-id]")||e.closest(".product-card");if(o){h.info(" Admin Interceptor: Click detected on",o),r.preventDefault(),r.stopPropagation();const i=o.dataset.productId,n=o.closest("[data-category]")?.dataset.category;if(i){const s=K();console.log(" [Admin Interceptor] Repo Instance:",s),console.log(" [Admin Interceptor] Has getProductByIdV2?",typeof s.getProductByIdV2),Promise.resolve(s.getProductByIdV2(i,n)).then(a=>{if(a)h.info(" Interceptor: Full Product Fetched:",a),Zt.selectProduct(a,o);else{h.warn(" Interceptor: Product not found in cache, using DOM fallback.");const c={id:i,nombre:o.dataset.productName||o.querySelector(".product-name")?.textContent||"Producto Sin Nombre",precio:o.dataset.productPrice,imagen:o.querySelector("img")?.src,disponible:!o.classList.contains("unavailable"),categoria:n};Zt.selectProduct(c,o)}})}return}}if(e.classList&&e.classList.contains("view-toggle-btn")){r.preventDefault(),this.toggleViewMode().then(()=>{const o=document.getElementById("content-container");if(o)return this.refreshCurrentView(o)}).catch(o=>{h.error("Error in view toggle:",o)});return}if(e.id==="home-btn"||e.closest("#home-btn")){r.preventDefault(),window.AppInit&&typeof window.AppInit.loadContent=="function"&&window.AppInit.loadContent("home");return}if(e.classList&&(e.classList.contains("back-button")||e.classList.contains("top-back-btn"))){r.preventDefault(),(e.closest(".content-wrapper")||document.querySelector(".content-wrapper"))&&this.handleBackButton(e);return}if(e.classList&&e.classList.contains("price-button")){r.preventDefault(),this.handlePriceButtonClick(e,r);return}if(e.classList&&e.classList.contains("video-thumb")||e.classList&&e.classList.contains("video-thumbnail")){r.preventDefault(),this.handleVideoClick(e);return}if(e.classList&&e.classList.contains("product-image")){r.preventDefault(),this.handleImageClick(e);return}if(e.classList&&e.classList.contains("product-card")){r.preventDefault(),this.handleCardClick(e,r);return}if(e.classList&&e.classList.contains("category-card")||e.closest(".category-card")){r.preventDefault(),this.handleCategoryCardClick(e);return}if(e.classList&&e.classList.contains("modal-close-btn")){r.preventDefault(),this.handleModalClose(e);return}if(e.classList&&e.classList.contains("modal-backdrop")||e.classList&&e.classList.contains("video-modal-backdrop")||e.classList&&e.classList.contains("image-modal-backdrop")){this.handleModalBackdropClick(e,r);return}},destroyEventDelegation:function(){z.boundDelegatedHandler&&(document.removeEventListener("click",z.boundDelegatedHandler),Fe.setBoundDelegatedHandler(null),Fe.setEventDelegationInitialized(!1),h.info("Event delegation system destroyed"))},createViewToggle:function(r){this.initEventDelegation();const e=document.createElement("div");e.className="view-toggle-container";const t=document.createElement("button");return t.className="view-toggle-btn",t.textContent=z.currentViewMode==="table"?"":"",t.classList.toggle("active",z.currentViewMode==="grid"),e.appendChild(t),e},handleCategoryCardClick:function(r){const e=r.closest(".category-card")||r,t=e.dataset.category||e.dataset.target;if(t){if(e.closest("#home-hub-grid")){h.info(`[Events] Home Hub Navigation -> ${t}`),window.AppInit&&typeof window.AppInit.loadContent=="function"?(A(()=>import("./NavigationDrawer-C4NccJW3.js"),[]).then(n=>{n.default.close()}),window.AppInit.loadContent(t)):h.error("[Events] AppInit.loadContent not found for Home Hub navigation");return}const i=e.closest(".content-wrapper")||document.querySelector(".content-wrapper");i?this.renderLicorSubcategory(i,t):h.error(` No se encontr container para categora ${t}`)}else h.warn(" No se encontr categora en el elemento clickeado")},handleModalClose:function(r){const e=r.closest(".modal-backdrop");e&&e.remove()},handleModalBackdropClick:function(r,e){e.target===r&&r.remove()},handlePriceButtonClick:function(r,e){if(r.disabled||r.classList&&r.classList.contains("non-selectable"))return;const t=r.closest(".price-button");if(!t){h.debug("[Events] Clicked element is not a price button (checked closest)");return}const o=t.closest("tr"),i=t.closest(".product-card");let n,s,a;if(o){const l=o.querySelector(".product-name");s=t.textContent,n=l.textContent,a=o}else if(i)n=t.dataset.productName,s=t.textContent,a=i;else{h.warn("Price button clicked outside of row or card context");return}h.debug(`[Events] Dispatching product-interaction for ${n}`);const c=new CustomEvent("product-interaction",{bubbles:!0,detail:{action:"select",productName:n,priceText:s,contextElement:a,originalEvent:e,target:t}});document.dispatchEvent(c)},handleVideoClick:function(r){const e=r.dataset.videoUrl||r.src,t=r.dataset.videoUrlFallback,o=(r.alt||"Producto").replace(/^(Ver video de|Video de)\s+/i,"").trim(),n=r.closest("table, .product-grid")?.dataset.category,s=n==="cervezas"||n==="refrescos"?n:null;this.showVideoModal(e,o,s,t),st.trackView({nombre:o,categoria:n,context:{via:"video"}})},handleImageClick:function(r){const e=r.src,t=r.alt||"Producto",i=r.closest("table, .product-grid")?.dataset.category,n=i==="cervezas"||i==="refrescos"?i:null;this.showImageModal(e,t,n),st.trackView({nombre:t,categoria:i,context:{via:"image"}})},handleCardClick:function(r,e){},handleBackButton:function(r){(r.title==="Volver a Licores"||r.dataset.action==="back-to-licores")&&(window.AppInit&&typeof window.AppInit.loadContent=="function"?(h.info("Navigating back to Licores via AppInit"),window.AppInit.loadContent("licores")):h.error("AppInit not available for back navigation"))}},To={async getLicoresCategories(){return await K().getLicoresCategories()},async getProductsByCategory(r){return await K().getProductsByCategory(r)},async getLiquorSubcategory(r){return await K().getLiquorSubcategory(r)}};class R{constructor(){if(R.instance)return R.instance;this.overlay=null,this.currentModal=null,this.closeTimeout=null,this.onCloseCallback=null,this._init(),R.instance=this}static getInstance(){return R.instance||new R,R.instance}_init(){let e=document.querySelector(".sys-modal-overlay");e||(e=document.createElement("div"),e.className="sys-modal-overlay",e.id="sys-global-overlay",document.body.appendChild(e)),this.overlay=e,this.overlay.addEventListener("click",t=>{t.target===this.overlay&&this.close()})}static show(e){const t=R.getInstance();return t.build(e).open(),t}build(e){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null),this.onCloseCallback=e.onClose;const t=document.createElement("div");t.className=`sys-modal-container ${e.size?`sys-modal-${e.size}`:""}`;const o=document.createElement("div");o.className="sys-modal-header",o.innerHTML=`
            <h2>${e.title||"Attention"}</h2>
            <button class="close-btn">&times;</button>
        `,o.querySelector(".close-btn").onclick=()=>this.close(),t.appendChild(o);const i=document.createElement("div");if(i.className="sys-modal-body",typeof e.content=="string"?i.innerHTML=e.content:e.content instanceof HTMLElement&&i.appendChild(e.content),t.appendChild(i),e.actions&&e.actions.length>0){const n=document.createElement("div");n.className="sys-modal-footer",e.actions.forEach(s=>{const a=document.createElement("button"),c=s.type==="primary"?"btn-contrast":s.type==="ghost"?"btn-ghost":"btn-primary";a.className=`btn ${c}`,a.textContent=s.label,a.disabled=s.disabled||!1,a.onclick=()=>{s.onClick&&s.onClick()},n.appendChild(a)}),t.appendChild(n)}return this.currentModal=t,this}open(){this.currentModal&&(this.overlay.innerHTML="",this.overlay.appendChild(this.currentModal),requestAnimationFrame(()=>{this.overlay.classList.add("active")}))}static close(){R.getInstance().close()}close(){this.closeTimeout||(this.overlay.classList.remove("active"),this.closeTimeout=setTimeout(()=>{if(this.overlay.classList.contains("active")||(this.overlay.innerHTML=""),this.closeTimeout=null,this.onCloseCallback){const e=this.onCloseCallback;this.onCloseCallback=null,e()}},300))}}R.instance=null;const Io=Object.freeze(Object.defineProperty({__proto__:null,ModalSystem:R},Symbol.toStringTag,{value:"Module"})),Ri={PRODUCTS_UPDATED:"products:updated",SAAS_CONTEXT_CHANGED:"saas:context_changed"};class qu{constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(o=>o!==t))}emit(e,t){this.listeners[e]&&(h.debug(`[EventBus] Emitting ${e}`,t),this.listeners[e].forEach(o=>{try{o(t)}catch(i){h.error(`[EventBus] Error in listener for ${e}`,i)}}))}}const Ni=new qu,$o=Object.freeze(Object.defineProperty({__proto__:null,EVENTS:Ri,EventBus:Ni},Symbol.toStringTag,{value:"Module"})),xu={alitas:{tableName:"alitas",fields:["nombre","ingredientes","video","precio_10_piezas","precio_25_piezas"],headers:["NOMBRE","INGREDIENTES","VIDEO","10 PIEZAS","25 PIEZAS"],priceFields:[{key:"precio_10_piezas",column:"precio_10_piezas",label:"10 Piezas"},{key:"precio_25_piezas",column:"precio_25_piezas",label:"25 Piezas"}]},brandy:{tableName:"brandy",fields:["nombre","imagen","precio_botella","precio_litro","precio_copa","mixers_botella","mixers_litro","mixers_copa"],headers:["NOMBRE","IMAGEN","BOTELLA","LITRO","COPA"],priceFields:[{key:"botella",column:"precio_botella",label:"Botella"},{key:"litro",column:"precio_litro",label:"Litro"},{key:"copa",column:"precio_copa",label:"Copa"}]},cafe:{tableName:"cafe",fields:["nombre","ingredientes","video","precio"],headers:["NOMBRE","INGREDIENTES","VIDEO","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]},cervezas:{tableName:"cervezas",fields:["nombre","imagen","precio"],headers:["NOMBRE","IMAGEN","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]},cocteleria:{tableName:"cocteleria",fields:["nombre","ingredientes","video","precio"],headers:["NOMBRE","INGREDIENTES","VIDEO","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]},cognac:{tableName:"cognac",fields:["nombre","imagen","precio_botella","precio_litro","precio_copa"],headers:["NOMBRE","IMAGEN","BOTELLA","LITRO","COPA"],priceFields:[{key:"botella",column:"precio_botella",label:"Botella"},{key:"litro",column:"precio_litro",label:"Litro"},{key:"copa",column:"precio_copa",label:"Copa"}]},cortes_de_carne:{tableName:"cortes_de_carne",fields:["nombre","ingredientes","video","precio"],headers:["NOMBRE","INGREDIENTES","VIDEO","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]},digestivos:{tableName:"digestivos",fields:["nombre","imagen","precio_botella","precio_copa","mixers_botella","mixers_copa"],headers:["NOMBRE","IMAGEN","BOTELLA","COPA"],priceFields:[{key:"botella",column:"precio_botella",label:"Botella"},{key:"copa",column:"precio_copa",label:"Copa"}]},ensaladas:{tableName:"ensaladas",fields:["nombre","ingredientes","video","precio"],headers:["NOMBRE","INGREDIENTES","VIDEO","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]},espumosos:{tableName:"espumosos",fields:["nombre","imagen","precio_botella"],headers:["NOMBRE","IMAGEN","BOTELLA"],priceFields:[{key:"botella",column:"precio_botella",label:"Botella"}]},ginebra:{tableName:"ginebra",fields:["nombre","imagen","precio_botella","precio_litro","precio_copa","mixers_botella","mixers_litro","mixers_copa"],headers:["NOMBRE","IMAGEN","BOTELLA","LITRO","COPA"],priceFields:[{key:"botella",column:"precio_botella",label:"Botella"},{key:"litro",column:"precio_litro",label:"Litro"},{key:"copa",column:"precio_copa",label:"Copa"}]},licores:{tableName:"licores",fields:["nombre","imagen"],headers:["CATEGORA","IMAGEN"]},mezcal:{tableName:"mezcal",fields:["nombre","imagen","precio_botella","precio_litro","precio_copa","mixers_botella","mixers_litro","mixers_copa"],headers:["NOMBRE","IMAGEN","BOTELLA","LITRO","COPA"],priceFields:[{key:"botella",column:"precio_botella",label:"Botella"},{key:"litro",column:"precio_litro",label:"Litro"},{key:"copa",column:"precio_copa",label:"Copa"}]},pizzas:{tableName:"pizzas",fields:["nombre","ingredientes","video","precio"],headers:["NOMBRE","INGREDIENTES","VIDEO","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]},platos_fuertes:{tableName:"platos_fuertes",fields:["nombre","ingredientes","video","precio"],headers:["NOMBRE","INGREDIENTES","VIDEO","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]},postres:{tableName:"postres",fields:["nombre","ingredientes","video","precio"],headers:["NOMBRE","INGREDIENTES","VIDEO","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]},refrescos:{tableName:"refrescos",fields:["nombre","imagen","precio"],headers:["NOMBRE","IMAGEN","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]},ron:{tableName:"ron",fields:["nombre","imagen","precio_botella","precio_litro","precio_copa","mixers_botella","mixers_litro","mixers_copa"],headers:["NOMBRE","IMAGEN","BOTELLA","LITRO","COPA"],priceFields:[{key:"botella",column:"precio_botella",label:"Botella"},{key:"litro",column:"precio_litro",label:"Litro"},{key:"copa",column:"precio_copa",label:"Copa"}]},snacks:{tableName:"snacks",fields:["nombre","thumbnail","video","ingredientes","precio"],headers:["NOMBRE","IMAGEN","VIDEO","INGREDIENTES","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]},sopas:{tableName:"sopas",fields:["nombre","ingredientes","video","precio"],headers:["NOMBRE","INGREDIENTES","VIDEO","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]},tequila:{tableName:"tequila",fields:["nombre","imagen","precio_botella","precio_litro","precio_copa","mixers_botella","mixers_litro","mixers_copa"],headers:["NOMBRE","IMAGEN","BOTELLA","LITRO","COPA"],priceFields:[{key:"botella",column:"precio_botella",label:"Botella"},{key:"litro",column:"precio_litro",label:"Litro"},{key:"copa",column:"precio_copa",label:"Copa"}]},vodka:{tableName:"vodka",fields:["nombre","imagen","precio_botella","precio_litro","precio_copa","mixers_botella","mixers_litro","mixers_copa"],headers:["NOMBRE","IMAGEN","BOTELLA","LITRO","COPA"],priceFields:[{key:"botella",column:"precio_botella",label:"Botella"},{key:"litro",column:"precio_litro",label:"Litro"},{key:"copa",column:"precio_copa",label:"Copa"}]},whisky:{tableName:"whisky",fields:["nombre","imagen","precio_botella","precio_litro","precio_copa","mixers_botella","mixers_litro","mixers_copa"],headers:["NOMBRE","IMAGEN","BOTELLA","LITRO","COPA"],priceFields:[{key:"botella",column:"precio_botella",label:"Botella"},{key:"litro",column:"precio_litro",label:"Litro"},{key:"copa",column:"precio_copa",label:"Copa"}]}};function ur(r){const e=r?r.toLowerCase().trim().replace(/[\s-]+/g,"_"):"default";return xu[e]||{fields:["nombre","imagen","precio"],headers:["NOMBRE","IMAGEN","PRECIO"],priceFields:[{key:"standard",column:"precio",label:"Precio"}]}}const Lo="/assets/no-image.png",Ir={...zu,initRealtimeUpdates:function(){Ni.on(Ri.PRODUCTS_UPDATED,r=>{h.info(" [Realtime] Products Updated Event Received:",r);const e=document.getElementById("content-container");e&&this.refreshCurrentView(e)})},showVideoModal:function(r,e,t,o){A(async()=>{const{ModalSystem:i}=await Promise.resolve().then(()=>Io);return{ModalSystem:i}},void 0).then(({ModalSystem:i})=>{const n=document.createElement("video");n.src=r,n.controls=!0,n.autoplay=!0,n.className="modal-video-player",i.show({title:e||"Video del Producto",content:n,size:"large",onClose:()=>{n.pause(),n.src=""}})})},showImageModal:function(r,e,t){A(async()=>{const{ModalSystem:o}=await Promise.resolve().then(()=>Io);return{ModalSystem:o}},void 0).then(({ModalSystem:o})=>{const i=document.createElement("img");i.src=r,i.className="modal-image-preview",i.style.maxWidth="100%",o.show({title:e||"Imagen del Producto",content:i,size:"medium"})})},_renderLiquorInBox:function(r,e,t,o){z.currentViewMode==="grid"?this.createProductGrid(r,e,["nombre","ruta_archivo","precio"],t,o):this.createProductTable(r,["NOMBRE","IMAGEN","PRECIO"],e,["nombre","ruta_archivo","precio"],"liquor-table",t,o)},toggleViewMode:async function(){const r=Fe.toggleViewMode();h.info("View mode toggled to:",r);const e=document.querySelector(".view-toggle-btn");e&&(e.textContent=r==="table"?"":"",e.classList.toggle("active",r==="grid"));const t=document.getElementById("content-container");return t&&(await this.refreshCurrentView(t),this._retranslateIfNeeded(t)),r},refreshCurrentView:async function(r){const e=this._extractViewData(r);if(!e)return;const t=this._preserveBackButton(r),o=this._clearAndRestoreContainer(r,t);await this._renderCategoryView(o,e.category),this._retranslateIfNeeded(o)},_extractViewData:function(r){const e=r.querySelector("table, .product-grid");if(!e)return null;const t=e.dataset.category;return t?{category:t}:null},_preserveBackButton:function(r){const e=r.querySelector(".back-button-container");return e?e.outerHTML:null},_clearAndRestoreContainer:function(r,e){const t=document.getElementById("content-container");return t?(t.innerHTML="",e&&this._restoreBackButton(t,e),t):(h.error("CRITICAL: #content-container missing from DOM. Static structure compromised."),r)},_restoreBackButton:function(r,e){const t=document.createElement("div");t.innerHTML=e;const o=t.firstChild;r.appendChild(o)},_renderCategoryView:async function(r,e){const o=this._getCategoryRenderers()[e];o?(await o(r),this._retranslateIfNeeded(r)):h.warn("Unknown category for refresh:",e)},renderCategory:async function(r,e){const t=ur(e),o=K(),n=window.AppInit?.modules?.get("appConfig")?.getCategoryConfig(e),s=n?.header||e;n&&h.info(`[ProductRenderer] Using standardized header for ${e}: "${s}"`),r.innerHTML="";try{const a=e.toLowerCase().trim().replace(/\s+/g,"_"),l={platos_fuertes:"getPlatosFuertes","platos fuertes":"getPlatosFuertes",cocteleria:"getCocteles",snacks:"getSnacks",pizzas:"getPizzas",alitas:"getAlitas",cervezas:"getCervezas",refrescos:"getRefrescos",cafe:"getCafe",postres:"getPostres",cortes_de_carne:"getCortesDeCarne"}[a]||`get${a.charAt(0).toUpperCase()+a.slice(1).replace(/_([a-z])/g,g=>g[1].toUpperCase())}`;let d;typeof o[l]=="function"?d=await o[l]():d=await o.getLiquorSubcategory(e);const u=t.fields||["nombre","imagen","precio"],p=t.headers||["NOMBRE","IMAGEN","PRECIO"];z.currentViewMode==="grid"?this.createProductGrid(r,d,u,s,e):this.createProductTable(r,p,d,u,t.modalType==="drink-options"?"liquor-table":"standard-table",s,e)}catch(a){G(`Error rendering ${s}:`,a),r.innerHTML=`<p>Error cargando ${s}. Por favor, intente de nuevo.</p>`}},_getCategoryRenderers:function(){const r={cocteleria:e=>this.renderCocteleria(e),refrescos:e=>this.renderRefrescos(e),cervezas:e=>this.renderCervezas(e),tequila:e=>this.renderLiquorCategory(e,"tequila","Tequila"),whisky:e=>this.renderLiquorCategory(e,"whisky","Whisky"),ron:e=>this.renderLiquorCategory(e,"ron","Ron"),vodka:e=>this.renderLiquorCategory(e,"vodka","Vodka"),ginebra:e=>this.renderLiquorCategory(e,"ginebra","Ginebra"),mezcal:e=>this.renderLiquorCategory(e,"mezcal","Mezcal"),cognac:e=>this.renderLiquorCategory(e,"cognac","Cognac"),brandy:e=>this.renderLiquorCategory(e,"brandy","Brandy"),digestivos:e=>this.renderDigestivos(e),espumosos:e=>this.renderLiquorCategory(e,"espumosos","Espumosos"),"platos-fuertes":e=>this.renderPlatosFuertes(e),snacks:e=>this.renderSnacks(e),pizzas:e=>this.renderPizzas(e),alitas:e=>this.renderAlitas(e),sopas:e=>this.renderSopas(e),ensaladas:e=>this.renderEnsaladas(e),"cortes-de-carne":e=>this.renderCortesDeCarne(e),cafe:e=>this.renderCafe(e),postres:e=>this.renderPostres(e)};return r["platos fuertes"]=r["platos-fuertes"],r["cortes de carne"]=r["cortes-de-carne"],r.cortes_de_carne=r["cortes-de-carne"],r.cocktails=r.cocteleria,r.cocteles=r.cocteleria,r},createProductTable:function(r,e,t,o,i,n,s){const a=this._createTableElement(i,n,s);if(e&&e.length>0){const p=document.createElement("colgroup");e.forEach(()=>{const g=document.createElement("col");p.appendChild(g)}),a.appendChild(p)}const c=e&&e.length?e.length:1,l=this._createTitleRow(n,c),d=this._createTableHeader(e||[],l),u=this._createTableBody(t||[],o||[],n);a.appendChild(d),a.appendChild(u),r.appendChild(a),this._retranslateIfNeeded(r)},_createTableElement:function(r,e,t){const o=document.createElement("table");o.className=`${r} u-full-width`;const i=t||Oo(e);return o.dataset.category=i,o.dataset.productType=Pu(i,r,e),o},_createTitleRow:function(r,e){const t=document.createElement("tr");t.className="title-row";const o=document.createElement("td");o.colSpan=e;const i=document.createElement("h2");if(i.className="page-title",i.textContent=r,r){const n=`category-title_${me((r||"").trim())}`;i.setAttribute("data-translate",n),i.setAttribute("data-original-text",r),i.setAttribute("data-namespace","category.title")}return o.appendChild(i),t.appendChild(o),t},_createTableHeader:function(r,e){const t=document.createElement("thead");t.appendChild(e);const o=document.createElement("tr");return o.setAttribute("data-nombre-column","true"),r.forEach(i=>{const n=document.createElement("th");if(n.textContent=i,i){const s=`table-header_${me((i||"").trim())}`;n.setAttribute("data-translate",s),n.setAttribute("data-original-text",i),n.setAttribute("data-namespace","table.header")}i==="NOMBRE"&&n.setAttribute("data-nombre-header","true"),o.appendChild(n)}),t.appendChild(o),t},_createTableBody:function(r,e,t){const o=document.createElement("tbody");return r.forEach(i=>{const n=this._createTableRow(i,e,t);o.appendChild(n)}),o},_createTableRow:function(r,e,t){const o=document.createElement("tr"),i=r.id||r.producto_id||r.product_id;i&&(o.dataset.productId=i);const n=r.codigo||r.sku||r.product_code;return n&&(o.dataset.productCode=n),e.forEach(s=>{const a=this._createTableCell(r,s,t);o.appendChild(a)}),o},_createTableCell:function(r,e,t){const o=document.createElement("td");return e==="nombre"?this._createNameCell(o,r[e]):e==="ingredientes"?this._createIngredientsCell(o,r[e]):e==="precios"?this._createStackedPriceCell(o,r,t):e==="precios_alitas"?this._createAlitasPriceCell(o,r,t):ju(e)?this._createPriceCell(o,r,e,t):e==="video"?this._createVideoCell(o,r,t):e==="imagen"||e==="ruta_archivo"?this._createImageCell(o,r,e,t):o.textContent=r[e]||"",o},_createNameCell:function(r,e){r.className="product-name",r.textContent=e;const t=`product-name_${me((e||"").trim())}`;r.setAttribute("data-translate",t),r.setAttribute("data-namespace","products"),r.setAttribute("data-original-text",e||"")},_createIngredientsCell:function(r,e){if(r.className="product-ingredients",r.textContent=e||"",e){const t=`product-ingredients_${me((e||"").trim())}`;r.setAttribute("data-translate",t),r.setAttribute("data-namespace","products"),r.setAttribute("data-original-text",e||"")}},_createMultiPriceCell:function(r,e,t,o){r.className="stacked-price-cell";const i=document.createElement("div");i.className="stacked-price-container";const n=e.id||e.producto_id||e.product_id,s=e.codigo||e.sku||e.product_code;t.forEach(a=>{const c=e[a.key];if(c&&c!=="0"&&c!=="--"&&c!==0){const l=document.createElement("div");l.className="price-chip";const d=document.createElement("span");d.className="price-label-mini",d.textContent=a.label;const u=document.createElement("button");if(u.className="btn btn-contrast price-button mobile-optimized",u.textContent=Ao(c),u.dataset.productName=e.nombre,u.dataset.price=c,u.dataset.field=a.key,o&&(u.dataset.category=o),n&&(u.dataset.productId=n),s&&(u.dataset.productCode=s),a.mixerField&&e[a.mixerField]){const p=e[a.mixerField];Array.isArray(p)&&p.length>0&&(u.dataset.mixers=JSON.stringify(p))}l.appendChild(d),l.appendChild(u),i.appendChild(l)}}),r.appendChild(i)},_createStackedPriceCell:function(r,e,t){const o=[{key:"precioBotella",label:"Botella",mixerField:"mixersBotella"},{key:"precioLitro",label:"Litro",mixerField:"mixersLitro"},{key:"precioCopa",label:"Copa",mixerField:"mixersCopa"}];this._createMultiPriceCell(r,e,o,t)},_createAlitasPriceCell:function(r,e,t){const o=[{key:"precio_10_piezas",label:"10 pzas"},{key:"precio_25_piezas",label:"25 pzas"}];this._createMultiPriceCell(r,e,o,t)},_createPriceCell:function(r,e,t,o){r.className="product-price";const i=this._createPriceButton(e[t],e,t,o);r.appendChild(i)},_createVideoCell:function(r,e,t){if(r.className="video-icon",e.video){const o=e.video,i=e.thumbnail||e.imagen||e.ruta_archivo||Lo,n=document.createElement("img");n.className="video-thumb",n.loading="lazy",n.decoding="async",n.src=i,n.alt=`Ver video de ${e.nombre}`,n.dataset.videoUrl=o,n.onerror=function(){const s=this.src;if(this.dataset.triedJpg&&this.dataset.triedPng){this.dataset.fallenBack||(this.dataset.fallenBack="true",h.warn(`Thumbnail fall definitivamente: ${this.src}`));return}if(!this.dataset.triedJpg){this.dataset.triedJpg="true";const a=s.replace(/\.webp$/i,".jpg");this.src=a;return}if(!this.dataset.triedPng){this.dataset.triedPng="true";const a=s.replace(/\.jpg$/i,".png");this.src=a;return}},r.appendChild(n)}else r.textContent="--"},_createImageCell:function(r,e,t,o){r.className="image-icon";const i=e.thumbnail||e[t]||e.imagen||e.ruta_archivo;if(i){const n=document.createElement("img");n.loading="lazy",n.decoding="async",n.src=i,n.alt=e.nombre,n.onerror=function(){const l=this.src;if(h.warn(`Error loading image (attempting fallback): ${l}`),this.dataset.triedJpg&&this.dataset.triedPng){this.dataset.fallenBack||(this.dataset.fallenBack="true",h.error(`Image failed permanently: ${this.src}`));return}if(!this.dataset.triedJpg){this.dataset.triedJpg="true";const d=l.replace(/\.webp$/i,".jpg").replace(/\.png$/i,".jpg");if(d!==l){this.src=d;return}}if(!this.dataset.triedPng){this.dataset.triedPng="true";const d=l.replace(/\.webp$/i,".png").replace(/\.jpg$/i,".png");if(d!==l){this.src=d;return}}};const s=["cervezas","refrescos","licores","whisky","tequila","ron","vodka","ginebra","mezcal","cognac","brandy","digestivos","espumosos"],a=(o||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(),c=s.includes(a);n.className=c?"product-image ratio-1-1":"product-image",r.appendChild(n)}else r.textContent="--"},createProductCard:function(r,e,t){const o=document.createElement("div");o.className="product-card";const i=r.id||r.producto_id||r.product_id;i&&(o.dataset.productId=i);const n=r.codigo||r.sku||r.product_code;n&&(o.dataset.productCode=n);const s=document.createElement("div");s.className="product-name",s.textContent=r.nombre;const a=`product-name_${me((r.nombre||"").trim())}`;if(s.setAttribute("data-translate",a),s.setAttribute("data-namespace","products"),s.setAttribute("data-original-text",r.nombre||""),o.appendChild(s),r.ingredientes){const v=document.createElement("div");v.className="product-ingredients",v.textContent=r.ingredientes;const S=`product-ingredients_${me((r.ingredientes||"").trim())}`;v.setAttribute("data-translate",S),v.setAttribute("data-namespace","products"),v.setAttribute("data-original-text",r.ingredientes||""),o.appendChild(v)}const c=document.createElement("div");c.className="product-media";const u=["cervezas","refrescos","licores","whisky","tequila","ron","vodka","ginebra","mezcal","cognac","brandy","digestivos","espumosos"].includes(t)?r.thumbnail||r.imagen:r.thumbnail||r.imagen||r.ruta_archivo;if(r.video){const v=r.video,S=u||Lo,_=document.createElement("img");_.className="video-thumbnail",_.loading="lazy",_.decoding="async",_.src=S,_.alt=`Video de ${r.nombre}`,_.dataset.videoUrl=v,_.onerror=function(){this.dataset.fallenBack||(this.dataset.fallenBack="true",h.warn(`Video Thumbnail failed (${u?"DB":"Generated"}): ${this.src}`))},c.appendChild(_)}else if(u){const v=document.createElement("img");v.className="product-image",v.loading="lazy",v.decoding="async",v.alt=r.nombre,v.onload=function(){this.naturalHeight>this.naturalWidth&&(o.classList.add("sys-card-vertical"),h.debug(`Vertical layout applied to: ${r.nombre}`))},v.src=u,c.appendChild(v)}o.appendChild(c);const g=["whisky","tequila","ron","vodka","ginebra","mezcal","cognac","brandy","digestivos","espumosos"].includes(t);!r.ingredientes?(o.classList.add("sys-card-vertical"),h.debug(`Pure heuristic vertical layout applied to: ${r.nombre}`)):o.classList.add("sys-card-standard"),g?(o.classList.add("liquor-card"),o.dataset.productType="liquor",o.dataset.category=t):t==="alitas"&&o.classList.add("variant-card");const b=document.createElement("div");return b.className="product-prices",this._renderCardPrices(b,r,e,g,t),o.appendChild(b),o},_renderCardPrices:function(r,e,t,o,i){if(o){[{key:"precioBotella",label:"Botella"},{key:"precioLitro",label:"Litro"},{key:"precioCopa",label:"Copa"}].forEach(s=>{const a=e[s.key];a&&a!=="--"&&a!=="0"&&a!==0&&this._createPriceItemRow(r,s.label,a,e,s.key,i)});return}if(i==="alitas"){t.forEach(n=>{if(n.includes("_piezas")&&e[n]){const a=`${n.replace("precio_","").replace("_piezas","")} piezas`;this._createPriceItemRow(r,a,e[n],e,n,i)}});return}t.forEach(n=>{if((n.includes("precio")||n==="precio")&&e[n]){const s=this._createPriceButton(e[n],e,n,i);r.appendChild(s)}})},_createPriceItemRow:function(r,e,t,o,i,n){const s=document.createElement("div");s.className="price-item";const a=document.createElement("span");a.className="price-label",a.textContent=e+":";const c=this._createPriceButton(t,o,i,n);s.appendChild(a),s.appendChild(c),r.appendChild(s)},_createPriceButton:function(r,e,t,o){const i=document.createElement("button");if(!r||r==="--"||r==="0"||r===0)return i.textContent="--",i.className="btn btn-ghost price-button non-selectable",i.disabled=!0,i;i.className="btn btn-contrast price-button",i.textContent=Ao(r);const n=e.id||e.producto_id||e.product_id,s=e.codigo||e.sku||e.product_code;i.dataset.productName=e.nombre,i.dataset.price=r,i.dataset.field=t,n&&(i.dataset.productId=n),s&&(i.dataset.productCode=s),o&&(i.dataset.category=o);let a=null;if(t==="precioBotella"||t==="precio_botella"?a=e.mixersBotella||e.mixers_botella:t==="precioLitro"||t==="precio_litro"?a=e.mixersLitro||e.mixers_litro:(t==="precioCopa"||t==="precio_copa")&&(a=e.mixersCopa||e.mixers_copa),a){const c=typeof a=="string"?a:JSON.stringify(a);c!=="[]"&&c!=="null"&&c!=='""'&&(i.dataset.mixers=c)}return i},createProductGrid:function(r,e,t,o,i){const n=document.createElement("div");n.className="grid-view-container u-flex-column u-flex-align-c";const s=document.createElement("div");s.className="product-grid";const a=i||Oo(o);s.dataset.category=a;let c;const l=["pizza","alita","sopa","ensalada","carne","plato","snack","cafe","postre","cocktail","cocteleria"],d=["refresco","cerveza","jugo","jarra","vaso","licor","whisky","tequila","ron","vodka","ginebra","mezcal","cognac","brandy","digestivo","espumoso"];l.some(p=>a.includes(p))?c="food":d.some(p=>a.includes(p))?(c="beverage",s.classList.add("sys-grid-vertical")):c="unknown",s.dataset.productType=c;const u=document.createElement("h2");u.className="page-title",u.textContent=o,o&&(u.setAttribute("data-translate",o),u.setAttribute("data-original-text",o),u.setAttribute("data-namespace","category.title")),n.appendChild(u),e.forEach(p=>{const g=this.createProductCard(p,t,a);s.appendChild(g)}),n.appendChild(s),r.appendChild(n),this._retranslateIfNeeded(r)},showMediaModal:function(r){const{type:e,url:t,title:o,category:i}=r,n=document.createElement("div");if(n.className=`media-modal-wrapper ${e}-modal`,i&&n.setAttribute("data-category",i),e==="video"){const l=document.createElement("video");l.src=t,l.controls=!0,l.autoplay=!0,l.playsInline=!0,l.className="media-content video-content u-full-width",l.style.borderRadius="var(--radius-md, 8px)",l.onerror=()=>{h.error(`Media Modal: Video failed to load: ${t}`),n.innerHTML='<div class="error-message u-p-lg text-center">Video no disponible</div>'},n.appendChild(l)}else{const l=document.createElement("img");l.src=t,l.alt=o,l.className="media-content image-content u-full-width",l.style.borderRadius="var(--radius-md, 8px)",l.onerror=()=>{h.error(`Media Modal: Image failed to load: ${t}`),n.innerHTML='<div class="error-message u-p-lg text-center">Imagen no disponible</div>'},n.appendChild(l)}const s=e==="video"?"sys-modal-video":"sys-modal-no-glow",a=e==="video"?"large sys-modal-top":"media-image",c=(o||"Multimedia").replace(/^(Video de|Ver video de)\s+/i,"").trim();R.show({title:c,content:n,size:`${a} ${s}`,onClose:()=>{const l=n.querySelector("video");l&&(l.pause(),l.src="",l.load())}})},showVideoModal:function(r,e,t=null){this.showMediaModal({type:"video",url:r,title:e,category:t})},showImageModal:function(r,e,t=null){this.showMediaModal({type:"image",url:r,title:e,category:t})},renderLicores:async function(r){let e=r;if(r.id!=="content-container"&&(e=document.getElementById("content-container"),!e)){const a=document.querySelector(".content-container-flex");if(a){e=document.createElement("div"),e.id="content-container";const c=a.querySelector("#order-sidebar");c?a.insertBefore(e,c):a.appendChild(e)}else{const c=document.getElementById("order-sidebar"),l=c?c.outerHTML:null;e=r,l&&!r.querySelector("#order-sidebar")&&r.insertAdjacentHTML("beforeend",l)}}const i=window.AppInit?.modules?.get("appConfig")?.getCategoryConfig("licores")?.header||"Licores",n=await this.createLicoresCategories(),s=`
      <div class="grid-view-container u-p-xl">
        <h2 class="page-title" data-translate="category.title.licores" data-original-text="${i}" data-namespace="categories">${i}</h2>
        <div class="category-grid sys-grid-5" data-product-type="liquor" data-category="licores">
          ${n}
        </div>
        <div class="subcategory-prompt">
          <h3 class="page-title" data-translate="category.prompt.choose" data-original-text="Elige una categora" data-namespace="categories">Elige una categora</h3>
        </div>
      </div>
    `;Nt(e,s),this._retranslateIfNeeded(e)},createLicoresCategories:async function(){return(await To.getLicoresCategories()).map(t=>{const o=(t.nombre||"").trim(),i=`liquor-category_${me(o)}`;return`
        <div class="category-card" data-category="${o.toLowerCase()}" data-product-type="liquor">
          <img src="${t.icono||t.imagen}" alt="${o}" class="category-image">
          <h3 class="category-name" data-translate="${i}" data-original-text="${o}" data-namespace="liquors">${o}</h3>
        </div>
      `}).join("")},renderLicorSubcategory:async function(r,e){h.info(` Navegando hacia subcategora de licores: ${e}`);const t=document.getElementById("main-screen"),o=document.getElementById("content-container"),i=document.getElementById("orders-box");h.debug(" Estado DOM antes de renderizar subcategora:",{category:e,mainScreen:!!t,contentContainer:!!o,ordersBox:!!i,mainScreenVisible:t?!t.classList.contains("hidden"):!1,mainScreenClasses:t?Array.from(t.classList):[]});const n=document.getElementById("order-sidebar");n?(n.outerHTML,h.debug(" Sidebar preservado para subcategora")):(h.warn(" No se encontr sidebar para preservar"),h.debug(" Buscando sidebar en DOM completo:",{sidebarInDocument:!!document.getElementById("order-sidebar"),contentContainerFlex:!!document.querySelector(".content-container-flex"),containerType:r.className||r.tagName}));let s=document.getElementById("content-container");if(s)s.innerHTML="",h.debug(" Content container limpiado, sidebar intacto");else{h.warn(" No se encontr content-container, creando uno nuevo");const d=document.querySelector(".content-container-flex");if(d){s=document.createElement("div"),s.id="content-container";const u=d.querySelector("#order-sidebar");u?d.insertBefore(s,u):d.appendChild(s),h.debug(" Content container creado en estructura flex")}else{h.error(" No se encontr content-container-flex, estructura DOM comprometida");return}}const a=document.getElementById("top-nav-bar"),c=document.getElementById("top-back-btn");document.getElementById("nav-title"),a&&(a.classList.remove("top-nav-hidden"),a.classList.add("top-nav-visible")),c&&(c.classList.remove("back-btn-hidden"),c.dataset.action="back-to-licores",c.title="Volver a Licores",this._topBackBtnHandler&&c.removeEventListener("click",this._topBackBtnHandler),this._topBackBtnHandler=d=>{d.preventDefault(),d.stopPropagation(),h.info(" Botn de back clickeado - navegando a licores"),this.handleBackButton(c)},c.addEventListener("click",this._topBackBtnHandler));const l=e.charAt(0).toUpperCase()+e.slice(1);switch(e){case"whisky":await this.renderWhisky(s,l);break;case"tequila":await this.renderTequila(s,l);break;case"ron":await this.renderRon(s,l);break;case"vodka":await this.renderVodka(s,l);break;case"brandy":await this.renderBrandy(s,l);break;case"ginebra":await this.renderGinebra(s,l);break;case"mezcal":await this.renderMezcal(s,l);break;case"cognac":await this.renderCognac(s,l);break;case"digestivos":await this.renderDigestivos(s,l);break;case"espumosos":await this.renderEspumosos(s,l);break;default:s.innerHTML+="<p>Categora no disponible</p>"}this._retranslateIfNeeded(s),setTimeout(()=>{const d=document.getElementById("main-screen"),u=document.getElementById("content-container"),p=document.getElementById("orders-box");h.debug(" Estado DOM despus de renderizar subcategora:",{category:e,mainScreen:!!d,contentContainer:!!u,ordersBox:!!p,mainScreenVisible:d?!d.classList.contains("hidden"):!1,mainScreenClasses:d?Array.from(d.classList):[]}),h.info(` Subcategora ${e} renderizada completamente`)},100)},_retranslateIfNeeded:function(r){try{const e=He.getCurrentLanguage();if(e&&e!=="es"){const t=r||document;typeof lt.translateElement=="function"?t.querySelectorAll("[data-translate], [data-translate-placeholder]").forEach(i=>lt.translateElement(i,e)):typeof He.translatePage=="function"&&He.translatePage(e)}}catch(e){h.warn("Translation reapply failed after view change:",e)}},renderLiquorCategory:async function(r,e,t){const o=["nombre","imagen","precios"],i=["NOMBRE","IMAGEN","PRECIOS"];try{const n=await To.getLiquorSubcategory(e);z.currentViewMode==="grid"?this.createProductGrid(r,n,["nombre","imagen","precioBotella","precioLitro","precioCopa"],t,e):this.createProductTable(r,i,n,o,"liquor-table",t,e)}catch(n){G(`Error rendering ${t}:`,n),r.innerHTML+=`<p>Error cargando ${t}. Por favor, intente de nuevo.</p>`}},renderWhisky:async function(r,e="Whisky"){await this.renderLiquorCategory(r,"whisky",e)},renderTequila:async function(r,e="Tequila"){await this.renderLiquorCategory(r,"tequila",e)},renderRon:async function(r,e="Ron"){await this.renderLiquorCategory(r,"ron",e)},renderVodka:async function(r,e="Vodka"){await this.renderLiquorCategory(r,"vodka",e)},renderGinebra:async function(r,e="Ginebra"){await this.renderLiquorCategory(r,"ginebra",e)},renderMezcal:async function(r,e="Mezcal"){await this.renderLiquorCategory(r,"mezcal",e)},renderCognac:async function(r,e="Cognac"){await this.renderLiquorCategory(r,"cognac",e)},renderBrandy:async function(r,e="Brandy"){await this.renderLiquorCategory(r,"brandy",e)},renderDigestivos:async function(r,e="Digestivos"){const t=K();try{const o=await t.getLiquorSubcategory("digestivos");z.currentViewMode==="grid"?this.createProductGrid(r,o,["nombre","imagen","precioBotella","precioLitro","precioCopa"],e,"digestivos"):this.createProductTable(r,["NOMBRE","IMAGEN","PRECIO BOTELLA","PRECIO LITRO","PRECIO COPA"],o,["nombre","imagen","precioBotella","precioLitro","precioCopa"],"liquor-table",e,"digestivos")}catch(o){G(`Error rendering ${e}:`,o),r.innerHTML+=`<p>Error cargando ${e}. Por favor, intente de nuevo.</p>`}},renderEspumosos:async function(r,e="Espumosos"){await this.renderLiquorCategory(r,"espumosos",e)},renderCervezas:async function(r){const e=K();try{const t=await e.getCervezas();this._renderSegmentedCategory(r,t,{cssCategory:"cervezas",groupBy:"titulo",defaultTitle:"Cervezas",renderStrategy:this._renderLiquorInBox.bind(this)})}catch(t){G("Error rendering Cervezas:",t),r.innerHTML="<p>Error cargando Cervezas. Por favor, intente de nuevo.</p>"}},renderPizzas:async function(r){const e=K();try{const t=await e.getPizzas();z.currentViewMode==="grid"?this.createProductGrid(r,t,["nombre","ingredientes","video","precio"],"Pizzas","pizzas"):this.createProductTable(r,["NOMBRE","INGREDIENTES","VIDEO","PRECIO"],t,["nombre","ingredientes","video","precio"],"standard-table","Pizzas","pizzas")}catch(t){G("Error rendering Pizzas:",t);const o=r.id==="content-container"?r:document.getElementById("content-container")||r;o.innerHTML="<p>Error cargando Pizzas. Por favor, intente de nuevo.</p>"}},renderFoodCategory:async function(r,e,t,o=null,i=null,n=null){const s=K(),a=["nombre","ingredientes","video","precio"],c=["NOMBRE","INGREDIENTES","VIDEO","PRECIO"],l=o||a,d=i||c;r.innerHTML="";try{const u=await s[e]();z.currentViewMode==="grid"?this.createProductGrid(r,u,l,t,n||e.replace("get","").toLowerCase()):this.createProductTable(r,d,u,l,"standard-table",t,n||e.replace("get","").toLowerCase())}catch(u){G(`Error rendering ${t}:`,u),r.innerHTML=`<p>Error cargando ${t}. Por favor, intente de nuevo.</p>`}},renderAlitas:async function(r){const e=K();try{const t=await e.getAlitas();z.currentViewMode==="grid"?this.createProductGrid(r,t,["nombre","ingredientes","video","precio_10_piezas","precio_25_piezas"],"Alitas","alitas"):this.createProductTable(r,["NOMBRE","INGREDIENTES","VIDEO","PRECIOS"],t,["nombre","ingredientes","video","precios_alitas"],"standard-table table-compact","Alitas","alitas")}catch(t){G("Error rendering Alitas:",t),r.innerHTML="<p>Error cargando Alitas. Por favor, intente de nuevo.</p>"}},_renderSegmentedCategory:function(r,e,t){const o=new Map;if(t.groupBy)e.forEach(c=>{const d=(c[t.groupBy]||t.defaultTitle||"General").trim();o.has(d)||o.set(d,[]),o.get(d).push(c)});else if(t.segments){const c=t.defaultTitle||"General";o.set(c,[]);const l=t.segments.map(d=>(o.set(d.title,[]),d));e.forEach(d=>{const u=(d.nombre||"").toUpperCase();let p=!1;for(const g of l)if(g.matcher(d,u)){o.get(g.title).push(d),p=!0;break}p||o.get(c).push(d)})}r.innerHTML="";const i=(c,l)=>(c.nombre||"").localeCompare(l.nombre||""),n=Array.from(o.entries()).sort((c,l)=>c[0]===t.defaultTitle?-1:l[0]===t.defaultTitle?1:c[0].localeCompare(l[0])),s=(c,l,d)=>{z.currentViewMode==="grid"?this.createProductGrid(c,l,["nombre","ruta_archivo","precio"],d,t.cssCategory):this.createProductTable(c,["NOMBRE","IMAGEN","PRECIO"],l,["nombre","ruta_archivo","precio"],"liquor-table",d,t.cssCategory)},a=t.renderStrategy||s;n.forEach(([c,l])=>{if(l.length===0)return;l.sort(i);const d=document.createElement("div");d.className=t.defaultClass||"product-section",a(d,l,c,t.cssCategory);const u=d.querySelector(".product-grid, table");u&&u.setAttribute("data-category",t.cssCategory),r.appendChild(d)})},renderSopas:async function(r){await this.renderFoodCategory(r,"getSopas","Sopas",null,null,"sopas")},renderEnsaladas:async function(r){await this.renderFoodCategory(r,"getEnsaladas","Ensaladas",null,null,"ensaladas")},renderCortesDeCarne:async function(r){await this.renderFoodCategory(r,"getCarnes","Cortes de Carne",null,null,"cortes-de-carne")},renderSnacks:async function(r){await this.renderFoodCategory(r,"getSnacks","Snacks",null,null,"snacks")},renderPlatosFuertes:async function(r){await this.renderFoodCategory(r,"getPlatosFuertes","Platos Fuertes",null,null,"platos-fuertes")},renderCafe:async function(r){await this.renderFoodCategory(r,"getCafe","Caf",null,null,"cafe")},renderPostres:async function(r){await this.renderFoodCategory(r,"getPostres","Postres",null,null,"postres")},renderRefrescos:async function(r){const e=K();try{const t=await e.getRefrescos();this._renderSegmentedCategory(r,t,{cssCategory:"refrescos",groupBy:"titulo",defaultTitle:"Refrescos",renderStrategy:this._renderLiquorInBox.bind(this)})}catch(t){G("Error rendering Refrescos:",t),await this.renderFoodCategory(r,"getRefrescos","Refrescos",null,null,"refrescos")}},renderCocteleria:async function(r){await this.renderFoodCategory(r,"getCocteles","Coctelera",null,null,"cocteleria")},renderCocktails:async function(r){return this.renderCocteleria(r)},initTranslationListener:function(){window.addEventListener("languageChanged",r=>{h.info(" Language changed event received in ProductRenderer",r.detail);const e=document.getElementById("content-container");e&&this._retranslateIfNeeded(e)})}};window.ProductRenderer=Ir;Ir.initTranslationListener();const Mu=Object.freeze(Object.defineProperty({__proto__:null,default:Ir},Symbol.toStringTag,{value:"Module"})),Bu={async render(r){if(h.info("[HomeHub] Rendering Dashboard..."),!r){h.error("[HomeHub] Container is null");return}const e=T.interfaces||[];if(e.length===0){h.warn("[HomeHub] No interfaces found in AppConfig"),Nt(r,'<div class="empty-state">Cargando men...</div>');return}const t=document.createElement("div");t.className="grid-view-container u-flex-column u-flex-align-c fade-in";const o=document.createElement("h2");o.className="page-title",o.textContent="Men",o.setAttribute("data-translate","menu.title"),o.setAttribute("data-original-text","Men"),o.setAttribute("data-namespace","home"),t.appendChild(o);const i=document.createElement("div");i.id="home-hub-grid",i.className="product-grid sys-grid-vertical",e.forEach((n,s)=>{if(!n.label||n.isHidden)return;const a=document.createElement("div");a.className="category-card sys-card-vertical panel-glow",a.style.animationDelay=`${s*50}ms`,a.setAttribute("data-target",n.slug),a.setAttribute("data-category",n.slug);const c=document.createElement("h3");c.className="category-name",c.textContent=n.label,a.appendChild(c);const l=document.createElement("div");l.className="product-media";const d=document.createElement("img");d.className="product-image";const u=n.thumbnailUrl||n.image||"/assets/no-image.png";d.src=u,d.alt=n.label,d.loading="lazy",["platos-fuertes","cocteleria","pizzas","snacks","alitas","sopas","ensaladas","cortes_de_carne","cafe","postres"].includes(n.slug)?(l.style.aspectRatio="16 / 9",d.style.width="100%",d.style.height="100%",d.style.objectFit="cover",l.style.maxHeight="180px",a.classList.add("wide-category-card")):(d.style.maxHeight="160px",d.style.objectFit="contain"),l.appendChild(d),a.appendChild(l);const f=document.createElement("div");f.className="category-description",f.textContent=n.descripcion||"",f.style.width="100%",a.appendChild(f);const b=document.createElement("div");b.className="product-prices",b.style.height="10px",a.appendChild(b),i.appendChild(a)}),t.appendChild(i),r.innerHTML="",r.appendChild(t),lt.processNewElement(r),h.info("[HomeHub] Render complete.")}},wt=(r,e)=>{const o=getComputedStyle(document.documentElement).getPropertyValue(r).trim();return o?parseInt(o):e},Qe={get WELCOME(){return wt("--duration-welcome",3e3)},get LOGO(){return wt("--duration-logo",3e3)},get CATEGORY(){return wt("--duration-category",2e3)},get FADE(){return wt("--duration-fade",1e3)}},Po={delay(r){return new Promise(e=>setTimeout(e,r))},async transitionScreen(r,e,t){h.info(t),r&&r.classList&&(r.classList.remove("fade-in"),r.classList.add("fade-out")),await this.delay(Qe.FADE),r&&r.classList&&(r.style.zIndex="1",r.classList.remove("screen-visible"),r.classList.add("screen-hidden"),r.classList.remove("fade-out")),e&&e.classList&&(e.style.zIndex="10",e.classList.remove("screen-hidden"),e.classList.add("screen-visible"),e.classList.add("fade-in"))},validateScreenElements(){const r={welcomeScreen:document.querySelector(".welcome-screen"),logoScreen:document.querySelector(".logo-screen"),categoryTitleScreen:document.querySelector(".category-title-screen"),mainContentScreen:document.querySelector(".main-content-screen"),hamburgerBtn:document.getElementById("hamburger-btn")},e=Object.entries(r).filter(([t,o])=>t!=="hamburgerBtn"&&!o).map(([t])=>t);return e.length>0?(h.error("Missing required screen elements:",e),null):r},async loadInitialContent(){h.info("Loading initial content...");try{const r=window.AppInit;if(!r||typeof r.loadContent!="function")throw new Error("AppInit not available or loadContent method missing");await this.delay(100),h.info('Calling AppInit.loadContent("home")'),await r.loadContent("home"),typeof ProductRenderer.initRealtimeUpdates=="function"&&ProductRenderer.initRealtimeUpdates(),h.info("Welcome sequence completed successfully")}catch(r){h.error("Error loading content:",r),this.showErrorFallback(r)}},showErrorFallback(r){const e=document.querySelector(".main-content-screen");if(e){const t=document.createElement("div");t.className="error-fallback",t.innerHTML=`
        <h2>Error al cargar contenido</h2>
        <p>Por favor, recarga la pgina o contacta al soporte tcnico.</p>
        <button onclick="location.reload()">Recargar pgina</button>
      `,e.appendChild(t)}},async startWelcomeSequence(){h.info("Starting welcome sequence...");try{document.documentElement.classList.add("no-scrollbars"),document.body.classList.add("no-scrollbars");const r=this.validateScreenElements();if(!r)return;const{welcomeScreen:e,logoScreen:t,categoryTitleScreen:o,mainContentScreen:i,hamburgerBtn:n}=r;h.info("Showing welcome screen for",Qe.WELCOME,"ms"),await this.delay(Qe.WELCOME),await this.transitionScreen(e,t," Transitioning from welcome to logo screen"),h.info("Showing logo screen for",Qe.LOGO,"ms"),await this.delay(Qe.LOGO),await this.transitionScreen(t,i," Transitioning to main content screen"),document.documentElement.classList.remove("no-scrollbars"),document.body.classList.remove("no-scrollbars"),n&&(n.className="hamburger-btn hamburger-visible",h.info("Hamburger menu displayed")),await this.loadInitialContent(),await this.showTopNavigationBar(),h.info("Welcome sequence completed - Top navigation bar displayed")}catch(r){h.error("Error in welcome sequence:",r),document.documentElement.classList.remove("no-scrollbars"),document.body.classList.remove("no-scrollbars"),this.showErrorFallback(r)}},async showTopNavigationBar(){h.info("Showing top navigation bar...");try{const r=document.getElementById("top-nav-bar"),e=document.querySelector(".main-content-screen");r?(r.classList.remove("top-nav-hidden"),r.classList.add("top-nav-visible"),e&&e.classList.add("with-top-nav"),this.attachTopNavEventListeners(),h.info("Top navigation bar displayed successfully")):h.warn("Top navigation bar element not found")}catch(r){h.error("Error showing top navigation bar:",r)}},attachTopNavEventListeners(){},async handleViewToggle(){try{const{actions:r,state:e}=await A(async()=>{const{actions:a,state:c}=await Promise.resolve().then(()=>Ru);return{actions:a,state:c}},void 0),{resolveService:t}=await A(async()=>{const{resolveService:a}=await Promise.resolve().then(()=>$u);return{resolveService:a}},void 0),o=r.toggleViewMode(),i=document.getElementById("view-toggle-btn");i&&(i.textContent=o==="table"?"":"",i.classList.toggle("active",o==="grid"));const n=document.getElementById("content-container"),s=document.querySelector("[data-category]")?.getAttribute("data-category")||n?.querySelector("[data-category]")?.getAttribute("data-category");if(n&&s&&s!=="home"){h.info(`View toggled to ${o}. Refreshing ${s}...`);try{await(await t("CategoryManager")).loadCategory(n,s)}catch(a){h.error("Failed to refresh view after toggle",a)}}h.info(`View toggled to: ${o}`)}catch(r){h.error("Error handling view toggle:",r)}},skipToMainContent(){h.info("Skipping welcome sequence...");const r=this.validateScreenElements();if(!r)return;const{welcomeScreen:e,logoScreen:t,categoryTitleScreen:o,mainContentScreen:i,hamburgerBtn:n}=r;[e,t,o].forEach(s=>{s&&s.classList&&(s.classList.remove("screen-visible"),s.classList.add("screen-hidden"))}),i&&i.classList&&(i.classList.remove("screen-hidden"),i.classList.add("screen-visible"),i.classList.add("fade-in")),n&&(n.className="hamburger-btn hamburger-visible"),this.showTopNavigationBar(),this.loadInitialContent()},isLoading:!1,retryCount:0,async navigateTo(r="cocteleria"){if(this.isLoading){h.warn(`[NavSystem] navigateTo busy, ignoring: ${r}`);return}if(this.checkUserNavigation()&&r==="cocteleria"){h.info(" User navigation detected, skipping automatic load");return}this.isLoading=!0,h.info(`[NavSystem] Navigating to: ${r}`);const e=document.getElementById("top-back-btn");e&&e.classList.add("back-btn-hidden"),document.dispatchEvent(new CustomEvent("navigation:starting")),h.info("[NavSystem] navigation:starting dispatched");const t=document.getElementById("content-container"),o=document.querySelector(".main-content-screen")||document.querySelector("[data-category]");if(!t||!o){h.error("[NavSystem] Critical DOM elements missing during navigation"),this.isLoading=!1;return}o.classList.contains("screen-hidden")&&(o.classList.remove("screen-hidden"),o.classList.add("screen-visible")),r=this.validateContentType(r),o.setAttribute("data-category",r),setTimeout(async()=>{await this.initializeContent(r,t)&&(h.info(`[NavSystem] Content loaded: ${r}`),t.classList.remove("opacity-0"),t.classList.add("opacity-1"),document.dispatchEvent(new CustomEvent("app-content-ready",{detail:{contentType:r}})),this.updateDrawerState(r)),this.isLoading=!1},50)},validateContentType(r){return["home","cocteleria","refrescos","licores","cervezas","pizzas","alitas","sopas","ensaladas","carnes","cortes_de_carne","cortes-de-carne","platos-fuertes","platos_fuertes","snacks","cafe","postres"].includes(r)?r:"home"},async initializeContent(r,e){if(!e)return!1;if(e.id!=="content-container"){const t=e.querySelector("#content-container");t&&(e=t)}try{if(r==="home")return await Bu.render(e),!0;try{return await(await Li("CategoryManager")).loadCategory(e,r),!0}catch(t){throw G(`Failed to resolve CategoryManager for ${r}`,t),t}}catch(t){return G("Error loading content",t),Nt(e,"<p>Error cargando contenido</p>"),!1}},checkUserNavigation(){const r=document.getElementById("drawer-menu");return!!(r&&r.classList.contains("open"))},updateDrawerState(r){const e=document.querySelectorAll("#drawer-menu .nav-button");e&&e.forEach(t=>{t.getAttribute("data-target")===r?t.classList.add("active"):t.classList.remove("active")})}},xe=(r,e="individual")=>{const t=typeof r=="string"?r.replace("$",""):r,o=parseFloat(t);if(isNaN(o))return"$0.00";const i=`$${o.toFixed(2)}`;return{individual:i,jarra:`${i} (Jarra)`,botella:`${i} (Botella)`,copa:`${i} (Copa)`,litro:`${i} (Litro)`}[e]||i};class Uu{constructor(){this.items=[],this.idCounter=0}addProduct(e){const t=Ke.validateProduct(e);Ke.throwIfInvalid(t,"Producto en orden");const o={...e,id:this.generateUniqueId(),addedAt:new Date().toISOString(),price:parseFloat(e.price)||0};return this.items.push(o),o}generateUniqueId(){return this.idCounter++,`order_${Date.now()}_${this.idCounter}`}removeItem(e){if(!e)throw new Error("Item ID is required");const t=this.items.length;return this.items=this.items.filter(o=>o.id!==e),this.items.length<t}getTotal(){return this.items.reduce((e,t)=>e+(t.price||0),0)}getItems(){return[...this.items]}getItemCount(){return this.items.length}findItemById(e){return this.items.find(t=>t.id===e)||null}clearItems(){const e=this.items.length;return this.items=[],this.idCounter=0,e}isEmpty(){return this.items.length===0}}function hr(r){const e=r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();return["PIA","UVA","NARANJA","ARANDANO","MANGO","DURAZNO","JUGO"].some(t=>e.includes(t))}class pr{static validateSelection(e,t){return t&&!e.target.disabled&&!(e.target.classList&&e.target.classList.contains("non-selectable"))}static validateDrinkOptions(e,t){return!e||!e.drinkOptions?(h.error("No drink options found for product:",t),!1):!0}static hasValidDrinkSelection(e,t,o){return o.name.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().includes("JAGERMEISTER")&&o.priceType==="precioBotella"?e.includes("2 Boost")||Object.values(t).some(n=>n>0):e.length>0||Object.values(t).some(n=>n>0)}static validateCookingTerm(e){return!!e}static validateProductName(e){return!e||typeof e!="string"?{isValid:!1,message:"Invalid productName: must be a non-empty string"}:{isValid:!0}}static validateOrderCompletion(e){return!e||e.length===0?{isValid:!1,message:"La orden est vaca. Por favor agregue productos."}:{isValid:!0}}static validateSpecialBottleRules(e,t,o,i,n){const s=this._isSpecialBottleCategory(i,n);if(this._isOnlySodaCategory(i))return!e&&o<5;if(s){const c=e?t+1:t,l=e?o:o+1;return c<=2&&l===0||c===0&&l<=5||c===1&&l<=2}return t+o<5}static validateSpecialDrinkLimits(e,t,o,i,n){const s=this._isOnlySodaCategory(i),a=this._isSpecialBottleCategory(i,n);return s?e||o>=5:a?e?t>=2||o>0&&t>=1||o>2:t>=2||t===0&&o>=5||t===1&&o>=2:t+o>=5}static canAddDrink(e,t,o,i,n,s,a){return this._isSpecialBottleCategory(s,a)?this.validateSpecialBottleRules(e,i,n,s,a):t<o}static _isSpecialBottleCategory(e,t){if(e==="VODKA"||e==="GINEBRA")return!0;if(e==="RON"){const o=t?.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase()||"";return["BACARDI MANGO","BACARDI RASPBERRY","MALIBU"].some(i=>o.includes(i))}return!1}static _isOnlySodaCategory(e){return!1}static validateDOMElement(e,t){return e?!0:(h.error(`Element '${t}' not found`),!1)}static validateModalElement(e){return e?typeof e.show!="function"||typeof e.hide!="function"?(h.error(`Modal ${e.id} validation FAILED - show: ${typeof e.show}, hide: ${typeof e.hide}`),!1):!0:(h.error("validateModalElement: No modal provided"),!1)}static validatePriceText(e){return!e||typeof e!="string"?{isValid:!1,message:"Price text must be a non-empty string"}:/\$?\d+(\.\d{2})?/.test(e)?{isValid:!0}:{isValid:!1,message:"Invalid price format"}}static validateEventTarget(e){return!e||!e.target?{isValid:!1,message:"Invalid event or event target"}:{isValid:!0}}static showValidationModal(e,t){typeof t=="function"?t(e,"Aceptar",()=>{}):h.error("showValidationModal: createModalCallback is not a function")}}function et(r){let e=0;for(let t=0;t<r.length;t++){const o=r.charCodeAt(t);e=(e<<5)-e+o,e=e&e}return Math.abs(e).toString(36)}const O={MAX_DRINK_COUNT:5,SPECIAL_PRODUCTS:{NO_MODAL:["HIPNOTIQ","BAILEYS"],JAGER:"JAGERMEISTER",SPECIAL_RON:["BACARDI MANGO","BACARDI RASPBERRY","MALIBU"]},PRICE_TYPES:{BOTTLE:"precioBotella",LITER:"precioLitro",CUP:"precioCopa"},MESSAGES:{SPECIAL:"Puedes elegir: 2 Jarras de jugo  5 Refrescos  1 Jarra de jugo y 2 Refrescos",ONLY_SODAS:"Puedes elegir hasta 5 refrescos",DEFAULT:"Puedes elegir hasta 5 acompaamientos",NO_REFRESCOS:"Este producto no incluye refrescos"},SELECTORS:{SIDEBAR:"order-sidebar",TABLES:".product-table",ORDER_BTN:"create-order-btn"}};class Vu{constructor(){this.selectedDrinks=[],this.drinkCounts={},this.currentProduct=null,this.currentCategory=null,this.bottleCategory=null,this.selectedCookingTerm=null,this.maxDrinkCount=O.MAX_DRINK_COUNT}resetSelectionState(){this.selectedDrinks=[],this.drinkCounts={},this.selectedCookingTerm=null}setCurrentProduct(e,t){this.currentProduct=e,this.currentCategory=t?t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase():"unknown",this.currentSchema=ur(this.currentCategory),this.bottleCategory=this.currentSchema.modalType==="drink-options"?this.currentCategory.toUpperCase():"OTROS"}extractPrice(e){if(!e||typeof e!="string")return h.warn("Invalid priceText provided to extractPrice",{priceText:e}),0;const t=e.replace(/[^\d.]/g,""),o=parseFloat(t);return isNaN(o)?0:o}getProductMetadata(e){if(!e)return{type:"unknown",category:"unknown",productId:null,productCode:null};const t=e.dataset?.category,o=e.dataset?.productId,i=e.dataset?.productCode;if(t&&o)return{type:(ur(t).productType||"unknown").toLowerCase(),category:t.toLowerCase(),productId:o,productCode:i||null};const n=e.closest("tr, .product-card")||e,s=n.closest("table, .product-grid");return s?{type:(s.dataset.productType||"unknown").toLowerCase(),category:(t||s.dataset.category||"unknown").toLowerCase(),productId:o||n.dataset.productId||null,productCode:i||n.dataset.productCode||null}:{type:"unknown",category:t||"unknown",productId:o||n.dataset.productId||null,productCode:i||n.dataset.productCode||null}}getPriceType(e,t){if(t.disabled||t.classList&&t.classList.contains("non-selectable")||t.textContent.trim()==="--")return null;if(t.dataset.field)return t.dataset.field;if(t.dataset.priceType)return t.dataset.priceType;const o=e.closest("table");if(!o)return h.error("Could not find parent table for getPriceType",null,{row:e}),null;const i=o.querySelectorAll("thead th"),n=Array.from(e.cells).findIndex(l=>l.contains(t));if(n===-1||!i||n>=i.length)return h.error("Invalid headers or cellIndex in getPriceType",null,{tableHeaders:i,cellIndex:n}),null;const s=i[n],c=((s.dataset&&s.dataset.originalText?s.dataset.originalText:"")||s.textContent||"").trim().toUpperCase();return c.includes("BOTELLA")?O.PRICE_TYPES.BOTTLE:c.includes("LITRO")?O.PRICE_TYPES.LITER:c.includes("COPA")?O.PRICE_TYPES.CUP:"precio"}isBottleProduct(e){return Array.from(document.querySelectorAll("th")).some(t=>{const o=t.textContent.toUpperCase();return["BOTELLA","LITRO","COPA"].some(i=>o.includes(i))})&&e.querySelector(".product-price")}isFoodProduct(){return this.currentSchema?.modalType==="food-customization"}isMeatProduct(){return this.currentSchema?.modalType==="meat-customization"}isPlatosFuertesProduct(){return this.currentSchema?.modalType==="platos-customization"}calculateTotalJagerDrinkCount(){return this.calculateTotalDrinkCount()}calculateTotalDrinkCount(){return Object.values(this.drinkCounts).reduce((e,t)=>e+t,0)}calculateTotalJuiceCount(){return Object.entries(this.drinkCounts).reduce((e,[t,o])=>hr(t)?e+o:e,0)}hasValidDrinkSelection(){return this.currentProduct?pr.hasValidDrinkSelection(this.selectedDrinks,this.drinkCounts,this.currentProduct):(h.error("No current product selected for drink selection validation"),!1)}validateDrinkOptions(e){return this.currentProduct?pr.validateDrinkOptions(e,this.currentProduct.name):(h.error("No current product selected for drink options validation"),!1)}isSpecialBottleCategory(){if(this.bottleCategory==="VODKA"||this.bottleCategory==="GINEBRA")return!0;if(this.bottleCategory==="RON"){const e=this.currentProduct?.name?.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase()||"";return O.SPECIAL_PRODUCTS.SPECIAL_RON.some(t=>e.includes(t))}return!1}isOnlySodaCategory(e){return!e||e.length===0?!1:e.every(t=>!hr(t))&&e.length>0&&!e.includes("Ninguno")}isSpecialDrinkProduct(e){return this.isSpecialBottleCategory()||this.isOnlySodaCategory(e)}hasAnyDynamicMixers(){return!!(this.currentProduct&&this.currentProduct.mixers&&this.currentProduct.mixers.length>0)}getAdaptiveOptions(){if(!this.currentProduct)return{options:["Ninguno"],message:"Error",mode:"none"};const t=this.currentProduct.name.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();if(this.currentProduct.mixers&&Array.isArray(this.currentProduct.mixers)&&this.currentProduct.mixers.length>0){const s=this.currentProduct.mixers;return{options:s,message:this._resolveAdaptiveMessage(s),mode:this.currentProduct.priceType===O.PRICE_TYPES.BOTTLE?"multi":"single",max:O.MAX_DRINK_COUNT,source:"Dynamic (DB/Mixers)"}}const o=this.currentSchema;if(o&&o.accompaniments&&o.accompaniments.length>0)return{options:o.accompaniments,message:this._resolveAdaptiveMessage(o.accompaniments),mode:o.accompanimentMode||"none",max:O.MAX_DRINK_COUNT,source:"Category Schema"};const i=(this.currentCategory||"").toLowerCase().replace(/\s+/g,"_");if(i==="carnes"||i==="cortes_de_carne")return{options:["Trmino ","Trmino ","Bien Cocido"],message:"Seleccione el trmino de coccin:",mode:"single",source:"Hardcoded Fallback (Meat)"};const n=this._getSpecialProductOptions(t);return n?{options:n.drinkOptions,message:n.message,mode:this.currentProduct.priceType===O.PRICE_TYPES.BOTTLE?"multi":"single",max:O.MAX_DRINK_COUNT,source:"Special Legacy Fallback"}:{options:["Ninguno"],message:this.bottleCategory==="ESPUMOSOS"?O.MESSAGES.NO_REFRESCOS:O.MESSAGES.DEFAULT,mode:"none"}}_resolveAdaptiveMessage(e){const t=this.isOnlySodaCategory(e);return this.bottleCategory==="VODKA"||this.bottleCategory==="GINEBRA"||this.isSpecialBottleCategory()?O.MESSAGES.SPECIAL:t?O.MESSAGES.ONLY_SODAS:O.MESSAGES.DEFAULT}getDrinkOptionsForProduct(e){const t=this.getAdaptiveOptions();return{drinkOptions:t.options,message:t.message}}getDrinkModalTitle(e){return{title:"Seleccione acompaamiento",subtitle:this.getDrinkOptionsForProduct(e).message}}_getSpecialProductOptions(e){return e.includes(O.SPECIAL_PRODUCTS.JAGER)?{drinkOptions:["2 Boost","5 Refrescos","1 Jarra y 2 Refrescos","Ninguno"],message:O.MESSAGES.SPECIAL}:this.bottleCategory==="RON"&&O.SPECIAL_PRODUCTS.SPECIAL_RON.some(t=>e.includes(t))?{drinkOptions:["Mineral","Agua","Coca","Manzana","Ninguno"],message:O.MESSAGES.ONLY_SODAS}:null}_getDigestivoOptions(e,t){if(!e||!t||!this.currentProduct)return{drinkOptions:["Ninguno"],message:"Sin acompaamientos"};if(this.currentProduct.priceType===O.PRICE_TYPES.BOTTLE){const o={"LICOR 43":["Botella de Agua","Mineral"],"CADENAS DULCE":["Botella de Agua","Mineral"],"ZAMBUCA NEGRO":["Botella de Agua","Mineral"]};for(const[i,n]of Object.entries(o))if(e.includes(i))return{drinkOptions:Array.isArray(n)?n:["Ninguno"],message:"Seleccione acompaamiento:"};return{drinkOptions:["Ninguno"],message:O.MESSAGES.NO_REFRESCOS}}return this.currentProduct.priceType===O.PRICE_TYPES.CUP&&t.includes("BAILEYS")?{drinkOptions:["Rocas"],message:"Acompaamientos para copa"}:{drinkOptions:["Ninguno"],message:O.MESSAGES.NO_REFRESCOS}}buildProductInfo(){if(!this.currentProduct)return h.error("No current product selected for building product info"),{prefix:"",name:"",customization:"Error: No product selected"};const e=this.currentProduct.priceType,t=this.currentProduct.name.replace(/\s*\d+\s*ML/i,""),o=this.currentProduct.name.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().includes("JAGERMEISTER")&&e==="precioBotella",n={precioBotella:"Botella",precioLitro:"Litro",precioCopa:"Copa"}[e]||"";let s="";return e==="precioBotella"?o&&this.selectedDrinks.includes("2 Boost")?s="Con: 2 Boost":Object.values(this.drinkCounts).some(a=>a>0)?s=`Con: ${Object.entries(this.drinkCounts).filter(([,c])=>c>0).map(([c,l])=>`${l}x ${c}`).join(", ")}`:s=this.selectedDrinks.includes("Ninguno")?"Sin acompaamientos":`Con: ${this.selectedDrinks.join(", ")}`:e==="precioLitro"?s=`Mezclador: ${this.selectedDrinks[0]||"Ninguno"}`:e==="precioCopa"&&(s=`Estilo: ${this.selectedDrinks[0]||"Ninguno"}`),{prefix:n,name:t,customization:s}}getActiveOrders(){try{return JSON.parse(localStorage.getItem("orders")||"[]")}catch(e){return h.error("Error reading active orders from localStorage",e),[]}}getOrderHistory(){try{return JSON.parse(localStorage.getItem("orderHistory")||"[]")}catch(e){return h.error("Error reading order history from localStorage",e),[]}}saveOrderToStorage(e){try{const t=this.getActiveOrders();return t.unshift(e),localStorage.setItem("orders",JSON.stringify(t)),h.info("Order saved to localStorage",{orderId:e.id,itemCount:e.items.length}),!0}catch(t){return h.error("Error saving order to localStorage",t),!1}}moveOrderToHistory(e){try{const t=this.getActiveOrders(),o=t.find(s=>s.id==e);if(!o)return h.warn("Order not found for moving to history. Available IDs:",{target:e,available:t.map(s=>s.id)}),!1;const i=t.filter(s=>s.id!=e);localStorage.setItem("orders",JSON.stringify(i));const n=this.getOrderHistory();return n.unshift({...o,deletedAt:new Date().toISOString()}),localStorage.setItem("orderHistory",JSON.stringify(n)),h.info("Order moved to history",{orderId:e}),!0}catch(t){return h.error("Error moving order to history",t),!1}}deleteOrderFromHistory(e){try{const t=this.getOrderHistory(),o=t.filter(i=>i.id!=e);return t.length===o.length?(h.warn("Order not found in history to delete",{orderId:e}),!1):(localStorage.setItem("orderHistory",JSON.stringify(o)),h.info("Order permanently removed from history UI",{orderId:e}),!0)}catch(t){return h.error("Error deleting order from history",t),!1}}clearOrderHistory(){try{return localStorage.setItem("orderHistory","[]"),h.info("Order history cleared"),!0}catch(e){return h.error("Error clearing order history",e),!1}}generateOrderId(){return`order_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}class Fu{constructor(e){this.controller=e,this.eventDelegationInitialized=!1}initialize(){this.initEventDelegation(),this._initOrientationListener(),document.addEventListener("navigation:starting",()=>{h.info("[OrderUI] Navigation detected, closing orders screen."),this.hideOrdersScreen()})}initEventDelegation(){this.eventDelegationInitialized||(document.addEventListener("click",e=>this.controller.handleDelegatedEvent(e)),this.eventDelegationInitialized=!0,h.debug("OrderSystem event delegation initialized"))}_createElement(e,t,o=""){const i=document.createElement(e);return t&&(i.className=t),o&&(i.textContent=o),i}showValidationModal(e){h.info("[OrderUI] showValidationModal called with:",e),R.show({title:"Atencin",content:`<p class="u-modal-text-center">${e}</p>`,actions:[{label:"Aceptar",type:"contrast",onClick:()=>R.close()}]})}showConfirmationModal(e,t,o){R.show({title:e||"Confirmacin",content:`<p class="u-modal-text-center">${t}</p>`,actions:[{label:"Confirmar",type:"contrast",onClick:()=>{o(),R.close()}},{label:"Cancelar",type:"ghost",onClick:()=>R.close()}]})}updateOrderDisplay(e){const t=document.getElementById("order-items");if(!t){this.controller.isOrderMode&&h.debug("updateOrderDisplay: order-items not found");return}this._updateOrderDisplayContent(t,e)}_updateOrderDisplayContent(e,t){e.innerHTML="";const o=document.getElementById("order-total-amount");o&&(o.textContent=xe(this.controller.core.getTotal())),t.forEach(i=>{const n=document.createElement("div");n.className="order-item";const s=document.createElement("div");s.className="order-item-header";const a=document.createElement("div");a.className="order-item-name",a.textContent=i.name;const c=`product-name_${et((i.name||"").trim())}`;a.setAttribute("data-translate",c),a.setAttribute("data-namespace","products"),a.setAttribute("data-original-text",i.name||"");const l=document.createElement("button");l.className="remove-order-item",Nt(l,"&times;"),l.addEventListener("click",()=>{this.controller.removeOrderItem(i.id)}),s.appendChild(a),s.appendChild(l);const d=document.createElement("div");d.className="order-item-price",d.textContent=xe(i.price),d.style.fontSize="0.75rem",n.appendChild(s),n.appendChild(d),i.customizations&&i.customizations.length>0&&i.customizations.forEach(u=>{const p=document.createElement("div");p.className="order-item-customization",p.textContent=u;const g=`product-option_${et((u||"").trim())}`;p.setAttribute("data-translate",g),p.setAttribute("data-namespace","products"),p.setAttribute("data-original-text",u||""),n.appendChild(p)}),e.appendChild(n)}),requestAnimationFrame(()=>{const i=document.querySelector(".order-scroll-layer");i?i.scrollTop=i.scrollHeight:e.scrollTop=e.scrollHeight})}toggleOrderModeUI(e){const t={sidebar:document.getElementById(O.SELECTORS.SIDEBAR),tables:document.querySelectorAll(O.SELECTORS.TABLES),wrapper:document.querySelector(".content-wrapper"),orderBtn:document.getElementById(O.SELECTORS.ORDER_BTN),body:document.body};this._updateOrderButton(t.orderBtn,e),this._updateSidebarVisibility(t.sidebar,e),this._updateTablesMode(t.tables,e),this._updateWrapperState(t.wrapper,e),this._updateBodyState(t.body,e)}_updateOrderButton(e,t){this._updateHamburgerMenuButton(t)}async _updateHamburgerMenuButton(e){const t=document.querySelectorAll("#drawer-menu .nav-button"),o=Array.from(t).find(i=>i.getAttribute("data-action")==="createOrder");o&&(e?(o.setAttribute("data-translate","menu.cancel_order"),o.setAttribute("data-namespace","menu"),o.setAttribute("data-original-text","CANCELAR ORDEN"),o.textContent="CANCELAR ORDEN"):(o.setAttribute("data-translate","menu.create_order"),o.setAttribute("data-namespace","menu"),o.setAttribute("data-original-text","Crear orden"),o.textContent="Crear orden"))}_updateSidebarVisibility(e,t){if(!e)return;const o=this.controller.core&&this.controller.core.getItems&&this.controller.core.getItems().length>0,i=t||o;A(()=>import("./OrderDrawer-BWVmZfwH.js"),__vite__mapDeps([2,3])).then(n=>{const s=n.default;i?s.open():s.close(!0)}).catch(n=>{console.error("Failed to load OrderDrawer",n),e.classList.toggle("sidebar-visible",i),document.body.classList.toggle("sidebar-open",i)})}_handleMobileHiding(e){A(()=>import("./OrderDrawer-BWVmZfwH.js"),__vite__mapDeps([2,3])).then(t=>{t.default.close(!0)})}_initOrientationListener(){window.addEventListener("orientationchange",()=>{setTimeout(()=>this._handleOrientationChange(),100)}),window.addEventListener("resize",()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>this._handleOrientationChange(),150)})}_handleOrientationChange(){const e=document.getElementById(O.SELECTORS.SIDEBAR);if(e&&e.classList.contains("sidebar-visible")){this._handleMobileOrientation(e);const t=document.querySelector(".content-wrapper");t&&t.classList.toggle("with-sidebar",this._isLandscape())}}_updateTablesMode(e,t){e&&e.forEach(o=>{o&&o.classList&&o.classList.toggle("price-selection-mode",t)})}_updateWrapperState(e,t){e&&e.classList&&e.classList.toggle("order-active",t)}_updateBodyState(e,t){e&&e.classList&&e.classList.toggle("order-mode-active",t)}showAdaptiveModal(){h.info("[OrderUI:LOG] showAdaptiveModal called"),this._setupAdaptiveModal()}renderDrinkOptions(e,t){if(!Array.isArray(t)){h.error("renderDrinkOptions: options is not an array:",t);return}const o=this._createElement("div","bottle-mixer-grid");t.forEach(i=>{o.appendChild(i==="Ninguno"?this._createNoneOption(i):this._createDrinkOption(i))}),e.appendChild(o)}renderOptionsGrid(e,t){if(!Array.isArray(t)){h.error("renderOptionsGrid: options is not an array:",t);return}const o=this._createElement("div","drink-modal__grid");t.forEach(i=>{const n=this._createElement("button","drink-option drink-modal__option nav-button");n.textContent=i;const s=`drink_options.${et(i)}`;n.setAttribute("data-translate",s),n.setAttribute("data-namespace","menu"),n.setAttribute("data-original-text",i),n.addEventListener("click",()=>{e.querySelectorAll(".drink-option").forEach(a=>a.classList.remove("selected")),n.classList.add("selected"),this.controller.logic.selectedDrinks=[i],this.controller.logic.drinkCounts={}}),o.appendChild(n)}),e.appendChild(o)}showAdaptiveModal(){const e=this.controller.logic,t=e.currentProduct,{options:o,message:i,mode:n,title:s,source:a}=e.getAdaptiveOptions(),c=(t.category_normalized||"").toLowerCase().replace(/\s+/g,"_");h.info("[OrderUI:LOG] showAdaptiveModal for:",{product:t.name,category:c,mode:n,source:a,optionsCount:o?.length}),e.selectedDrinks=[],e.drinkCounts={};const l=document.createElement("div");if(l.className="adaptive-options-wrapper u-full-width",i){const d=document.createElement("p");d.className="drink-options-message",d.textContent=i,l.appendChild(d)}n==="single"?this.renderOptionsGrid(l,o):n==="multi"&&this.renderDrinkOptions(l,o),R.show({title:s||"Personalice su pedido",content:l,size:"large sys-modal-compact sys-modal-premium-buttons bottle-modal",actions:[{label:"Confirmar",type:"contrast",onClick:()=>{this._handleAdaptiveConfirmation(l,n,c)}},{label:"Cancelar",type:"ghost",onClick:()=>{this.controller.cancelProductSelection()}}]}),n==="multi"&&setTimeout(()=>this.updateTotalDrinkCount(),50)}_handleAdaptiveConfirmation(e,t,o){const i=this.controller.logic,n=(o||"").toLowerCase().replace(/\s+/g,"_"),s=[];i.selectedDrinks&&i.selectedDrinks.length>0&&(t==="single"?s.push(i.selectedDrinks[0]):Object.entries(i.drinkCounts).forEach(([c,l])=>{l>0&&s.push(`${l} ${c}`)}));const a=e.querySelector(".form-textarea");if(a){const c=a.value.trim();s.push(c?`Guarnicin: ${c}`:"Guarnicin Normal")}n==="carnes"||n==="cortes_de_carne"?this.controller.confirmProductWithCustomization(s):this.controller.confirmDrinkOptions(),R.close()}renderGarnishSection(e){const t=document.createElement("h3");t.textContent="Desea cambiar algo de la guarnicin?",t.className="modal-section-title u-mt-lg",e.appendChild(t);const o=document.createElement("div");o.className="garnish-choice u-flex u-gap-md u-mb-md u-flex-justify-center";const i=document.createElement("button");i.className="btn btn-primary active",i.textContent="No (Normal)";const n=document.createElement("button");n.className="btn btn-ghost",n.textContent="S (Cambiar)";const s=document.createElement("div");s.className="u-hidden u-fade-in u-mt-md u-full-width";const a=document.createElement("textarea");a.className="form-textarea",a.placeholder="Indique los cambios en la guarnicin",s.appendChild(a),n.onclick=()=>{n.classList.add("active"),i.classList.remove("active"),s.classList.remove("u-hidden"),a.focus()},i.onclick=()=>{i.classList.add("active"),n.classList.remove("active"),s.classList.add("u-hidden"),a.value=""},o.append(i,n),e.appendChild(o),e.appendChild(s)}async _retranslateIfNeeded(e){try{const t=await A(()=>Promise.resolve().then(()=>ha),void 0),o=t.default||t,i=typeof o.getCurrentLanguage=="function"?o.getCurrentLanguage():"es";if(i&&i!=="es")try{const n=await A(()=>Promise.resolve().then(()=>ga),void 0),s=n.default||n;if(s&&typeof s.translateElement=="function"){const c=(e||document).querySelectorAll("[data-translate], [data-translate-placeholder]");await Promise.all(Array.from(c).map(l=>s.translateElement(l,i)))}else typeof o.translatePage=="function"&&o.translatePage(i)}catch(n){h.warn("DOMTranslator not available, using translatePage",n),typeof o.translatePage=="function"&&o.translatePage(i)}}catch(t){h.warn("Failed to re-apply translation in OrderUI",t)}}_createNoneOption(e){const t=this._createElement("button","drink-option");return t.textContent=e,t.setAttribute("data-original-text",e),t.setAttribute("data-translate",`drinks.option.${et(e)}`),t.setAttribute("data-namespace","drinks"),t.addEventListener("click",()=>{this.controller.handleOptionClick(e)}),t}_createDrinkOption(e){const t=this._createElement("div","drink-option-container"),o=this._createElement("span","drink-option-name");o.textContent=e,o.setAttribute("data-original-text",e),o.setAttribute("data-translate",`drinks.option.${et(e)}`),o.setAttribute("data-namespace","drinks");const i=this._createElement("div","counter-container"),n=this._createElement("span","count-display","0"),s=this.controller.logic.drinkCounts[e]||0;n.textContent=s,s>0&&t.classList.add("selected");const a=this._createCounterButton("",()=>this._handleDrinkDecrement(e,n,t)),c=this._createCounterButton("+",()=>this._handleDrinkIncrement(e,n,t));return i.append(a,n,c),t.append(o,i),t}_createCounterButton(e,t){const o=this._createElement("button","counter-btn");return o.textContent=e,t&&o.addEventListener("click",i=>{i.stopPropagation(),t()}),o}_handleDrinkDecrement(e,t,o){const i=this.controller.handleDrinkDecrement(e);i!==null&&(t.textContent=i,this.updateTotalDrinkCount())}_handleDrinkIncrement(e,t,o){const i=this.controller.handleDrinkIncrement(e);i!==null&&(t.textContent=i,this.updateTotalDrinkCount())}updateTotalDrinkCount(){const e=document.getElementById("total-drinks-count"),t=this.controller.logic.calculateTotalDrinkCount();e&&(e.textContent=t);const o=this.controller.logic.maxDrinkCount;this.controller.logic.isSpecialDrinkProduct(),document.querySelectorAll(".drink-option-container .counter-btn").forEach(i=>{i.textContent==="+"&&(i.disabled=t>=o)})}_launchCustomizationModal(e){const t=this.controller.logic.currentProduct;R.show({title:t.name,size:"food-customization",content:e.content,actions:[{label:"Confirmar",type:"contrast",onClick:e.onConfirm},{label:"Cancelar",type:"ghost",onClick:()=>this.controller.cancelProductSelection()}]})}showFoodCustomizationModal(){this._showIngredientsCustomizationModal({title:"Desea su platillo con todos los ingredientes?",placeholder:"Indique los ingredientes que desea quitar o cambios adicionales",wrapperClass:"food-customization-wrapper"})}showPlatosCustomizationModal(){this._showIngredientsCustomizationModal({title:"Desea su plato con todos los ingredientes?",placeholder:"Indique si desea quitar algn ingrediente o guarnicin",wrapperClass:"platos-customization-wrapper"})}_showIngredientsCustomizationModal(e){this.controller.logic.currentProduct;const t=document.createElement("div");t.className=`${e.wrapperClass} u-modal-text-center`;const o=document.createElement("h3");o.textContent=e.title,o.className="modal-section-title",t.appendChild(o);const i=document.createElement("div");i.className="ingredients-choice u-flex u-gap-md u-flex-center";const n=document.createElement("button");n.className="btn btn-ghost",n.textContent="No (Personalizar)";const s=document.createElement("button");s.className="btn btn-primary active",s.textContent="S (Normal)";const a=document.createElement("div");a.className="u-hidden u-fade-in u-mt-lg";const c=document.createElement("textarea");c.className="form-textarea",c.placeholder=e.placeholder,a.appendChild(c),n.onclick=()=>{n.classList.add("active"),s.classList.remove("active"),a.classList.remove("u-hidden"),c.focus()},s.onclick=()=>{s.classList.add("active"),n.classList.remove("active"),a.classList.add("u-hidden"),c.value=""},i.append(s,n),t.appendChild(i),t.appendChild(a),this._launchCustomizationModal({content:t,onConfirm:()=>{const l=[],d=c.value.trim();l.push(d?`Personalizado: ${d}`:"Sin cambios"),this.controller.confirmProductWithCustomization(l),R.close()}})}showMeatCustomizationModal(){const e=this.controller.logic;e.currentProduct;const t=document.createElement("div");t.className="meat-customization-wrapper";const o=document.createElement("h3");o.textContent="Seleccione el trmino de coccin:",o.className="modal-section-title",t.appendChild(o);const i=document.createElement("div");i.className="cooking-options sys-modal-grid u-mb-lg";const n=[{id:"medio",label:"Trmino "},{id:"tres-cuartos",label:"Trmino "},{id:"bien-cocido",label:"Bien Cocido"}];n.forEach(p=>{const g=document.createElement("button");g.className="cooking-option btn btn-ghost",g.textContent=p.label,g.dataset.term=p.id,g.onclick=()=>{i.querySelectorAll(".cooking-option").forEach(f=>{f.classList.remove("active")}),g.classList.add("active"),e.selectedCookingTerm=p.id,i.classList.remove("u-validation-error")},i.appendChild(g)}),t.appendChild(i);const s=document.createElement("h3");s.textContent="Desea cambiar algo de la guarnicin?",s.className="modal-section-title",t.appendChild(s);const a=document.createElement("div");a.className="garnish-choice u-flex u-gap-md u-mb-md";const c=document.createElement("button");c.className="btn btn-primary active",c.textContent="No (Normal)";const l=document.createElement("button");l.className="btn btn-ghost",l.textContent="S (Cambiar)";const d=document.createElement("div");d.className="u-hidden u-fade-in u-mt-md";const u=document.createElement("textarea");u.className="form-textarea",u.placeholder="Indique los cambios en la guarnicin",d.appendChild(u),l.onclick=()=>{l.classList.add("active"),c.classList.remove("active"),d.classList.remove("u-hidden"),u.focus()},c.onclick=()=>{c.classList.add("active"),l.classList.remove("active"),d.classList.add("u-hidden"),u.value=""},a.append(c,l),t.appendChild(a),t.appendChild(d),this._launchCustomizationModal({content:t,onConfirm:()=>{if(!e.selectedCookingTerm){i.classList.remove("u-validation-error"),i.offsetWidth,i.classList.add("u-validation-error"),h.warn("Validation failed: No cooking term selected");return}const p=[],g=n.find(b=>b.id===e.selectedCookingTerm).label;p.push(g);const f=u.value.trim();p.push(f?`Guarnicin: ${f}`:"Guarnicin Normal"),this.controller.confirmProductWithCustomization(p),R.close()}}),e.selectedCookingTerm=null}showOrdersScreen(e,t=!1){h.info("Showing orders screen",{orderCount:e.length,isHistory:t});const o={mainContentScreen:document.querySelector(".main-content-screen"),contentContainer:document.getElementById("content-container"),hamburgerBtn:document.getElementById("hamburger-btn"),ordersScreen:document.querySelector(".orders-screen")};o.contentContainer&&(o.contentContainer.className="content-hidden"),o.ordersScreen&&o.ordersScreen.parentNode&&o.ordersScreen.parentNode.removeChild(o.ordersScreen),o.mainContentScreen&&o.mainContentScreen.appendChild(this._createOrdersScreen(e,t))}_createOrdersScreen(e,t){const o=this._createElement("div","orders-screen"),i=this._createOrdersHeader(t),n=this._createElement("div","orders-view-container");return this._populateOrdersGrid(n,e),o.appendChild(i),o.appendChild(n),t&&e.length>0&&this._createFixedBottomButton(o,"Limpiar Historial",()=>{this.controller.handleClearHistory()}),o}_createOrdersHeader(e){const t=this._createElement("div","orders-screen-header"),o=this._createElement("div","orders-actions-container");o.style.display="flex",o.style.gap="10px",o.style.marginLeft="auto";const i=this._createElement("button","btn btn-ghost nav-button orders-back-btn","Volver");i.addEventListener("click",()=>{this.controller.toggleOrderHistoryView()}),i.style.display=e?"block":"none";const n=this._createElement("button","btn btn-ghost nav-button history-btn","Ver Historial");return n.addEventListener("click",()=>{this.controller.toggleOrderHistoryView()}),n.style.display=e?"none":"block",o.appendChild(i),o.appendChild(n),t.appendChild(o),t}_populateOrdersGrid(e,t){if(e.innerHTML="",t.length===0){const o=this._createElement("div","orders-empty-state");o.style.gridColumn="1 / -1",o.style.textAlign="center",o.style.padding="var(--spacing-xl)",o.textContent="No hay rdenes registradas.",e.appendChild(o);return}t.forEach(o=>{e.appendChild(this._createOrderCard(o))})}_createOrderCard(e){const t=this._createElement("div","order-card");let o=parseFloat(e.totalAmount||e.total||0);(o===0||isNaN(o))&&e.items&&e.items.length>0&&(o=e.items.reduce((w,$)=>w+(parseFloat($.price)||0),0));const i=e.completedAt||e.timestamp||new Date;let n="",s=!0;try{const w=new Date(i);if(isNaN(w.getTime()))throw new Error("Invalid Date");n=w.toLocaleString("es-MX",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"}),s=!0}catch{n=`Orden #${(e.id||"???").toString().slice(-4)}`,s=!1}const a=this._createElement("div","order-header"),c=this._createElement("span","order-id",n);c.style.textTransform="capitalize",c.style.fontSize="1rem";const l=this._createElement("div");if(l.style.display="flex",l.style.flexDirection="column",l.appendChild(c),s){const w=this._createElement("span","order-time",`#${(e.id||"???").toString().slice(-4)}`);l.appendChild(w)}a.appendChild(l);const d=this._createElement("div","order-items-list");(e.items||[]).forEach(w=>{const $=this._createElement("div","order-line-item"),I=this._createElement("span","item-name",w.name),q=this._createElement("span","item-price",xe(w.price));if($.append(I,q),d.appendChild($),w.customizations&&w.customizations.length>0){const re=this._createElement("div","order-customization",w.customizations.join(", "));d.appendChild(re)}});const u=this._createElement("div","internal-total-separator"),p=this._createElement("span","","TOTAL"),g=this._createElement("span","",xe(o));u.append(p,g);const f=this._createElement("div","order-footer"),b=this._createElement("button","btn-delete","Eliminar");b.onclick=w=>{w.stopPropagation(),this.controller.handleDeleteOrder(e.id)};const v=e.synced===!1,S=v?"status-badge pending":"status-badge synced",_=v?"PENDIENTE":"SYNC",y=this._createElement("span",S,_);return f.append(b,y),t.onclick=()=>{this._showOrderDetailsModal(e,o,n)},t.append(a,d,u,f),t}_showOrderDetailsModal(e,t,o){const i=this._createElement("div","sys-modal-overlay");i.classList.add("active");const n=this._createElement("div","sys-modal-container sys-modal-order-details"),s=this._createElement("div","sys-modal-header"),a=this._createElement("div","modal-icon"),c=this._createElement("h2","",o),l=this._createElement("div","close-btn","");l.onclick=()=>{document.body.removeChild(i)},i.onclick=f=>{f.target===i&&document.body.removeChild(i)},s.append(a,c,l);const d=this._createElement("div","sys-modal-body");(e.items||[]).forEach(f=>{const b=this._createElement("div","detail-item-row"),v=this._createElement("span","detail-name",f.name),S=this._createElement("span","detail-price",xe(f.price));b.append(v,S),d.appendChild(b)});const u=this._createElement("div","sys-modal-footer"),p=this._createElement("div","modal-total-display",`Total: ${xe(t)}`),g=this._createElement("button","btn btn-contrast","Cerrar");g.onclick=()=>document.body.removeChild(i),u.append(p,g),n.append(s,d,u),i.appendChild(n),document.body.appendChild(i),requestAnimationFrame(()=>{n.classList.add("active")})}_createFixedBottomButton(e,t,o){const i=this._createElement("div","fixed-bottom-actions"),n=this._createElement("button","btn btn-primary nav-button clear-history-btn",t);n.addEventListener("click",o),i.appendChild(n),e.appendChild(i)}async hideOrdersScreen(){const e=document.querySelector(".orders-screen");e&&e.parentNode&&e.parentNode.removeChild(e);const t=document.getElementById("hamburger-btn");t&&(t.className="hamburger-btn");const o=document.getElementById("content-container");o&&(o.className="content-container")}updateOrdersDisplay(e,t){const o=document.querySelector(".orders-view-container");if(o)this._populateOrdersGrid(o,e);else{const s=document.querySelector(".orders-list");s&&this._populateOrdersGrid(s,e)}const i=document.querySelector(".orders-back-btn"),n=document.querySelector(".history-btn");t?(i&&(i.style.display="block"),n&&(n.style.display="none")):(i&&(i.style.display="none"),n&&(n.style.display="block"))}showMeatCustomizationModal(){const e=this.controller.logic;e.currentProduct;const{options:t,message:o}=e.getAdaptiveOptions(),i=document.createElement("div");i.className="meat-customization-wrapper";const n=document.createElement("h3");n.textContent=o||"Seleccione el trmino de coccin:",n.className="modal-section-title",i.appendChild(n);const s=document.createElement("div");s.className="cooking-options sys-modal-grid u-mb-lg",e.selectedDrinks=[],t.forEach(a=>{const c=document.createElement("button");c.className="cooking-option btn btn-ghost",c.textContent=a,c.onclick=()=>{s.querySelectorAll(".cooking-option").forEach(l=>{l.classList.remove("active")}),c.classList.add("active"),e.selectedDrinks=[a],s.classList.remove("u-validation-error")},s.appendChild(c)}),i.appendChild(s),this.renderGarnishSection(i),this._launchCustomizationModal({content:i,onConfirm:()=>{if(!e.selectedDrinks||e.selectedDrinks.length===0){s.classList.remove("u-validation-error"),s.offsetWidth,s.classList.add("u-validation-error"),h.warn("Validation failed: No selection made");return}const a=[e.selectedDrinks[0]],c=i.querySelector(".form-textarea");if(c){const l=c.value.trim();a.push(l?`Guarnicin: ${l}`:"Guarnicin Normal")}this.controller.confirmProductWithCustomization(a),R.close()}})}_isLandscape(){return window.innerWidth>window.innerHeight}_handleMobileOrientation(e){e&&(this._isLandscape()?e.classList.remove("mobile-portrait"):e.classList.add("mobile-portrait"))}}class Gu{async getAllCocktails(){throw new Error("Method not implemented")}async getCocktailById(e){throw new Error("Method not implemented")}}class Di{constructor(){this.adapterName=this.constructor.name,h.debug(`${this.adapterName}: Initialized`)}safeExecute(e,t,o=[]){try{const i=e();return h.debug(`${this.adapterName}.${t}: Success`),i}catch(i){return ie.handle(i,`${this.adapterName}.${t}`),h.error(`${this.adapterName}.${t}: Error occurred`,{error:i.message}),o}}async safeExecuteAsync(e,t,o=[]){const[i,n]=await ie.handleAsync(e(),`${this.adapterName}.${t}`);return i?(h.error(`${this.adapterName}.${t}: Async error`,{userMessage:i.userMessage}),o):(h.debug(`${this.adapterName}.${t}: Async success`),n)}validateTextParam(e,t){return Ke.isValidText(e)?!0:(h.warn(`${this.adapterName}: Invalid ${t} parameter`,{[t]:e}),!1)}getStandardCategories(){return["cocteles","refrescos","licores","cervezas","pizzas","alitas","sopas","ensaladas","carnes","cortes_de_carne","cafes","postres"]}}const Hu=Ar({id:L(),producto_id:L().optional(),nombre:L().optional(),name:L().optional(),price:te().nonnegative(),category:L().optional(),categoria:L().optional(),producto_codigo:L().optional(),codigo:L().optional(),customizations:Y(L()).default([]),cantidad:te().int().positive().default(1)}).transform(r=>({...r,producto_id:r.producto_id||r.id,nombre:r.nombre||r.name||"Producto desconocido",name:r.name||r.nombre||"Producto desconocido",precio:r.price,categoria:r.categoria||r.category||"general",producto_codigo:r.producto_codigo||r.codigo||"PROD-UNKNOWN"})),Zu=Ar({id:L().optional(),establecimiento_id:L().uuid().optional(),establecimiento_nombre:L().optional(),orden_numero:L().optional(),mesa:L().min(1).default("General"),mesa_id:L().optional(),items:Y(Hu).min(1,"La orden debe tener al menos un producto"),subtotal:te().nonnegative().default(0),descuento:te().nonnegative().default(0),impuesto:te().nonnegative().default(0),total:te().nonnegative(),discrepancia_total:Si().default(!1).optional(),total_calculado_db:te().optional(),status:Or(["pendiente","completada","cancelada"]).default("pendiente"),notas:L().nullable().default(null),usuario_id:L().uuid().nullable().optional(),mesero_id:L().uuid().nullable().optional(),fecha_hora_creacion:L().datetime().optional().default(()=>new Date().toISOString()),fecha_hora_completado:L().datetime().nullable().optional()}),jo=r=>{const e=r.items||[],t=r.total||e.reduce((i,n)=>i+(parseFloat(n.price)||0),0),o={...r,subtotal:r.subtotal||t,total:t,mesa:r.mesa||"General",items:e};return Zu.parse(o)};h.info("SupabaseAdapter: Configuracin compartida cargada");class Wu extends Di{constructor(){super(),this.client=H,this.port=new Gu,this._initOnlineListener()}async getProducts(e){return this.validateTextParam(e,"type")?this.safeExecuteAsync(()=>this.client.from("products").select("*").eq("category",e).order("price",{ascending:!0}),"getProducts",[]).then(t=>t?.data||[]):[]}async getAllCocktails(){return(await this.safeExecuteAsync(()=>this.client.from("products").select("id, nombre, ingredientes, video, precio, imagen").eq("category","cocteleria").order("nombre",{ascending:!0}),"getAllCocktails",[]))?.data||[]}async getCocktails(){return h.warn("SupabaseAdapter.getCocktails: Using deprecated method, use getAllCocktails() instead"),this.getAllCocktails()}async getProductsByCategory(e){return this.validateTextParam(e,"category")?this.safeExecuteAsync(()=>this.client.from("products").select("*").eq("category",e).order("nombre",{ascending:!0}),"getProductsByCategory",[]).then(t=>t?.data||[]):[]}async saveOrder(e){if(!e)return!1;if(navigator.onLine)try{const t=T.get("database.establishmentId"),o=T.get("database.establishmentName"),i={...e,establecimiento_id:t,establecimiento_nombre:o},n=jo(i),s={mesa:n.mesa,establecimiento_id:n.establecimiento_id,establecimiento_nombre:n.establecimiento_nombre,orden_numero:n.orden_numero,items:n.items,descuento:n.descuento,impuesto:n.impuesto,status:n.status,notas:n.notas,fecha_hora_creacion:n.fecha_hora_creacion};h.info("SupabaseAdapter: Final Payload for INSERT (with Totals)",s),h.info("SupabaseAdapter: Payload KEYS",Object.keys(s));const{error:a}=await this.client.from("ordenes").insert(s);if(a)throw a;return h.info("Order synced to Supabase successfully"),!0}catch(t){return h.error("Supabase save failed:",{message:t.message,details:t.details,hint:t.hint,stack:t.stack}),!1}return this._saveToLocalBuffer(e),!1}_saveToLocalBuffer(e){try{const t=JSON.parse(localStorage.getItem("pending_orders")||"[]");t.find(o=>o.id===e.id)||(t.push({...e,synced:!1}),localStorage.setItem("pending_orders",JSON.stringify(t)),h.info("Order buffered locally:",e.id))}catch(t){h.error("Failed to save order to local buffer",t)}}_initOnlineListener(){typeof window<"u"&&(window.addEventListener("online",()=>{h.info("Network restored. Syncing pending orders..."),this.syncPendingOrders()}),navigator.onLine&&setTimeout(()=>this.syncPendingOrders(),3e3))}async syncPendingOrders(){const e=JSON.parse(localStorage.getItem("pending_orders")||"[]");if(navigator.onLine&&e.length>0){h.info(`Syncing ${e.length} pending orders to Supabase...`);const t=T.get("database.establishmentId"),o=T.get("database.establishmentName"),i=[];for(const n of e)try{const s={...n,establecimiento_id:t,establecimiento_nombre:o},a=jo(s),c={mesa:a.mesa,establecimiento_id:a.establecimiento_id,establecimiento_nombre:a.establecimiento_nombre,orden_numero:a.orden_numero,items:a.items,descuento:a.descuento,impuesto:a.impuesto,status:a.status,notas:a.notas,fecha_hora_creacion:a.fecha_hora_creacion};delete c.subtotal,delete c.total;const{error:l}=await this.client.from("ordenes").insert(c);if(l)throw l;h.info("Synced pending order:",n.id)}catch(s){h.warn(`Failed to sync order ${n.id}, keeping in buffer`,s),i.push(n)}localStorage.setItem("pending_orders",JSON.stringify(i)),i.length===0&&h.info("All pending orders synced successfully.")}}async uploadFile(e,t){if(!e||!t)return null;try{h.info(`SupabaseAdapter: Uploading file to ${t}...`);const o=this.client.storage.from("productos").upload(t,e,{cacheControl:"3600",upsert:!0}),i=new Promise((c,l)=>setTimeout(()=>l(new Error("Upload Timeout: El servidor tard demasiado en responder.")),2e4)),{data:n,error:s}=await Promise.race([o,i]);if(s)throw s;const{data:a}=this.client.storage.from("productos").getPublicUrl(t);return h.info(`Archivo subido exitosamente: ${t}`),a.publicUrl}catch(o){return h.error("Supabase Storage Upload Failed:",o),null}}}const Ju=Object.freeze(Object.defineProperty({__proto__:null,default:Wu},Symbol.toStringTag,{value:"Module"}));class zi{constructor(e=null){this.productRepository=e,this.isInitialized=!1,this.core=new Uu,this.logic=new Vu,this.ui=new Fu(this),this.isOrderMode=!1,this.isShowingHistory=!1,this.previousCategory=null,this.handleDelegatedEvent=this.handleDelegatedEvent.bind(this),this._interactionHandler=null,this._legacyHandler=null}async initialize(){if(this.isInitialized){h.debug("[OrderSystem] Already initialized, skipping.");return}try{this._ensureProductRepository(),this.ui.initialize(),this._interactionHandler=e=>{if(!e.detail)return;h.info("[OrderSystem:LOG] Received product-interaction",{action:e.detail.action,productName:e.detail.productName,isOrderMode:this.isOrderMode});const{action:t,productName:o,priceText:i,contextElement:n,target:s}=e.detail;if(t==="select"){if(!this.isOrderMode){h.info("[OrderSystem:LOG] Order mode inactive - SHOWING WARNING MODAL"),this.ui.showValidationModal("Para seleccionar productos, primero inicia una orden.");return}h.info("[OrderSystem:LOG] Proceeding with selection for:",o),st.track("intent_to_buy",{nombre:o,priceText:i}),this.handleProductSelection(o,i,n,{target:s||e.detail.originalEvent?.target})}},document.addEventListener("product-interaction",this._interactionHandler),document.addEventListener("product-selected",e=>{if(!e.detail)return;const{productName:t,priceText:o,row:i,card:n,target:s}=e.detail;this.handleProductSelection(t,o,i||n,{target:s})}),this.updateOrderDisplay(),this.isInitialized=!0,h.info("[OrderSystem] System initialized successfully")}catch(e){G("Failed to initialize OrderSystem",e)}}_ensureProductRepository(){if(this.productRepository)this.isInitialized=!0;else try{this.productRepository=K(),this.isInitialized=!0}catch(e){throw G("Failed to initialize product repository",e),e}}handleDelegatedEvent(e){const t=e.target;if(t.closest("#complete-order-btn")){this.handleCompleteOrder();return}if(t.closest("#cancel-order-btn")){this.handleClearOrder();return}if(t.closest("#confirm-drinks-btn")){this.confirmDrinkOptions();return}if(t.closest("#cancel-drinks-btn")){this.cancelProductSelection();return}t.closest(".drink-option-container")||t.closest(".modal-actions")}handlePriceClick(e,t){if(!this.isOrderMode){this.ui.showValidationModal("Para agregar productos, primero activa Crear orden.");return}const o=e.closest("tr");if(!o)return;const i=o.cells[0].textContent.trim(),n=e.textContent.trim();this.handleProductSelection(i,n,o,t)}handleProductSelection(e,t,o,i){if(!this.isOrderMode){this.ui.showValidationModal("Para agregar productos, primero activa Crear orden.");return}const n=i.target.closest("button")||i.target,s=this.logic.extractPrice(t),a=this.logic.getPriceType(o,n),c=this.logic.getProductMetadata(n),{category:l,productId:d,productCode:u}=c;let p=null;if(n.dataset.mixers)try{p=JSON.parse(n.dataset.mixers)}catch(f){h.warn("Failed to parse mixers data",f)}const g={producto_id:d,producto_codigo:u,name:e,price:s,priceType:a,category:l,mixers:p};this.logic.setCurrentProduct(g,l),this._logTraceabilityReport(g,n),this.processProductSelection()}processProductSelection(){const e=this.logic.currentSchema,t=(this.logic.currentCategory||"").toLowerCase().replace(/\s+/g,"_");if(t==="carnes"||t==="cortes_de_carne"){this.ui.showMeatCustomizationModal();return}const o=this.logic.getAdaptiveOptions();if(o&&o.options&&o.options.length>0&&!o.options.includes("Ninguno")){this.ui.showAdaptiveModal();return}if(e.modalType==="food-customization"){this.ui.showFoodCustomizationModal();return}if(e.modalType==="platos-customization"){this.ui.showPlatosCustomizationModal();return}if(e.modalType==="drink-options"&&(this.logic.currentProduct.priceType===O.PRICE_TYPES.BOTTLE||this.logic.currentProduct.priceType===O.PRICE_TYPES.LITER||this.logic.currentProduct.priceType===O.PRICE_TYPES.CUP)){const i=this.logic.currentProduct.name.toUpperCase();if(!O.SPECIAL_PRODUCTS.NO_MODAL.some(s=>i.includes(s))&&(this.logic.bottleCategory!=="OTROS"||this.logic.hasAnyDynamicMixers())&&typeof this.ui.showDrinkOptionsModal=="function"){this.showDrinkOptionsModal();return}}this.addProductToOrder({name:this.logic.currentProduct.priceType===O.PRICE_TYPES.BOTTLE||this.logic.currentProduct.priceType===O.PRICE_TYPES.LITER||this.logic.currentProduct.priceType===O.PRICE_TYPES.CUP?this._getFormattedProductName():this.logic.currentProduct.name,price:this.logic.currentProduct.price,category:this.logic.currentCategory,customizations:[]})}showDrinkOptionsModal(){this.logic.resetSelectionState(),this.ui.showAdaptiveModal()}confirmDrinkOptions(){const e=[];if(Object.values(this.logic.drinkCounts).some(i=>i>0))Object.entries(this.logic.drinkCounts).forEach(([i,n])=>{n>0&&e.push(`${n} x ${i}`)});else if(this.logic.selectedDrinks.length>0){const i=this.logic.selectedDrinks[0];i!=="Ninguno"?e.push(i):e.push("Sin acompaamientos")}e.length===0&&e.push("Sin acompaamientos");const o=this._getFormattedProductName();this.addProductToOrder({name:o,price:this.logic.currentProduct.price,category:this.logic.currentCategory,customizations:e}),R.close(),this.logic.resetSelectionState()}cancelProductSelection(){R.close(),this.logic.resetSelectionState()}handleDrinkDecrement(e){const t=this.logic.drinkCounts[e]||0;return t>0?(this.logic.drinkCounts[e]=t-1,this.logic.drinkCounts[e]===0&&(this.logic.selectedDrinks=this.logic.selectedDrinks.filter(o=>o!==e)),this.logic.drinkCounts[e]):null}handleDrinkIncrement(e){if(this.canIncrementDrink(e)){const t=this.logic.drinkCounts[e]||0;return this.logic.drinkCounts[e]=t+1,this.logic.selectedDrinks.includes(e)||this.logic.selectedDrinks.push(e),this.logic.drinkCounts[e]}return null}canIncrementDrink(e){const t=hr(e),o=this.logic.calculateTotalDrinkCount(),i=this.logic.calculateTotalJuiceCount(),n=Math.max(0,o-i);return pr.canAddDrink(t,o,this.logic.maxDrinkCount,i,n,this.logic.bottleCategory,this.logic.currentProduct?.name)}async handleCompleteOrder(){if(this.core.items.length===0){this.ui.showValidationModal("La orden est vaca.");return}this.ui.showConfirmationModal("Confirmar Orden","Desea completar la orden?",async()=>{const e={mesa:"General",orden_numero:`ORD-${Date.now().toString().slice(-6)}`,items:this.core.getItems(),total:this.core.getTotal(),subtotal:this.core.getTotal(),descuento:0,impuesto:0,status:"pendiente",timestamp:new Date().toISOString(),completedAt:new Date().toISOString()};try{const t={...e,id:this.logic.generateOrderId()},o=this.logic.saveOrderToStorage(t);let i=!1;if(this.productRepository&&typeof this.productRepository.saveOrder=="function")try{i=await this.productRepository.saveOrder(e)}catch(n){h.error("Cloud synchronization failed at repository level",n),i=!1}else h.warn("Cloud persistence unavailable: saveOrder method not found in repository");o?(h.info("Order processed successfully",{savedLocal:o,syncedCloud:i}),this.core.clearItems(),this.updateOrderDisplay(),this.toggleOrderMode(),i?this.ui.showValidationModal("Orden completada y sincronizada en la nube."):this.ui.showValidationModal("Orden guardada localmente (Pendiente de sincronizar cuando haya conexin).")):this.ui.showValidationModal("Error al guardar la orden localmente. Por favor, contacte a soporte.")}catch(t){h.error("OrderSystem.handleCompleteOrder: Critical Failure",{message:t.message,stack:t.stack,errorObject:t}),this.ui.showValidationModal(`Error crtico al procesar la orden: ${t.message||"Error desconocido"}`)}})}handleClearOrder(){if(console.log("[OrderSystem] handleClearOrder called"),console.log("[OrderSystem] Current Items:",this.core.items),this.core.items.length===0){console.log("[OrderSystem] Order empty, toggling mode"),this.isOrderMode&&this.toggleOrderMode();return}console.log("[OrderSystem] Showing cancellation confirmation modal"),this.ui.showConfirmationModal("Cancelar Orden","Est seguro de cancelar la orden actual?",()=>{this.core.clearItems(),this.updateOrderDisplay(),this.isOrderMode&&this.toggleOrderMode()})}handleOptionClick(e){e==="Ninguno"&&(this.logic.selectedDrinks=["Ninguno"],this.logic.drinkCounts={})}addProductToOrder(e){if(!this.isOrderMode){this.ui.showValidationModal("Para agregar productos, primero activa Crear orden.");return}this.core.addProduct(e),this.updateOrderDisplay(),st.trackAddToCart(e)}removeOrderItem(e){this.core.removeItem(e),this.updateOrderDisplay(),st.trackRemoveFromCart({id:e,context:{action:"manual_remove"}})}updateOrderDisplay(){this.ui.updateOrderDisplay(this.core.getItems())}toggleOrderMode(){this.isOrderMode=!this.isOrderMode,this.ui.toggleOrderModeUI(this.isOrderMode),this.isOrderMode||this.logic.resetSelectionState()}confirmProductWithCustomization(e){if(!this.logic.currentProduct){h.error("confirmProductWithCustomization: No current product selected");return}this.addProductToOrder({name:this._getFormattedProductName(),price:this.logic.currentProduct.price,category:this.logic.currentCategory,customizations:e}),h.info(`Product confirmed with customization: ${this.logic.currentProduct.name}`,e)}validateSelection(){return!0}showOrdersScreen(){h.info("Showing orders screen"),this.isShowingHistory=!1;const e=document.querySelector(".main-content-screen");this.previousCategory=e?.getAttribute("data-category")||"cocteles";const t=this.logic.getActiveOrders();this.ui.showOrdersScreen(t,!1)}async hideOrdersScreen(){await this.ui.hideOrdersScreen(),window.AppInit&&this.previousCategory&&(h.debug("Restoring previous category:",this.previousCategory),await window.AppInit.loadContent(this.previousCategory))}toggleOrderHistoryView(){this.isShowingHistory=!this.isShowingHistory;const e=this.isShowingHistory?this.logic.getOrderHistory():this.logic.getActiveOrders();this.ui.updateOrdersDisplay(e,this.isShowingHistory)}handleDeleteOrder(e){this.isShowingHistory?this.ui.showConfirmationModal("Eliminar del Historial","Esta accin eliminar la orden del historial y ya no se podr acceder.",()=>{if(this.logic.deleteOrderFromHistory(e)){const o=this.logic.getOrderHistory();this.ui.updateOrdersDisplay(o,!0)}}):this.ui.showConfirmationModal("Est seguro?","Esta accin mover la orden al historial.",()=>{if(this.logic.moveOrderToHistory(e)){const o=this.logic.getActiveOrders();this.ui.updateOrdersDisplay(o,!1)}})}handleClearHistory(){this.ui.showConfirmationModal("Limpiar Historial","Est seguro de eliminar todo el historial de rdenes?",()=>{this.logic.clearOrderHistory()&&this.ui.updateOrdersDisplay([],!0)})}getDrinkOptionsForProduct(e){return this.logic.getDrinkOptionsForProduct(e)}_getFormattedProductName(){if(!this.logic.currentProduct)return"";const e=this.logic.currentProduct.name,t=this.logic.currentProduct.priceType;return t===O.PRICE_TYPES.BOTTLE?`Botella ${e}`:t===O.PRICE_TYPES.LITER?`Litro ${e}`:t===O.PRICE_TYPES.CUP?`Copa ${e}`:e}_logTraceabilityReport(e,t){const o="background: #1a1a1a; color: #00ff00; padding: 5px; font-weight: bold; border-radius: 4px;",i="color: #00d2ff; font-weight: bold;",n="color: #ffffff;";console.group("%c  TRACEABILITY REPORT: Product Selection ",o);const s=this.logic.getAdaptiveOptions();console.log(`%c[UUID/ID]:      %c${e.producto_id||"NOT_FOUND"}`,i,n),console.log(`%c[Categora]:    %c${e.category||"NOT_FOUND"}`,i,n),console.log(`%c[Presentacin]: %c${e.priceType||"Standard"}`,i,n),console.log(`%c[Source]:       %c${s.options.includes("Ninguno")?"Schema Fallback":"Dynamic UI (Adaptive)"}`,i,s.options.includes("Ninguno")?n:"color: #ffde00; font-weight: bold;"),console.log(`%c[Logic Mode]:   %c${s.mode.toUpperCase()}`,i,n),console.dir({source_element:t,raw_dataset:t.dataset,resolved_product:e}),console.groupEnd()}get items(){return this.core.items}}if(typeof window<"u"){window.OrderSystem||(window.OrderSystem=new zi);const r=window.OrderSystem,e=()=>{h.info("[OrderSystem:Init] Container detected, finalizing initialization..."),r.initialize()};document.addEventListener("app-init-complete",()=>{e()}),document.readyState!=="loading"&&window.container&&r.initialize()}const nh=Object.freeze(Object.defineProperty({__proto__:null,default:zi},Symbol.toStringTag,{value:"Module"}));class $r{constructor(){this.services=new Map,this.singletons=new Map,this.resolving=new Set}register(e,t,o={}){if(typeof e!="string"||!e.trim())throw new Error("Service name must be a non-empty string");if(typeof t!="function")throw new Error("Factory must be a function");return this.services.set(e,{factory:t,singleton:o.singleton||!1,dependencies:o.dependencies||[]}),this}singleton(e,t,o=[]){return this.register(e,t,{singleton:!0,dependencies:o})}resolve(e){if(this.resolving.has(e))throw new Error(`Circular dependency detected: ${[...this.resolving,e].join(" -> ")}`);if(this.singletons.has(e))return this.singletons.get(e);const t=this.services.get(e);if(!t)throw new Error(`Service '${e}' not found. Available services: ${[...this.services.keys()].join(", ")}`);try{this.resolving.add(e);const o=t.dependencies.map(n=>this.resolve(n)),i=t.factory(...o);return t.singleton&&this.singletons.set(e,i),i}catch(o){throw new Error(`Failed to resolve '${e}': ${o.message}`)}finally{this.resolving.delete(e)}}has(e){return this.services.has(e)}clear(){this.services.clear(),this.singletons.clear(),this.resolving.clear()}getRegisteredServices(){return[...this.services.keys()]}validate(){const e=[],t=[...this.services.keys()];for(const o of t)try{const i=new $r;for(const[n,s]of this.services)i.services.set(n,s);i.resolve(o)}catch(i){e.push(`${o}: ${i.message}`)}return{success:e.length===0,errors:e}}}class Ku{constructor(e){this.adapter=e,this.syncInterval=null,this.isRunning=!1,this.lastSyncTime=null,this.syncRetries=new Map,h.debug("DataSyncService: Initialized")}startAutoSync(){if(this.isRunning){h.debug("DataSyncService: Auto-sync already running");return}this.isRunning=!0,this.syncInterval=setInterval(()=>{this.syncAllCategories()},fe.BACKGROUND_SYNC_INTERVAL),h.info(`DataSyncService: Auto-sync started (interval: ${fe.BACKGROUND_SYNC_INTERVAL}ms)`),setTimeout(()=>{this.syncAllCategories()},5e3)}stopAutoSync(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.isRunning=!1,h.info("DataSyncService: Auto-sync stopped")}async syncAllCategories(){if(!this.adapter){h.warn("DataSyncService: No adapter available for sync");return}const e=["cocteleria","refrescos","licores","cervezas","pizzas","alitas","sopas","ensaladas","cortes_de_carne","cafe","espumosos","postres","vodka","whisky","tequila","ron","brandy","cognac","digestivos","ginebra","mezcal"];h.debug(`DataSyncService: Starting sync for ${e.length} categories`),this.lastSyncTime=Date.now();const t=e.map(o=>this.syncCategory(o));try{await Promise.allSettled(t),h.info("DataSyncService: Background sync completed")}catch(o){h.error("DataSyncService: Error during sync",{error:o.message})}}async syncCategory(e){try{this.adapter._updateFromSupabaseBackground&&(await this.adapter._updateFromSupabaseBackground(e),this.syncRetries.delete(e))}catch(t){h.debug(`DataSyncService: Sync failed for ${e}`,{error:t.message}),this.scheduleRetry(e)}}scheduleRetry(e){const t=this.syncRetries.get(e)||0;t<fe.MAX_SYNC_RETRIES?(this.syncRetries.set(e,t+1),setTimeout(()=>{h.debug(`DataSyncService: Retrying sync for ${e} (attempt ${t+1})`),this.syncCategory(e)},fe.SYNC_RETRY_DELAY)):(h.warn(`DataSyncService: Max retries reached for ${e}`),this.syncRetries.delete(e))}async forceSyncNow(){h.info("DataSyncService: Force sync requested"),await this.syncAllCategories()}getSyncStatus(){return{isRunning:this.isRunning,lastSyncTime:this.lastSyncTime,interval:fe.BACKGROUND_SYNC_INTERVAL,autoUpdateEnabled:fe.AUTO_UPDATE_ENABLED,pendingRetries:Array.from(this.syncRetries.keys()),nextSyncIn:this.isRunning&&this.lastSyncTime?Math.max(0,this.lastSyncTime+fe.BACKGROUND_SYNC_INTERVAL-Date.now()):null}}destroy(){this.stopAutoSync(),this.syncRetries.clear(),this.adapter=null,h.debug("DataSyncService: Destroyed")}}const Wt={alitas:{select:"id,nombre,titulo,categoria,ingredientes,video,thumbnail,precio_10_piezas,precio_25_piezas",hasSaaS:!1},pizzas:{select:"id,nombre,titulo,categoria,ingredientes,video,thumbnail,precio",hasSaaS:!1},sopas:{select:"id,nombre,titulo,categoria,ingredientes,video,thumbnail,precio",hasSaaS:!1},ensaladas:{select:"id,nombre,titulo,categoria,ingredientes,video,thumbnail,precio",hasSaaS:!1},platos_fuertes:{select:"id,nombre,titulo,categoria,ingredientes,video,thumbnail,precio",hasSaaS:!1},cortes_de_carne:{select:"id,nombre,titulo,categoria,ingredientes,video,thumbnail,precio,opciones_personalizadas",hasSaaS:!1},postres:{select:"id,nombre,titulo,categoria,ingredientes,video,thumbnail,precio",hasSaaS:!1},snacks:{select:"id,nombre,titulo,categoria,ingredientes,video,thumbnail,precio",hasSaaS:!1},cafe:{select:"id,nombre,titulo,categoria,ingredientes,video,thumbnail,precio",hasSaaS:!1},cocteleria:{select:"id,nombre,titulo,categoria,ingredientes,video,thumbnail,precio",hasSaaS:!1},cervezas:{select:"id,nombre,titulo,categoria,precio,imagen",hasSaaS:!1},refrescos:{select:"id,nombre,titulo,categoria,precio,imagen",hasSaaS:!1},licores:{select:"id,nombre,titulo,categoria,imagen",hasSaaS:!1},whisky:{select:"id,nombre,titulo,categoria,imagen,precio_botella,precio_copa,precio_litro,mixers_botella,mixers_copa,mixers_litro",hasSaaS:!1},tequila:{select:"id,nombre,titulo,categoria,imagen,precio_botella,precio_copa,precio_litro,mixers_botella,mixers_copa,mixers_litro",hasSaaS:!1},ron:{select:"id,nombre,titulo,categoria,imagen,precio_botella,precio_copa,precio_litro,mixers_botella,mixers_copa,mixers_litro",hasSaaS:!1},brandy:{select:"id,nombre,titulo,categoria,imagen,precio_botella,precio_copa,precio_litro,mixers_botella,mixers_copa,mixers_litro",hasSaaS:!1},vodka:{select:"id,nombre,titulo,categoria,imagen,precio_botella,precio_copa,precio_litro,mixers_botella,mixers_copa,mixers_litro",hasSaaS:!1},ginebra:{select:"id,nombre,titulo,categoria,imagen,precio_botella,precio_copa,precio_litro,mixers_botella,mixers_copa,mixers_litro",hasSaaS:!1},mezcal:{select:"id,nombre,titulo,categoria,imagen,precio_botella,precio_copa,precio_litro,mixers_botella,mixers_copa,mixers_litro",hasSaaS:!1},cognac:{select:"id,nombre,titulo,categoria,imagen,precio_botella,precio_copa,precio_litro",hasSaaS:!1},digestivos:{select:"id,nombre,titulo,categoria,imagen,precio_botella,precio_copa,mixers_botella,mixers_copa",hasSaaS:!1},espumosos:{select:"id,nombre,titulo,categoria,imagen,precio_botella",hasSaaS:!1},menu_overrides:{select:"*",hasSaaS:!0}};class qi extends Di{constructor(){super(),this.productData=Iu,this.supabaseUrl=T.get("database.supabaseUrl"),this.supabaseKey=T.get("database.supabaseKey"),this.syncService=new Ku(this),this.syncService.startAutoSync(),this.restaurantId=null,this.overridesCache={}}setRestaurantContext(e){this.restaurantId!==e&&(this.restaurantId=e,this.overridesCache={},e?(h.info(`Contexto SaaS establecido: ${e}`),this._loadOverrides()):h.warn("Contexto SaaS limpiado (Desconectado/Invitado)."))}async _loadOverrides(){try{const{data:e,error:t}=await this._runSupabaseQuery("menu_overrides",o=>o.eq("restaurante_id",this.restaurantId));e?(this.overridesCache=e.reduce((o,i)=>(o[i.producto_id_generico]=i.cambios,o),{}),h.info(`Overrides cargados para ${this.restaurantId}: ${Object.keys(this.overridesCache).length} personalizaciones.`)):t&&h.warn("Error loading overrides:",t)}catch(e){h.warn("Exception loading overrides:",e)}}async getProductByIdV2(e,t=null){if(!this.productData)return h.warn("[ProductDataAdapter] getProductById: this.productData is null/undefined"),null;t&&(!this.productData[t]||Array.isArray(this.productData[t])&&this.productData[t].length===0)&&(h.info(`[ProductDataAdapter] Cache miss for category '${t}' during lookup. Fetching...`),await this._fetchFromSupabase(t));const o=t?[t,...Object.keys(this.productData).filter(i=>i!==t)]:Object.keys(this.productData);for(const i of o){const n=this.productData[i];if(Array.isArray(n)){const s=n.find(a=>String(a.id)===String(e));if(s){h.debug(`[ProductDataAdapter] Found product in category: ${i}`);let[a]=this._applyOverrides([s]);return a}}}return h.warn(`[ProductDataAdapter]  Product ID ${e} not found in any category.`),null}async _runSupabaseQuery(e,t=null){const{supabaseUrl:o,supabaseKey:i}=this,n=Wt[e]||{select:"*",hasSaaS:!1},s=n.select;let a=`${o}/rest/v1/${e}?select=${s}`;this.restaurantId&&n.hasSaaS&&(a+=`&${e==="menu_overrides"?"restaurante_id":"restaurant_id"}=eq.${this.restaurantId}`);try{let c=`Bearer ${this.supabaseKey}`;try{const{default:u}=await A(async()=>{const{default:g}=await import("./AuthService-BxOLs-0-.js");return{default:g}},[]),p=u.session;p?.access_token&&(c=`Bearer ${p.access_token}`)}catch{}const l=await fetch(a,{headers:{apikey:this.supabaseKey,Authorization:c}});if(!l.ok){const p=(await l.json()).message||`HTTP ${l.status}`;return h.error(`[ProductDataAdapter] Supabase Query Failed (${a}):`,p),{error:{message:p,code:l.status}}}return{data:await l.json()}}catch(c){return h.error("[ProductDataAdapter] Network Error:",c),{error:c}}}async _getGenericCategory(e,t=e,o=null){try{const i=await this._fetchFromSupabase(e);let n=i.length>0?i:this.productData[t]||[];return o&&n.length>0&&(n=n.map(s=>({...s,categoria:o}))),n}catch(i){return h.error(`Error in get${e.charAt(0).toUpperCase()+e.slice(1)}: `,i),this.productData[t]||[]}}async _fetchFromSupabase(e){(Wt[e]||{select:"*"}).select;let o=this.productData[e];if(!o||Array.isArray(o)&&o.length===0)try{const n=(await A(async()=>{const{default:s}=await Promise.resolve().then(()=>Jt);return{default:s}},void 0)).default.get(`supabase_${e}`);n&&Array.isArray(n)&&n.length>0&&(h.debug(`[Cache] Restored ${e} from local storage.`),this.productData[e]=n,o=n)}catch{}return!o||Array.isArray(o)&&o.length===0?(h.info(`No local data for '${e}', waiting for Supabase fetch...`),await this._updateFromSupabaseBackground(e),o=this.productData[e]||[]):this._updateFromSupabaseBackground(e),this._applyOverrides(o)}_applyOverrides(e){return!e||!Array.isArray(e)?[]:(Object.keys(this.overridesCache).length===0&&this._loadOverrides(),e.map(t=>{const o=this.overridesCache[t.id];return o?o.hidden?null:{...t,...o}:t}).filter(Boolean))}async saveProduct(e,t,o=null){const i=t._tableName||"products";let n=!1;try{const{default:a}=await A(async()=>{const{default:c}=await import("./AuthService-BxOLs-0-.js");return{default:c}},[]);n=a.isMasterAdmin()}catch{}const s=o&&o.restaurantId!==this.restaurantId&&!n;if(h.info(` Iniciando guardado (${s?"CLONACIN":"ACTUALIZACIN"}) en tabla: ${i} ${n?"(MAESTRO)":""}`),!n&&!this.restaurantId)throw new Error("Sesin de administrador requerida para guardar cambios.");try{const a={...t};delete a._tableName;const c=`${this.supabaseUrl}/rest/v1/${i}`;let l="POST",d={apikey:this.supabaseKey,"Content-Type":"application/json",Prefer:"resolution=merge-duplicates,return=representation"};try{const{default:g}=await A(async()=>{const{default:f}=await import("./AuthService-BxOLs-0-.js");return{default:f}},[]);g.session?.access_token&&(d.Authorization=`Bearer ${g.session.access_token}`)}catch{}a.restaurant_id=this.restaurantId,s?(delete a.id,h.info(` Clonando producto base para el restaurante ${this.restaurantId}`)):(a.id=e,h.info(" Actualizando producto personal del usuario."));const u=await fetch(c,{method:l,headers:d,body:JSON.stringify(a)});if(!u.ok){const g=await u.text();throw new Error(`Error en base de datos: ${g}`)}const[p]=await u.json();if(h.info(` Producto guardado con xito. Nuevo ID: ${p.id}`),this.productData[i]||(this.productData[i]=[]),s)this.productData[i].push(p);else{const g=this.productData[i].findIndex(f=>f.id===p.id);g!==-1&&(this.productData[i][g]=p)}try{const{EventBus:g,EVENTS:f}=await A(async()=>{const{EventBus:b,EVENTS:v}=await Promise.resolve().then(()=>$o);return{EventBus:b,EVENTS:v}},void 0);g.emit(f.PRODUCTS_UPDATED,{source:"ProductDataAdapter",reason:s?"forked":"updated",productId:p.id,originalId:e})}catch{}return p}catch(a){throw h.error(" Fall el guardado del producto:",a),a}}async deleteProduct(e,t){if(h.info(` Solicitando eliminacin de copia personalizada: ${e} en tabla ${t}`),!this.restaurantId)throw new Error("Sesin de administrador requerida para esta accin.");try{const o=`${this.supabaseUrl}/rest/v1/${t}?id=eq.${e}`;let i={apikey:this.supabaseKey,"Content-Type":"application/json"};try{const{default:s}=await A(async()=>{const{default:a}=await import("./AuthService-BxOLs-0-.js");return{default:a}},[]);s.session?.access_token&&(i.Authorization=`Bearer ${s.session.access_token}`)}catch{}if(!(await fetch(o,{method:"DELETE",headers:i})).ok)throw new Error("Error al eliminar el producto de la base de datos.");h.info(" Copia personalizada eliminada con xito."),this.productData[t]&&(this.productData[t]=this.productData[t].filter(s=>s.id!==e)),this.overridesCache[e]&&delete this.overridesCache[e];try{const{EventBus:s,EVENTS:a}=await A(async()=>{const{EventBus:c,EVENTS:l}=await Promise.resolve().then(()=>$o);return{EventBus:c,EVENTS:l}},void 0);s.emit(a.PRODUCTS_UPDATED,{source:"ProductDataAdapter",reason:"reset_to_base",productId:e})}catch{}return!0}catch(o){throw h.error(" Fall la eliminacin del producto:",o),o}}async saveOverride(e,t,o=null){return this.saveProduct(e,t,o)}async _updateFromSupabaseBackground(e,t=0,o=999){try{const n=(await A(async()=>{const{default:p}=await Promise.resolve().then(()=>Jt);return{default:p}},void 0)).default.getCacheInfo(`supabase_${e}`);if(n&&Date.now()-new Date(n.created).getTime()<3e5){h.debug(`[Sync] Skipping background update for ${e} (Fresh)`);return}const a=(Wt[e]||{select:"*",hasSaaS:!1}).select,c=`${this.supabaseUrl}/rest/v1/${e}?select=${a}`,l=await fetch(c,{method:"GET",headers:{apikey:this.supabaseKey,Authorization:`Bearer ${this.supabaseKey}`,"Content-Type":"application/json",Range:`${t}-${o}`}});if(l.status===404){h.debug(`Tabla '${e}' no encontrada en Supabase.Manteniendo datos locales.`);return}if(!l.ok)throw new Error(`HTTP error! status: ${l.status} `);const d=await l.json(),u=this._normalizeSupabaseData(d,e);u&&u.length>0&&(this.productData[e]=u,(await A(async()=>{const{default:g}=await Promise.resolve().then(()=>Jt);return{default:g}},void 0)).default.set(`supabase_${e} `,u,36e5))}catch(i){h.debug(`Background sync failed for ${e}: `,i.message)}}_normalizeSupabaseData(e,t){if(!e||!Array.isArray(e))return[];const o=e.map(i=>{const n=i.nombre||i.titulo||"Producto Sin Nombre",s=i.imagen||i.thumbnail||null;return{...i,nombre:String(n).trim(),imagen:s,categoria:i.categoria||t}});try{const i=Yu(o,t);return h.debug(`[ProductDataAdapter] Shielded ${i.length} items for ${t}`),i}catch(i){return h.error(`[ProductDataAdapter] Shielding failed for ${t}:`,i),o}}async getCocteles(){return this._getGenericCategory("cocteleria","cocteles","cocteleria")}async getRefrescos(){return this._getGenericCategory("refrescos","refrescos","refrescos")}async getLicores(){try{const[e,t,o,i,n,s,a,c,l,d]=await Promise.all([this._fetchFromSupabase("vodka"),this._fetchFromSupabase("whisky"),this._fetchFromSupabase("tequila"),this._fetchFromSupabase("ron"),this._fetchFromSupabase("brandy"),this._fetchFromSupabase("cognac"),this._fetchFromSupabase("digestivos"),this._fetchFromSupabase("ginebra"),this._fetchFromSupabase("mezcal"),this._fetchFromSupabase("licores")]),u=[...e,...t,...o,...i,...n,...s,...a,...c,...l,...d];return u.length>0&&(console.log("[ProductDataAdapter] Raw Liquor Data Sample:",u[0]),console.log("[ProductDataAdapter] Sample Keys:",Object.keys(u[0]))),u.length>0?u:this.productData.licores||[]}catch(e){return h.error("Error in getLicores:",e),this.productData.licores||[]}}async getCervezas(){return this._getGenericCategory("cervezas","cervezas","cervezas")}async getPizzas(){return this._getGenericCategory("pizzas","pizzas","pizzas")}async getAlitas(){return this._getGenericCategory("alitas","alitas","alitas")}async getSopas(){return this._getGenericCategory("sopas","sopas","sopas")}async getEnsaladas(){return this._getGenericCategory("ensaladas","ensaladas","ensaladas")}async getCarnes(){const e=await this._fetchFromSupabase("cortes_de_carne");return e&&e.length>0?e:this._getGenericCategory("carnes","carnes","carnes")}async getCortesDeCarne(){return this.getCarnes()}async getPlatosFuertes(){return(await this._getGenericCategory("platos_fuertes")).map(t=>this._mapPlatoFuerteItem(t))}_mapPlatoFuerteItem(e){return{...e,id:e.id,nombre:e.nombre,ingredientes:e.ingredientes,video:e.video,precio:e.precio,imagen:e.thumbnail||e.imagen,categoria:"platos fuertes"}}async getCafe(){return this._getGenericCategory("cafe","cafes","cafe")}async getEspumosos(){return this._getGenericCategory("espumosos","espumosos","espumosos")}async getPostres(){return this._getGenericCategory("postres","postres","postres")}getProductById(e){const t=["cocteles","refrescos","licores","cervezas","pizzas","alitas","sopas","ensaladas","carnes","cafes","postres"];for(const o of t){const n=(this.productData[o]||[]).find(s=>s.id===e);if(n)return n}return null}async getProductsByCategory(e){const t=e.toLowerCase(),o={cocteles:()=>this.getCocteles(),cocteleria:()=>this.getCocteles(),refrescos:()=>this.getRefrescos(),licores:()=>this.getLicores(),vodka:()=>this.getLiquorSubcategory("vodka"),vodkas:()=>this.getLiquorSubcategory("vodka"),whisky:()=>this.getLiquorSubcategory("whisky"),whiskies:()=>this.getLiquorSubcategory("whisky"),tequila:()=>this.getLiquorSubcategory("tequila"),tequilas:()=>this.getLiquorSubcategory("tequila"),ron:()=>this.getLiquorSubcategory("ron"),rones:()=>this.getLiquorSubcategory("ron"),brandy:()=>this.getLiquorSubcategory("brandy"),brandies:()=>this.getLiquorSubcategory("brandy"),cognac:()=>this.getLiquorSubcategory("cognac"),cognacs:()=>this.getLiquorSubcategory("cognac"),digestivos:()=>this.getLiquorSubcategory("digestivos"),ginebra:()=>this.getLiquorSubcategory("ginebra"),ginebras:()=>this.getLiquorSubcategory("ginebra"),mezcal:()=>this.getLiquorSubcategory("mezcal"),mezcales:()=>this.getLiquorSubcategory("mezcal"),cervezas:()=>this.getCervezas(),espumosos:()=>this.getLiquorSubcategory("espumosos"),pizzas:()=>this.getPizzas(),alitas:()=>this.getAlitas(),sopas:()=>this.getSopas(),ensaladas:()=>this.getEnsaladas(),carnes:()=>this.getCarnes(),cortes_de_carne:()=>this.getCarnes(),"platos-fuertes":()=>this.getPlatosFuertes(),cafe:()=>this.getCafe(),caf:()=>this.getCafe(),postres:()=>this.getPostres(),snacks:()=>this._getGenericCategory("snacks"),bebidas:()=>this._getGenericCategory("bebidas")};if(o[t])return await o[t]();try{const i=await this._fetchFromSupabase(t);return i.length>0?i:this.productData[t]||[]}catch(i){return h.error(`Error in getProductsByCategory for ${e}: `,i),[]}}async getSnacks(){return this._getGenericCategory("snacks","snacks","snacks")}searchProducts(e){if(!e||typeof e!="string")return[];const t=e.toLowerCase(),o=[],i=["cocteles","refrescos","licores","cervezas","pizzas","alitas","sopas","ensaladas","carnes","cafes","postres"];for(const n of i){const a=(this.productData[n]||[]).filter(c=>{const l=c.nombre&&c.nombre.toLowerCase().includes(t),d=c.ingredientes&&c.ingredientes.toLowerCase().includes(t);return l||d});o.push(...a)}return o}getAvailableCategories(){return this.getStandardCategories()}getTotalProductCount(){return this.getAvailableCategories().reduce((t,o)=>{const i=this.productData[o]||[];return t+i.length},0)}async getLicoresCategories(){return this._getGenericCategory("licores","licoresCategories")}async getLiquorSubcategory(e){return(await this._getGenericCategory(e)).map(o=>this._mapLiquorItem(o,e))}_mapLiquorItem(e,t){return{id:e.id,nombre:e.nombre,imagen:e.imagen,precioBotella:e.precioBotella||e.precio_botella,precioLitro:e.precioLitro||e.precio_litro,precioCopa:e.precioCopa||e.precio_copa,pais:e.pais,mixersBotella:e.mixersBotella||e.mixers_botella,mixersLitro:e.mixersLitro||e.mixers_litro,mixersCopa:e.mixersCopa||e.mixers_copa,categoria:t}}async forceSyncNow(){this.syncService&&await this.syncService.forceSyncNow()}getSyncStatus(){return this.syncService?this.syncService.getSyncStatus():{isRunning:!1,lastSyncTime:null,autoUpdateEnabled:!1}}startAutoSync(){this.syncService&&this.syncService.startAutoSync()}stopAutoSync(){this.syncService&&this.syncService.stopAutoSync()}async saveOrder(e){if(!e)return!1;try{if(!this._supabaseAdapterInstance){const t=await A(()=>Promise.resolve().then(()=>Ju),void 0),o=t.default||t;this._supabaseAdapterInstance=new o}return await this._supabaseAdapterInstance.saveOrder(e)}catch(t){return h.warn("ProductDataAdapter: Cloud save failed or Supabase not available.",t),!1}}}function Yu(r,e){return r}const Xu=Object.freeze(Object.defineProperty({__proto__:null,default:qi},Symbol.toStringTag,{value:"Module"}));class gr{static cache=new Map;static prefix="mtb_";static stats={hits:0,misses:0,sets:0,removes:0};static set(e,t,o=3e5){const i=Date.now()+o,n={data:t,expires:i,created:Date.now(),accessed:Date.now(),accessCount:0};this.cache.set(e,n),this.stats.sets++;try{localStorage.setItem(this.prefix+e,JSON.stringify(n))}catch(s){h.debug("SimpleCache: localStorage write failed",s)}}static get(e){let t=this.cache.get(e);if(!t)try{const o=localStorage.getItem(this.prefix+e);o&&(t=JSON.parse(o))}catch(o){h.debug("SimpleCache: localStorage read failed",o)}return!t||Date.now()>t.expires?(this.remove(e),this.stats.misses++,null):(t.accessed=Date.now(),t.accessCount=(t.accessCount||0)+1,this.cache.set(e,t),this.stats.hits++,t.data)}static remove(e){this.cache.delete(e),this.stats.removes++;try{localStorage.removeItem(this.prefix+e)}catch(t){h.debug("SimpleCache: localStorage remove failed",t)}}static clear(){this.cache.clear();try{Object.keys(localStorage).filter(e=>e.startsWith(this.prefix)).forEach(e=>localStorage.removeItem(e))}catch(e){h.debug("SimpleCache: localStorage clear failed",e)}this.stats={hits:0,misses:0,sets:0,removes:0}}static getStats(){const e=this.stats.hits+this.stats.misses;return{...this.stats,hitRate:e>0?(this.stats.hits/e*100).toFixed(2)+"%":"0%",cacheSize:this.cache.size,memoryKeys:Array.from(this.cache.keys())}}static getCacheInfo(e){const t=this.cache.get(e);return t?{key:e,created:new Date(t.created).toISOString(),accessed:new Date(t.accessed).toISOString(),expires:new Date(t.expires).toISOString(),accessCount:t.accessCount,timeToExpire:Math.max(0,t.expires-Date.now()),isExpired:Date.now()>t.expires}:null}static cleanExpired(){const e=Date.now();let t=0;for(const[o,i]of this.cache.entries())e>i.expires&&(this.remove(o),t++);return t}}const Jt=Object.freeze(Object.defineProperty({__proto__:null,default:gr},Symbol.toStringTag,{value:"Module"})),Ro=100,Qu={isInitialized:!1,initializationPromise:null,startTime:null,modules:new Map,isRecovering:!1,retryCount:0,maxRetries:3,isLoading:!1,async initialize(r={}){return this.isInitialized?(h.info("AppInit already initialized"),!0):this.initializationPromise?this.initializationPromise:(this.initializationPromise=this.performEnhancedInitialization(r),this.initializationPromise)},async performEnhancedInitialization(r){try{return this.startTime=performance.now(),h.info("Starting Enhanced Master Technology Bar Application..."),r.clearCache&&(gr.clear(),h.debug("AppInit: Cache cleared on startup")),window.AppInit=this,window.AppConfig=T,r.enableEnhancedFeatures!==!1&&await this.initializeEnhancedConfig(r.customConfig||{}),await this.initializeCoreSystem(),r.skipLegacyInit||await this.initializeLegacySystems(),r.enableEnhancedFeatures!==!1&&await this.initializeEnhancedModules(),await this.startApplication(),this.isInitialized=!0,this.logInitializationSuccess(),!0}catch(e){return ie.handle(e,"AppInit.enhancedInitialize"),this.handleInitializationError(e,r)}},async initializeEnhancedConfig(r){try{await T.waitForInitialSync(),T.validateConfiguration(),h.info("Enhanced configuration initialized and synced"),this.modules.set("appConfig",T)}catch(e){Et("Enhanced config initialization failed, using legacy config",e),this.initializeLegacyConfig()}},async initializeCoreSystem(){this.setupDIContainer(),h.info("Core systems initialized")},async initializeLegacySystems(){this.modules.has("appConfig")||this.initializeLegacyConfig(),h.info("Legacy systems initialized")},async initializeEnhancedModules(){try{this.setupEnhancedErrorHandling(),T.get("performance.enableMonitoring")&&this.setupPerformanceMonitoring(),h.info("Enhanced modules initialized")}catch(r){Et("Some enhanced modules failed to initialize",r)}},async startApplication(){const r=T.get("ui.initialDelay")||Ro;setTimeout(()=>{this.startWelcomeSequence(),this.initializeDrawerMenu(),this.initializeEnhancedUI()},r),h.info("Application started")},initializeLegacyConfig(){window.appConfig={validations:{ageCheck:{enabled:!1},stockEnabled:!1}},h.info("Legacy configuration initialized")},setupEnhancedErrorHandling(){window.addEventListener("error",r=>{G("Global error in AppInit context",{message:r.message,filename:r.filename,lineno:r.lineno,colno:r.colno,error:r.error})}),window.addEventListener("unhandledrejection",r=>{G("Unhandled promise rejection in AppInit context",r.reason),r.preventDefault()})},setupPerformanceMonitoring(){if("PerformanceObserver"in window)try{new PerformanceObserver(e=>{for(const t of e.getEntries())t.duration>50&&h.warn(`Long task in AppInit: ${t.duration.toFixed(2)}ms`)}).observe({entryTypes:["longtask"]})}catch(r){Et("Performance monitoring setup failed",r)}},initializeEnhancedUI(){const r=T.get("ui.theme")||"light-blue";document.documentElement.setAttribute("data-theme",r),T.get("ui.animations")&&document.documentElement.classList.add("animations-enabled"),document.documentElement.classList.add("js-enabled","enhanced-features"),document.documentElement.classList.remove("no-js"),h.info("Enhanced UI features initialized"),this.initializePropertyEditor(),A(()=>Promise.resolve().then(()=>Mu),void 0).then(e=>{e.default&&typeof e.default.initEventDelegation=="function"&&(e.default.initEventDelegation(),h.info(" Global Event Delegation Initialized via AppInit"))})},async initializePropertyEditor(){try{const{default:r}=await A(async()=>{const{default:e}=await import("./PropertyEditor-BRS94YcV.js");return{default:e}},__vite__mapDeps([4,3]));r.init(),h.info(" SaaS Property Editor Initialized (Lazy Loaded)")}catch(r){h.error("Failed to init PropertyEditor",r)}},async handleInitializationError(r,e){if(G("AppInit initialization failed, attempting recovery",r),this.isRecovering)return h.warn("Recovery already in progress, skipping duplicate attempt"),!1;this.isRecovering=!0;try{if(e.enableEnhancedFeatures!==!1){h.info("Attempting fallback initialization...");const t=await this.performEnhancedInitialization({...e,enableEnhancedFeatures:!1});return this.isRecovering=!1,t}return h.info("Attempting basic legacy initialization..."),this.basicLegacyInitialize(),this.isRecovering=!1,!0}catch(t){return G("All initialization attempts failed",t),this.isRecovering=!1,!1}},basicLegacyInitialize(){window.AppInit=this,this.setupDIContainer(),this.initializeLegacyConfig(),setTimeout(()=>{try{this.startWelcomeSequence(),this.initializeDrawerMenu()}catch(r){G("Basic initialization failed",r)}},Ro),this.isInitialized=!0,h.info("Basic legacy initialization completed")},logInitializationSuccess(){const e=performance.now()-this.startTime;h.info("Enhanced AppInit initialization completed successfully!",{totalTime:`${e.toFixed(2)}ms`,modules:Array.from(this.modules.keys()).length}),T.get&&T.get("ui.debugMode")&&(h.debug("Initialization modules",Array.from(this.modules.keys())),h.debug("SimpleCache stats",gr.getStats()));const t=new CustomEvent("app-init-complete",{bubbles:!0,composed:!0,detail:{totalTime:e,modules:Array.from(this.modules.keys()),timestamp:Date.now()}});document.dispatchEvent(t),h.debug("app-init-complete event dispatched")},getModule(r){return this.modules.get(r)||null},getStats(){return{isInitialized:this.isInitialized,initializationTime:this.startTime?performance.now()-this.startTime:0,modules:Array.from(this.modules.keys()),hasEnhancedConfig:this.modules.has("appConfig"),appConfigStats:this.modules.has("appConfig")?"Available":null}},startWelcomeSequence:function(){Po.startWelcomeSequence()},initializeDrawerMenu:function(){const r=document.getElementById("hamburger-btn"),e=document.getElementById("drawer-menu");if(!e||e.getAttribute("data-init")==="true")return;e.setAttribute("data-init","true");const t=document.getElementById("drawer-overlay"),o=e.querySelector(".drawer-content"),i=document.createElement("div");i.className="drawer-logo-container";const n=document.createElement("img"),s=T.resources?.logo;n.src=typeof s=="string"?s:s?.url||"",n.alt="Master Technology Bar Logo",n.className="drawer-logo",i.appendChild(n),o.appendChild(i);const a=l=>{if(l.logo){const p=typeof l.logo=="string"?l.logo:l.logo.url;n.src=p;const g=document.querySelector(".logo-screen .logo");g&&(g.src=p)}const d=document.querySelector(".logo-screen .logo-container");d&&l.logoSize&&(d.classList.remove("size-small","size-medium","size-large"),d.classList.add(`size-${l.logoSize}`));const u=document.querySelector(".logo-screen .title-text");if(u&&l.establishmentName){const p=l.establishmentName.value||"";p.trim()?(u.textContent=p,u.style.display=""):u.style.display="none"}};window.addEventListener("app:resources-ready",l=>a(l.detail)),window.addEventListener("app:interfaces-updated",()=>a(T.resources)),T.resources&&(T.resources.logo||T.resources.establishmentName)&&a(T.resources);const c=l=>{A(()=>import("./NavigationDrawer-C4NccJW3.js"),[]).then(d=>{d.default.renderDynamicMenu(l,u=>this.loadContent(u))})};T.interfaces&&T.interfaces.length>0&&c(T.interfaces),window.addEventListener("app:interfaces-ready",l=>{h.info("[AppInit] Refreshing Sidebar from dynamic interfaces"),c(l.detail)}),r.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),A(()=>import("./NavigationDrawer-C4NccJW3.js"),[]).then(d=>{d.default.toggle()}).catch(d=>{console.error("Failed to load NavigationDrawer",d)})}),t&&(t.style.display="none"),this.initializeNavigationDrawer(),this.initializeOrderDrawer(),this.initializeSettingsDrawer()},initializeNavigationDrawer:async function(){try{(await A(()=>import("./NavigationDrawer-C4NccJW3.js"),[])).default.init(),h.info("NavigationDrawer initialized within AppInit")}catch(r){h.error("Failed to initialize NavigationDrawer",r)}},initializeOrderDrawer:async function(){try{(await A(()=>import("./OrderDrawer-BWVmZfwH.js"),__vite__mapDeps([2,3]))).default.init(),h.info("OrderDrawer initialized within AppInit")}catch(r){h.error("Failed to initialize OrderDrawer",r)}},initializeSettingsDrawer:async function(){try{(await A(()=>import("./SettingsDrawer-BQVYxWAK.js"),[])).default.init(),h.info("SettingsDrawer initialized within AppInit")}catch(r){h.error("Failed to initialize SettingsDrawer",r)}},ensureMainScreenVisible:function(r){h.info(`[NAVIGATION DEBUG] ensureMainScreenVisible called with contentType: ${r}`),setTimeout(()=>{h.info("[NAVIGATION DEBUG] ensureMainScreenVisible timeout executed");const e=document.querySelector(".main-content-screen")||document.querySelector("[data-category]");if(h.info("[NAVIGATION DEBUG] ensureMainScreenVisible - element search:",{mainScreenFound:!!e,mainScreenClasses:e?.className,mainScreenDisplay:e?getComputedStyle(e).display:"N/A",mainScreenVisibility:e?getComputedStyle(e).visibility:"N/A"}),e){h.info("[NAVIGATION DEBUG] Attempting to make mainScreen visible");const t=e.className;e.classList.remove("screen-hidden"),e.classList.add("screen-visible");const o=e.className;h.info("[NAVIGATION DEBUG] Class changes:",{before:t,after:o,displayAfter:getComputedStyle(e).display,visibilityAfter:getComputedStyle(e).visibility}),h.info("[NAVIGATION DEBUG] Screen visibility fixed, but stopping here to avoid recursion"),this.isLoading=!1}else{h.error("[NAVIGATION DEBUG] MainScreen still not found in ensureMainScreenVisible");const t=document.querySelectorAll("*"),o=Array.from(t).filter(i=>i.className&&(i.className.includes("screen")||i.className.includes("content")));h.info("[NAVIGATION DEBUG] Available screen/content elements:",o.map(i=>({tag:i.tagName,id:i.id,classes:i.className,display:getComputedStyle(i).display}))),G("Cannot find main screen element to make visible")}},100)},loadContent:async function(r="home"){return h.info(`[AppInit] Delegating navigation to ScreenManager: ${r}`),Po.navigateTo(r)},setupDIContainer:function(){window.container=new $r,window.container.singleton("AppConfig",()=>T),window.container.singleton("ProductRepository",()=>{const r=new qi,e=T.get("database.establishmentId");return e&&r.setRestaurantContext(e),r}),window.container.singleton("CategoryManager",async()=>{const{CategoryManager:r}=await A(async()=>{const{CategoryManager:e}=await import("./CategoryManager-CEVIM8vP.js");return{CategoryManager:e}},[]);return new r}),h.info("DI Container initialized (simplified)")}};document.addEventListener("DOMContentLoaded",function(){Qu.initialize()});export{T as A,lt as D,h as L,Xu as P,Ju as S,He as T,A as _,me as a,z as b,K as c,Pu as d,Zt as e,Ao as f,ur as g,ju as i,Oo as n,nh as o,H as s};
